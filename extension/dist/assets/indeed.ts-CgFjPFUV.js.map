{"version":3,"file":"indeed.ts-CgFjPFUV.js","sources":["../../src/content/indeed.ts"],"sourcesContent":["/**\n * Indeed Content Script\n * \n * Injected on Indeed job pages to enable JD capture.\n * Similar to LinkedIn script but with Indeed-specific selectors.\n */\n\nimport type { JobMeta, ExtensionMessage } from '../background/messages';\n\n// Safe wrapper for messaging that handles extension context invalidation\nasync function safeMessage(message: ExtensionMessage): Promise<any> {\n    try {\n        if (!chrome.runtime?.id) {\n            console.warn('[RIYP] Extension context invalidated, please reload the page');\n            return { success: false, error: 'Extension reloaded - please refresh the page' };\n        }\n        return await chrome.runtime.sendMessage(message);\n    } catch (error: any) {\n        if (error?.message?.includes('Extension context invalidated')) {\n            console.warn('[RIYP] Extension context invalidated, please reload the page');\n            return { success: false, error: 'Extension reloaded - please refresh the page' };\n        }\n        throw error;\n    }\n}\n\n// Indeed-specific selectors\nconst JD_SELECTORS = [\n    '#jobDescriptionText',\n    '.jobsearch-jobDescriptionText',\n    '[data-testid=\"jobDescriptionText\"]',\n    '.job-description',\n];\n\nconst JOB_TITLE_SELECTORS = [\n    '.jobsearch-JobInfoHeader-title',\n    '[data-testid=\"jobTitle\"]',\n    'h1.jobTitle',\n    '.icl-u-xs-mb--xs',\n];\n\nconst COMPANY_SELECTORS = [\n    '[data-testid=\"inlineHeader-companyName\"]',\n    '.jobsearch-InlineCompanyRating-companyHeader',\n    '.icl-u-lg-mr--sm',\n    'a[data-tn-element=\"companyName\"]',\n];\n\nconst LOCATION_SELECTORS = [\n    '[data-testid=\"inlineHeader-companyLocation\"]',\n    '.jobsearch-JobInfoHeader-subtitle > div:nth-child(2)',\n    '.icl-u-xs-mt--xs .icl-Icon',\n];\n\n// State\nlet captureButton: HTMLElement | null = null;\nlet isCapturing = false;\n\n/**\n * Initialize content script\n */\nfunction init() {\n    console.log('[RIYP Indeed] Content script initialized on:', window.location.href);\n\n    // Wait for page to stabilize, then inject button\n    setTimeout(injectCaptureButton, 1500);\n\n    // Re-inject on dynamic navigation\n    observeNavigationChanges();\n}\n\n/**\n * Inject the floating capture button\n */\nfunction injectCaptureButton() {\n    if (captureButton) {\n        captureButton.remove();\n        captureButton = null;\n    }\n\n    // Check if we're on a job page\n    const jdElement = queryWithFallback(JD_SELECTORS);\n    if (!jdElement) {\n        console.log('[RIYP Indeed] No JD element found, skipping button injection');\n        return;\n    }\n\n    // Create button using Shadow DOM\n    const container = document.createElement('div');\n    container.id = 'riyp-capture-container';\n    container.style.cssText = `\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    z-index: 9999;\n  `;\n\n    const shadow = container.attachShadow({ mode: 'open' });\n    shadow.innerHTML = getCaptureButtonHTML();\n\n    const button = shadow.querySelector('.riyp-capture-btn');\n    if (button) {\n        button.addEventListener('click', handleCapture);\n    }\n\n    document.body.appendChild(container);\n    captureButton = container;\n\n    console.log('[RIYP Indeed] Capture button injected');\n}\n\nfunction getCaptureButtonHTML(): string {\n    return `\n    <style>\n      .riyp-capture-btn {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        padding: 12px 16px;\n        background: #0D9488;\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: all 150ms cubic-bezier(0.16, 1, 0.3, 1);\n      }\n      .riyp-capture-btn:hover {\n        background: #0F766E;\n        transform: translateY(-2px);\n      }\n      .riyp-capture-btn.loading { opacity: 0.8; pointer-events: none; }\n      .riyp-capture-btn.success { background: #166534; }\n      .riyp-capture-btn.error { background: #DC2626; }\n      .riyp-icon { width: 18px; height: 18px; }\n      .riyp-spinner {\n        width: 16px; height: 16px;\n        border: 2px solid rgba(255,255,255,0.3);\n        border-top-color: white;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      @keyframes spin { to { transform: rotate(360deg); } }\n    </style>\n    <button class=\"riyp-capture-btn\" title=\"Capture JD for RIYP\">\n      <svg class=\"riyp-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/>\n        <polyline points=\"14 2 14 8 20 8\"/>\n        <line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"12\"/>\n        <line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"/>\n      </svg>\n      <span class=\"riyp-text\">Capture JD</span>\n    </button>\n  `;\n}\n\nasync function handleCapture() {\n    if (isCapturing) return;\n\n    const button = captureButton?.shadowRoot?.querySelector('.riyp-capture-btn');\n    const textSpan = captureButton?.shadowRoot?.querySelector('.riyp-text');\n    const iconSvg = captureButton?.shadowRoot?.querySelector('.riyp-icon');\n\n    if (!button || !textSpan) return;\n\n    try {\n        isCapturing = true;\n        button.classList.add('loading');\n\n        if (iconSvg) iconSvg.outerHTML = '<div class=\"riyp-spinner\"></div>';\n        textSpan.textContent = 'Capturing...';\n\n        const jd = extractJobDescription();\n        const meta = extractJobMeta();\n\n        if (!jd) {\n            throw new Error('Could not extract job data');\n        }\n\n        const message: ExtensionMessage = {\n            type: 'CAPTURE_JD',\n            payload: { jd, meta },\n        };\n\n        const response = await safeMessage(message);\n\n        if (!response.success) {\n            throw new Error(response.error || 'Failed to save job');\n        }\n\n        button.classList.remove('loading');\n        button.classList.add('success');\n        textSpan.textContent = response.data.score ? `Matched: ${response.data.score}%` : 'Saved!';\n\n        setTimeout(() => {\n            button.classList.remove('success');\n            textSpan.textContent = 'Capture JD';\n            resetButtonIcon(button);\n            isCapturing = false;\n        }, 3000);\n\n    } catch (error) {\n        console.error('[RIYP Indeed] Capture error:', error);\n\n        button.classList.remove('loading');\n        button.classList.add('error');\n        textSpan.textContent = 'Error';\n\n        setTimeout(() => {\n            button.classList.remove('error');\n            textSpan.textContent = 'Capture JD';\n            isCapturing = false;\n        }, 2000);\n    }\n}\n\nfunction resetButtonIcon(button: Element) {\n    const spinner = button.querySelector('.riyp-spinner');\n    if (spinner) {\n        spinner.outerHTML = `\n      <svg class=\"riyp-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/>\n        <polyline points=\"14 2 14 8 20 8\"/>\n        <line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"12\"/>\n        <line x1=\"9\" y1=\"15\" x2=\"15\" y2=\"15\"/>\n      </svg>\n    `;\n    }\n}\n\nfunction queryWithFallback(selectors: string[]): Element | null {\n    for (const selector of selectors) {\n        const element = document.querySelector(selector);\n        if (element) return element;\n    }\n    return null;\n}\n\nfunction extractText(element: Element | null): string {\n    if (!element) return '';\n    return element.textContent?.trim().replace(/\\s+/g, ' ') ?? '';\n}\n\nfunction extractJobDescription(): string {\n    const element = queryWithFallback(JD_SELECTORS);\n    return extractText(element);\n}\n\nfunction extractJobMeta(): JobMeta {\n    // Extract job ID from URL\n    const urlMatch = window.location.search.match(/jk=([a-f0-9]+)/);\n    const jobId = urlMatch ? urlMatch[1] : `indeed-${Date.now()}`;\n\n    return {\n        id: jobId,\n        title: extractText(queryWithFallback(JOB_TITLE_SELECTORS)),\n        company: extractText(queryWithFallback(COMPANY_SELECTORS)),\n        location: extractText(queryWithFallback(LOCATION_SELECTORS)),\n        url: window.location.href,\n        capturedAt: Date.now(),\n    };\n}\n\nfunction observeNavigationChanges() {\n    let lastUrl = window.location.href;\n\n    const observer = new MutationObserver(() => {\n        if (window.location.href !== lastUrl) {\n            lastUrl = window.location.href;\n            console.log('[RIYP Indeed] URL changed, re-checking for job page');\n            setTimeout(injectCaptureButton, 1000);\n        }\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n    window.addEventListener('popstate', () => setTimeout(injectCaptureButton, 1000));\n}\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n} else {\n    init();\n}\n"],"names":[],"mappings":"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"}