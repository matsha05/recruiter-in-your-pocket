<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recruiter in Your Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Mixpanel Analytics (set MIXPANEL_TOKEN to enable) -->
  <script>
    // Mixpanel token - set this to enable analytics
    window.MIXPANEL_TOKEN = ""; // TODO: Add production Mixpanel token
    
    // Only load Mixpanel if token is set
    if (window.MIXPANEL_TOKEN) {
      (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
      mixpanel.init(window.MIXPANEL_TOKEN, { track_pageview: true, persistence: 'localStorage' });
    }
  </script>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&family=Manrope:wght@400;500;600&display=swap");

    :root {
      --bg-page: #FDFDFC;
      --bg-panel: #ffffff;
      --bg-card: #ffffff;
      --border-subtle: #d7dae3;
      --border-strong: #c6cbd6;
      --accent: #3341A6;
      --accent-dark: #26328C;
      --accent-soft: color-mix(in srgb, var(--accent) 24%, #ffffff);
      --accent-wash: #EEF0FA;
      --accent-boost: #3341A6;
      --accent-strong: #1E2A78;
      --text-main: var(--ink-900);
      --text-soft: var(--slate-700);
      --text-muted: var(--slate-500);
      --ink-900: #0F172A;
      --slate-700: #334155;
      --slate-500: #64748B;
      --wash: #FAF9F6;
      --surface-tint: #F3F4F6;
      --success: #15803d;
      --success-dark: #047857;
      --success-light: #22c55e;
      --error: #b91c1c;
      --error-light: #fca5a5;
      --error-dark: #7f1d1d;
      --error-bg: rgba(185, 28, 28, 0.08);
      --warning: #d97706;
      --warning-dark: #92400e;
      --font-display: "Plus Jakarta Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-body: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --fs-hero: 52px;
      --fs-h1: 26px;
      --fs-h2: 21px;
      --fs-h3: 17px;
      --fs-body: 15px;
      --fs-small: 13px;
      --fs-xs: 12px;
      --fs-tiny: 11px;
      --fs-label: 14px;
      --fs-base: 16px;
      --fs-lg: 18px;
      --fs-xl: 20px;
      --fs-2xl: 22px;
      --fs-3xl: 32px;
      --fs-dial: 36px;
      --lh-very-tight: 1.1;
      --lh-tight: 1.15;
      --lh-snug: 1.2;
      --lh-cozy: 1.25;
      --lh-medium: 1.4;
      --lh-normal: 1.5;
      --lh-custom: 1.55;
      --lh-relaxed: 1.6;
      --lh-loose: 1.65;
      --lh-extra-loose: 1.7;
      --space-micro: 2px;
      --space-xxs: 4px;
      --space-xs: 6px;
      --space-tight: 8px;
      --space-sm: 10px;
      --space-sm-alt: 12px;
      --space-md: 15px;
      --space-md-alt: 16px;
      --space-md-lg: 18px;
      --space-lg: 20px;
      --space-lg-alt: 22px;
      --space-xl: 30px;
      --space-xl-alt: 24px;
      --space-2xl: 40px;
      --space-3xl: 32px;
      --space-xxl: 50px;
      --motion-duration-short: 200ms;
      --motion-duration-medium: 300ms;
      --motion-ease-premium: cubic-bezier(0.16, 1, 0.3, 1);
      --radius-xs: 6px;
      --radius-sm: 8px;
      --radius-md: 10px;
      --radius-input: 12px;
      --radius-lg: 14px;
      --radius-xl: 16px;
      --radius-card: 18px;
      --radius-2xl: 20px;
      --radius-3xl: 22px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 30px rgba(15, 23, 42, 0.06);
      --accent-width: 2px;
      --accent-width-strong: 6px;
      --stack-gap: 16px;
      --focus-outline-color: #A5B4FC;
      --focus-outline-width: 2px;
      --focus-outline-offset: 3px;
      --focus-shadow: 0 0 0 2px rgba(28, 78, 216, 0.16);
      --icon-size-sm: 8px;
      --space-tight-alt: 9px;
      --icon-size-md: 16px;
      --shadow-card: 0 10px 24px rgba(15, 23, 42, 0.08);
      --shadow-button: 0 4px 14px rgba(28, 78, 216, 0.25);
      --shadow-button-hover: 0 6px 18px rgba(23, 60, 169, 0.27);
      --shadow-modal: 0 18px 45px rgba(15, 23, 42, 0.12);
      --shadow-hero: 0 16px 32px rgba(15, 23, 42, 0.08);
    }

    /* Dark mode color overrides */
    [data-theme="dark"] {
      --bg-page: #0F1115;
      --bg-panel: #1A1C20;
      --bg-card: #25272D;
      --border-subtle: #2D3038;
      --border-strong: #3A3D45;
      --accent: #5B6FD8;
      --accent-dark: #4A5BC4;
      --accent-soft: color-mix(in srgb, var(--accent) 36%, #1A1C20);
      --accent-wash: rgba(91, 111, 216, 0.12);
      --accent-boost: #6B7FE8;
      --accent-strong: #4A5BC4;
      --text-main: #F5F6F8;
      --text-soft: #D1D5DB;
      --text-muted: #9CA3AF;
      --ink-900: #F5F6F8;
      --slate-700: #D1D5DB;
      --slate-500: #9CA3AF;
      --wash: #1E2025;
      --surface-tint: #25272D;
      --success: #22c55e;
      --success-dark: #16a34a;
      --success-light: #4ade80;
      --error: #ef4444;
      --error-light: #fca5a5;
      --error-dark: #dc2626;
      --error-bg: rgba(239, 68, 68, 0.12);
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --shadow-soft: 0 18px 30px rgba(0, 0, 0, 0.3);
      --focus-outline-color: #6B7FE8;
      --focus-shadow: 0 0 0 2px rgba(107, 127, 232, 0.25);
      --shadow-card: 0 10px 24px rgba(0, 0, 0, 0.25);
      --shadow-button: 0 4px 14px rgba(91, 111, 216, 0.35);
      --shadow-button-hover: 0 6px 18px rgba(91, 111, 216, 0.4);
      --shadow-modal: 0 18px 45px rgba(0, 0, 0, 0.4);
      --shadow-hero: 0 16px 32px rgba(0, 0, 0, 0.3);
    }

    /* Dark mode specific overrides for gradients and rgba values */
    [data-theme="dark"] .page {
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    [data-theme="dark"] .status-dot {
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.2);
    }

    [data-theme="dark"] .hero::before {
      background: radial-gradient(circle at 20% 20%, rgba(91, 111, 216, 0.08), transparent 30%),
                  radial-gradient(circle at 80% 10%, rgba(107, 127, 232, 0.06), transparent 26%);
    }

    [data-theme="dark"] .hero::after {
      background: linear-gradient(180deg, 
        rgba(91, 111, 216, 0.12) 0%, 
        rgba(91, 111, 216, 0.08) 50%,
        transparent 100%);
    }

    [data-theme="dark"] .card-input {
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: linear-gradient(165deg, #25272D 0%, #1E2025 100%);
    }

    [data-theme="dark"] .card-input:hover {
      box-shadow: 0 24px 55px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] .run-row::before {
      background: radial-gradient(circle at 50% 30%, rgba(91, 111, 216, 0.1), transparent 55%);
    }

    [data-theme="dark"] .btn-primary:disabled {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .btn-primary:disabled:hover {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .btn-secondary {
      border: 1px solid rgba(91, 111, 216, 0.5);
      box-shadow: 0 4px 10px rgba(91, 111, 216, 0.2);
    }

    [data-theme="dark"] .paywall-backdrop {
      background: rgba(0, 0, 0, 0.6);
    }

    [data-theme="dark"] .paywall-card {
      box-shadow: 0 22px 48px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] .score-tooltip.open {
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] textarea {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) inset;
    }

    [data-theme="dark"] .card-input:hover {
      box-shadow: 0 24px 55px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] .card-output {
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] #loading-bar.active {
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] #results-body {
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    [data-theme="dark"] .results-summary {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .proof-editorial {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    [data-theme="dark"] .accent-card-primary {
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.3);
    }

    @media (max-width: 768px) {
      [data-theme="dark"] .results-top {
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.3);
      }
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: var(--font-body);
    }

    /* Base type: Manrope 15px / 1.7 for body text */
    body {
      min-height: 100vh;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: var(--space-2xl) var(--space-lg) 42px;
      font-size: var(--fs-body);
      line-height: var(--lh-normal);
    }

    .page {
      width: 100%;
      max-width: 1200px;
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.06);
      background: var(--bg-panel);
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(15, 23, 42, 0.02);
      padding: var(--space-2xl);
      position: relative;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .page {
        padding: var(--space-md-alt) var(--space-md-alt) var(--space-lg-alt) var(--space-md-alt);
        border-radius: var(--radius-3xl);
      }
      .tool-layout {
        gap: var(--space-md-lg);
      }
      .card {
        padding: var(--space-md-lg);
      }
      .hero {
        margin-bottom: var(--space-md-alt);
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-sm);
      }
      .hero-title {
        font-size: var(--fs-h1);
      }
      .hero-subtitle {
        font-size: var(--fs-label);
        line-height: var(--lh-custom);
      }
      .proof-editorial {
        margin-top: var(--space-xl-alt);
        margin-bottom: var(--space-xl-alt);
        padding: var(--space-md-alt) var(--space-md-lg);
      }
      .proof-editorial-heading {
        font-size: var(--fs-label);
        margin-bottom: var(--space-sm-alt);
      }
      .proof-editorial-quote {
        font-size: var(--fs-xs);
        margin-bottom: var(--space-sm);
      }
    }

    /* Top bar */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md-alt);
      gap: var(--space-sm-alt);
      padding: var(--space-xxs) 0 var(--space-md-alt);
    }

    .brand {
      display: inline-flex;
      align-items: baseline;
      gap: var(--space-sm);
    }

    .brand-wordmark {
      font-family: var(--font-display);
      font-size: var(--fs-lg);
      letter-spacing: -0.03em;
      font-weight: 800;
      color: var(--text-main);
      text-transform: none;
      line-height: var(--lh-very-tight);
    }

    .version-pill {
      display: inline-flex;
      align-items: center;
      gap: var(--space-tight);
      padding: var(--space-xxs) var(--space-sm);
      border-radius: var(--radius-xs);
      border: 1px solid var(--border-subtle);
      background: var(--bg-panel);
      font-size: var(--fs-xs);
      color: var(--text-muted);
      letter-spacing: 0.01em;
      text-transform: none;
      box-shadow: none;
    }

    .trust-inline {
      margin-top: var(--space-sm);
      font-size: var(--fs-xs);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: var(--space-tight);
    }

    .trust-inline button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      cursor: pointer;
      font-size: var(--fs-xs);
      padding: 0;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .trust-inline button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .status-dot {
      width: var(--icon-size-sm);
      height: var(--icon-size-sm);
      border-radius: var(--radius-pill);
      background: var(--success);
      box-shadow: 0 0 0 5px rgba(21, 128, 61, 0.12);
    }

    .theme-toggle {
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: var(--fs-lg);
      cursor: pointer;
      padding: var(--space-xxs) var(--space-sm);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      transition: color var(--motion-duration-short) var(--motion-ease-premium), background var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      line-height: 1;
      min-width: 32px;
      min-height: 32px;
    }

    .theme-toggle:hover {
      color: var(--accent);
      background: var(--accent-wash);
    }

    .theme-toggle:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .theme-toggle-icon {
      display: inline-block;
      transition: transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    [data-theme="dark"] .theme-toggle-icon {
      transform: rotate(180deg);
    }

    @media (max-width: 600px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .theme-toggle {
        margin-top: var(--space-xs);
      }
    }

    /* Hero */

    .hero {
      position: relative;
      margin: 0 auto var(--space-xl);
      padding: var(--space-xl) var(--space-2xl);
      max-width: 1100px;
      border-radius: var(--radius-card);
      background: var(--wash);
      box-shadow: var(--shadow-hero);
      overflow: hidden;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -8% -12%;
      background: radial-gradient(circle at 20% 20%, rgba(30, 42, 120, 0.10), transparent 30%),
                  radial-gradient(circle at 80% 10%, rgba(15, 23, 42, 0.10), transparent 26%);
      pointer-events: none;
    }

    .hero::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: var(--space-xl);
      background: linear-gradient(180deg, 
        rgba(51, 65, 166, 0.15) 0%, 
        rgba(51, 65, 166, 0.10) 50%,
        transparent 100%);
      border-radius: var(--radius-pill);
      pointer-events: none;
      opacity: 0.7;
    }

    .hero > * {
      position: relative;
      z-index: 1;
    }

    .hero-title {
      font-family: var(--font-display);
      font-size: var(--fs-hero);
      letter-spacing: -0.02em;
      color: var(--ink-900);
      font-weight: 700;
      line-height: var(--lh-tight);
      margin-bottom: var(--space-md);
      max-width: 820px;
    }

    .hero-subtitle {
      font-size: var(--fs-body);
      color: var(--text-soft);
      max-width: 640px;
      line-height: var(--lh-normal);
      margin-bottom: var(--space-sm);
    }

    .hero-credibility {
      font-size: var(--fs-small);
      color: var(--text-muted);
      max-width: 640px;
      line-height: var(--lh-normal);
      margin-bottom: var(--space-lg);
      font-style: italic;
      opacity: 0.9;
    }

    .process-track {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: var(--space-lg);
      margin-top: var(--space-xl);
      margin-bottom: var(--space-lg);
      padding: 0 var(--space-sm);
    }

    .process-line {
      position: absolute;
      top: 16px;
      left: var(--space-xl);
      right: var(--space-xl);
      height: 2px;
      background: var(--border-subtle);
      z-index: 0;
    }

    /* Gradient line for premium feel */
    .process-line::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        var(--accent-wash) 20%, 
        var(--accent-wash) 80%, 
        transparent 100%);
    }

    .process-step {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: var(--space-sm);
    }

    .process-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--bg-main);
      border: 2px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: var(--fs-small);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 4px var(--bg-main); /* Mask the line */
      transition: all 0.3s var(--motion-ease-premium);
    }

    .process-step:hover .process-icon {
      border-color: var(--accent);
      color: var(--accent);
      transform: scale(1.1);
      box-shadow: 0 0 0 6px var(--bg-main);
    }

    .process-label {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-snug);
      max-width: 180px;
      font-weight: 500;
    }

    @media (max-width: 600px) {
      .process-track {
        grid-template-columns: 1fr;
        gap: var(--space-md);
        padding-left: var(--space-lg);
      }

      .process-line {
        top: 0;
        bottom: 0;
        left: 15px; /* Align with icon center */
        right: auto;
        width: 2px;
        height: auto;
        background: linear-gradient(180deg, 
          transparent 0%, 
          var(--border-subtle) 15%, 
          var(--border-subtle) 85%, 
          transparent 100%);
      }

      .process-line::after {
        display: none;
      }

      .process-step {
        flex-direction: row;
        text-align: left;
        align-items: flex-start;
      }

      .process-icon {
        flex-shrink: 0;
        /* On mobile, box-shadow masking is trickier with a vertical line if background isn't solid, 
           but bg-main is solid so it works. */
      }
    }

    .hero-promise {
      margin-top: var(--space-lg);
      font-size: var(--fs-body);
      color: var(--slate-700);
      line-height: var(--lh-loose);
      max-width: 720px;
    }

    .hero-promise strong {
      color: var(--ink-900);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .hero-promise ul {
      list-style: disc;
      padding-left: var(--space-md-lg);
      margin-top: var(--space-xxs);
      display: grid;
      gap: var(--space-xxs);
    }

    /* Two-column hero layout */
    .hero-grid-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2xl);
      align-items: start;
    }

    .hero-content {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .hero-preview {
      position: relative;
    }

    .hero-preview-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-card);
      padding: var(--space-lg);
      box-shadow: var(--shadow-card);
      position: relative;
      overflow: hidden;
      transition: box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .hero-preview-card:hover {
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12);
      transform: translateY(-3px);
    }

    /* Staggered entrance animation for hero preview */
    .hero-preview-card {
      opacity: 0;
      animation: heroCardEntrance 0.6s var(--motion-ease-premium) 0.2s forwards;
    }

    @keyframes heroCardEntrance {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hero-preview-badge {
      opacity: 0;
      animation: heroElementFade 0.4s ease-out 0.4s forwards;
    }

    .hero-preview-verdict {
      opacity: 0;
      animation: heroElementFade 0.4s ease-out 0.8s forwards;
    }

    .hero-preview-section {
      opacity: 0;
      animation: heroElementFade 0.4s ease-out 1.1s forwards;
    }

    @keyframes heroElementFade {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (prefers-reduced-motion: reduce) {
      .hero-preview-card,
      .hero-preview-badge,
      .hero-preview-verdict,
      .hero-preview-section {
        opacity: 1;
        animation: none;
        transform: none;
      }
    }

    .hero-preview-card::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      border-radius: var(--radius-card) 0 0 var(--radius-card);
    }

    .hero-preview-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      padding: var(--space-xxs) var(--space-sm);
      background: var(--accent-wash);
      color: var(--accent);
      font-size: var(--fs-tiny);
      font-weight: 600;
      border-radius: var(--radius-pill);
      margin-bottom: var(--space-md);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .hero-preview-score {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .hero-preview-dial {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: conic-gradient(var(--accent) 0deg 0deg, var(--border-subtle) 0deg 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      flex-shrink: 0;
      /* JS handles the conic-gradient animation; see animateHeroDialNumber() */
    }

    @media (prefers-reduced-motion: reduce) {
      .hero-preview-dial {
        background: conic-gradient(var(--accent) 0deg 309deg, var(--border-subtle) 309deg 360deg);
      }
    }

    .hero-preview-dial::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      background: var(--bg-card);
    }

    .hero-preview-dial-number {
      position: relative;
      font-family: var(--font-display);
      font-size: var(--fs-xl);
      font-weight: 800;
      color: var(--accent);
    }

    .hero-preview-score-text {
      flex: 1;
    }

    .hero-preview-score-label {
      font-size: var(--fs-tiny);
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: var(--space-xxs);
    }

    .hero-preview-score-band {
      font-family: var(--font-display);
      font-size: var(--fs-lg);
      font-weight: 700;
      color: var(--ink-900);
    }

    .hero-preview-verdict {
      font-size: var(--fs-label);
      color: var(--text-main);
      line-height: var(--lh-relaxed);
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--border-subtle);
    }

    .hero-preview-section {
      margin-bottom: var(--space-sm);
    }

    .hero-preview-section-title {
      font-size: var(--fs-tiny);
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: var(--space-xs);
    }

    .hero-preview-item {
      font-size: var(--fs-small);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      padding-left: var(--space-md);
      position: relative;
      margin-bottom: var(--space-xxs);
    }

    .hero-preview-item::before {
      content: "•";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 700;
    }

    .hero-preview-fade {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(transparent, var(--bg-card));
      pointer-events: none;
    }

    .hero-cta-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .hero-cta-note {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      line-height: var(--lh-normal);
    }

    .hero-cta-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: var(--space-md) var(--space-xl);
      background: var(--accent);
      color: white;
      font-size: var(--fs-base);
      font-weight: 600;
      border: none;
      border-radius: var(--radius-input);
      cursor: pointer;
      box-shadow: var(--shadow-button);
      transition: background var(--motion-duration-short) var(--motion-ease-premium),
                  transform var(--motion-duration-short) var(--motion-ease-premium),
                  box-shadow var(--motion-duration-short) var(--motion-ease-premium),
                  filter var(--motion-duration-short) var(--motion-ease-premium);
      text-decoration: none;
      width: fit-content;
    }

    .hero-cta-primary:hover {
      background: color-mix(in srgb, var(--accent) 85%, white 15%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-button-hover), 0 0 0 6px color-mix(in srgb, var(--accent-wash) 60%, transparent);
      filter: drop-shadow(0 10px 28px rgba(28, 78, 216, 0.18));
    }

    .hero-cta-primary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .hero-cta-secondary {
      font-size: var(--fs-small);
      color: var(--accent-boost);
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: none;
      font-weight: 500;
      padding: var(--space-xxs) 0;
      transition: color var(--motion-duration-short) var(--motion-ease-premium);
      width: fit-content;
      position: relative;
    }

    .hero-cta-secondary::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 1px;
      background: currentColor;
      transform: scaleX(0);
      transform-origin: left;
      transition: transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .hero-cta-secondary:hover {
      color: var(--accent-strong);
    }

    .hero-cta-secondary:hover::after {
      transform: scaleX(1);
    }

    .hero-cta-secondary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      border-radius: var(--radius-xs);
    }

    @media (max-width: 900px) {
      .hero-grid-layout {
        grid-template-columns: 1fr;
        gap: var(--space-xl);
      }

      .hero-preview {
        order: -1;
      }

      .hero-preview-card {
        max-height: 280px;
        overflow: hidden;
      }
    }

    /* Value strip */
    .value-strip {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-md);
      margin: 0 auto var(--space-2xl);
      max-width: 1100px;
      padding: 0 var(--space-md);
    }

    .value-item {
      text-align: center;
      padding: var(--space-md);
    }

    .value-icon {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      stroke-width: 1.5;
      fill: none;
      display: inline-block;
      flex-shrink: 0;
      margin-bottom: var(--space-xs);
      transition: transform var(--motion-duration-short) var(--motion-ease-premium), color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .value-item:hover .value-icon {
      transform: translateY(-1px);
    }

    .value-title {
      font-family: var(--font-display);
      font-size: var(--fs-label);
      font-weight: 700;
      color: var(--ink-900);
      margin-bottom: var(--space-xxs);
      letter-spacing: -0.01em;
    }

    .value-desc {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
    }

    @media (max-width: 768px) {
      .value-strip {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-sm);
      }
    }

    @media (max-width: 480px) {
      .value-strip {
        grid-template-columns: 1fr;
      }
    }

    /* Social proof */
    .proof {
      margin-top: var(--space-md-lg);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-sm-alt);
    }

    .proof-card {
      background: color-mix(in srgb, var(--bg-panel) 82%, transparent);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-sm-alt) var(--space-md-alt);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .proof-quote {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
    }

    .proof-name {
      font-size: var(--fs-tiny);
      color: var(--text-muted);
      letter-spacing: 0.01em;
    }

    .proof-editorial {
      margin-top: 0;
      margin-bottom: var(--space-2xl);
      padding: var(--space-lg) var(--space-xl-alt);
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-input);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.04);
    }

    .proof-editorial-heading {
      font-size: var(--fs-body);
      font-weight: 700;
      color: var(--ink-900);
      margin-bottom: var(--space-md-lg);
      letter-spacing: -0.01em;
    }

    .proof-editorial-quote {
      font-size: var(--fs-small);
      color: var(--text-main);
      line-height: var(--lh-loose);
      margin-bottom: var(--space-sm-alt);
    }

    .proof-editorial-quote:last-child {
      margin-bottom: 0;
    }

    .future-ribbon {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-sm-alt);
      flex-wrap: wrap;
    }

    .future-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      padding: var(--space-xxs) var(--space-sm);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
      font-size: var(--fs-tiny);
      letter-spacing: 0.01em;
    }

    .future-chip.warm {
      border-color: var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      :root {
        /* --fs-hero: 43px;  Removed: handled by specific overrides */
        --fs-h1: 24px;
        --fs-h2: 20px;
      }
      .hero {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-lg);
        margin-bottom: var(--space-md-lg);
      }
      .hero-title {
        font-size: var(--fs-3xl);
      }
      .hero-subtitle {
        font-size: var(--fs-label);
      }
      .hero-credibility {
        font-size: var(--fs-xs);
        margin-bottom: var(--space-md-lg);
      }
      .hero-grid {
        gap: var(--space-tight) var(--space-sm-alt);
      }
      .stack-heading {
        font-size: var(--fs-2xl);
        margin-bottom: var(--space-sm);
      }
      .stack-subline {
        font-size: var(--fs-small);
        margin-bottom: var(--space-md-alt);
      }
      .stack-section {
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        margin-bottom: var(--space-xl-alt);
      }
      .results-summary {
        padding: var(--space-md-alt) var(--space-md-lg);
        margin-bottom: var(--space-lg);
      }
      .tool-layout {
        gap: var(--space-md-alt);
        grid-template-columns: 1fr;
      }
      .card {
        padding: var(--space-md-alt);
      }
      .results-top {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-lg);
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.1);
      }
      .ideas-sheet {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-alt) var(--space-lg);
      }
      .ideas-sheet::before {
        left: var(--space-md-lg);
        top: var(--space-md-lg);
        bottom: var(--space-md-alt);
      }
      .ideas-sheet-header {
        margin-bottom: var(--space-md-lg);
        gap: var(--space-sm-alt);
      }
      .ideas-sheet-title {
        font-size: var(--fs-xl);
        margin-bottom: var(--space-xxs);
      }
      .ideas-sheet-subtitle {
        font-size: var(--fs-small);
      }
      .ideas-actions .ghost-button {
        font-size: var(--fs-tiny);
        padding: var(--space-xs) var(--space-tight-alt);
      }
    }

    /* Main tool area */

    .tool-layout {
      position: relative;
      margin-top: var(--space-xl);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2xl);
      align-items: start;
    }

    .tool-layout::before {
      content: "";
      position: absolute;
      top: calc(var(--space-xl) * -1);
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: var(--space-xl);
      background: linear-gradient(180deg, 
        rgba(51, 65, 166, 0.12) 0%, 
        rgba(51, 65, 166, 0.08) 50%,
        transparent 100%);
      border-radius: var(--radius-pill);
      pointer-events: none;
      opacity: 0.6;
    }

    .tool-layout.input-full-width {
      grid-template-columns: 1fr;
    }

    /* Ensure columns are balanced and feel like distinct workspaces */
    .card-input {
      min-height: 400px;
    }

    /* Make report wrapper feel like a distinct report panel */
    .report-wrapper {
      position: relative;
    }

    @media (max-width: 1024px) {
      .tool-layout {
        grid-template-columns: 1fr;
        gap: var(--space-xxl);
      }
      
      .card-input {
        min-height: auto;
      }
    }

    .card {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.07);
      padding: var(--space-2xl);
      box-shadow: var(--shadow-soft);
      overflow: visible;
      transition: box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .card::before {
      display: none;
    }

    .card-output {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      padding: var(--space-lg) var(--space-lg) var(--space-xl-alt);
      overflow: hidden;
    }

    .card-output::before {
      content: "";
      position: absolute;
      left: var(--space-lg);
      top: var(--space-lg);
      bottom: var(--space-lg);
      width: 3px;
      border-radius: var(--radius-sm);
      background: var(--accent);
      opacity: 0.3;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
    }

    .card-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
      line-height: var(--lh-cozy);
    }

    .card-input .card-title {
      font-size: var(--fs-h1);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: var(--space-xxs);
    }

    .card-subtitle {
      font-size: var(--fs-small);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      margin-bottom: var(--space-xs);
    }

    .card-helper-note {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-normal);
      margin-bottom: var(--space-md);
    }

    /* Short-resume confirmation dialog */
    .short-resume-dialog {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 25;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .short-resume-dialog.open {
      display: flex;
      animation: fadeIn var(--motion-duration-medium) var(--motion-ease-premium) forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px) scale(0.98);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .short-resume-card {
      background: var(--bg-panel);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-xl);
      padding: var(--space-xl) var(--space-xl-alt);
      max-width: 420px;
      width: 90vw;
      box-shadow: 0 24px 64px rgba(15, 23, 42, 0.2), 0 8px 24px rgba(15, 23, 42, 0.12);
      animation: slideUp var(--motion-duration-medium) var(--motion-ease-premium) forwards;
    }

    .short-resume-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--warning) 0%, color-mix(in srgb, var(--warning) 80%, #000) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: var(--space-md);
      box-shadow: 0 4px 12px rgba(217, 119, 6, 0.25);
    }

    .short-resume-title {
      font-family: var(--font-display);
      font-size: var(--fs-xl);
      font-weight: 800;
      color: var(--text-main);
      margin-bottom: var(--space-tight);
      letter-spacing: -0.02em;
      line-height: var(--lh-tight);
    }

    .short-resume-message {
      font-size: var(--fs-body);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      margin-bottom: var(--space-xl-alt);
    }

    .short-resume-actions {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm-alt);
    }

    .short-resume-primary {
      font-family: var(--font-display);
      font-size: var(--fs-label);
      font-weight: 700;
      color: #ffffff;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-sm-alt) var(--space-lg);
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(51, 65, 166, 0.3);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .short-resume-primary:hover {
      background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-strong) 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(51, 65, 166, 0.35);
    }

    .short-resume-primary:active {
      transform: translateY(0);
    }

    .short-resume-secondary {
      font-family: var(--font-body);
      font-size: var(--fs-small);
      font-weight: 500;
      color: var(--text-soft);
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      cursor: pointer;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .short-resume-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-wash);
    }

    .short-resume-checkbox {
      display: flex;
      align-items: center;
      gap: var(--space-tight);
      margin-top: var(--space-md);
      font-size: var(--fs-xs);
      color: var(--text-muted);
    }

    .short-resume-checkbox input {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: var(--accent);
      border-radius: 4px;
    }

    /* After-run toast */
    .run-toast {
      position: fixed;
      bottom: var(--space-xl);
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, var(--bg-panel) 0%, var(--wash) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-md) var(--space-xl-alt);
      box-shadow: 0 16px 48px rgba(15, 23, 42, 0.15), 0 4px 12px rgba(15, 23, 42, 0.08);
      font-size: var(--fs-small);
      color: var(--text-main);
      z-index: 30;
      opacity: 0;
      transition: transform 0.4s var(--motion-ease-premium),
                  opacity 0.4s var(--motion-ease-premium);
      max-width: 420px;
      text-align: center;
      line-height: var(--lh-relaxed);
      display: flex;
      align-items: center;
      gap: var(--space-sm-alt);
    }

    .run-toast::before {
      content: "✨";
      font-size: var(--fs-lg);
      flex-shrink: 0;
    }

    .run-toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Locked section upsell pattern */
    .locked-section-teaser {
      position: relative;
      background: linear-gradient(135deg, var(--wash) 0%, color-mix(in srgb, var(--accent-wash) 40%, var(--wash)) 100%);
      border: 1px solid color-mix(in srgb, var(--accent) 15%, transparent);
      border-radius: var(--radius-lg);
      padding: var(--space-lg) var(--space-xl-alt);
      text-align: center;
      margin-top: var(--space-md);
      overflow: hidden;
    }

    .locked-section-teaser::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent) 0%, color-mix(in srgb, var(--accent) 60%, var(--success)) 100%);
      opacity: 0.6;
    }

    .locked-section-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto var(--space-sm-alt);
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent-wash) 0%, color-mix(in srgb, var(--accent) 10%, transparent) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .locked-section-text {
      font-size: var(--fs-small);
      color: var(--text-main);
      font-weight: 500;
      margin-bottom: var(--space-sm-alt);
      line-height: var(--lh-relaxed);
    }

    .locked-section-cta {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      font-size: var(--fs-small);
      color: var(--accent);
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      padding: var(--space-tight) var(--space-sm-alt);
      border-radius: var(--radius-sm);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .locked-section-cta:hover {
      background: var(--accent-wash);
      color: var(--accent-dark);
    }

    /* Free tier upsell banner */
    .free-tier-upsell {
      position: relative;
      background: linear-gradient(135deg, var(--wash) 0%, var(--accent-wash) 50%, var(--wash) 100%);
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
      border: 1px solid color-mix(in srgb, var(--accent) 25%, transparent);
      border-radius: var(--radius-xl);
      padding: var(--space-xl-alt) var(--space-lg);
      margin-top: var(--space-xl);
      text-align: center;
      overflow: hidden;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .free-tier-upsell::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent 0%, var(--accent) 50%, transparent 100%);
    }

    .free-tier-upsell-icon {
      width: 52px;
      height: 52px;
      margin: 0 auto var(--space-md);
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 6px 20px rgba(51, 65, 166, 0.25);
    }

    .free-tier-upsell-title {
      font-family: var(--font-display);
      font-size: var(--fs-body);
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: var(--space-xs);
      letter-spacing: -0.01em;
    }

    .free-tier-upsell-text {
      font-size: var(--fs-small);
      color: var(--text-soft);
      margin-bottom: var(--space-md);
      line-height: var(--lh-relaxed);
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
    }

    .free-tier-upsell-cta {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      font-family: var(--font-display);
      font-size: var(--fs-small);
      font-weight: 700;
      color: #ffffff;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-sm-alt) var(--space-lg);
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(51, 65, 166, 0.3);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .free-tier-upsell-cta:hover {
      background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-strong) 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(51, 65, 166, 0.35);
    }

    .free-tier-upsell-cta:active {
      transform: translateY(0);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    label {
      display: block;
      font-size: var(--fs-small);
      color: var(--text-soft);
      margin-bottom: var(--space-sm-alt);
      letter-spacing: 0.01em;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      max-height: 360px;
      overflow-y: auto;
      padding: var(--space-md-alt) var(--space-md-alt);
      font-size: var(--fs-body);
      color: var(--text-main);
      border-radius: var(--radius-input);
      border: 1px solid var(--border-subtle);
      background: var(--bg-panel);
      resize: none;
      margin: 0;
      line-height: var(--lh-loose);
      box-shadow: 0 2px 4px rgba(0,0,0,0.02) inset;
      transition: border-color var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    textarea:focus {
      border-color: var(--accent-light);
      box-shadow: 0 0 0 4px var(--accent-wash), 0 2px 4px rgba(0,0,0,0.02) inset;
      outline: none;
    }

    textarea::placeholder {
      color: rgba(100, 116, 139, 0.42);
      font-size: var(--fs-label);
      font-weight: 500;
      letter-spacing: 0.005em;
    }

    .input-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--fs-xs);
      margin-bottom: var(--space-sm-alt);
      color: var(--text-muted);
    }

    .saved-indicator {
      color: var(--success-light);
      opacity: 0;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium);
    }

    .saved-indicator.visible {
      opacity: 1;
    }

    .input-validation-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--fs-xs);
      margin-bottom: var(--space-sm-alt);
      min-height: 20px;
    }

    .char-count {
      color: var(--text-muted);
      font-size: var(--fs-xs);
      transition: color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .char-count.warning {
      color: var(--warning, #f59e0b);
    }

    .char-count.error {
      color: var(--error, #ef4444);
      font-weight: 500;
    }

    .validation-error {
      color: var(--error, #ef4444);
      font-size: var(--fs-xs);
      font-weight: 500;
      flex: 1;
      text-align: right;
    }

    .validation-error.hidden {
      display: none;
    }

    body.focus-mode .tool-layout {
      grid-template-columns: minmax(0, 1fr);
      margin-top: var(--space-sm);
    }

    body.focus-mode .tool-layout::after {
      display: none;
    }

    body.focus-mode .card-input {
      display: none;
    }

    body.focus-mode .card-output {
      grid-column: 1 / -1;
      max-width: 960px;
      margin: 0 auto;
    }

    .card-input {
      margin-top: 0;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(12, 17, 32, 0.08);
      padding: var(--space-xl-alt);
      background: linear-gradient(165deg, #ffffff 0%, #fafbfd 100%);
      transition: transform 0.4s var(--motion-ease-premium), box-shadow 0.4s var(--motion-ease-premium);
    }

    .card-input:hover {
      transform: translateY(-2px);
      box-shadow: 0 24px 55px rgba(15, 23, 42, 0.12);
    }

    .coming-soon-hint {
      font-size: var(--fs-tiny);
      color: var(--text-muted);
      margin-top: var(--space-micro);
      margin-bottom: var(--space-sm);
    }

    .run-row {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin-top: var(--space-md-alt);
    }

    .run-row::before {
      content: "";
      position: absolute;
      inset: -10px 8px 0 8px;
      background: radial-gradient(circle at 50% 30%, rgba(30, 42, 120, 0.12), transparent 55%);
      filter: blur(6px);
      z-index: 0;
      pointer-events: none;
    }

    .run-row > * {
      position: relative;
      z-index: 1;
    }

    .run-helper-text {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      line-height: var(--lh-normal);
      margin-top: calc(-1 * var(--space-xxs));
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg-panel);
      font-weight: 600;
      border-radius: var(--radius-input);
      padding: var(--space-sm-alt) var(--space-lg-alt);
      border: none;
      box-shadow: var(--shadow-button);
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xxs);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--accent-dark);
      box-shadow: var(--shadow-button-hover);
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: var(--shadow-soft);
      transform: none;
    }

    .btn-primary:disabled:hover {
      background: var(--accent);
      transform: none;
      box-shadow: var(--shadow-soft);
    }

    .btn-success-state {
      background: var(--success-light) !important;
      color: var(--success-dark) !important;
      border-color: var(--success-light) !important;
      transition: all 0.2s ease;
    }

    .btn-secondary {
      background: var(--bg-panel);
      border: 1px solid rgba(28, 78, 216, 0.45);
      color: var(--accent);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-lg);
      box-shadow: var(--shadow-button);
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium), border-color var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xxs);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--accent-wash);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary:disabled:hover {
      background: var(--bg-panel);
      border-color: var(--border-subtle);
      transform: none;
    }

    .run-button {
      width: 100%;
      font-size: var(--fs-base);
      letter-spacing: -0.01em;
    }

    .copy-button,
    .export-button {
      font-size: var(--fs-small);
      gap: var(--space-xxs);
    }

    .icon {
      width: var(--icon-size-md);
      height: var(--icon-size-md);
      flex-shrink: 0;
      stroke: currentColor;
    }

    @keyframes runButtonPulse {
      0% { background: var(--accent); }
      50% { background: color-mix(in srgb, var(--accent) 92%, white 8%); }
      100% { background: var(--accent); }
    }

    @keyframes shimmer {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    .status {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      min-height: var(--space-md-lg);
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium),
                  transform var(--motion-duration-short) var(--motion-ease-premium);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      font-weight: 500;
      letter-spacing: -0.01em;
    }

    .status.status-loading {
      color: var(--text-main);
    }

    .status.status-loading::before {
      content: "";
      width: 6px;
      height: 6px;
      background-color: var(--accent);
      border-radius: 50%;
      animation: statusPulse 1.5s ease-in-out infinite;
    }

    @keyframes statusPulse {
      0% { opacity: 0.4; transform: scale(0.9); }
      50% { opacity: 1; transform: scale(1.1); }
      100% { opacity: 0.4; transform: scale(0.9); }
    }

    .status:not(:empty) {
      animation: statusFadeIn 0.4s var(--motion-ease-premium);
    }

    @keyframes statusFadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Results */

    .results-header-row {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
      display: block;
      margin-top: var(--space-xxs);
      margin-bottom: var(--space-sm);
    }

    .focus-controls {
      display: flex;
      justify-content: flex-end;
      margin: var(--space-xxs) 0 var(--space-sm-alt);
    }

    .focus-button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      font-size: var(--fs-small);
      font-weight: 600;
      letter-spacing: -0.01em;
      cursor: pointer;
      padding: var(--space-xxs) 0;
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      text-decoration: none;
      transition: color var(--motion-duration-short) var(--motion-ease-premium), text-decoration-color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .focus-button:hover {
      color: var(--accent-strong);
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 2px;
    }

    .focus-button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .report-header {
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-lg) var(--space-lg);
      margin-bottom: var(--space-lg);
      box-shadow: var(--shadow-card);
      transition: background var(--motion-duration-short) var(--motion-ease-premium);
    }

    .report-container--visible .report-header {
      background: linear-gradient(135deg, var(--wash) 0%, color-mix(in srgb, var(--accent-wash) 8%, var(--wash) 92%) 100%);
    }

    .report-header-top {
      display: flex;
      flex-direction: column;
      gap: var(--space-xl);
    }

    .report-header-content {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .report-verdict {
      font-size: var(--fs-body);
      color: var(--text-main);
      line-height: var(--lh-relaxed);
      font-weight: 500;
      padding: var(--space-md) 0;
    }

    .top-fixes {
      margin-top: var(--space-sm);
    }

    .top-fixes-label {
      font-size: var(--fs-small);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
      margin-bottom: var(--space-sm);
    }

    .top-fixes-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .top-fixes-list li {
      font-size: var(--fs-label);
      color: var(--text-main);
      line-height: var(--lh-relaxed);
      padding-left: var(--space-md);
      position: relative;
    }

    .top-fixes-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 700;
    }

    .report-cards {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .report-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-card);
      padding: var(--space-xl) var(--space-lg);
      box-shadow: var(--shadow-soft);
      transition: 
        box-shadow var(--motion-duration-short) var(--motion-ease-premium),
        transform var(--motion-duration-short) var(--motion-ease-premium),
        border-color var(--motion-duration-short) var(--motion-ease-premium);
      overflow: hidden;
    }

    .report-card:hover {
      box-shadow: var(--shadow-card);
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .report-card-title-group {
      flex: 1;
    }

    .report-card-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.02em;
      margin: 0 0 var(--space-xxs) 0;
      line-height: var(--lh-cozy);
    }

    .report-card-subtitle {
      font-size: var(--fs-label);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      margin: 0;
      opacity: 0.9;
    }

    .report-card-toggle {
      background: none;
      border: none;
      color: var(--accent);
      font-size: var(--fs-small);
      font-weight: 600;
      cursor: pointer;
      padding: var(--space-xxs) var(--space-sm);
      border-radius: var(--radius-sm);
      transition: 
        background var(--motion-duration-short) var(--motion-ease-premium),
        color var(--motion-duration-short) var(--motion-ease-premium);
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
    }

    .report-card-toggle:hover {
      background: var(--accent-wash);
    }

    .report-card-toggle:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .report-card-toggle-icon {
      transition: transform var(--motion-duration-short) var(--motion-ease-premium);
      display: inline-block;
    }

    .report-card.expanded .report-card-toggle-icon {
      transform: rotate(180deg);
    }

    .report-card-preview {
      font-size: var(--fs-label);
      color: var(--text-main);
      line-height: var(--lh-relaxed);
      margin-top: var(--space-sm);
      opacity: 0.85;
      max-height: 200px;
      overflow: hidden;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium), max-height var(--motion-duration-short) var(--motion-ease-premium);
    }

    .report-card.expanded .report-card-preview {
      max-height: 0;
      opacity: 0;
      margin-top: 0;
      margin-bottom: 0;
      padding-top: 0;
      padding-bottom: 0;
      overflow: hidden;
    }

    .report-card-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height var(--motion-duration-short) var(--motion-ease-premium);
      margin-top: 0;
    }

    .report-card.expanded .report-card-content {
      max-height: 5000px;
      margin-top: var(--space-md);
    }

    .report-card-content-inner {
      padding-top: var(--space-sm);
    }

    /* Static chapter layout (non-collapsible report sections) */
    .report-chapter {
      position: relative;
      padding: var(--space-xl) var(--space-lg) var(--space-lg) var(--space-xl);
      margin-bottom: var(--space-lg);
      border-radius: var(--radius-input);
      background: transparent;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), 
                  box-shadow var(--motion-duration-short) var(--motion-ease-premium), 
                  transform var(--motion-duration-short) var(--motion-ease-premium);
      /* Entry animation - starts hidden */
      opacity: 0;
      transform: translateY(5px);
    }

    .report-chapter.chapter-visible {
      opacity: 1;
      transform: translateY(0);
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium), 
                  transform var(--motion-duration-short) var(--motion-ease-premium),
                  background var(--motion-duration-short) var(--motion-ease-premium), 
                  box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    .report-chapter:hover {
      background: rgba(51, 65, 166, 0.03);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      transform: translateY(-2px);
    }

    .section-divider {
      max-width: 1100px;
      margin: var(--space-2xl) auto var(--space-xl);
      height: 2px;
      background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--accent) 30%, transparent), transparent);
      border-radius: var(--radius-pill);
      opacity: 0.6;
    }

    .report-chapter.chapter-visible:hover {
      transform: translateY(-2px);
    }

    .report-chapter::before {
      content: "";
      position: absolute;
      left: 0;
      top: var(--space-sm);
      bottom: var(--space-sm);
      width: 3px;
      background: linear-gradient(180deg, var(--accent) 0%, color-mix(in srgb, var(--accent) 50%, transparent) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.6;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium);
    }

    /* Compare strip */
    .compare-strip {
      max-width: 1100px;
      margin: var(--space-2xl) auto;
      padding: var(--space-3xl) var(--space-lg) var(--space-2xl);
      background: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
    }

    .compare-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text-main);
      margin-bottom: var(--space-md-lg);
    }

    .compare-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      padding: var(--space-xxs) var(--space-sm-alt);
      background: var(--accent-wash);
      color: var(--accent);
      border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
      border-radius: var(--radius-pill);
      font-size: var(--fs-xs);
      font-weight: 600;
      letter-spacing: 0.01em;
      margin-bottom: var(--space-sm);
      width: fit-content;
    }

    .compare-subline {
      font-size: var(--fs-small);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      margin-bottom: var(--space-xl-alt);
    }

    .compare-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-lg);
    }

    .compare-column {
      background: rgba(0, 0, 0, 0.015);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-soft);
      transition: box-shadow var(--motion-duration-short) var(--motion-ease-premium),
                  transform var(--motion-duration-short) var(--motion-ease-premium),
                  border-color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .compare-column h3 {
      font-family: var(--font-display);
      font-size: var(--fs-h3);
      font-weight: 700;
      letter-spacing: -0.01em;
      margin-bottom: var(--space-sm);
      color: var(--text-main);
    }

    .compare-column ul {
      list-style: none;
      padding-left: 0;
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .compare-column li {
      position: relative;
      padding-left: var(--space-md);
    }

    .compare-column li::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0.6em;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent-wash) 60%, transparent);
      transform: translateY(-50%);
    }

    .compare-column:hover {
      border-color: var(--accent);
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.12);
      transform: translateY(-2px);
    }

    @media (max-width: 600px) {
      .compare-strip {
        padding: var(--space-xl) var(--space-md-alt) var(--space-xl);
      }

      .compare-title {
        font-size: var(--fs-h2);
      }
    }

    /* Reduced motion: show chapters immediately */
    @media (prefers-reduced-motion: reduce) {
      .report-chapter {
        opacity: 1;
        transform: none;
        transition: background var(--motion-duration-short) var(--motion-ease-premium);
      }
      .report-chapter:hover {
        transform: none;
      }
    }

    .report-chapter:hover {
      background: rgba(51, 65, 166, 0.03);
    }

    .report-chapter:hover::before {
      opacity: 0.9;
    }

    .report-chapter:last-child {
      margin-bottom: 0;
    }

    .report-chapter-title {
      font-family: var(--font-display);
      font-size: var(--fs-h2);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin: 0 0 var(--space-xxs) 0;
      line-height: var(--lh-cozy);
    }

    .report-chapter-subtitle {
      font-size: var(--fs-small);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      margin: 0 0 var(--space-md) 0;
    }

    .report-chapter-content {
      font-size: var(--fs-label);
      color: var(--text-main);
      line-height: var(--lh-relaxed);
    }

    .report-chapter-content p {
      margin: 0 0 var(--space-sm) 0;
    }

    .report-chapter-content ul {
      margin: 0 0 var(--space-sm) 0;
      padding-left: var(--space-lg);
    }

    .report-chapter-content li {
      margin-bottom: var(--space-xs);
      line-height: var(--lh-relaxed);
    }

    .report-chapters {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .report-view {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .results-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: var(--space-sm);
      margin-top: var(--space-tight);
    }

    .results-actions-bottom {
      margin-top: var(--space-md-alt);
    }

    .score-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      padding: 0;
      border-radius: var(--radius-pill);
      background: transparent;
      border: none;
      box-shadow: none;
      width: 100%;
    }

    .score-wrapper.hidden {
      display: none;
    }

    .score-cluster {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .score-texts {
      display: flex;
      flex-direction: column;
      gap: var(--space-micro);
    }

    .score-label-text {
      font-size: var(--fs-small);
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-short-text {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-medium);
    }

    .report-meta {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
      line-height: var(--lh-medium);
    }

    .score-help {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-top: var(--space-xxs);
      line-height: var(--lh-normal);
    }

    #results-title {
      font-size: var(--fs-xl);
      margin-bottom: var(--space-tight);
      color: var(--text-main);
      font-weight: 800;
      letter-spacing: -0.02em;
      position: relative;
    }

    .results-bridge {
      margin: var(--space-md-alt) 0 var(--space-md-lg);
    }

    .report-accent-line {
      height: var(--accent-width);
      background: var(--accent);
      border-radius: var(--radius-pill);
      margin: var(--space-tight) 0 var(--space-xxs);
      transform-origin: left;
      width: 100%;
    }

    .report-wrapper {
      display: none;
    }

    .report-container {
      opacity: 0;
      transform: translateY(12px) scale(0.98);
      filter: blur(3px);
    }

    .report-container--visible {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
      transition:
        opacity 420ms cubic-bezier(0.16, 1, 0.3, 1),
        transform 420ms cubic-bezier(0.16, 1, 0.3, 1),
        filter 420ms cubic-bezier(0.16, 1, 0.3, 1);
    }

    @media (prefers-reduced-motion: reduce) {
      .report-container,
      .report-container--visible {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
        transition: none !important;
      }
      .report-header {
        transition: none !important;
      }
    }

    .report-title {
      position: relative;
      display: inline-block;
    }

    .report-title::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -6px;
      height: 2px;
      width: 100%;
      background: var(--accent);
      transform: scaleX(0);
      transform-origin: left;
    }

    .bridge-heading {
      font-size: var(--fs-base);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin-bottom: var(--space-tight);
    }

    #results-subtitle {
      font-size: var(--fs-base);
      color: var(--slate-700);
      line-height: var(--lh-relaxed);
      max-width: 620px;
      margin: 0;
    }

    .score-header-inside {
      width: 100%;
      display: flex;
        flex-direction: column;
        align-items: center;
      gap: var(--space-sm-alt);
      margin: var(--space-tight) 0 var(--space-md-lg);
    }

    .score-dial-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      position: relative;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .score-dial-container.visible {
      opacity: 1;
    }

    .score-dial {
      position: relative;
      width: 140px;
      height: 140px;
    }

    .score-dial svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .score-dial-bg {
      fill: none;
      stroke: rgba(15, 23, 42, 0.08);
      stroke-width: 8;
    }

    .score-dial-progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 339.292;
      stroke-dashoffset: 339.292;
      transform-origin: center;
    }

    @media (prefers-reduced-motion: reduce) {
      .score-dial-progress {
        transition: none;
      }
    }

    .score-dial-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: var(--font-display);
      font-size: var(--fs-dial);
      font-weight: 800;
      letter-spacing: -0.02em;
      color: var(--text-main);
      line-height: 1;
    }

    .score-dial-label {
      font-size: var(--fs-small);
      color: var(--text-muted);
      font-weight: 500;
      text-align: center;
      letter-spacing: 0.01em;
    }

    .score-dial--reveal {
      animation: none;
    }

    @media (prefers-reduced-motion: reduce) {
      .score-dial--reveal {
        animation: none;
      }
      .score-dial-glow {
        animation: none;
      }
    }

    .score-tooltip {
      position: absolute;
      top: calc(100% + var(--space-md-alt));
      left: 50%;
      transform: translateX(-50%) translateY(var(--space-xxs));
      width: 320px;
      max-width: calc(100vw - var(--space-3xl));
      background: var(--bg-panel);
      border: 1px solid var(--border-strong);
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
      border-radius: var(--radius-input);
      padding: var(--space-sm-alt);
      font-size: var(--fs-xs);
      color: var(--text-main);
      line-height: var(--lh-normal);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      z-index: 5;
    }

    .score-tip-line {
      margin-bottom: var(--space-xxs);
      color: var(--text-soft);
    }

    .score-tip-line:last-child {
      margin-bottom: 0;
    }

    .score-wrapper:hover .score-tooltip,
    .score-wrapper:focus-within .score-tooltip,
    .score-dial-container:hover ~ .score-tooltip,
    .score-dial-container:focus-within ~ .score-tooltip,
    .score-tooltip.open {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
    }

    .score-low .score-dial-progress {
      stroke: var(--error);
    }

    .score-low .score-dial-number {
      color: var(--error-dark);
    }

    .score-mid .score-dial-progress {
      stroke: var(--warning);
    }

    .score-mid .score-dial-number {
      color: var(--warning-dark);
    }

    .score-good .score-dial-progress {
      stroke: var(--accent);
    }

    .score-good .score-dial-number {
      color: var(--accent);
    }

    .score-great .score-dial-progress {
      stroke: var(--success-light);
    }

    .score-great .score-dial-number {
      color: var(--success-dark);
    }

    .issue-breakdown {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin-top: var(--space-tight);
      width: 100%;
      max-width: 280px;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .issue-breakdown.visible {
      opacity: 1;
    }

    .issue-bar {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      padding: var(--space-sm) var(--space-sm-alt);
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
      text-align: left;
      overflow: hidden;
    }

    .issue-bar:hover,
    .issue-bar:focus-visible {
      background: var(--accent-wash);
      border-color: var(--accent);
      transform: translateX(2px);
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .issue-bar-content {
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .issue-bar-label {
      font-size: var(--fs-small);
      font-weight: 600;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .issue-bar-count {
      font-size: var(--fs-xs);
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.01em;
    }

    .issue-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: var(--accent);
      opacity: 0.08;
      width: 0%;
      transition: width var(--motion-duration-medium) var(--motion-ease-premium);
      z-index: 1;
    }

    .issue-bar[data-count="0"] .issue-bar-fill {
      width: 0%;
    }

    .issue-bar[data-count="1"] .issue-bar-fill {
      width: 20%;
    }

    .issue-bar[data-count="2"] .issue-bar-fill {
      width: 40%;
    }

    .issue-bar[data-count="3"] .issue-bar-fill {
      width: 60%;
    }

    .issue-bar[data-count="4"] .issue-bar-fill,
    .issue-bar[data-count="5"] .issue-bar-fill {
      width: 80%;
    }

    .issue-bar[data-count="6"] .issue-bar-fill,
    .issue-bar[data-count="7"] .issue-bar-fill,
    .issue-bar[data-count="8"] .issue-bar-fill,
    .issue-bar[data-count="9"] .issue-bar-fill,
    .issue-bar[data-count="10"] .issue-bar-fill {
      width: 100%;
    }

    @media (max-width: 1024px) {
      .issue-breakdown {
        max-width: 100%;
        margin-top: var(--space-md-alt);
      }
    }

    @media (max-width: 600px) {
      .issue-breakdown {
        margin-top: var(--space-md-alt);
        gap: var(--space-tight);
      }

      .issue-bar {
        padding: var(--space-tight) var(--space-sm);
      }

      .issue-bar-label {
        font-size: var(--fs-xs);
      }

      .issue-bar-count {
        font-size: var(--fs-tiny);
      }
    }

    .issue-breakdown-microcopy {
      margin-top: var(--space-sm-alt);
      font-size: var(--fs-xs);
      color: var(--text-muted);
      text-align: center;
      line-height: var(--lh-medium);
      letter-spacing: 0.01em;
    }

    @media (max-width: 600px) {
      .issue-breakdown-microcopy {
        font-size: var(--fs-tiny);
        margin-top: var(--space-sm);
      }
    }

    .score-bands-trigger {
      background: none;
      border: none;
      padding: 0;
      color: var(--text-soft);
      font-size: var(--fs-xs);
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: var(--space-micro);
      margin-top: var(--space-tight);
      align-self: flex-start;
    }

    .score-bands-trigger:hover,
    .score-bands-trigger:focus-visible {
      color: var(--text-main);
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .score-bands-panel {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      max-width: 320px;
    }

    .score-bands-panel-title {
      font-size: var(--fs-small);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .score-bands-intro {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-custom);
    }

    .score-bands-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .score-band-item {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-tight) var(--space-sm);
      background: var(--surface-tint);
      display: flex;
      flex-direction: column;
      gap: var(--space-xxs);
    }

    .score-band-item.active {
      border-color: var(--accent);
      background: var(--accent-wash);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .score-band-header {
      display: flex;
      align-items: center;
      gap: var(--space-xxs);
      font-size: var(--fs-small);
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-range {
      color: var(--text-main);
    }

    .score-band-label {
      color: var(--text-soft);
      font-weight: 600;
    }

    .score-band-chip {
      margin-left: auto;
      font-size: var(--fs-tiny);
      background: color-mix(in srgb, var(--accent) 20%, var(--bg-panel) 80%);
      color: var(--accent-strong);
      padding: var(--space-xxs) var(--space-xxs);
      border-radius: var(--radius-pill);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-description {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-normal);
    }

    /* Paywall */
    .paywall-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .paywall-backdrop[style*="flex"] {
      animation: fadeIn var(--motion-duration-medium) var(--motion-ease-premium) forwards;
    }

    .paywall-card {
      background: var(--bg-panel);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-xl);
      box-shadow: 0 32px 80px rgba(15, 23, 42, 0.25), 0 12px 32px rgba(15, 23, 42, 0.12);
      width: min(520px, 92vw);
      padding: var(--space-lg) var(--space-lg) var(--space-md-lg);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm-alt);
      animation: slideUp var(--motion-duration-medium) var(--motion-ease-premium) forwards;
    }

    .paywall-title {
      font-size: var(--fs-xl);
      font-weight: 800;
      color: var(--text-main);
      letter-spacing: -0.02em;
      line-height: var(--lh-tight);
    }

    .paywall-subtitle {
      font-size: var(--fs-small);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
    }

    .paywall-list {
      margin: var(--space-xxs) 0 var(--space-tight);
      padding-left: var(--space-md-lg);
      color: var(--text-main);
      line-height: var(--lh-custom);
      font-size: var(--fs-label);
    }

    .paywall-actions {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
      margin-top: var(--space-xxs);
    }

    .paywall-primary {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: #ffffff;
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-sm-alt) var(--space-lg);
      font-family: var(--font-display);
      font-size: var(--fs-label);
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(51, 65, 166, 0.25);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--accent-dark) 0%, var(--accent-strong) 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(51, 65, 166, 0.3);
    }

    .paywall-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .paywall-primary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: 0 4px 14px rgba(51, 65, 166, 0.25), var(--focus-shadow);
    }

    .paywall-secondary {
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md-lg);
      font-size: var(--fs-label);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-secondary:hover:not(:disabled) {
      background: var(--accent-wash);
      border-color: var(--accent);
      color: var(--accent);
      transform: translateY(-1px);
    }

    .paywall-secondary:active:not(:disabled) {
      transform: translateY(0);
    }

    .paywall-secondary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    /* Redesigned Paywall with Tier Cards */
    .paywall-card--pricing {
      width: min(560px, 94vw);
      padding: var(--space-xl) var(--space-xl-alt) var(--space-lg);
      padding-top: calc(var(--space-xl) + var(--space-sm));
      gap: var(--space-lg);
      position: relative;
    }

    .paywall-close-btn {
      position: absolute;
      top: var(--space-md-alt);
      right: var(--space-md-alt);
      width: 32px;
      height: 32px;
      background: var(--surface-tint);
      border: 1px solid var(--border-subtle);
      color: var(--text-muted);
      cursor: pointer;
      padding: 0;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-close-btn:hover {
      color: var(--text-main);
      background: var(--wash);
      border-color: var(--border-strong);
      transform: scale(1.05);
    }

    .paywall-close-btn:active {
      transform: scale(0.98);
    }

    .paywall-close-btn:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
    }

    .paywall-header {
      text-align: center;
      margin-bottom: var(--space-sm);
      padding-inline: var(--space-lg);
    }

    .paywall-card--pricing .paywall-title {
      font-size: var(--fs-xl);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: var(--space-xs);
    }

    .paywall-card--pricing .paywall-subtitle {
      font-size: var(--fs-small);
      color: var(--text-muted);
    }

    .paywall-tiers {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
    }

    .paywall-tier {
      position: relative;
      background: var(--wash);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-md-alt) var(--space-md-lg);
      text-align: center;
      cursor: pointer;
      overflow: visible;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-tier::before {
      display: none;
    }

    .paywall-tier:hover {
      border-color: var(--accent);
      box-shadow: 0 12px 32px rgba(51, 65, 166, 0.15);
      transform: translateY(-3px);
    }

    .paywall-tier:hover::before {
      background: var(--accent);
    }

    .paywall-tier:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
    }

    .paywall-tier--24h {
      background: linear-gradient(165deg, var(--accent-wash) 0%, var(--wash) 60%);
      border-color: var(--accent);
    }

    .paywall-tier--24h::before {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-dark) 100%);
    }

    .paywall-tier--24h:hover {
      background: linear-gradient(165deg, color-mix(in srgb, var(--accent-wash) 130%, var(--wash)) 0%, var(--wash) 60%);
      box-shadow: 0 16px 40px rgba(51, 65, 166, 0.2);
    }

    .paywall-tier-badge {
      position: absolute;
      top: calc(var(--space-sm-alt) * -1);
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: white;
      font-size: var(--fs-tiny);
      font-weight: 700;
      padding: var(--space-xxs) var(--space-sm-alt);
      border-radius: var(--radius-pill);
      letter-spacing: 0.03em;
      text-transform: uppercase;
      box-shadow: 0 4px 12px rgba(51, 65, 166, 0.25);
    }

    .paywall-tier--30d .paywall-tier-badge {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
      box-shadow: 0 4px 12px rgba(21, 128, 61, 0.25);
    }

    .paywall-tier-price {
      font-family: var(--font-display);
      font-size: 38px;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: -0.03em;
      margin-bottom: var(--space-xxs);
      line-height: 1;
    }

    .paywall-tier--30d .paywall-tier-price {
      color: var(--success-dark);
    }

    .paywall-tier-name {
      font-family: var(--font-display);
      font-size: var(--fs-body);
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: var(--space-tight);
      letter-spacing: -0.01em;
    }

    .paywall-tier-desc {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
    }

    .paywall-tier.selected {
      border-color: var(--accent);
      box-shadow: 0 14px 40px rgba(51, 65, 166, 0.18), 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent);
      transform: translateY(-3px);
    }

    .paywall-tier.selected::before {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-dark) 100%);
    }

    .paywall-tier--30d.selected {
      border-color: var(--success);
      box-shadow: 0 14px 40px rgba(21, 128, 61, 0.18), 0 0 0 3px color-mix(in srgb, var(--success) 20%, transparent);
    }

    .paywall-tier--30d.selected::before {
      background: linear-gradient(90deg, var(--success) 0%, var(--success-dark) 100%);
    }

    .paywall-status {
      text-align: center;
      font-size: var(--fs-small);
      color: var(--text-muted);
      min-height: var(--space-lg);
    }

    .paywall-auth {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm-alt);
      background: linear-gradient(135deg, var(--wash) 0%, color-mix(in srgb, var(--accent-wash) 30%, var(--wash)) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-md-alt);
    }

    .paywall-input-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-xxs);
    }

    .paywall-input-group label {
      font-size: var(--fs-xs);
      font-weight: 600;
      color: var(--text-soft);
      letter-spacing: 0.01em;
    }

    .paywall-input-helper {
      font-size: var(--fs-tiny);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
    }

    .paywall-input-group input {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-sm-alt);
      font-size: var(--fs-base);
      color: var(--text-main);
      background: var(--bg-panel);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 15%, transparent);
    }

    .paywall-input-group input::placeholder {
      color: var(--text-muted);
    }

    .paywall-actions-row {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .paywall-footer {
      text-align: center;
      padding-top: var(--space-md);
      margin-top: var(--space-xs);
      border-top: 1px solid var(--border-subtle);
    }

    .paywall-trust {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xxs);
    }

    .paywall-trust::before {
      content: "🔒";
      font-size: var(--fs-tiny);
    }

    @media (max-width: 520px) {
      .paywall-tiers {
        grid-template-columns: 1fr;
      }
      .paywall-card--pricing {
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-alt);
      }
    }

    /* Pricing Section */
    .pricing-section {
      max-width: 1100px;
      margin: var(--space-2xl) auto;
      padding: var(--space-2xl) var(--space-lg);
      background: var(--wash);
      border-radius: var(--radius-card);
      border: 1px solid var(--border-subtle);
    }

    .pricing-header {
      text-align: center;
      margin-bottom: var(--space-2xl);
    }

    .pricing-chip {
      display: inline-block;
      background: var(--accent-wash);
      color: var(--accent);
      font-size: var(--fs-tiny);
      font-weight: 700;
      padding: var(--space-xxs) var(--space-sm-alt);
      border-radius: var(--radius-pill);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: var(--space-md);
    }

    .pricing-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      line-height: var(--lh-cozy);
      margin-bottom: var(--space-sm);
      max-width: 620px;
      margin-left: auto;
      margin-right: auto;
    }

    .pricing-subline {
      font-size: var(--fs-body);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      max-width: 480px;
      margin: 0 auto;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .pricing-card {
      position: relative;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      padding: var(--space-xl) var(--space-lg);
      display: flex;
      flex-direction: column;
      transition: 
        box-shadow var(--motion-duration-short) var(--motion-ease-premium),
        transform var(--motion-duration-short) var(--motion-ease-premium),
        border-color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .pricing-card:hover {
      box-shadow: var(--shadow-card);
      transform: translateY(-3px);
    }

    .pricing-card--popular {
      border-color: var(--accent);
      border-width: 2px;
      box-shadow: 0 12px 32px rgba(51, 65, 166, 0.12);
    }

    .pricing-card--popular:hover {
      box-shadow: 0 18px 40px rgba(51, 65, 166, 0.18);
    }

    .pricing-card-popular-badge {
      position: absolute;
      top: calc(var(--space-sm-alt) * -1);
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent);
      color: white;
      font-size: var(--fs-tiny);
      font-weight: 700;
      padding: var(--space-xxs) var(--space-md);
      border-radius: var(--radius-pill);
      letter-spacing: 0.02em;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .pricing-card-header {
      margin-bottom: var(--space-md);
    }

    .pricing-card-badge {
      display: inline-block;
      font-size: var(--fs-tiny);
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: var(--space-xs);
    }

    .pricing-card-price {
      margin-bottom: var(--space-xs);
    }

    .pricing-price-amount {
      font-family: var(--font-display);
      font-size: var(--fs-dial);
      font-weight: 800;
      color: var(--ink-900);
      letter-spacing: -0.03em;
    }

    .pricing-card--popular .pricing-price-amount {
      color: var(--accent);
    }

    .pricing-card-title {
      font-family: var(--font-display);
      font-size: var(--fs-h3);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
    }

    .pricing-card-features {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--space-lg);
      flex: 1;
    }

    .pricing-card-features li {
      font-size: var(--fs-small);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
      padding-left: var(--space-lg);
      position: relative;
      margin-bottom: var(--space-sm);
    }

    .pricing-card-features li::before {
      content: "✓";
      position: absolute;
      left: 0;
      color: var(--success);
      font-weight: 700;
    }

    .pricing-card-cta {
      display: block;
      text-align: center;
      padding: var(--space-sm-alt) var(--space-lg);
      border-radius: var(--radius-input);
      font-size: var(--fs-label);
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: 
        background var(--motion-duration-short) var(--motion-ease-premium),
        transform var(--motion-duration-short) var(--motion-ease-premium),
        box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    .pricing-cta--free {
      background: var(--surface-tint);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
    }

    .pricing-cta--free:hover {
      background: var(--border-subtle);
      transform: translateY(-1px);
    }

    .pricing-cta--primary {
      background: var(--accent);
      color: white;
      border: none;
      box-shadow: var(--shadow-button);
    }

    .pricing-cta--primary:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-button-hover);
    }

    .pricing-cta--secondary {
      background: var(--bg-card);
      color: var(--accent);
      border: 2px solid var(--accent);
    }

    .pricing-cta--secondary:hover {
      background: var(--accent-wash);
      transform: translateY(-1px);
    }

    .pricing-trust-row {
      display: flex;
      justify-content: center;
      gap: var(--space-xl);
      flex-wrap: wrap;
    }

    .pricing-trust-item {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: var(--fs-xs);
      color: var(--text-muted);
    }

    .pricing-trust-icon {
      color: var(--text-muted);
      opacity: 0.7;
    }

    @media (max-width: 900px) {
      .pricing-grid {
        grid-template-columns: 1fr;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }
      .pricing-card--popular {
        order: -1;
      }
    }

    @media (max-width: 600px) {
      .pricing-section {
        padding: var(--space-xl) var(--space-md-alt);
        margin: var(--space-xl) 0;
        border-radius: var(--radius-lg);
      }
      .pricing-title {
        font-size: var(--fs-h2);
      }
      .pricing-trust-row {
        flex-direction: column;
        align-items: center;
        gap: var(--space-sm);
      }
    }

    /* Dark mode for pricing */
    [data-theme="dark"] .pricing-section {
      background: var(--bg-card);
    }

    [data-theme="dark"] .pricing-card {
      background: var(--bg-panel);
    }

    [data-theme="dark"] .pricing-card--popular {
      box-shadow: 0 12px 32px rgba(91, 111, 216, 0.2);
    }

    [data-theme="dark"] .pricing-cta--free {
      background: var(--surface-tint);
      border-color: var(--border-strong);
    }

    [data-theme="dark"] .paywall-tier {
      background: var(--bg-card);
    }

    [data-theme="dark"] .paywall-tier--24h {
      background: linear-gradient(165deg, var(--accent-wash) 0%, var(--bg-card) 60%);
    }

    [data-theme="dark"] .paywall-tier:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
    }

    [data-theme="dark"] .paywall-tier.selected {
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35), 0 0 0 3px color-mix(in srgb, var(--accent) 25%, transparent);
    }

    [data-theme="dark"] .short-resume-dialog {
      background: rgba(0, 0, 0, 0.65);
    }

    [data-theme="dark"] .short-resume-card {
      box-shadow: 0 24px 64px rgba(0, 0, 0, 0.5), 0 8px 24px rgba(0, 0, 0, 0.35);
    }

    [data-theme="dark"] .run-toast {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-panel) 100%);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .locked-section-teaser {
      background: linear-gradient(135deg, var(--bg-card) 0%, color-mix(in srgb, var(--accent-wash) 30%, var(--bg-card)) 100%);
    }

    [data-theme="dark"] .free-tier-upsell {
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--accent-wash) 50%, var(--bg-card) 100%);
    }

    #loading-bar {
      height: 3px;
      border-radius: var(--radius-pill);
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      margin-top: var(--space-tight);
      opacity: 0;
      transform: scaleX(0.9);
      transform-origin: center;
    }

    #loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.1s linear infinite;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.18);
    }

    @keyframes loadingSlide {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    #results-body {
      border: 1px solid var(--border-subtle);
      padding: var(--space-md-alt) var(--space-md-lg);
      line-height: var(--lh-loose);
      white-space: normal;
      font-weight: 400;
      margin-top: var(--space-tight);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02);
      background: var(--bg-panel);
      border-radius: var(--radius-input);
    }

    #results-body.muted {
      opacity: 0.55;
      filter: grayscale(0.06);
    }

    #results-body.refreshed {
      animation: fadeUp var(--motion-duration-short) var(--motion-ease-premium);
    }

    #results-body.empty {
      color: color-mix(in srgb, var(--text-muted) 82%, transparent);
      background: var(--wash);
      text-align: center;
      padding: var(--space-xl) var(--space-lg);
    }

    .results-summary {
      font-size: var(--fs-body);
      color: var(--text-main);
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-input);
      padding: var(--space-lg) var(--space-xl-alt);
      line-height: var(--lh-extra-loose);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
      margin-bottom: var(--space-xl-alt);
    }

    .results-summary.empty {
      color: var(--text-muted);
      box-shadow: none;
      text-align: center;
    }

    .results-skeleton {
      display: flex;
      flex-direction: column;
      gap: 0;
      min-height: 400px;
      position: relative;
      background: transparent;
      border: none;
      padding: 0;
      margin: 0;
    }

    .skeleton-score-area {
      display: flex !important;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      padding-bottom: var(--space-tight);
      width: 100%;
    }

    .skeleton-score-dial {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: var(--border-strong) !important;
      border: 2px solid var(--border-subtle);
      position: relative;
      overflow: visible;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-score-dial::after {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      background: var(--wash);
      border: 1px solid var(--border-subtle);
    }

    .skeleton-score-label {
      width: 120px;
      height: var(--fs-label);
      border-radius: var(--radius-xs);
      background: var(--border-strong) !important;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-issue-breakdown {
      display: flex !important;
      flex-direction: column;
      gap: var(--space-sm);
      width: 100%;
      margin-top: var(--space-tight);
      max-width: 100%;
    }

    .skeleton-issue-bar {
      height: 42px;
      border-radius: var(--radius-sm);
      background: var(--border-strong) !important;
      border: 1px solid var(--border-subtle);
      width: 100%;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-results-top {
      position: relative;
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-lg) var(--space-lg);
      margin-bottom: var(--space-lg);
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
      width: 100%;
    }

    .skeleton-card {
      position: relative;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-card);
      padding: var(--space-xl) var(--space-lg);
      margin-bottom: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
      width: 100%;
    }

    .skeleton-header-row {
      margin-bottom: var(--space-sm-alt);
    }

    .skeleton-heading {
      width: 200px;
      height: 26px;
      border-radius: var(--radius-xs);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      margin-bottom: var(--space-sm-alt);
      animation: skeletonShimmer 3s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-subline {
      width: 85%;
      height: 14px;
      border-radius: var(--radius-xs);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      margin-bottom: var(--space-lg);
      opacity: 0.7;
      animation: skeletonShimmer 3s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-line {
      height: 8px;
      border-radius: var(--radius-pill);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      width: 100%;
      animation: skeletonPulse 1.8s ease-in-out infinite,
                 skeletonShimmer 2.5s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-score-dial,
    .skeleton-score-label,
    .skeleton-issue-bar {
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%) !important;
      background-size: 200% 100% !important;
      animation: skeletonShimmer 3s ease-in-out infinite;
    }

    @keyframes skeletonPulse {
      0%, 100% {
        opacity: 1;
        background-color: var(--border-strong);
      }
      50% {
        opacity: 0.7;
        background-color: color-mix(in srgb, var(--border-strong) 85%, var(--border-subtle) 15%);
      }
    }

    @keyframes skeletonShimmer {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    /* Make skeleton visible when not hidden - override .hidden class */
    .results-skeleton.hidden {
      display: none !important;
      visibility: hidden !important;
    }
    
    .results-skeleton:not(.hidden) {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 1;
    }

    /* Skeleton accent line should be visible but subtle */
    .results-skeleton.stack-accent-line .skeleton-results-top::before,
    .results-skeleton.stack-accent-line .skeleton-summary-section::before,
    .results-skeleton.stack-accent-line .skeleton-section::before {
      content: "";
      position: absolute;
      left: 0;
      top: 8px;
      bottom: 8px;
      width: 3px;
      background: linear-gradient(180deg, var(--border-strong) 0%, color-mix(in srgb, var(--border-strong) 60%, transparent) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.4;
      pointer-events: none;
      animation: skeletonPulse 1.5s ease-in-out infinite;
    }

    .results-skeleton.stack-accent-line .skeleton-results-top::before {
      display: none; /* results-top doesn't have accent line */
    }

    .skeleton-line.wide { width: 92%; }
    .skeleton-line.mid { width: 74%; }
    .skeleton-line.short { width: 52%; }

    .skeleton-title {
      width: 180px;
      height: 24px;
      margin-bottom: var(--space-sm-alt);
    }

    .skeleton-text-wide {
      width: 85%;
      height: 12px;
      margin-bottom: var(--space-tight);
    }

    .skeleton-text-mid {
      width: 70%;
      height: 12px;
    }

    .skeleton-content-line {
      margin-top: var(--space-tight);
    }

    .hidden {
      display: none !important;
    }

    .results-summary.empty {
      color: var(--text-muted);
    }

    @keyframes reportRevealSoft {
      from {
        opacity: 0;
        transform: translateY(12px) scale(0.98);
        filter: blur(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    @keyframes scorePillPop {
      from {
        transform: scale(0.90);
        background-color: color-mix(in srgb, var(--score-pill-bg) 80%, white 20%);
        opacity: 0.85;
      }
      50% {
        transform: scale(1.04);
        background-color: color-mix(in srgb, var(--score-pill-bg) 95%, white 5%);
        opacity: 0.98;
      }
      100% {
        transform: scale(1);
        background-color: var(--score-pill-bg);
        opacity: 1;
      }
    }

    @keyframes accentLineDraw {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes accentWipe {
      from { transform: scaleY(0); }
      to { transform: scaleY(1); }
    }

    @keyframes titleUnderline {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes reportSectionIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-error {
      border-color: var(--error) !important;
      color: var(--error-dark) !important;
      background: var(--error-bg) !important;
    }

    #results-body {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
      position: relative;
    }

    .stack-accent-line {
      position: relative;
    }

    .stack::before,
    .stack-accent-line::before {
      content: "";
      position: absolute;
      left: 0;
      top: 8px;
      bottom: 8px;
      width: 3px;
      background: linear-gradient(180deg, var(--accent) 0%, color-mix(in srgb, var(--accent) 60%, transparent) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.7;
      pointer-events: none;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium);
    }

    .stack-section {
      position: relative;
      padding: var(--space-3xl) var(--space-lg) var(--space-xl-alt) var(--space-3xl);
      margin: 0 0 var(--space-3xl) 0;
      border-radius: var(--radius-input);
      transition:
        background var(--motion-duration-short) var(--motion-ease-premium),
        transform var(--motion-duration-short) var(--motion-ease-premium),
        box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    .stack-section:last-child {
      margin-bottom: 0;
    }

    .stack-heading {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin-top: 0;
      margin-bottom: var(--space-sm-alt);
      line-height: var(--lh-cozy);
    }


    .stack-subline {
      font-size: var(--fs-label);
      color: var(--text-muted);
      margin-top: 0;
      margin-bottom: var(--space-lg);
      line-height: var(--lh-relaxed);
      font-weight: 400;
      opacity: 0.9;
    }

    .stack-section:hover,
    .stack-section:focus-within {
      background: rgba(31, 63, 182, 0.04);
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
    }

    .stack-section:hover.stack-accent-line::before,
    .stack-section:focus-within.stack-accent-line::before {
      opacity: 0.9;
    }

    .accent-card-primary {
      position: relative;
      overflow: hidden;
    }

    .accent-card-primary::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      border-radius: var(--radius-card);
    }

    /* Testimonials: keep clean without spine */
    .proof-editorial.accent-card-primary::before {
      display: none;
    }

    /* Hide duplicate accent on ideas sheet header (sheet has its own accent) */
    .ideas-sheet-header.accent-card-primary::before {
      display: none;
    }

    .accent-heading {
      position: relative;
      padding-left: var(--space-md);
    }

    .accent-heading::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 2px;
      height: 1.6em;
      background: var(--accent);
      border-radius: var(--radius-pill);
    }

    .ideas-sheet-header.accent-left {
      padding-left: var(--space-lg);
    }

    .ideas-sheet-header.accent-card-primary {
      padding-left: calc(var(--space-xl) - var(--accent-width-strong));
      overflow: visible;
    }

    .result-paragraph {
      margin: 0 0 var(--space-sm);
    }

    .result-list {
      margin: var(--space-xxs) 0 var(--space-md-alt);
      padding-left: var(--space-md-lg);
    }

    .result-list li {
      margin-bottom: var(--space-sm);
      line-height: var(--lh-relaxed);
    }

    .rewrite-label {
      font-weight: 600;
      color: var(--text-soft);
      margin: 0 0 var(--space-tight);
      font-size: var(--fs-tiny);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-family: var(--font-display);
    }

    .rewrite-column .rewrite-label {
      color: var(--text-muted);
      opacity: 0.8;
    }

    .rewrite-column.right .rewrite-label {
      color: var(--accent);
      font-weight: 700;
      opacity: 1;
    }

    .rewrite-text {
      margin: 0;
      padding-left: 0;
      color: var(--text-main);
      line-height: var(--lh-loose);
      font-size: var(--fs-label);
    }

    .rewrite-column .rewrite-text {
      color: var(--text-soft);
      opacity: 0.85;
    }

    .rewrite-column.right .rewrite-text {
      color: var(--text-main);
      font-weight: 400;
      opacity: 1;
    }

    .empty-hint {
      font-size: var(--fs-xs);
      color: color-mix(in srgb, var(--text-muted) 85%, transparent);
      margin-top: var(--space-xxs);
    }

    #results-body:not(.empty) + .empty-hint {
      display: none;
    }

    .rewrite-enhancement-note {
      margin-top: var(--space-sm-alt);
      font-size: var(--fs-xs);
      font-style: italic;
      padding: 0;
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      padding-left: var(--space-lg);
      position: relative;
      opacity: 0.9;
    }

    .rewrite-enhancement-note::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0.5em;
      width: var(--space-xxs);
      height: var(--space-xxs);
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.4;
    }

    .results-body-better-flash .rewrite-column.right {
      filter: contrast(1.05);
      transition: filter 0.2s ease;
    }

    .results-body-better-flash .rewrite-column:not(.right) {
      opacity: 0.82;
      transition: opacity 0.2s ease;
    }

    @media (prefers-reduced-motion: reduce) {
      .report-view,
      .report-view.report-view--reveal {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view.report-view--focus-start {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view,
      .report-card,
      .score-pill,
      .report-accent-line,
      .report-section,
      .report-title::after,
      .accent-heading::before,
      .accent-card-primary::before {
        animation: none !important;
        transition: none !important;
        transform: none !important;
        opacity: 1 !important;
      }
      .skeleton-heading,
      .skeleton-subline,
      .skeleton-line,
      .skeleton-score-dial,
      .skeleton-score-label,
      .skeleton-issue-bar {
        animation: skeletonPulse 1.8s ease-in-out infinite !important;
        background: var(--border-strong) !important;
        background-size: 100% 100% !important;
      }
      .status {
        animation: none !important;
      }

      .score-dial {
        width: calc(var(--space-3xl) * 3.75);
        height: calc(var(--space-3xl) * 3.75);
      }

      .score-dial-number {
        font-size: calc(var(--fs-3xl) * 0.9375);
      }

      .score-dial-label {
        font-size: var(--fs-xs);
      }

      .run-button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .stack-section {
        transition: none !important;
        transform: none !important;
      }
    }

    .copy-button,
    .export-button {
      font-size: var(--fs-small);
      gap: var(--space-xxs);
    }

    /* Rewrite blocks and section separators */

    .rewrite-block {
      margin-top: 0;
      margin-bottom: var(--space-md-alt);
      padding: var(--space-lg);
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
      position: relative;
      opacity: 0;
      transform: translateY(var(--space-xxs));
      animation: rewrite-tile-reveal 0.25s var(--motion-ease-premium) forwards;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
    }

    .rewrite-block:nth-child(1) {
      animation-delay: 0ms;
    }

    .rewrite-block:nth-child(2) {
      animation-delay: 40ms;
    }

    .rewrite-block:nth-child(3) {
      animation-delay: 80ms;
    }

    .rewrite-block:nth-child(4) {
      animation-delay: 120ms;
    }

    .rewrite-block:nth-child(5) {
      animation-delay: 160ms;
    }

    @keyframes rewrite-tile-reveal {
      from {
        opacity: 0;
        transform: translateY(var(--space-xxs));
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .rewrite-block {
        animation: none;
        opacity: 1;
        transform: none;
      }
    }

    .rewrite-block:hover {
      background: var(--bg-panel);
      border-color: var(--accent);
      box-shadow: 0 4px 16px rgba(15, 23, 42, 0.08), 0 0 0 1px rgba(28, 78, 216, 0.08);
      transform: translateY(-1px);
    }

    .rewrite-columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: var(--space-xl-alt);
      align-items: start;
    }

    .rewrite-column {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .rewrite-column.right {
      position: relative;
      padding-left: var(--space-xl-alt);
    }

    .rewrite-column.right::before {
      content: "";
      position: absolute;
      left: 0;
      top: var(--space-micro);
      bottom: var(--space-micro);
      width: 2px;
      background: linear-gradient(to bottom, var(--accent), color-mix(in srgb, var(--accent) 80%, transparent));
      border-radius: var(--radius-pill);
      opacity: 0.6;
    }

    .rewrite-column.right::after {
      content: "✓";
      position: absolute;
      left: calc(-1 * var(--space-xxs));
      top: 0;
      width: var(--space-md-lg);
      height: var(--space-md-lg);
      background: var(--accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--fs-tiny);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(28, 78, 216, 0.25), 0 0 0 2px var(--bg-panel);
      line-height: 1;
    }

    @media (max-width: 600px) {
      .rewrite-columns {
        grid-template-columns: 1fr;
      }
      .rewrite-column.right {
        padding-left: var(--space-xl-alt);
      }

      .rewrite-column.right::before {
        display: block;
      }

      .rewrite-column.right::after {
        display: flex;
      }
    }

    /* Remove border between rewrite blocks since they're now cards */
    .rewrite-block + .rewrite-block {
      border-top: none;
      margin-top: 0;
    }

    /* First rewrite block in a cluster */
    .rewrite-cluster-heading + .rewrite-block {
      margin-top: 0;
    }

    .result-section {
      border-top: 1px solid var(--border-subtle);
      padding-top: var(--space-sm-alt);
      margin-top: var(--space-sm-alt);
    }

    .next-steps-heading {
      border-top: 1px solid var(--border-subtle);
      padding-top: var(--space-sm-alt);
      margin-top: var(--space-sm-alt);
    }

    .result-subline {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
      line-height: var(--lh-normal);
    }

    .rewrite-cluster-heading {
      font-size: var(--fs-small);
      font-weight: 700;
      color: var(--text-main);
      margin: var(--space-xl-alt) 0 var(--space-md-alt);
      font-family: var(--font-display);
      letter-spacing: -0.01em;
      text-transform: none;
    }

    /* Creator line and footer */

    .creator-section {
      text-align: center;
      color: var(--text-muted);
      font-size: var(--fs-tiny);
      opacity: 0.7;
      margin-top: var(--space-md-alt);
      margin-bottom: var(--space-xxs);
    }

    .footer {
      margin-top: var(--space-md-alt);
      padding-top: 0;
      border-top: none;
      text-align: center;
      color: var(--slate-500);
      font-size: var(--fs-tiny);
      line-height: var(--lh-custom);
    }

    .footer strong {
      color: var(--text-soft);
      font-weight: 600;
    }

    textarea:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      border-color: rgba(15, 23, 42, 0.28);
      box-shadow:
        0 14px 30px rgba(15, 23, 42, 0.14),
        inset 0 0 0 1px rgba(15, 23, 42, 0.28),
        var(--focus-shadow);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .run-button:focus-visible,
    .sample-resume-button:focus-visible,
    .copy-button:focus-visible,
    .export-button:focus-visible,
    .ideas-open-link:focus-visible,
    .stack-section:focus-within {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .input-wrapper {
      position: relative;
      max-height: 440px;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .resume-input-container {
      overflow: hidden;
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.08);
      background: rgba(15, 23, 42, 0.015);
      padding: var(--space-xl-alt) var(--space-md-lg);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.10);
    }

    @media (max-width: 600px) {
      .input-wrapper {
        max-height: 540px;
      }
    }

    .status-bar {
      margin-top: var(--space-xxs);
      font-size: var(--fs-small);
      opacity: 0.95;
      min-height: 1.2em;
      color: var(--text-muted);
      line-height: var(--lh-normal);
      transition: color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .status-bar.status-info {
      color: var(--text-soft);
    }

    .status-bar.status-error {
      color: var(--error);
      font-weight: 500;
    }

    /* Achievement ideas (inline + modal) */
    .ideas-inline {
      margin-top: var(--space-xl);
      margin-bottom: var(--space-lg);
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-xl-alt) var(--space-lg);
      display: flex;
      flex-direction: column;
      gap: var(--space-md-lg);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
    }

    .ideas-inline.hidden {
      display: none;
    }

    .ideas-inline .ideas-text {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .ideas-actions {
      display: flex;
      gap: var(--space-xxs);
      align-items: flex-start;
      flex-shrink: 0;
      flex-basis: auto;
    }

    .ideas-kicker {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      padding: var(--space-xxs) var(--space-sm);
      background: var(--accent-wash);
      color: var(--accent);
      border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
      border-radius: var(--radius-pill);
      font-size: var(--fs-xs);
      font-weight: 700;
      letter-spacing: 0.01em;
      margin-bottom: 0;
      width: fit-content;
    }

    .ideas-subtitle {
      font-weight: 400;
      font-size: var(--fs-label);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      max-width: none;
    }

    .ideas-open-link {
      background: transparent;
      border: none;
      color: var(--accent);
      font-size: var(--fs-label);
      font-weight: 500;
      padding: var(--space-tight) 0;
      cursor: pointer;
      text-decoration: none;
      align-self: flex-start;
      transition: color var(--motion-duration-short) var(--motion-ease-premium), border-color var(--motion-duration-short) var(--motion-ease-premium);
      border-bottom: 1px solid transparent;
    }

    .ideas-open-link:hover,
    .ideas-open-link:focus-visible {
      color: var(--accent-strong);
      border-bottom-color: var(--accent-strong);
      transform: none;
    }

    .ideas-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-md-alt) var(--space-sm-alt);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s var(--motion-ease-premium);
    }

    .ideas-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .ideas-modal.hidden {
      opacity: 0;
      pointer-events: none;
      display: flex; /* Keep flex for layout, rely on opacity */
      visibility: hidden;
    }

    .ideas-modal:not(.hidden) {
        visibility: visible;
    }

    .ideas-modal.visible { /* Legacy class support if JS uses it */
      opacity: 1;
      pointer-events: auto;
      visibility: visible;
    }

    .ideas-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      opacity: 1; /* Parent controls opacity */
    }

    .ideas-sheet {
      position: relative;
      z-index: 1;
      width: min(720px, 92vw);
      max-height: 90vh;
      background: var(--wash);
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-modal);
      padding: calc(var(--space-xl) - var(--space-micro)) var(--space-xl-alt) var(--space-xl-alt) calc(var(--space-xl) + var(--space-xs));
      display: flex;
      flex-direction: column;
      gap: var(--space-sm-alt);
      transform: translateY(8px) scale(0.96);
      transition: transform 0.4s var(--motion-ease-premium);
      border-top: 2px solid var(--accent);
      overflow: hidden;
    }

    .ideas-modal:not(.hidden) .ideas-sheet,
    .ideas-modal.visible .ideas-sheet {
      transform: translateY(0) scale(1);
    }

    .ideas-sheet-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-lg);
      margin-bottom: var(--space-md-alt);
      padding: 0;
      border-bottom: none;
      position: relative;
    }

    .ideas-sheet-header > div:first-child {
      flex: 1 1 auto;
      min-width: 0;
      overflow: visible;
    }

    .ideas-sheet-title {
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin-bottom: var(--space-tight);
      word-wrap: break-word;
      overflow-wrap: break-word;
      line-height: var(--lh-snug);
    }

    .ideas-sheet-subtitle {
      font-size: var(--fs-label);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      margin-top: 0;
      margin-bottom: 0;
      padding-bottom: var(--space-micro);
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      max-width: 100%;
      display: block;
    }

    .ideas-loading-bar {
      margin: 0 0 var(--space-tight) 0;
    }

    .ideas-status {
      margin-bottom: var(--space-tight);
    }

    .ideas-sheet-body {
      overflow-y: auto;
      padding: 0 var(--space-micro) var(--space-sm) 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-md-alt);
      margin-top: 0;
      flex: 1;
    }

    @media (max-width: 768px) {
      .ideas-modal {
        align-items: flex-end;
        padding: var(--space-sm-alt) 0;
      }
      .ideas-sheet {
        width: 100vw;
        max-width: 100vw;
        max-height: calc(100vh - 96px - env(safe-area-inset-top, 0px));
        height: auto;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        box-shadow: var(--shadow-modal);
        margin-top: env(safe-area-inset-top, var(--space-tight));
        gap: var(--space-md-lg);
      }
      .ideas-sheet::before {
        left: var(--space-md-alt);
        top: var(--space-lg);
        bottom: var(--space-md-lg);
      }
      .ideas-sheet-header {
        position: sticky;
        top: 0;
        padding: 0;
        background: var(--wash);
        z-index: 2;
        border-bottom: none;
        margin-bottom: var(--space-md-alt);
        gap: var(--space-md-lg);
      }
      .ideas-sheet-header > div:first-child {
        flex: 1 1 auto;
        min-width: 0;
        overflow: visible;
      }
      .ideas-sheet-title {
        font-size: var(--fs-2xl);
        margin-bottom: var(--space-xxs);
        line-height: var(--lh-snug);
      }
      .ideas-sheet-subtitle {
        font-size: var(--fs-small);
        line-height: var(--lh-relaxed);
        margin-top: 0;
        padding-bottom: 0;
      }
      .ideas-sheet-body {
        flex: 1;
        overflow-y: auto;
        padding: 0 var(--space-micro) var(--space-sm) 0;
        margin-top: 0;
        gap: var(--space-md-lg);
      }
      .ideas-inline {
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        gap: var(--space-sm-alt);
      }
      .ideas-kicker {
        font-size: var(--fs-2xl);
      }
      .ideas-actions {
        flex-wrap: wrap;
        gap: var(--space-tight);
      }
      .ideas-actions .ghost-button {
        font-size: var(--fs-xs);
        padding: var(--space-xxs) var(--space-sm);
      }
    }

    .ghost-button {
      background: var(--surface-tint);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      padding: var(--space-xs) var(--space-sm-alt);
      border-radius: var(--radius-md);
      font-size: var(--fs-xs);
      cursor: pointer;
      transition: border-color var(--motion-duration-short) var(--motion-ease-premium), background var(--motion-duration-short) var(--motion-ease-premium);
      align-self: flex-start;
    }

    .ghost-button:hover {
      border-color: var(--border-strong);
      background: var(--surface-tint);
    }

    .ghost-button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .ghost-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (prefers-reduced-motion: reduce) {
      .run-button:hover,
      .run-button:active,
      .copy-button:hover,
      .export-button:hover,
      .sample-resume-button:hover,
      .sample-report-button:hover {
        transform: none !important;
        box-shadow: 0 10px 22px color-mix(in srgb, var(--accent) 18%, transparent);
      }
    }

    .sample-resume-button {
      align-self: flex-start;
      margin: var(--space-xxs) 0 var(--space-sm);
      font-size: var(--fs-small);
    }

    .sample-report-button {
      align-self: flex-start;
      margin: var(--space-xxs) 0 var(--space-sm);
      font-size: var(--fs-small);
    }

    .sample-helper-text {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-top: calc(-1 * var(--space-xs));
      margin-bottom: var(--space-sm);
      line-height: var(--lh-normal);
    }

    .report-tag {
      font-size: var(--fs-xs);
      color: var(--accent);
      font-weight: 600;
      margin-left: var(--space-sm);
      padding: var(--space-xxs) var(--space-sm);
      background: var(--accent-wash);
      border-radius: var(--radius-sm);
      letter-spacing: 0.01em;
    }

    .report-tag.hidden {
      display: none;
    }

    .clear-button {
      align-self: flex-start;
      margin: var(--space-xxs) 0 var(--space-sm);
      font-size: var(--fs-small);
    }

    .clear-button.hidden {
      display: none;
    }

    .button-group {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
      flex-wrap: wrap;
    }

    .data-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s var(--motion-ease-premium);
    }

    .data-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .data-modal.hidden {
      opacity: 0;
      pointer-events: none;
      /* Override display:none from utility class if needed, or rely on opacity */
    }

    .data-modal-card {
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-modal);
      border-radius: var(--radius-lg);
      max-width: 420px;
      width: min(420px, calc(100vw - var(--space-3xl)));
      padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-alt);
      color: var(--text-main);
      transform: translateY(8px) scale(0.96);
      transition: transform 0.4s var(--motion-ease-premium);
    }

    .data-modal:not(.hidden) .data-modal-card {
      transform: translateY(0) scale(1);
    }

    .data-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-sm-alt);
      margin-bottom: var(--space-sm);
    }

    .data-modal-title {
      margin: 0;
      font-size: var(--fs-base);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .data-modal-close {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: var(--fs-small);
      color: var(--text-soft);
      padding: var(--space-xxs);
      border-radius: var(--radius-sm);
      transition: color 0.2s ease;
    }

    .data-modal-close:hover {
      color: var(--text-main);
    }

    .data-modal-close:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .data-modal-body {
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
      color: var(--text-soft);
    }

    .data-modal-body p {
      margin: 0 0 var(--space-sm);
    }

    .data-modal-body p:last-child {
      margin-bottom: 0;
    }

    .ideas-loading-bar {
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
      margin-top: var(--space-xxs);
      border-radius: var(--radius-pill);
      height: 1.5px;
    }

    .ideas-status {
      font-size: var(--fs-xs);
      color: rgba(148, 163, 184, 0.9);
      margin-top: var(--space-xxs);
      min-height: var(--space-md-alt);
    }

    .ideas-status.error {
      color: var(--error-light);
    }

    .ideas-body {
      margin-top: var(--space-xxs);
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      gap: var(--space-md-alt);
    }

    .ideas-body.empty {
      color: color-mix(in srgb, var(--text-muted) 90%, transparent);
      border: 1px dashed var(--border-subtle);
      border-radius: var(--radius-input);
      padding: var(--space-lg) var(--space-md-alt);
      text-align: center;
      background: var(--wash);
    }

    .ideas-section-card {
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-xl-alt) var(--space-lg-alt);
    }

    .ideas-section-title {
      font-size: var(--fs-lg);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin: 0 0 var(--space-sm-alt);
    }

    .ideas-section-subline {
      margin: 0 0 var(--space-md-alt);
      color: var(--text-muted);
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
    }

    .ideas-section-card p {
      margin: 0;
      color: var(--text-main);
      line-height: var(--lh-extra-loose);
      font-size: var(--fs-label);
    }

    .ideas-list {
      margin: 0;
      padding-left: var(--space-xl-alt);
    }

    .ideas-list li {
      margin-bottom: var(--space-sm);
      line-height: var(--lh-extra-loose);
      color: var(--text-main);
      font-size: var(--fs-label);
    }

    .ideas-how {
      margin-top: 0;
      font-weight: 600;
      font-size: var(--fs-small);
      line-height: var(--lh-normal);
      color: var(--text-main);
    }

    .ideas-sublist {
      margin-top: var(--space-xxs);
      padding-left: var(--space-md-alt);
      color: var(--text-muted);
      opacity: 0.85;
      font-size: var(--fs-xs);
      line-height: var(--lh-normal);
    }

    .ideas-divider {
      border-top: 1px solid var(--border-subtle);
      margin: var(--space-sm-alt) 0 var(--space-tight);
      padding-top: 0;
    }

    .ideas-actions .ghost-button {
      border-radius: var(--radius-md);
      padding: var(--space-xs) var(--space-sm-alt);
      box-shadow: var(--shadow-soft);
    }

    @media print {
      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        transition: none !important;
        animation: none !important;
      }

      body {
        background: var(--bg-panel);
        color: var(--text-main);
        padding: var(--space-lg);
        font-size: var(--fs-small);
      }

      .page {
        border: none;
        box-shadow: none;
        padding: 0;
        max-width: 780px;
        margin: 0 auto;
      }

      .top-bar,
      .hero,
      .card-input,
      .run-row,
      .results-actions-bottom,
      .data-handling-row,
      .sample-resume-button,
      .version-pill,
      #loading-bar,
      #focus-toggle,
      textarea,
      label[for="main-input"],
      .input-wrapper {
        display: none !important;
      }

      button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .run-button {
        pointer-events: none;
      }

      .card-output {
        box-shadow: 0 0 0 1px rgba(12, 17, 32, 0.08);
        border: 1px solid rgba(12, 17, 32, 0.08);
        padding: var(--space-md);
        border-radius: var(--radius-md);
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-top {
        box-shadow: none;
        border: none;
        background: var(--bg-panel);
        padding: 0 0 var(--space-lg) 0;
      }

      #results-body {
        border: none;
        padding: 0;
      }

      .stack::before,
      .stack-accent-line::before {
        display: none;
      }

      .stack-accent-line {
        border-left: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
        padding-left: var(--space-lg);
      }

      .stack-section {
        margin: var(--space-lg) 0;
        padding: 0 0 var(--space-md) 0;
        box-shadow: none;
        background: var(--bg-panel);
        border-radius: var(--radius-xs);
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .stack-heading {
        margin-bottom: var(--space-md);
      }

      .result-list li,
      .rewrite-block,
      .rewrite-columns,
      .ideas-section-card,
      .card-output {
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-summary {
        border: none;
        box-shadow: none;
        background: var(--bg-panel);
        padding-left: 0;
      }

      .stack-section:hover,
      .stack-section:focus-within,
      .ideas-open-link:hover,
      .ideas-open-link:focus-visible,
      .run-button:hover,
      .copy-button:hover,
      .export-button:hover {
        background: var(--bg-panel);
        transform: none;
        box-shadow: none;
      }

      .ideas-open-link {
        color: var(--text-main);
        text-decoration: none;
        border: none;
      }

      body::after {
        content: "Generated with Recruiter in Your Pocket — recruiterinyourpocket.com";
        display: block;
        margin-top: var(--space-xl);
        font-size: var(--fs-xs);
        color: var(--text-muted);
        text-align: center;
      }
    }

  </style>
</head>

<body>
  <div class="page">
    <div class="page-inner">
      <header class="top-bar">
        <div class="brand">
          <div class="brand-wordmark">Recruiter in Your Pocket</div>
        </div>
        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle dark mode" title="Toggle dark mode">
          <span class="theme-toggle-icon">🌙</span>
        </button>
      </header>

      <div id="loading-bar"></div>

      <section class="hero">
        <div class="hero-grid-layout">
          <div class="hero-content">
            <h1 class="hero-title">See how recruiters actually read your resume.</h1>
            <p class="hero-subtitle">Get a recruiter-grade read, stronger bullets, and clear next steps in minutes.</p>
            <p class="hero-credibility">Built by a recruiter who’s run 10,000+ interviews and hired 1,000+ across Google, Meta, OpenAI, and high-growth startups.</p>
            
            <div class="hero-cta-group">
              <a href="#main-input" class="hero-cta-primary" id="hero-cta-scroll">Get a recruiter's read →</a>
              <button type="button" class="hero-cta-secondary" id="hero-sample-report">See a sample report</button>
            </div>
            <div class="hero-cta-note">Your first full report is free. No login or card.</div>

            <div class="trust-inline hero-trust-line">
              <span class="status-dot"></span>
              <span>Your resume stays private.</span>
              <button id="data-handling-inline" type="button" aria-haspopup="dialog" aria-controls="data-modal">How we handle data</button>
            </div>
          </div>

          <div class="hero-preview">
            <div class="hero-preview-card">
              <div class="hero-preview-badge">Sample Report</div>
              <div class="hero-preview-score">
                <div class="hero-preview-dial">
                  <span class="hero-preview-dial-number">86</span>
                </div>
                <div class="hero-preview-score-text">
                  <div class="hero-preview-score-label">Clarity Score</div>
                  <div class="hero-preview-score-band">Strong foundation</div>
                </div>
              </div>
              <div class="hero-preview-verdict">You read as someone who takes messy workstreams and makes them shippable. Your edge is steady ownership.</div>
              <div class="hero-preview-section">
                <div class="hero-preview-section-title">Top fixes</div>
                <div class="hero-preview-item">Add scope (teams, volume) to two top bullets</div>
                <div class="hero-preview-item">State one before/after metric in a headline</div>
                <div class="hero-preview-item">Split any bullet that mixes decisions and outcomes</div>
              </div>
              <div class="hero-preview-fade"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Value strip -->
      <div class="value-strip" aria-label="What you get">
        <div class="value-item">
          <svg class="value-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3A.75.75 0 0 0 3 3.75v16.5A.75.75 0 0 0 3.75 21h16.5a.75.75 0 0 0 .75-.75V3.75A.75.75 0 0 0 20.25 3H3.75z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 9.75v6.75M12 7.5v9M16.5 12.75V17.25" />
          </svg>
          <div class="value-title">Clarity score</div>
          <div class="value-desc">See how clearly your story lands on a first read</div>
        </div>
        <div class="value-item">
          <svg class="value-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12.75h6.75m-6.75-3h3.75M2.25 12c0 2.485 2.239 4.5 5 4.5.477 0 .94-.058 1.382-.166a4.5 4.5 0 0 0 3.348 1.416c.628 0 1.227-.118 1.776-.333L18 18.75l-.567-1.417A4.5 4.5 0 0 0 19.5 13.5C19.5 10.462 16.89 8 13.75 8c-.177 0-.351.007-.525.02A6.375 6.375 0 0 0 2.25 12Z" />
          </svg>
          <div class="value-title">Honest read</div>
          <div class="value-desc">What's working, what's buried, and what's getting missed</div>
        </div>
        <div class="value-item">
          <svg class="value-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487a2.25 2.25 0 1 1 3.182 3.183L9.31 18.404a4.5 4.5 0 0 1-1.591 1.028l-2.685.895.895-2.685a4.5 4.5 0 0 1 1.028-1.591L16.862 4.487z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M18.375 5.625 20.25 7.5" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6.75H6.75A2.25 2.25 0 0 0 4.5 9v10.5A2.25 2.25 0 0 0 6.75 21h10.5A2.25 2.25 0 0 0 19.5 18.75V12" />
          </svg>
          <div class="value-title">Stronger phrasing</div>
          <div class="value-desc">Real rewrites you can copy, not generic advice</div>
        </div>
        <div class="value-item">
          <svg class="value-icon" xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="1.5"
               aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75" />
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="value-title">Clear next steps</div>
          <div class="value-desc">Know exactly what to fix in your next editing session</div>
        </div>
      </div>

      <div class="proof-editorial accent-card-primary" aria-label="Testimonials from users">
        <div class="proof-editorial-heading">What early users say</div>
        <div class="proof-editorial-quote">"Honestly, I thought my resume was fine, but this showed me what actually mattered and what I could finally cut."</div>
          <div class="proof-editorial-quote">"I thought my bullets were good until this showed me my scope was invisible. I had no idea recruiters couldn’t see it."</div>
        <div class="proof-editorial-quote">"I kept tweaking the same three bullets. This told me why they felt weak and gave me the actual rewrite."</div>
        <div class="proof-editorial-quote">"It finally made me stop rewriting my resume at midnight every week."</div>
      </div>

      <div id="data-modal" class="data-modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="data-modal-title">
        <div id="data-modal-card" class="data-modal-card" tabindex="-1">
          <div class="data-modal-header">
            <h3 id="data-modal-title" class="data-modal-title">How we handle data</h3>
            <button id="data-modal-close" class="data-modal-close" type="button" aria-label="Close">✕</button>
          </div>
          <div class="data-modal-body">
            <p>Your resume stays in your browser until you run a review.</p>
            <p>When you run a review, we send only your text to our servers over an encrypted connection.</p>
            <p>We don't keep your resume or use it to train anything.</p>
          </div>
        </div>
      </div>

      <main class="tool-layout">
        <!-- Left column -->
        <section class="card card-input" aria-label="Input panel">
          <div class="card-inner">
            <div class="card-header">
              <h2 class="card-title">Your resume</h2>
              <p class="card-subtitle">Paste your resume text below for a recruiter-grade review</p>
              <p class="card-helper-note">Your first full report is free. No login or card.</p>
            </div>

            <label for="main-input" id="input-label" class="sr-only">
              Resume text input
            </label>

            <div class="button-group">
              <button id="sample-resume-button" type="button" class="sample-resume-button btn-primary">Try a sample resume →</button>
              <button id="sample-report-button" type="button" class="sample-report-button btn-secondary">See Sample Report →</button>
              <button id="clear-button" type="button" class="clear-button btn-secondary hidden">Clear</button>
            </div>
            <div class="sample-helper-text">See exactly what you'll get before pasting your resume</div>

            <div class="input-wrapper resume-input-container resume-input-shell">
              <textarea
                id="main-input"
                placeholder="Paste your full resume, including work history, skills, and education."
                maxlength="30000"
              ></textarea>
            </div>

            <div class="input-meta-row">
              <div>Your resume stays in your browser until you run a review.</div>
              <div id="saved-indicator" class="saved-indicator">Saved</div>
            </div>
            <div class="input-validation-row">
              <div id="char-count" class="char-count"></div>
              <div id="validation-error" class="validation-error hidden"></div>
            </div>

            <div class="run-row">
              <button id="run-button" class="run-button btn-primary">Get a recruiter’s read</button>
              <div class="run-helper-text">Your first Clarity Score is free; no login or card required.</div>
              <div id="status" class="status" aria-live="polite" role="status"></div>
            </div>
          </div>
        </section>

        <!-- Right column -->
        <div class="report-wrapper">
          <section class="card card-output" aria-label="Results panel">
            <div class="card-inner report-view report-card report-container" id="report-view">
            <div class="report-header">
              <div class="report-header-top">
                <div class="score-header-inside">
                  <div id="score-wrapper" class="score-wrapper hidden">
                    <div
                      id="score-dial-container"
                      class="score-dial-container"
                      tabindex="0"
                      aria-describedby="score-tooltip"
                    >
                      <div id="score-dial" class="score-dial">
                        <svg viewBox="0 0 120 120">
                          <circle class="score-dial-bg" cx="60" cy="60" r="54" />
                          <circle
                            id="score-dial-progress"
                            class="score-dial-progress"
                            cx="60"
                            cy="60"
                            r="54"
                          />
                        </svg>
                        <div id="score-dial-number" class="score-dial-number">0</div>
                      </div>
                      <div id="score-dial-label" class="score-dial-label">Overall clarity score</div>
                    </div>
                    <div id="score-tooltip" class="score-tooltip" role="tooltip"></div>
                    <div id="issue-breakdown" class="issue-breakdown hidden">
                      <button class="issue-bar" data-section="impact-results" type="button" aria-label="Impact & Results">
                        <div class="issue-bar-content">
                          <span class="issue-bar-label">Impact & Results</span>
                          <span class="issue-bar-count">0 top suggestions</span>
                        </div>
                        <div class="issue-bar-fill"></div>
                      </button>
                      <button class="issue-bar" data-section="clarity-structure" type="button" aria-label="Clarity & Conciseness">
                        <div class="issue-bar-content">
                          <span class="issue-bar-label">Clarity & Conciseness</span>
                          <span class="issue-bar-count">0 top suggestions</span>
                        </div>
                        <div class="issue-bar-fill"></div>
                      </button>
                      <button class="issue-bar" data-section="focus-craft" type="button" aria-label="Focus & Craft">
                        <div class="issue-bar-content">
                          <span class="issue-bar-label">Focus & Craft</span>
                          <span class="issue-bar-count">0 top suggestions</span>
                        </div>
                        <div class="issue-bar-fill"></div>
                      </button>
                    </div>
                    <div class="issue-breakdown-microcopy">Prioritized improvements in each area</div>
                  </div>
                </div>
                <div class="report-header-content">
                  <div class="results-header-row">
                    <h2 id="results-title" class="card-title"><span class="report-title">Recruiter report</span></h2>
                    <div id="report-tag" class="report-tag hidden">Sample report</div>
                    <div class="focus-controls">
                      <button id="focus-toggle" class="focus-button hidden" type="button">Focus on report</button>
                    </div>
                  </div>
                  <div id="report-verdict" class="report-verdict hidden"></div>
                  <div id="top-fixes" class="top-fixes hidden">
                    <div class="top-fixes-label">Top 3 fixes</div>
                    <ul class="top-fixes-list"></ul>
                  </div>
                </div>
              </div>
              <div id="status-bar" class="status-bar"></div>
            </div>

            <div id="results-skeleton" class="results-skeleton hidden" aria-hidden="true">
              <div class="skeleton-results-top">
                <div class="skeleton-score-area">
                  <div class="skeleton-score-dial"></div>
                  <div class="skeleton-score-label"></div>
                  <div class="skeleton-issue-breakdown">
                    <div class="skeleton-issue-bar"></div>
                    <div class="skeleton-issue-bar"></div>
                    <div class="skeleton-issue-bar"></div>
                  </div>
                </div>
                <div class="skeleton-header-row">
                  <div class="skeleton-line skeleton-title"></div>
                </div>
                <div class="skeleton-line skeleton-text-wide"></div>
                <div class="skeleton-line skeleton-text-mid"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
              </div>
            </div>

            <div
              id="results-body"
              class="empty report-cards"
              role="region"
              aria-label="Resume feedback results"
            >
              <!-- Cards will be rendered here by JS -->
            </div>

            <div id="results-actions-bottom" class="results-actions results-actions-bottom hidden">
              <button id="export-button" class="export-button btn-primary" aria-label="Export PDF">
                <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 11L8 2M8 11L5 8M8 11L11 8M3 11L3 13C3 13.5523 3.44772 14 4 14L12 14C12.5523 14 13 13.5523 13 13L13 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Export PDF</span>
              </button>
              <button id="copy-full-button" class="copy-button btn-primary" aria-label="Copy report with headings">
                <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="5" y="5" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M4 7C4 6.44772 4.44772 6 5 6H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  <path d="M4 11C4 10.4477 4.44772 10 5 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span>Copy report</span>
              </button>
            </div>

            <div id="ideas-inline" class="ideas-inline hidden" aria-live="polite">
              <div class="ideas-text">
                <div class="ideas-kicker">Missing wins</div>
                <div class="ideas-subtitle">
                  Quick prompts that surface the wins you likely have but haven’t written yet.
                </div>
              </div>
              <div class="ideas-actions">
                <button
                  id="ideas-open"
                  class="ideas-open-link"
                  type="button"
                  aria-haspopup="dialog"
                  aria-controls="ideas-modal"
                >
                  Open the questions
                </button>
              </div>
            </div>

            <!-- Missing wins card will be rendered in results-body by JS -->

            <div id="ideas-modal" class="ideas-modal hidden" aria-hidden="true">
              <div id="ideas-backdrop" class="ideas-backdrop"></div>
              <div class="ideas-sheet" id="ideas-sheet" role="dialog" aria-modal="true" aria-labelledby="ideas-modal-title">
                <div class="ideas-sheet-header accent-card-primary">
                  <div>
                    <div id="ideas-modal-title" class="ideas-sheet-title">Missing wins</div>
                    <div class="ideas-sheet-subtitle">Surfaces buried impact, unclear outcomes, and scope you likely have but didn’t express.</div>
                  </div>
                  <div class="ideas-actions">
                    <button id="ideas-refresh" class="ghost-button" type="button">Refresh</button>
                    <button id="ideas-close" class="ghost-button" type="button" aria-label="Close missing wins">Close</button>
                  </div>
                </div>
                <div id="ideas-loading-bar" class="ideas-loading-bar"></div>
                <div id="ideas-status" class="ideas-status" aria-live="polite"></div>
                <div class="ideas-sheet-body">
                  <div id="ideas-body" class="ideas-body empty" aria-live="polite">
                    I’ll look for wins you have not written yet or forgot about.
                  </div>
                </div>
              </div>
            </div>

            </div>
          </section>
        </div>
      </main>

      <div class="section-divider" aria-hidden="true"></div>

      <section class="compare-strip">
        <span class="compare-chip">Recruiter-grade insight</span>
        <h2 class="compare-title">How this compares to typical resume checkers</h2>
        <p class="compare-subline">Built by recruiters to show how your story really lands, not to chase keyword scores.</p>
        <div class="compare-grid">
          <div class="compare-column">
            <h3>Most resume checkers</h3>
            <ul>
              <li>Focus on ATS keywords and formatting scores.</li>
              <li>Give generic AI advice you’ve seen before.</li>
              <li>Often require an account before showing value.</li>
            </ul>
          </div>
          <div class="compare-column">
            <h3>Recruiter in Your Pocket</h3>
            <ul>
              <li>Shows how your story actually lands to a recruiter.</li>
              <li>Surfaces what’s working and what’s easy to miss.</li>
              <li>Gives before/after bullet upgrades in your own voice.</li>
              <li>Provides clear next steps in plain language.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Pricing Section -->
      <section class="pricing-section" id="pricing">
        <div class="pricing-header">
          <span class="pricing-chip">Simple pricing</span>
          <h2 class="pricing-title">Stop renting resume tools you only use for a week.</h2>
          <p class="pricing-subline">No subscriptions. Just passes that match how people really job hunt.</p>
          </div>
        
        <div class="pricing-grid">
          <!-- Free Tier -->
          <div class="pricing-card pricing-card--free">
            <div class="pricing-card-header">
              <div class="pricing-card-badge">Always free</div>
              <div class="pricing-card-price">
                <span class="pricing-price-amount">$0</span>
              </div>
              <h3 class="pricing-card-title">Clarity Score</h3>
            </div>
            <ul class="pricing-card-features">
              <li>Instant Clarity Score and recruiter-style diagnosis</li>
              <li>See how your resume actually reads to a hiring manager</li>
              <li>Your first full report is free. Detailed rewrites after that need a pass.</li>
              <li>No account or credit card required</li>
          </ul>
            <a href="#main-input" class="pricing-card-cta pricing-cta--free">Try it free</a>
          </div>
          
          <!-- 24-Hour Fix Pass -->
          <div class="pricing-card pricing-card--popular">
            <div class="pricing-card-popular-badge">Most popular</div>
            <div class="pricing-card-header">
              <div class="pricing-card-badge">Most popular</div>
              <div class="pricing-card-price">
                <span class="pricing-price-amount">$9</span>
              </div>
              <h3 class="pricing-card-title">24-Hour Fix Pass</h3>
            </div>
            <ul class="pricing-card-features">
              <li>Unlimited full reports for 24 hours</li>
              <li>Ideal when you need to send a resume today</li>
              <li>Use on any device with your email</li>
            </ul>
            <button type="button" class="pricing-card-cta pricing-cta--primary" data-tier="24h">Get 24-Hour Fix Pass</button>
          </div>
          
          <!-- 30-Day Campaign Pass -->
          <div class="pricing-card pricing-card--campaign">
            <div class="pricing-card-header">
              <div class="pricing-card-badge">Best value</div>
              <div class="pricing-card-price">
                <span class="pricing-price-amount">$39</span>
              </div>
              <h3 class="pricing-card-title">30-Day Campaign Pass</h3>
            </div>
            <ul class="pricing-card-features">
              <li>Unlimited full reports for 30 days</li>
              <li>Perfect when you're applying to multiple roles this month</li>
              <li>Use on any device with your email</li>
            </ul>
            <button type="button" class="pricing-card-cta pricing-cta--secondary" data-tier="30d">Get 30-Day Campaign Pass</button>
          </div>
        </div>
        
        <div class="pricing-trust-row">
          <span class="pricing-trust-item">
            <svg class="pricing-trust-icon" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9.022 3.173a.75.75 0 0 1 .956 0l5.25 4.2a.75.75 0 0 1 .272.577v3.7a5.25 5.25 0 0 1-3.089 4.79l-2.837 1.264a.75.75 0 0 1-.614 0l-2.837-1.264A5.25 5.25 0 0 1 3.5 11.65v-3.7a.75.75 0 0 1 .272-.577l5.25-4.2Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="m7.75 10.75 1.75 1.75 3.75-3.75" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Built by a top recruiter from OpenAI, FAANG, and global startups.
          </span>
          <span class="pricing-trust-item">
            <svg class="pricing-trust-icon" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.75 9V5.25a3.75 3.75 0 10-7.5 0V9m-.75 0h9a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-9a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Your resume never trains models
          </span>
          <span class="pricing-trust-item">
            <svg class="pricing-trust-icon" width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.75 4.5h10.5v11.25l-2.25-1.5-2.25 1.5-2.25-1.5-2.25 1.5-2.25-1.5-2.25 1.5V4.5z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 8.25h6M9 11.25h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            No hidden subscriptions
          </span>
        </div>
      </section>

      <div id="paywall-backdrop" class="paywall-backdrop" role="dialog" aria-modal="true" aria-labelledby="paywall-title">
        <div class="paywall-card paywall-card--pricing">
          <button id="paywall-close" class="paywall-close-btn" type="button" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="paywall-header">
            <div class="paywall-title" id="paywall-title">You’ve used your free reviews. Pick a pass to keep going.</div>
            <div class="paywall-subtitle">Pick a pass that fits your timeline. No subscriptions.</div>
          </div>
          
          <div class="paywall-tiers">
            <button type="button" class="paywall-tier paywall-tier--24h" data-tier="24h">
              <div class="paywall-tier-badge">Most popular</div>
              <div class="paywall-tier-price">$9</div>
              <div class="paywall-tier-name">24-Hour Fix Pass</div>
              <div class="paywall-tier-desc">Unlimited full reports for 24 hours. Ideal when you need to send a resume today.</div>
            </button>
            
            <button type="button" class="paywall-tier paywall-tier--30d" data-tier="30d">
              <div class="paywall-tier-badge">Best value</div>
              <div class="paywall-tier-price">$39</div>
              <div class="paywall-tier-name">30-Day Campaign Pass</div>
              <div class="paywall-tier-desc">Unlimited full reports for 30 days. Perfect when you're applying to multiple roles this month.</div>
            </button>
          </div>
          <div class="paywall-auth">
            <div class="paywall-input-group">
              <label for="paywall-email">Email to save your pass</label>
              <input id="paywall-email" type="email" placeholder="you@example.com" autocomplete="email" />
              <div class="paywall-input-helper">Use this email to access your pass from any device.</div>
            </div>
            <div class="paywall-actions-row">
              <button id="paywall-send-code" class="paywall-secondary" type="button">Send sign-in code</button>
            </div>
            <div class="paywall-input-group">
              <label for="paywall-code">Enter the 6-digit code</label>
              <input id="paywall-code" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="123456" maxlength="6" />
            </div>
            <div class="paywall-actions-row">
              <button id="paywall-verify" class="paywall-primary" type="button">Verify and continue</button>
            </div>
          </div>

          <div id="paywall-status" class="paywall-status" aria-live="polite"></div>
          
          <div class="paywall-footer">
            <span class="paywall-trust">No recurring charges • Instant access</span>
          </div>
        </div>
      </div>

      <!-- Short-resume confirmation dialog -->
      <div id="short-resume-dialog" class="short-resume-dialog" role="dialog" aria-modal="true" aria-labelledby="short-resume-title">
        <div class="short-resume-card">
          <div class="short-resume-icon">📋</div>
          <div class="short-resume-title" id="short-resume-title">This looks shorter than a typical resume</div>
          <div class="short-resume-message">Did you mean to paste the full thing? A complete resume helps us give you better, more specific feedback.</div>
          <div class="short-resume-actions">
            <button id="short-resume-paste-full" class="short-resume-primary" type="button">Paste full resume</button>
            <button id="short-resume-review-anyway" class="short-resume-secondary" type="button">Review anyway</button>
          </div>
          <label class="short-resume-checkbox">
            <input type="checkbox" id="short-resume-skip-checkbox" />
            Don't show this again today
          </label>
        </div>
      </div>

      <!-- After-run toast -->
      <div id="run-toast" class="run-toast" aria-live="polite"></div>

      <footer class="footer">
        Made with care in Boulder, CO 🤍
      </footer>
    </div>
  </div>

  <script>
  // NOTE: This frontend is intentionally single-file. If you add new pages or modes,
  // consider splitting styles into a shared CSS file and moving JS into a small app.js
  // to reduce risk and keep components reusable.
  const STORAGE_KEY = "rip-main-input-v1";
  const API_AUTH_TOKEN = window.API_AUTH_TOKEN || "c2f8e0d9a4b76c3d9f1a7b20d84c6e1a";
  const authHeaders = API_AUTH_TOKEN ? { Authorization: `Bearer ${API_AUTH_TOKEN}` } : {};
  // Inline sample report as a guaranteed fallback so the sample preview always renders
  window.SAMPLE_REPORT = window.SAMPLE_REPORT || {
    score: 86,
    score_label: "Strong",
    score_comment_short:
      "You read as someone who takes messy workstreams and makes them shippable.",
    score_comment_long:
      "You read as someone who takes messy workstreams and makes them shippable. Your edge is steady ownership: you keep leaders aligned, run the checklist, and make clear calls. You operate with structure and avoid drift even when requirements shift. What is harder to see is the exact scope—teams, volume, dollars—and the before/after change you drove. Trajectory points up if you surface scale and measurable outcomes faster.",
    summary:
      "You read as someone who takes messy workstreams and makes them shippable. Your edge is steady ownership: you keep leaders aligned, run the checklist, and make clear calls. You operate with structure and avoid drift even when requirements shift. What is harder to see is the exact scope—teams, volume, dollars—and the before/after change you drove. Trajectory points up if you surface scale and measurable outcomes faster.",
    strengths: [
      "You keep delivery on track when priorities change and still close the loop with stakeholders.",
      "You use structure (checklists, reviews, comms) so launches and projects avoid drift.",
      'You describe decisions you owned instead of hiding behind "the team."',
      "You show pattern recognition in how you prevent issues from recurring."
    ],
    gaps: [
      "Scope (teams, geos, customers, volume, dollars) is often missing.",
      "Before/after impact is implied but not stated; add metrics or clear qualitative change.",
      "Some bullets blend multiple ideas; split them so impact lands.",
      "A few phrases could be more specific to the systems or programs you ran."
    ],
    rewrites: [
      {
        label: "Impact",
        original: "Improved process across teams.",
        better:
          "Ran a cross-team launch with clear owners, decisions, and checkpoints so delivery hit the agreed date.",
        enhancement_note:
          "If you have it, include: number of teams/regions and shipments or users affected, so scope is obvious."
      },
      {
        label: "Scope",
        original: "Supported leadership on projects.",
        better:
          "Supported leadership by running risk reviews and comms so projects stayed aligned across teams.",
        enhancement_note:
          "If you have it, include: number of teams or regions involved, which clarifies scale."
      },
      {
        label: "Clarity",
        original: "Handled stakeholder updates.",
        better:
          "Kept launches on track by running checklists, risk reviews, and stakeholder comms so go-live stayed on schedule.",
        enhancement_note:
          "If you have it, include: number of launches per month/quarter and audience size, to show reach."
      },
      {
        label: "Ownership",
        original: "Handled stakeholder updates.",
        better:
          "Led stakeholder updates with decisions, risks, and next steps so leaders could unblock issues quickly.",
        enhancement_note:
          "If you have it, include: cadence and the groups involved, so the reader sees scale."
      }
    ],
    suggested_bullets: [],
    missing_wins: [
      "Highlight one launch where you personally unblocked delivery (owner, decision, outcome).",
      "Add scope to a top bullet: teams/regions/users so scale is obvious.",
      "Show one before/after metric to make the impact of your decisions clear."
    ],
    next_steps: [
      "Add scope (teams, volume, regions) to two top bullets.",
      "State one before/after metric in a headline bullet.",
      "Split any bullet that mixes decisions and outcomes."
    ],
    layout_score: 86,
    layout_band: "strong",
    layout_notes: "Content is clear; add scope and outcomes faster so impact lands."
  };

  const SAMPLE_IDEAS_VARIANTS = [
    {
      questions: [
        "At Stripe, how did you pick and ship the KYC changes that cut drop-off and lifted sign-ups?",
        "When coordinating launches across Google’s three regions, how did you keep comms tight and unblock teams?",
        "How did you build the metrics framework at Stripe so leaders could make faster decisions?"
      ]
    },
    {
      questions: [
        "When a Google experiment slipped, what call did you make to realign teams and get it back on track?",
        "Which signals did you use at Stripe to choose the KYC fixes that moved conversion most?",
        "What was the toughest launch escalation you owned, and how did you resolve it?"
      ]
    },
    {
      questions: [
        "When execs wanted weekly clarity, how did you adapt the metrics cadence so decisions sped up?",
        "How did you prevent a launch risk at Google, and what was the impact on teams or users?",
        "At Stripe, how did you decide the highest-leverage scope to tackle first, and what changed after?"
      ]
    },
    {
      questions: [
        "How did you simplify a cross-functional decision you owned, and what changed for the teams involved?",
        "When data was thin, how did you pick which launch to greenlight, and what result followed?",
        "Where did you improve onboarding or activation, and how did you measure the lift?"
      ]
    }
  ].map((variant) => ({
    questions: variant.questions,
    notes: [
      "Answer 1–3 questions in a separate doc so you don’t overwrite what already works.",
      "From each answer, pull scope, the call you made, and the outcome (ideally with a number).",
      "Turn each into one bullet: verb + what you owned + outcome with a number."
    ],
    how_to_use:
      "Use these to surface wins your resume isn’t telling yet. If it would repeat what’s already on the page, skip it."
  }));

  const inputEl = document.getElementById("main-input");
  const inputLabelEl = document.getElementById("input-label");
  const runButton = document.getElementById("run-button");
  const statusEl = document.getElementById("status");
  const resultsTitleEl = document.getElementById("results-title");
  const resultsSubtitleEl = document.getElementById("results-subtitle");
  const resultsSummaryEl = document.getElementById("results-summary");
  const resultsBodyEl = document.getElementById("results-body");
  const resultsSkeletonEl = document.getElementById("results-skeleton");
  const reportViewEl = document.getElementById("report-view");
  const reportAccentLineEl = document.querySelector(".report-accent-line");
  const scoreWrapperEl = document.getElementById("score-wrapper");
  const scoreBandsTriggerEl = document.getElementById("score-bands-trigger");
  const scoreDialContainerEl = document.getElementById("score-dial-container");
  const issueBreakdownEl = document.getElementById("issue-breakdown");
  const scoreDialEl = document.getElementById("score-dial");
  const scoreDialProgressEl = document.getElementById("score-dial-progress");
  const scoreDialNumberEl = document.getElementById("score-dial-number");
  const scoreDialLabelEl = document.getElementById("score-dial-label");
  const scoreTooltipEl = document.getElementById("score-tooltip");
  const copyFullButtonEl = document.getElementById("copy-full-button");
  const exportButtonEl = document.getElementById("export-button");
  const resultsActionsBottomEl = document.getElementById("results-actions-bottom");
  const reportWrapperEl = document.querySelector(".report-wrapper");
  const dataHandlingInlineEl = document.getElementById("data-handling-inline");
  const dataModalEl = document.getElementById("data-modal");
  const dataModalCardEl = document.getElementById("data-modal-card");
  const dataModalCloseEl = document.getElementById("data-modal-close");
  const reportTagEl = document.getElementById("report-tag");
  const textareaEl = document.getElementById("main-input");
  const savedIndicatorEl = document.getElementById("saved-indicator");
  const loadingBarEl = document.getElementById("loading-bar");
  const sampleResumeButtonEl = document.getElementById("sample-resume-button");
  const sampleReportButtonEl = document.getElementById("sample-report-button");
  const clearButtonEl = document.getElementById("clear-button");
  const ideasInlineEl = document.getElementById("ideas-inline");
  const ideasOpenEl = document.getElementById("ideas-open");
  const ideasModalEl = document.getElementById("ideas-modal");
  const ideasBackdropEl = document.getElementById("ideas-backdrop");
  const ideasRefreshEl = document.getElementById("ideas-refresh");
  const ideasCloseEl = document.getElementById("ideas-close");
  const ideasBodyEl = document.getElementById("ideas-body");
  const ideasLoadingBarEl = document.getElementById("ideas-loading-bar");
  const ideasStatusEl = document.getElementById("ideas-status");
  const focusToggleEl = document.getElementById("focus-toggle");
  const charCountEl = document.getElementById("char-count");
  const validationErrorEl = document.getElementById("validation-error");
  const prefersReducedMotionQuery = window.matchMedia
    ? window.matchMedia("(prefers-reduced-motion: reduce)")
    : null;
  let focusMode = false;
  let hasReportContent = false;
  let hasLoggedPaste = false;
  let lastReportData = null;
  let isSampleReportActive = false;
  let cachedSampleReport = null;
  let hasPlayedReportReveal = false;
  let previousBodyOverflow = "";
  let currentReportIsSample = false;
  let dataModalReturnEl = null;
  let currentUser = null;
  let activePass = null;
  let selectedTier = "24h";

  function setFocusMode(enabled) {
    focusMode = Boolean(enabled);
    document.body.classList.toggle("focus-mode", focusMode);
    if (focusToggleEl) {
      focusToggleEl.classList.toggle("hidden", !hasReportContent);
      focusToggleEl.textContent = focusMode ? "Back to editor" : "Focus on report";
    }
    if (focusMode) {
      triggerFocusEntrance();
    }
  }

  // Theme management
  const themeToggleEl = document.getElementById("theme-toggle");
  const themeToggleIconEl = themeToggleEl ? themeToggleEl.querySelector(".theme-toggle-icon") : null;

  function getSystemPreference() {
    if (window.matchMedia) {
      return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    return "light";
  }

  function getStoredTheme() {
    try {
      return localStorage.getItem("theme");
    } catch (e) {
      return null;
    }
  }

  function setTheme(theme) {
    const root = document.documentElement;
    if (theme === "dark") {
      root.setAttribute("data-theme", "dark");
      if (themeToggleIconEl) {
        themeToggleIconEl.textContent = "☀️";
      }
      if (themeToggleEl) {
        themeToggleEl.setAttribute("aria-label", "Toggle light mode");
        themeToggleEl.setAttribute("title", "Toggle light mode");
      }
    } else {
      root.removeAttribute("data-theme");
      if (themeToggleIconEl) {
        themeToggleIconEl.textContent = "🌙";
      }
      if (themeToggleEl) {
        themeToggleEl.setAttribute("aria-label", "Toggle dark mode");
        themeToggleEl.setAttribute("title", "Toggle dark mode");
      }
    }
    try {
      localStorage.setItem("theme", theme);
    } catch (e) {
      // Ignore localStorage errors
    }
  }

  function initTheme() {
    const stored = getStoredTheme();
    const system = getSystemPreference();
    const theme = stored || system;
    setTheme(theme);
  }

  // Initialize theme on page load
  initTheme();
  refreshSessionState();

  // Listen for system preference changes
  if (window.matchMedia) {
    const colorSchemeQuery = window.matchMedia("(prefers-color-scheme: dark)");
    colorSchemeQuery.addEventListener("change", (e) => {
      const stored = getStoredTheme();
      if (!stored) {
        setTheme(e.matches ? "dark" : "light");
      }
    });
  }

  // Toggle theme on button click
  if (themeToggleEl) {
    themeToggleEl.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      setTheme(newTheme);
    });
  }

  const paywallBackdropEl = document.getElementById("paywall-backdrop");
  const paywallUpgradeEl = document.getElementById("paywall-upgrade");
  const paywallCloseEl = document.getElementById("paywall-close");
  const paywallStatusEl = document.getElementById("paywall-status");
  const paywallEmailInput = document.getElementById("paywall-email");
  const paywallCodeInput = document.getElementById("paywall-code");
  const paywallSendCodeBtn = document.getElementById("paywall-send-code");
  const paywallVerifyBtn = document.getElementById("paywall-verify");
  const paywallTierButtons = Array.from(document.querySelectorAll(".paywall-tier"));

  const currentMode = "resume";
  let saveTimeout = null;
  let originalButtonText = runButton.textContent;
  let ideasInFlight = false;
  let ideasRefreshCount = 0;
  const ideasSeenOrder = [];
  const ideasSeenSet = new Set();
  const ideasSeenQuestions = new Set();
  let currentScoreMeta = null;
  let lastScoreValue = null;
  let scoreBandsPinned = false;
  let scoreBandsHovering = false;
  let isSampleRun = false;

  const FREE_RUN_LIMIT = 2;
  const RUN_COUNT_KEY = "rip-free-runs-v2";
  const PAID_KEY = "rip-paid-v1";
  const SHORT_RESUME_SKIP_KEY = "rip-short-resume-skip-v1";

  // Short-resume detection thresholds (tunable)
  const SHORT_RESUME_CHAR_THRESHOLD = 1200;
  const SHORT_RESUME_BULLET_THRESHOLD = 8;

  // Mixpanel integration
  // DNT check and token-based tracking
  function trackEvent(name, props = {}) {
    // Check Do Not Track
    const dnt = navigator.doNotTrack === "1" || navigator.doNotTrack === "yes";
    if (dnt) {
      console.log("[event:dnt]", name, props);
      return;
    }
    // If Mixpanel is loaded and token is set, track
    if (window.mixpanel && window.MIXPANEL_TOKEN) {
      mixpanel.track(name, {
        ...props,
        timestamp: new Date().toISOString()
      });
    } else {
      console.log("[event]", name, props);
    }
  }

  // Backward-compatible alias
  function logEvent(name, data = {}) {
    trackEvent(name, data);
  }

  // Server-side free run tracking (cookie-based)
  // The server manages free runs via HTTP-only cookies
  // Client tracks last known state for UI purposes
  let clientFreeRunIndex = 0;
  let clientFreeUsesRemaining = FREE_RUN_LIMIT;

  function updateFreeRunState(serverResponse) {
    if (typeof serverResponse.free_run_index === "number") {
      clientFreeRunIndex = serverResponse.free_run_index;
    }
    if (typeof serverResponse.free_uses_remaining === "number") {
      clientFreeUsesRemaining = serverResponse.free_uses_remaining;
    }
  }

  function getRunCount() {
    // Deprecated: server tracks free runs
    return clientFreeRunIndex;
  }

  function incrementRunCount() {
    // Deprecated: server tracks free runs
    return clientFreeRunIndex;
  }

  function isPaid() {
    return Boolean(activePass);
  }

  function markPaid() {
    // Deprecated: pass status is maintained server-side
  }

  // Short-resume detection helpers
  function countBullets(text) {
    const bulletPatterns = /^[\s]*[-•*▪▸►●○◦⦿⦾]/gm;
    const matches = text.match(bulletPatterns);
    return matches ? matches.length : 0;
  }

  function isShortResume(text) {
    const trimmed = (text || "").trim();
    const charCount = trimmed.length;
    const bulletCount = countBullets(trimmed);
    return charCount < SHORT_RESUME_CHAR_THRESHOLD || bulletCount < SHORT_RESUME_BULLET_THRESHOLD;
  }

  function shouldSkipShortResumeDialog() {
    try {
      return sessionStorage.getItem(SHORT_RESUME_SKIP_KEY) === "1";
    } catch {
      return false;
    }
  }

  function setSkipShortResumeDialog() {
    try {
      sessionStorage.setItem(SHORT_RESUME_SKIP_KEY, "1");
    } catch {
      // Ignore storage errors
    }
  }

  function showReportContainer() {
    if (reportWrapperEl) {
      reportWrapperEl.style.display = "block";
    }
    if (reportViewEl) {
      reportViewEl.classList.add("report-container--visible");
    }
  }

  function showPaywall(msg = "") {
    logEvent("paywall_impression");
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "flex";
    }
    selectTier(selectedTier || "24h");
    if (paywallStatusEl) {
      const reassurance = "Your current report stays here while you upgrade.";
      paywallStatusEl.textContent = msg ? `${msg} ${reassurance}` : reassurance;
    }
    // Auto-focus the primary upgrade path (selected tier), fallback to email input.
    requestAnimationFrame(() => {
      const hasEmail = (paywallEmailInput?.value || "").trim().length > 0;
      const hasCode = (paywallCodeInput?.value || "").trim().length > 0;
      const activeTier =
        document.querySelector(".paywall-tier.selected") || paywallTierButtons?.[0];

      if (hasEmail && hasCode && paywallVerifyBtn?.focus) {
        paywallVerifyBtn.focus({ preventScroll: true });
        return;
      }

      if (activeTier?.focus) {
        activeTier.focus({ preventScroll: true });
        return;
      }

      if (paywallEmailInput?.focus) {
        paywallEmailInput.focus({ preventScroll: true });
      }
    });
  }

  function hidePaywall() {
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "none";
    }
    if (paywallStatusEl) {
      paywallStatusEl.textContent = "";
    }
  }

  function prefersReducedMotion() {
    return !!(prefersReducedMotionQuery && prefersReducedMotionQuery.matches);
  }

  const TIER_KEY = "rip-tier-v1";
  const TIER_EXPIRY_KEY = "rip-tier-expiry-v1";

  function getTierInfo() {
    try {
      const tier = localStorage.getItem(TIER_KEY);
      const expiry = localStorage.getItem(TIER_EXPIRY_KEY);
      if (!tier || !expiry) return null;
      const expiryDate = new Date(expiry);
      if (expiryDate < new Date()) {
        // Tier expired
        localStorage.removeItem(TIER_KEY);
        localStorage.removeItem(TIER_EXPIRY_KEY);
        localStorage.removeItem(PAID_KEY);
        return null;
      }
      return { tier, expiry: expiryDate };
    } catch (e) {
      return null;
    }
  }

  function setTierInfo(tier) {
    try {
      const now = new Date();
      let expiry;
      if (tier === "30d") {
        expiry = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days
      } else {
        expiry = new Date(now.getTime() + 24 * 60 * 60 * 1000); // 24 hours
      }
      localStorage.setItem(TIER_KEY, tier);
      localStorage.setItem(TIER_EXPIRY_KEY, expiry.toISOString());
    } catch (e) {
      console.warn("Could not save tier info", e);
    }
  }

  (function handleCheckoutParams() {
    const params = new URLSearchParams(window.location.search);
    const status = params.get("checkout");
    const tier = params.get("tier");
    if (status === "success") {
      refreshSessionState();
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
    if (status === "cancelled") {
      logEvent("checkout_cancelled");
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
  })();

  async function refreshSessionState() {
    try {
      const resp = await fetch("/api/me", { headers: authHeaders });
      const data = await resp.json().catch(() => null);
      if (data?.ok) {
        currentUser = data.user;
        activePass = data.active_pass;
      }
    } catch (err) {
      console.warn("Could not refresh session", err);
    }
  }

  function openDataModal() {
    if (!dataModalEl || !dataModalCardEl) return;
    dataModalEl.classList.remove("hidden");
    dataModalEl.setAttribute("aria-hidden", "false");
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    dataModalReturnEl = document.activeElement instanceof HTMLElement ? document.activeElement : null;
    const focusable = dataModalEl.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
    if (focusable.length > 0) {
      focusable[0].focus();
    }
  }

  function closeDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.add("hidden");
    dataModalEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = previousBodyOverflow || "";
    const returnTarget = dataModalReturnEl || dataHandlingInlineEl;
    if (returnTarget && typeof returnTarget.focus === "function") returnTarget.focus();
    dataModalReturnEl = null;
  }

  function trapDataModalFocus(event) {
    if (!dataModalEl || dataModalEl.classList.contains("hidden")) return;
    const focusable = dataModalEl.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
    if (focusable.length === 0) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (event.key === "Tab") {
      if (event.shiftKey && document.activeElement === first) {
        event.preventDefault();
        last.focus();
      } else if (!event.shiftKey && document.activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    }
    if (event.key === "Escape") {
      event.preventDefault();
      closeDataModal();
    }
  }

  function autoResizeTextarea() {
    const maxHeight = 340;
    inputEl.style.height = "auto";
    const next = Math.min(inputEl.scrollHeight, maxHeight);
    inputEl.style.height = next + "px";
  }

  function showSavedIndicator() {
    if (!savedIndicatorEl) return;
    savedIndicatorEl.classList.add("visible");
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      savedIndicatorEl.classList.remove("visible");
    }, 1200);
  }

  function updateClearButtonVisibility() {
    if (clearButtonEl) {
      const hasText = inputEl.value.trim().length > 0;
      clearButtonEl.classList.toggle("hidden", !hasText);
    }
  }

  function clearInput() {
    inputEl.value = "";
    autoResizeTextarea();
    updateCharCount();
    clearValidationError();
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {
      console.warn("Could not clear saved input", e);
    }
    resetIdeasSection();
    closeIdeasModal();
    if (ideasInlineEl) {
      ideasInlineEl.classList.add("hidden");
    }
    updateClearButtonVisibility();
    // Hide report shell and related state
    if (reportWrapperEl) reportWrapperEl.style.display = "none";
    if (reportViewEl) reportViewEl.classList.remove("report-container--visible");
    hasPlayedReportReveal = false;
    if (reportTagEl) reportTagEl.classList.add("hidden");
    if (issueBreakdownEl) issueBreakdownEl.classList.add("hidden");
    clearScoreBadge();
    lastReportData = null;
    currentReportIsSample = false;
    isSampleReportActive = false;
    if (resultsBodyEl) {
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
    }
    renderSummary("");
    if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
    clearScoreBadge();
    updateToolLayout();
  }

  function loadSavedInput() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        inputEl.value = saved;
        autoResizeTextarea();
        updateCharCount();
        showSavedIndicator();
        updateClearButtonVisibility();
        return;
      }
    } catch (e) {
      console.warn("Could not load saved input", e);
    }
    inputEl.value = "";
    autoResizeTextarea();
    updateCharCount();
    updateClearButtonVisibility();
  }

  const MAX_TEXT_LENGTH = 30000;
  const WARNING_THRESHOLD = 0.9; // 90% of limit

  function updateCharCount() {
    if (!charCountEl || !inputEl) return;
    const length = inputEl.value.length;
    const trimmedLength = inputEl.value.trim().length;
    
    if (length === 0) {
      charCountEl.textContent = "";
      charCountEl.classList.remove("warning", "error");
      return;
    }

    const percentage = length / MAX_TEXT_LENGTH;
    charCountEl.textContent = `${length.toLocaleString()} / ${MAX_TEXT_LENGTH.toLocaleString()} characters`;
    
    if (percentage >= 1.0) {
      charCountEl.classList.add("error");
      charCountEl.classList.remove("warning");
    } else if (percentage >= WARNING_THRESHOLD) {
      charCountEl.classList.add("warning");
      charCountEl.classList.remove("error");
    } else {
      charCountEl.classList.remove("warning", "error");
    }
  }

  function showValidationError(message) {
    if (!validationErrorEl) return;
    validationErrorEl.textContent = message;
    validationErrorEl.classList.remove("hidden");
  }

  function clearValidationError() {
    if (!validationErrorEl) return;
    validationErrorEl.textContent = "";
    validationErrorEl.classList.add("hidden");
  }

  function validateInput() {
    const text = inputEl.value.trim();
    clearValidationError();

    if (!text) {
      return { valid: false, error: "Paste your resume so I can review it." };
    }

    if (inputEl.value.length > MAX_TEXT_LENGTH) {
      return {
        valid: false,
        error: `Your resume text is very long (${inputEl.value.length.toLocaleString()} characters). Try sending a smaller section or trimming extra content.`
      };
    }

    return { valid: true };
  }

  inputEl.addEventListener("input", (event) => {
    autoResizeTextarea();
    updateCharCount();
    clearValidationError();
    const trimmed = inputEl.value.trim();

    if (!trimmed) {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {
        console.warn("Could not clear saved input", e);
      }
      resetIdeasSection();
      if (ideasInlineEl) ideasInlineEl.classList.add("hidden");
      closeIdeasModal();
      updateClearButtonVisibility();
      return;
    }

    try {
      localStorage.setItem(STORAGE_KEY, inputEl.value);
    } catch (e) {
      console.warn("Could not save input", e);
    }
    showSavedIndicator();
    updateClearButtonVisibility();
  });

  inputEl.addEventListener("paste", () => {
    if (!hasLoggedPaste) {
      logEvent("resume_pasted");
      hasLoggedPaste = true;
    }
  });

  function updateToolLayout() {
    const toolLayout = document.querySelector('.tool-layout');
    const resultsBody = document.getElementById('results-body');
    
    if (toolLayout && resultsBody) {
      if (resultsBody.classList.contains('empty')) {
        toolLayout.classList.add('input-full-width');
      } else {
        toolLayout.classList.remove('input-full-width');
      }
    }
  }

  // Stub function for legacy renderSummary calls
  function renderSummary(message) {
    // Summary is now rendered as part of the report chapters
    // This stub prevents errors from legacy code paths
    if (resultsSummaryEl && message) {
      resultsSummaryEl.textContent = message;
    }
  }

  function clearScoreBadge() {
    if (scoreDialNumberEl) scoreDialNumberEl.textContent = "0";
    if (scoreDialContainerEl) {
      scoreDialContainerEl.className = "score-dial-container";
      scoreDialContainerEl.removeAttribute("aria-label");
    }
    if (scoreDialProgressEl) {
      scoreDialProgressEl.style.strokeDashoffset = "339.292";
    }
    if (scoreTooltipEl) {
      scoreTooltipEl.textContent = "";
      scoreTooltipEl.classList.remove("open");
      scoreTooltipEl.setAttribute("aria-hidden", "true");
    }
    if (scoreWrapperEl) scoreWrapperEl.classList.add("hidden");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "none";
    if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
    if (issueBreakdownEl) {
      issueBreakdownEl.classList.add("hidden");
      issueBreakdownEl.classList.remove("visible");
      // Reset display for Focus & Craft bar
      const focusBar = issueBreakdownEl.querySelector('[data-section="focus-craft"]');
      if (focusBar) {
        focusBar.style.display = '';
      }
    }
    currentScoreMeta = null;
    lastScoreValue = null;
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", "false");
  }

  const SCORE_BANDS = [
    {
      id: "not_ready",
      min: 60,
      max: 69,
      label: "Not ready",
      description: "Story is hard to follow. Sections blur together and impact is mostly missing."
    },
    {
      id: "thin_signal",
      min: 70,
      max: 77,
      label: "Thin signal",
      description: "Some good pieces, but the signal is faint. Bullets are vague or light on impact."
    },
    {
      id: "strong_foundation",
      min: 78,
      max: 84,
      label: "Strong foundation",
      description: "Core story is clear. Real wins are present, but not every bullet carries weight."
    },
    {
      id: "high_bar",
      min: 85,
      max: 91,
      label: "High bar",
      description: "Ownership, scope, and results are consistently clear with very little noise."
    },
    {
      id: "rare_air",
      min: 92,
      max: 100,
      label: "Rare air",
      description: "Exceptionally clear and dense signal. Every line earns its place."
    }
  ];

  function getBandIdFromScore(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    const match = SCORE_BANDS.find((band) => clamped >= band.min && clamped <= band.max);
    if (match) return match.id;
    if (clamped < SCORE_BANDS[0].min) return SCORE_BANDS[0].id;
    return SCORE_BANDS[SCORE_BANDS.length - 1].id;
  }

  function getScoreMeta(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    if (clamped >= 97) {
      return {
        score: clamped,
        label: "Rare air",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 92) {
      return {
        score: clamped,
        label: "Top-bar ready",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 85) {
      return {
        score: clamped,
        label: "High bar",
        short: "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        long:
          "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 78) {
      return {
        score: clamped,
        label: "Strong story",
        short: "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        long:
          "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 70) {
      return {
        score: clamped,
        label: "Solid foundation",
        short:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        long:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 60) {
      return {
        score: clamped,
        label: "Needs clarity",
        short:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        long:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 50) {
      return {
        score: clamped,
        label: "Thin signal",
        short: "Ownership and outcomes are hard to see.",
        long:
          "Rebuild top bullets with clear role, scope, and before/after changes. Add context before applying.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    return {
      score: clamped,
      label: "Not ready",
      short: "Hard to see role, scope, or results.",
      long:
        "Add structure, roles, and outcomes so there is usable signal. Right now it is not review-ready.",
      bandId: getBandIdFromScore(clamped)
    };
  }

  function applyScoreColor(score) {
    if (Number.isNaN(score) || !scoreDialContainerEl) return;
    
    // Clear previous color classes
    scoreDialContainerEl.classList.remove("score-low", "score-mid", "score-good", "score-great");
    
    // Apply color class based on score
    let cls = "";
    if (score < 50) cls = "score-low";
    else if (score < 70) cls = "score-mid";
    else if (score < 90) cls = "score-good";
    else cls = "score-great";
    
    if (cls) {
      scoreDialContainerEl.classList.add(cls);
    }
    
    // Update dial progress and number with synchronized animation
    const circumference = 2 * Math.PI * 54; // radius is 54, approximately 339.292
    const targetScore = Math.round(score);
    const targetPercentage = Math.max(0, Math.min(100, targetScore)) / 100;
    const targetOffset = circumference * (1 - targetPercentage);
    const currentScore = parseInt(scoreDialNumberEl?.textContent) || 0;
    const currentPercentage = Math.max(0, Math.min(100, currentScore)) / 100;
    const currentOffset = circumference * (1 - currentPercentage);
    
    if (scoreDialProgressEl) {
      // Ensure stroke-dasharray is set
      if (!scoreDialProgressEl.style.strokeDasharray) {
        scoreDialProgressEl.style.strokeDasharray = circumference;
      }
      // Set initial position based on current score
      scoreDialProgressEl.style.strokeDashoffset = currentOffset;
    }
    
    // Animate both dial progress and number together
    if (prefersReducedMotion()) {
      if (scoreDialNumberEl) scoreDialNumberEl.textContent = targetScore;
      if (scoreDialProgressEl) scoreDialProgressEl.style.strokeDashoffset = targetOffset;
    } else {
      const duration = 800;
      const startDelay = 300; // Match hero dial delay
      const startTime = Date.now();
      
      if (scoreDialNumberEl) scoreDialNumberEl.textContent = currentScore.toString();
      
      setTimeout(() => {
        const animate = () => {
          const elapsed = Date.now() - startTime - startDelay;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
          const current = Math.round(currentScore + (targetScore - currentScore) * eased);
          const currentPercentage = Math.max(0, Math.min(100, current)) / 100;
          const currentOffset = circumference * (1 - currentPercentage);
          
          if (scoreDialNumberEl) {
            scoreDialNumberEl.textContent = current.toString();
          }
          if (scoreDialProgressEl) {
            scoreDialProgressEl.style.strokeDashoffset = currentOffset;
          }
          
          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            if (scoreDialNumberEl) scoreDialNumberEl.textContent = targetScore.toString();
            if (scoreDialProgressEl) scoreDialProgressEl.style.strokeDashoffset = targetOffset;
          }
        };
        animate();
      }, startDelay);
    }
    
    // Set aria label
    scoreDialContainerEl.setAttribute("aria-label", `Score ${Math.round(score)} out of 100`);
  }

  function renderScoreBandsPanel(scoreMeta = {}) {
    if (!scoreTooltipEl) return;
    const bandId = scoreMeta.bandId || getBandIdFromScore(scoreMeta.score);
    const bandsMarkup = SCORE_BANDS.map((band) => {
      const isActive = band.id === bandId;
      return `
        <div class="score-band-item ${isActive ? "active" : ""}">
          <div class="score-band-header">
            <span class="score-band-range">${band.min} to ${band.max}</span>
            <span class="score-band-label">· ${escapeHtml(band.label)}</span>
            ${isActive ? '<span class="score-band-chip">Your band</span>' : ""}
          </div>
          <div class="score-band-description">${escapeHtml(band.description)}</div>
        </div>
      `;
    }).join("");

    scoreTooltipEl.innerHTML = `
      <div class="score-bands-panel">
        <div class="score-bands-panel-title">How to read this score</div>
        <div class="score-bands-intro">This clarity score is powered by a calibrated model shaped by thousands of real interview cycles. Each band reflects how clearly your story lands on a first read.</div>
        <div class="score-bands-list">${bandsMarkup}</div>
      </div>
    `;
  }

  function updateScoreBandsVisibility() {
    if (!scoreTooltipEl) return;
    const isOpen = (scoreBandsPinned || scoreBandsHovering) && !!currentScoreMeta;
    scoreTooltipEl.classList.toggle("open", isOpen);
    scoreTooltipEl.setAttribute("aria-hidden", isOpen ? "false" : "true");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", isOpen ? "true" : "false");
  }

  function triggerScoreGlow() {
    if (!scoreDialContainerEl || prefersReducedMotion()) return;
    scoreDialContainerEl.classList.remove("score-dial--reveal");
    void scoreDialContainerEl.offsetWidth;
    scoreDialContainerEl.classList.add("score-dial--reveal");
  }

  function toggleScoreBandsPinned() {
    if (!currentScoreMeta) return;
    scoreBandsPinned = !scoreBandsPinned;
    if (scoreBandsPinned) {
      renderScoreBandsPanel(currentScoreMeta);
    }
    updateScoreBandsVisibility();
  }

  function closeScoreBandsPanel() {
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    updateScoreBandsVisibility();
  }

  function renderScoreMeta(score, modelMeta = {}) {
    const meta = getScoreMeta(score);
    const prevScoreValue = lastScoreValue;
    
    // Show the dial container
    if (scoreDialContainerEl) {
      scoreDialContainerEl.classList.add("visible");
      scoreDialContainerEl.classList.remove("score-dial--reveal");
      void scoreDialContainerEl.offsetWidth;
      scoreDialContainerEl.classList.add("score-dial--reveal");
    }
    
    applyScoreColor(meta.score);
    
    if (prevScoreValue !== meta.score) {
      triggerScoreGlow();
    }
    lastScoreValue = meta.score;

    const labelText = (modelMeta.score_label || "").trim() || meta.label;
    const shortText = (modelMeta.score_comment_short || "").trim() || meta.short;
    const longText = (modelMeta.score_comment_long || "").trim() || meta.long;
    currentScoreMeta = {
      ...meta,
      label: labelText,
      short: shortText,
      long: longText
    };
    renderScoreBandsPanel(currentScoreMeta);
    updateScoreBandsVisibility();
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "inline";
    if (scoreWrapperEl) scoreWrapperEl.classList.remove("hidden");
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function extractVerdict(summary) {
    if (!summary || !summary.trim()) return "";
    const sentences = summary
      .split(/(?<=[.!?])\s+/)
      .map((s) => s.trim())
      .filter(Boolean);
    return sentences.slice(0, 2).join(" ");
  }

  function extractTopFixes(data) {
    const { gaps = [], rewrites = [], next_steps: nextSteps = [] } = data || {};
    const fixes = [];
    const seen = new Set();

    const pushUnique = (value) => {
      const text = String(value || "").trim();
      if (!text) return;
      const key = text.toLowerCase();
      if (seen.has(key)) return;
      seen.add(key);
      fixes.push(text);
    };
    
    // Prioritize actionable next steps, then the clearest gaps.
    nextSteps.slice(0, 3).forEach(pushUnique);
    if (fixes.length < 3) {
      gaps.slice(0, 3 - fixes.length).forEach(pushUnique);
    }
    // Fall back only to rewrite enhancement notes (avoid original/better text).
    if (fixes.length < 3) {
      for (const r of rewrites) {
        pushUnique(r?.enhancement_note);
        if (fixes.length >= 3) break;
      }
    }
    
    return fixes.slice(0, 3);
  }

  function renderHeaderVerdictAndFixes(data) {
    const verdictEl = document.getElementById("report-verdict");
    const topFixesEl = document.getElementById("top-fixes");
    const topFixesListEl = topFixesEl ? topFixesEl.querySelector(".top-fixes-list") : null;
    
    const verdict = extractVerdict(data.summary);
    const topFixes = extractTopFixes(data);
    
    if (verdictEl) {
      if (verdict) {
        verdictEl.textContent = verdict;
        verdictEl.classList.remove("hidden");
      } else {
        verdictEl.classList.add("hidden");
      }
    }
    
    if (topFixesListEl) {
      if (topFixes.length > 0) {
        topFixesListEl.innerHTML = topFixes.map(fix => 
          `<li>${escapeHtml(String(fix))}</li>`
        ).join("");
        if (topFixesEl) topFixesEl.classList.remove("hidden");
      } else {
        if (topFixesEl) topFixesEl.classList.add("hidden");
      }
    }
  }

  function createCardPreview(content, type) {
    if (type === "summary") {
      const text = String(content || "").trim();
      if (!text) return "";
      const sentences = text.split(/(?<=[.!?])\s+/).filter(Boolean);
      const preview = sentences.slice(0, 1).join(" ") || text;
      // Truncate to ~120 chars if longer
      return preview.length > 120 ? preview.substring(0, 120) + "…" : preview;
    }
    if (type === "list") {
      const items = Array.isArray(content) ? content : [];
      if (items.length > 0) {
        const first = String(items[0] || "").trim();
        // Truncate to ~100 chars if longer
        return first.length > 100 ? first.substring(0, 100) + "…" : first;
      }
    }
    if (type === "rewrites") {
      const rewrites = Array.isArray(content) ? content : [];
      if (rewrites.length > 0) {
        const first = rewrites[0];
        const preview = String(first?.better || first?.original || "").trim();
        // Truncate to ~100 chars if longer
        return preview.length > 100 ? preview.substring(0, 100) + "…" : preview;
      }
    }
    return "";
  }

  function toggleCard(cardEl) {
    if (!cardEl) return;
    const isExpanded = cardEl.classList.contains("expanded");
    const toggleBtn = cardEl.querySelector('.report-card-toggle');
    const contentEl = cardEl.querySelector('.report-card-content');
    
    if (isExpanded) {
      cardEl.classList.remove("expanded");
      if (toggleBtn) {
        toggleBtn.setAttribute("aria-expanded", "false");
        toggleBtn.querySelector('span:first-child').textContent = "Expand";
      }
    } else {
      cardEl.classList.add("expanded");
      if (toggleBtn) {
        toggleBtn.setAttribute("aria-expanded", "true");
        toggleBtn.querySelector('span:first-child').textContent = "Collapse";
      }
    }
  }

  // Static chapter renderer (replaces collapsible cards)
  function renderChapter(sectionId, title, subtitle, contentHtml) {
    return `
      <div class="report-chapter" data-section="${sectionId}">
        <h3 class="report-chapter-title">${escapeHtml(title)}</h3>
        <p class="report-chapter-subtitle">${escapeHtml(subtitle)}</p>
        <div class="report-chapter-content">
          ${contentHtml}
        </div>
      </div>
    `;
  }

  // Legacy card renderer (kept for backwards compatibility)
  function renderCard(sectionId, title, subtitle, preview, contentHtml, isExpanded = false) {
    // Now uses static chapter layout
    return renderChapter(sectionId, title, subtitle, contentHtml);
  }

  function applySectionReveal() {
    const elements = [];
    if (resultsSummaryEl) {
      const summaryHeading = resultsSummaryEl.querySelector(".result-heading");
      if (summaryHeading) elements.push(summaryHeading);
    }
    if (resultsBodyEl) {
      const bodyHeadings = resultsBodyEl.querySelectorAll(".result-heading");
      bodyHeadings.forEach((el) => elements.push(el));
    }
    if (!elements.length) return;
    if (prefersReducedMotion()) {
      elements.forEach((el) => {
        el.style.removeProperty("animation-delay");
        el.classList.add("report-section");
      });
      return;
    }
    let delay = 260;
    elements.forEach((el) => {
      el.classList.add("report-section");
      el.style.animationDelay = `${delay}ms`;
      delay += 80;
    });
  }

  function triggerReportReveal() {
    if (!reportViewEl) return;
    applySectionReveal();
    if (!hasPlayedReportReveal) {
      reportViewEl.classList.add("report-container--visible");
      hasPlayedReportReveal = true;
    }
  }

  function triggerFocusEntrance() {
    if (!reportViewEl || prefersReducedMotion()) return;
    reportViewEl.classList.add("report-view--focus-start");
    void reportViewEl.offsetWidth;
    reportViewEl.classList.remove("report-view--focus-start");
  }

  function calculateIssueCounts(data) {
    const { gaps = [], rewrites = [] } = data || {};
    
    let impactResultsCount = 0;
    let clarityStructureCount = 0;
    let focusCraftCount = 0;

    // Group rewrites the same way renderStructuredResults does
    const clarityGroup = [];
    const impactGroup = [];
    const focusCraftGroup = [];
    
    for (const r of rewrites) {
      if (!r) continue;
      const label = (r.label || "").toLowerCase();
      if (label.includes("clarity") || label.includes("concise") || label.includes("conciseness") || label.includes("brevity") || label.includes("phrasing")) {
        clarityGroup.push(r);
      } else if (label.includes("impact") || label.includes("scope") || label.includes("ownership")) {
        impactGroup.push(r);
      } else if (label.includes("focus") || label.includes("relevance") || label.includes("craft") || label.includes("polish")) {
        focusCraftGroup.push(r);
      }
    }

    // Impact & Results: Count only rewrites in the Impact cluster (what's actually shown)
    impactResultsCount = impactGroup.length;

    // Clarity & Conciseness: Count only rewrites in the Clarity cluster (what's actually shown)
    clarityStructureCount = clarityGroup.length;

    // Focus & Craft: Count only Focus/Craft rewrites (no fallback - only show if rewrites exist)
    focusCraftCount = focusCraftGroup.length;

    return {
      impactResults: impactResultsCount,
      clarityStructure: clarityStructureCount,
      focusCraft: focusCraftCount
    };
  }

  function updateIssueBreakdown(counts) {
    if (!issueBreakdownEl) return;

    const impactBar = issueBreakdownEl.querySelector('[data-section="impact-results"]');
    const clarityBar = issueBreakdownEl.querySelector('[data-section="clarity-structure"]');
    const focusBar = issueBreakdownEl.querySelector('[data-section="focus-craft"]');

    if (impactBar) {
      const countEl = impactBar.querySelector('.issue-bar-count');
      if (countEl) {
        countEl.textContent = counts.impactResults === 1 ? '1 top suggestion' : `${counts.impactResults} top suggestions`;
      }
      impactBar.setAttribute('data-count', String(counts.impactResults));
    }

    if (clarityBar) {
      const countEl = clarityBar.querySelector('.issue-bar-count');
      if (countEl) {
        countEl.textContent = counts.clarityStructure === 1 ? '1 top suggestion' : `${counts.clarityStructure} top suggestions`;
      }
      clarityBar.setAttribute('data-count', String(counts.clarityStructure));
    }

    if (focusBar) {
      // Only show Focus & Craft bar if there are actual rewrites
      if (counts.focusCraft > 0) {
        const countEl = focusBar.querySelector('.issue-bar-count');
        if (countEl) {
          countEl.textContent = counts.focusCraft === 1 ? '1 top suggestion' : `${counts.focusCraft} top suggestions`;
        }
        focusBar.setAttribute('data-count', String(counts.focusCraft));
        focusBar.style.display = '';
      } else {
        // Hide the bar if no Focus/Craft rewrites exist
        focusBar.style.display = 'none';
      }
    }

    // Show the breakdown panel
    issueBreakdownEl.classList.remove('hidden');
    setTimeout(() => {
      issueBreakdownEl.classList.add('visible');
    }, 100);
  }

  function handleIssueBarClick(section) {
    const resultsBodyEl = document.getElementById("results-body");
    if (!resultsBodyEl) return;

    let targetChapter = null;

    if (section === "impact-results" || section === "clarity-structure") {
      // Scroll to "Stronger phrasing" chapter
      targetChapter = resultsBodyEl.querySelector('[data-section="stronger-phrasing"]');
    } else if (section === "focus-craft") {
      // Scroll to "What's harder to see" chapter
      targetChapter = resultsBodyEl.querySelector('[data-section="harder-to-see"]');
    }

    if (targetChapter) {
      targetChapter.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Add a subtle highlight effect
      targetChapter.style.transition = 'background-color var(--motion-duration-short) var(--motion-ease-premium)';
      targetChapter.style.backgroundColor = 'var(--accent-wash)';
      setTimeout(() => {
        targetChapter.style.backgroundColor = '';
        setTimeout(() => {
          targetChapter.style.transition = '';
        }, 180);
      }, 1000);
    }
  }

  function renderStructuredResults(data, options = {}) {
    const { isSample = false, accessTier = "pass_full" } = options;
    const {
      summary,
      strengths,
      gaps,
      rewrites,
      next_steps: nextSteps,
      score,
      score_label: scoreLabelText,
      score_comment_short: scoreCommentShort,
      score_comment_long: scoreCommentLong,
      suggested_bullets: suggestedBullets,
      missing_wins: missingWins
    } = data || {};
    hasReportContent = true;

    // Determine if this is a full access report or thin/free report
    const isFullAccess = accessTier === "pass_full" || isSample;
    const isFreeRun = accessTier === "free_full";
    
    // Free tier limits (spec: thin report = 2-3 issues, 1-2 rewrites)
    const FREE_ISSUES_LIMIT = 3;
    const FREE_REWRITES_LIMIT = 2;

    // Show/hide sample tag
    if (isSample) {
      showSampleTag();
    } else {
      hideSampleTag();
    }

    // Update export/copy button visibility based on access tier
    if (exportButtonEl) {
      if (isFullAccess) {
        exportButtonEl.style.display = "";
        exportButtonEl.disabled = false;
      } else {
        exportButtonEl.style.display = "none";
      }
    }
    if (copyFullButtonEl) {
      if (isFullAccess) {
        copyFullButtonEl.style.display = "";
        copyFullButtonEl.disabled = false;
      } else {
        copyFullButtonEl.style.display = "none";
      }
    }

    // Render header with verdict and top-3 fixes
    renderHeaderVerdictAndFixes(data);

    // Score dial and commentary
    if (typeof score === "number") {
      renderScoreMeta(score, {
        score_label: scoreLabelText,
        score_comment_short: scoreCommentShort,
        score_comment_long: scoreCommentLong
      });
    } else {
      clearScoreBadge();
    }

    // Calculate and update issue breakdown counts
    const counts = calculateIssueCounts({ gaps, rewrites });
    updateIssueBreakdown(counts);

    let html = "";

    // Card 1: How your story reads (summary)
    if (summary && summary.trim()) {
      const preview = createCardPreview(summary, "summary");
      const contentHtml = `<p class="result-paragraph">${escapeHtml(summary)}</p>`;
      html += renderCard("story-reads", "How your story reads", "A quick read on how your resume actually lands.", preview, contentHtml, true);
    }

    // Card 2: What's working (strengths)
    if (Array.isArray(strengths) && strengths.length > 0) {
      const preview = createCardPreview(strengths, "list");
      let contentHtml = `<ul class="result-list">`;
      for (const item of strengths) {
        if (!item) continue;
        contentHtml += `<li>${escapeHtml(String(item))}</li>`;
      }
      contentHtml += `</ul>`;
      html += renderCard("whats-working", "What is working", "Strengths that are already clear on first read and help your story land as intended.", preview, contentHtml);
    }

    // Card 3: What's harder to see (gaps)
    if (Array.isArray(gaps) && gaps.length > 0) {
      const preview = createCardPreview(gaps, "list");
      const gapsToShow = isFreeRun ? gaps.slice(0, FREE_ISSUES_LIMIT) : gaps;
      const hiddenGaps = isFreeRun ? Math.max(0, gaps.length - FREE_ISSUES_LIMIT) : 0;
      
      let contentHtml = `<ul class="result-list">`;
      for (const item of gapsToShow) {
        if (!item) continue;
        contentHtml += `<li>${escapeHtml(String(item))}</li>`;
      }
      contentHtml += `</ul>`;
      
      // Add locked section teaser if there are more gaps
      if (hiddenGaps > 0) {
        contentHtml += `<div class="locked-section-teaser">`;
        contentHtml += `<div class="locked-section-icon">🔒</div>`;
        contentHtml += `<div class="locked-section-text">Unlock ${hiddenGaps} more issue${hiddenGaps > 1 ? 's' : ''} identified</div>`;
        contentHtml += `<a href="#pricing" class="locked-section-cta" onclick="trackEvent('paywall_opened', { source: 'locked_issues' })">Get every fix with a pass →</a>`;
        contentHtml += `</div>`;
      }
      
      html += renderCard("harder-to-see", "What is harder to see", "Surfaces buried impact, unclear outcomes, and work that isn't landing clearly yet.", preview, contentHtml);
    }

    // Card 4: Stronger phrasing you can use (rewrites)
    if (Array.isArray(rewrites) && rewrites.length > 0) {
      const clarityGroup = [];
      const impactGroup = [];
      const fallbackGroup = [];

      for (const r of rewrites) {
        if (!r) continue;
        const label = (r.label || "").toLowerCase();
        if (label.includes("clarity") || label.includes("concise") || label.includes("conciseness") || label.includes("brevity") || label.includes("phrasing")) {
          clarityGroup.push(r);
        } else if (label.includes("impact") || label.includes("scope") || label.includes("ownership")) {
          impactGroup.push(r);
        } else {
          fallbackGroup.push(r);
        }
      }

      while (fallbackGroup.length) {
        const target = clarityGroup.length <= impactGroup.length ? clarityGroup : impactGroup;
        target.push(fallbackGroup.shift());
      }

      // For free runs, limit rewrites shown
      const totalRewrites = clarityGroup.length + impactGroup.length;
      const hiddenRewrites = isFreeRun ? Math.max(0, totalRewrites - FREE_REWRITES_LIMIT) : 0;
      let rewritesShown = 0;

      const renderRewriteGroup = (groupItems, maxToShow = Infinity) => {
        let groupHtml = "";
        let shown = 0;
        for (const r of groupItems) {
          if (!r) continue;
          if (shown >= maxToShow) break;
          
          const original = r.original || "";
          const better = r.better || "";
          const enhancementNote = r.enhancement_note || r.enhancementNote || "";

          groupHtml += `<div class="rewrite-block">`;
          groupHtml += `<div class="rewrite-columns">`;

          groupHtml += `<div class="rewrite-column">`;
          if (original) {
            groupHtml += `<div class="rewrite-label">Original</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(original))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `<div class="rewrite-column right">`;
          if (better) {
            groupHtml += `<div class="rewrite-label">Better</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(better))}</div>`;
          }
          if (enhancementNote) {
            groupHtml += `<div class="rewrite-enhancement-note">${escapeHtml(String(enhancementNote))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `</div>`;
          groupHtml += `</div>`;
          shown++;
        }
        rewritesShown += shown;
        return groupHtml;
      };

      const preview = createCardPreview(rewrites, "rewrites");
      let contentHtml = "";
      
      if (isFreeRun) {
        // For free runs, show limited rewrites across both groups
        const remainingLimit = FREE_REWRITES_LIMIT;
        if (clarityGroup.length > 0) {
          const clarityLimit = Math.min(clarityGroup.length, Math.ceil(remainingLimit / 2));
          contentHtml += `<div class="rewrite-cluster-heading" data-cluster="clarity">Clarity & Conciseness</div>`;
          contentHtml += renderRewriteGroup(clarityGroup, clarityLimit);
        }
        if (impactGroup.length > 0 && rewritesShown < FREE_REWRITES_LIMIT) {
          const impactLimit = FREE_REWRITES_LIMIT - rewritesShown;
          contentHtml += `<div class="rewrite-cluster-heading" data-cluster="impact">Impact, Scope & Ownership</div>`;
          contentHtml += renderRewriteGroup(impactGroup, impactLimit);
        }
        
        // Add locked section teaser if there are more rewrites
        if (hiddenRewrites > 0) {
          contentHtml += `<div class="locked-section-teaser">`;
          contentHtml += `<div class="locked-section-icon">🔒</div>`;
          contentHtml += `<div class="locked-section-text">Unlock ${hiddenRewrites} more rewrite${hiddenRewrites > 1 ? 's' : ''} in this section</div>`;
          contentHtml += `<a href="#pricing" class="locked-section-cta" onclick="trackEvent('paywall_opened', { source: 'locked_rewrites' })">Get every fix with a pass →</a>`;
          contentHtml += `</div>`;
        }
      } else {
        // Full access - show all rewrites
        if (clarityGroup.length > 0) {
          contentHtml += `<div class="rewrite-cluster-heading" data-cluster="clarity">Clarity & Conciseness</div>`;
          contentHtml += renderRewriteGroup(clarityGroup);
        }
        if (impactGroup.length > 0) {
          contentHtml += `<div class="rewrite-cluster-heading" data-cluster="impact">Impact, Scope & Ownership</div>`;
          contentHtml += renderRewriteGroup(impactGroup);
        }
      }

      html += renderCard("stronger-phrasing", "Stronger phrasing you can use", "Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.", preview, contentHtml);
    } else if (Array.isArray(suggestedBullets) && suggestedBullets.length > 0) {
      const preview = createCardPreview(suggestedBullets, "list");
      let contentHtml = `<ul class="result-list">`;
      for (const bullet of suggestedBullets) {
        if (!bullet) continue;
        contentHtml += `<li>${escapeHtml(String(bullet))}</li>`;
      }
      contentHtml += `</ul>`;
      html += renderCard("stronger-phrasing", "Stronger phrasing you can use", "Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.", preview, contentHtml);
    }

    // Card 5: Next steps
    const fixedNextSteps = [
      "Split multi idea bullets so your role and impact are clearer.",
      "Add numbers or specific outcomes where they strengthen the story.",
      "Highlight your ownership in key achievements so your contribution stands out.",
      "Remember to make your strongest work easy to spot. Most recruiters will make a yes, no, or maybe decision within a few seconds."
    ];
    const preview = createCardPreview(fixedNextSteps, "list");
    let contentHtml = `<ul class="result-list">`;
    for (const step of fixedNextSteps) {
      contentHtml += `<li>${escapeHtml(String(step))}</li>`;
    }
    contentHtml += `</ul>`;
    html += renderCard("next-steps", "Next steps", "Clear, doable actions that build momentum and make your story easier to read.", preview, contentHtml);

    if (!html) {
      html = '<div class="report-chapter"><p class="report-chapter-content">No feedback returned.</p></div>';
    }

    // Add free tier upsell banner for free runs
    if (isFreeRun) {
      html += `<div class="free-tier-upsell">`;
      html += `<div class="free-tier-upsell-icon">✨</div>`;
      html += `<div class="free-tier-upsell-title">Want the complete picture?</div>`;
      html += `<div class="free-tier-upsell-text">Unlock every rewrite, Missing Wins prompts, and PDF export with a pass.</div>`;
      html += `<button type="button" class="free-tier-upsell-cta" onclick="document.getElementById('pricing').scrollIntoView({ behavior: 'smooth' }); trackEvent('paywall_opened', { source: 'free_tier_banner' })">See pass options →</button>`;
      html += `</div>`;
    }

    // Wrap chapters in a container
    resultsBodyEl.innerHTML = `<div class="report-chapters">${html}</div>`;

    // Show/hide Missing Wins section based on access tier
    if (ideasInlineEl) {
      if (isFullAccess) {
        ideasInlineEl.classList.remove("hidden");
      } else {
        // Hide Missing Wins for free tier, show locked teaser instead
        ideasInlineEl.classList.add("hidden");
      }
    }

    resultsBodyEl.classList.remove("refreshed");
    void resultsBodyEl.offsetWidth;
    resultsBodyEl.classList.add("refreshed");
    resultsBodyEl.classList.remove("empty");
    resultsBodyEl.classList.add("results-body-better-flash");
    setTimeout(() => resultsBodyEl.classList.remove("results-body-better-flash"), 220);
    updateToolLayout();
  }

  if (scoreWrapperEl) {
    scoreWrapperEl.addEventListener("mouseenter", () => {
      if (!currentScoreMeta) return;
      scoreBandsHovering = true;
      renderScoreBandsPanel(currentScoreMeta);
      updateScoreBandsVisibility();
    });
    scoreWrapperEl.addEventListener("mouseleave", () => {
      scoreBandsHovering = false;
      updateScoreBandsVisibility();
    });
  }

  if (scoreDialContainerEl) {
    // Issue breakdown bar click handlers
    if (issueBreakdownEl) {
      const issueBars = issueBreakdownEl.querySelectorAll('.issue-bar');
      issueBars.forEach(bar => {
        bar.addEventListener('click', () => {
          const section = bar.getAttribute('data-section');
          if (section) {
            handleIssueBarClick(section);
          }
        });
      });
    }

    scoreDialContainerEl.addEventListener("click", () => {
      toggleScoreBandsPinned();
    });
  }

  if (scoreBandsTriggerEl) {
    scoreBandsTriggerEl.addEventListener("click", (event) => {
      event.preventDefault();
      toggleScoreBandsPinned();
    });
  }

  document.addEventListener("click", (event) => {
    if (
      (scoreTooltipEl && scoreTooltipEl.contains(event.target)) ||
      (scoreWrapperEl && scoreWrapperEl.contains(event.target)) ||
      (scoreBandsTriggerEl && scoreBandsTriggerEl.contains(event.target))
    ) {
      return;
    }
    closeScoreBandsPanel();
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      closeScoreBandsPanel();
    }
  });

  function selectTier(tier = "24h") {
    selectedTier = tier || "24h";
    paywallTierButtons.forEach((btn) => {
      const isActive = btn.getAttribute("data-tier") === selectedTier;
      btn.classList.toggle("selected", isActive);
    });
    if (paywallStatusEl) paywallStatusEl.textContent = "";
  }

  async function startCheckout(tier = selectedTier) {
    if (paywallStatusEl) paywallStatusEl.textContent = "Opening checkout...";
    logEvent("checkout_started", { tier });
    try {
      const resp = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: { ...authHeaders, "Content-Type": "application/json" },
        body: JSON.stringify({ tier })
      });
      const data = await resp.json().catch(() => null);
      if (resp.status === 401) {
        if (paywallStatusEl) paywallStatusEl.textContent = "Enter your email and code to continue.";
        return;
      }
      if (!resp.ok || !data?.ok || !data?.url) {
        const msg =
          data?.message || "Could not start checkout right now. Try again in a moment.";
        if (paywallStatusEl) paywallStatusEl.textContent = msg;
        return;
      }
      window.location.href = data.url;
    } catch (err) {
      if (paywallStatusEl) {
        paywallStatusEl.textContent =
          "Could not start checkout right now. Try again in a moment.";
      }
    }
  }

  // Paywall tier buttons
  document.querySelectorAll(".paywall-tier").forEach((btn) => {
    btn.addEventListener("click", () => {
      const tier = btn.getAttribute("data-tier");
      selectTier(tier);
    });
  });

  // Pricing section CTA buttons
  document.querySelectorAll(".pricing-card-cta[data-tier]").forEach((btn) => {
    btn.addEventListener("click", () => {
      const tier = btn.getAttribute("data-tier");
      selectTier(tier);
      showPaywall();
    });
  });

  async function requestLoginCode() {
    const email = (paywallEmailInput?.value || "").trim();
    if (!email) {
      paywallStatusEl.textContent = "Enter your email to continue.";
      return;
    }
    paywallStatusEl.textContent = "Sending code...";
    try {
      const resp = await fetch("/api/login/request-code", {
        method: "POST",
        headers: { ...authHeaders, "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });
      const data = await resp.json().catch(() => null);
      if (!resp.ok || !data?.ok) {
        paywallStatusEl.textContent = data?.message || "Could not send code right now.";
        return;
      }
      paywallStatusEl.textContent = "Code sent. Check your email.";
    } catch (err) {
      paywallStatusEl.textContent = "Could not send code right now.";
    }
  }

  async function verifyLoginCodeAndCheckout() {
    const email = (paywallEmailInput?.value || "").trim();
    const code = (paywallCodeInput?.value || "").trim();
    if (!email || !code) {
      paywallStatusEl.textContent = "Enter your email and code.";
      return;
    }
    paywallStatusEl.textContent = "Verifying code...";
    try {
      const resp = await fetch("/api/login/verify", {
        method: "POST",
        headers: { ...authHeaders, "Content-Type": "application/json" },
        body: JSON.stringify({ email, code })
      });
      const data = await resp.json().catch(() => null);
      if (!resp.ok || !data?.ok) {
        paywallStatusEl.textContent = data?.message || "Invalid code. Try again.";
        return;
      }
      currentUser = data.user;
      activePass = data.active_pass;
      paywallStatusEl.textContent = "Verified. Redirecting to checkout...";
      await startCheckout(selectedTier);
    } catch (err) {
      paywallStatusEl.textContent = "Could not verify code right now.";
    }
  }

  if (paywallSendCodeBtn) {
    paywallSendCodeBtn.addEventListener("click", requestLoginCode);
  }

  if (paywallVerifyBtn) {
    paywallVerifyBtn.addEventListener("click", verifyLoginCodeAndCheckout);
  }

  if (paywallCloseEl) {
    paywallCloseEl.addEventListener("click", () => {
      hidePaywall();
      statusEl.textContent = "";
      setStatus("");
    });
  }

  // Short-resume dialog handlers
  const shortResumeDialogEl = document.getElementById("short-resume-dialog");
  const shortResumePasteFullBtn = document.getElementById("short-resume-paste-full");
  const shortResumeReviewAnywayBtn = document.getElementById("short-resume-review-anyway");
  const shortResumeSkipCheckbox = document.getElementById("short-resume-skip-checkbox");

  function showShortResumeDialog() {
    if (shortResumeDialogEl) {
      shortResumeDialogEl.classList.add("open");
      trackEvent("short_resume_dialog_shown", {
        text_length: inputEl.value.length,
        bullet_count: countBullets(inputEl.value)
      });
    }
  }

  function hideShortResumeDialog() {
    if (shortResumeDialogEl) {
      shortResumeDialogEl.classList.remove("open");
    }
  }

  // Toast management
  const runToastEl = document.getElementById("run-toast");
  let toastTimeout = null;

  function showRunToast(message, duration = 6000) {
    if (!runToastEl) return;
    
    // Clear any existing toast
    if (toastTimeout) clearTimeout(toastTimeout);
    runToastEl.classList.remove("visible");
    
    // Small delay before showing new toast (for animation reset)
    requestAnimationFrame(() => {
      runToastEl.textContent = message;
      runToastEl.classList.add("visible");
      
      toastTimeout = setTimeout(() => {
        runToastEl.classList.remove("visible");
      }, duration);
    });
  }

  function hideRunToast() {
    if (!runToastEl) return;
    if (toastTimeout) clearTimeout(toastTimeout);
    runToastEl.classList.remove("visible");
  }

  // Auto-dismiss toast on scroll
  window.addEventListener("scroll", () => {
    if (runToastEl?.classList.contains("visible")) {
      hideRunToast();
    }
  }, { passive: true });

  // Dismiss toast on click
  if (runToastEl) {
    runToastEl.addEventListener("click", hideRunToast);
    runToastEl.style.cursor = "pointer";
  }

  // Pending short-resume confirmation state
  let pendingShortResumeOptions = null;

  async function runAnalysis(options = {}) {
    const sampleRun = options.sample ?? isSampleRun;
    const shortConfirmed = options.shortConfirmed ?? false;
    currentReportIsSample = sampleRun;
    isSampleRun = false;
    const text = (options.textOverride ?? inputEl.value ?? "").trim();
    const wasSampleView = isSampleReportActive;

    // Short-resume check (only for non-sample, non-confirmed runs)
    if (!sampleRun && !shortConfirmed && isShortResume(text) && !shouldSkipShortResumeDialog()) {
      // Store the options and show dialog
      pendingShortResumeOptions = { ...options, textOverride: text };
      showShortResumeDialog();
      return;
    }

    // If the sample report was open, reset to the default input-focused view
    if (wasSampleView) {
      hideSampleTag();
      isSampleReportActive = false;
      currentReportIsSample = false;
      lastReportData = null;
      if (reportWrapperEl) {
        reportWrapperEl.style.display = "none";
      }
      if (resultsBodyEl) {
        resultsBodyEl.innerHTML = "";
        resultsBodyEl.classList.add("empty");
        resultsBodyEl.classList.remove("results-error", "muted");
        resultsBodyEl.style.display = "";
      }
      if (resultsActionsBottomEl) {
        resultsActionsBottomEl.classList.add("hidden");
      }
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      hasPlayedReportReveal = false;
      updateToolLayout();
    }

    trackEvent("review_started", { 
      sample: sampleRun, 
      text_length: text.length,
      bullet_count: countBullets(text),
      short_confirmed: shortConfirmed
    });
    
    // Client-side validation before API call
    const validation = validateInput();
    if (!validation.valid) {
      const msg = validation.error;
      statusEl.textContent = msg;
      setStatus(msg, "error");
      showValidationError(msg);
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.remove("results-error");
      renderSummary("");
      if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
      return;
    }
    
    clearValidationError();

    if (!focusMode) {
      setFocusMode(false);
    }
    statusEl.textContent = "Reading your resume like a recruiter…";
    statusEl.classList.add("status-loading");
    setStatus("Reading your resume like a recruiter…", "");
    const shouldShowSkeleton = !wasSampleView;

    // Clear previous render so old content doesn't persist under loading
    if (resultsBodyEl) {
      resultsBodyEl.innerHTML = "";
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.remove("results-error", "muted");
      resultsBodyEl.style.display = "";
    }
    if (resultsSummaryEl) {
      resultsSummaryEl.textContent = "";
    }

    if (shouldShowSkeleton) {
      // Ensure the report container is visible while skeleton is showing
      if (reportViewEl) {
        reportViewEl.classList.add("report-container--visible");
      }
      runButton.disabled = true;
      originalButtonText = runButton.textContent;
      runButton.textContent = "Processing...";
      runButton.classList.add("processing");
      loadingBarEl.classList.add("active");
      // Clear previous render so old content doesn't show under the skeleton
      if (resultsBodyEl) {
        resultsBodyEl.innerHTML = "";
        resultsBodyEl.classList.add("empty");
        resultsBodyEl.classList.remove("results-error", "muted");
        resultsBodyEl.style.display = "";
      }
      renderSummary("");
      // Show skeleton and hide results-body content during loading
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.remove("hidden");
      }
      // Ensure results area is visible
      if (reportWrapperEl) {
        reportWrapperEl.style.display = "block";
      }
      // Hide results-body content and show skeleton
      resultsBodyEl.classList.remove("results-error");
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.add("muted");
      resultsBodyEl.style.display = "none"; // Hide results-body when skeleton is showing
      
      // Auto-scroll to results area to show skeleton
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);
    } else {
      // Keep the input full-width until the new report is ready
      runButton.disabled = true;
      originalButtonText = runButton.textContent;
      runButton.textContent = "Processing...";
      runButton.classList.add("processing");
      loadingBarEl.classList.add("active");
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
    }
    clearScoreBadge();
    resetIdeasSection();

        try {
      const response = await fetch("/api/resume-feedback", {
        method: "POST",
        headers: {
          ...authHeaders,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          mode: currentMode,
          text,
          short_confirmed: shortConfirmed
        })
      });

      // New: read the unified payload from the backend
      const payload = await response.json().catch(() => null);

      const fieldMessages =
        payload?.details?.fieldErrors &&
        Object.values(payload.details.fieldErrors)
          .filter(Boolean)
          .join(" ");

      const isValidationError = payload?.errorCode === "VALIDATION_ERROR";

      // If HTTP is not ok or payload is missing, show a calm error
      if (!response.ok || !payload) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(
            payload?.errorCode,
            payload?.message || "Unexpected server response."
          );
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, "error");
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        showReportContainer();
        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
          updateToolLayout();
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
          updateToolLayout();
        }
        return;
      }

      // Backend explicitly signaled an error (ok === false)
      if (payload.ok === false) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(payload.errorCode, payload.message);
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, payload.errorCode === "PAYWALL_REQUIRED" ? "info" : "error");
        if (payload.errorCode === "PAYWALL_REQUIRED") {
          // Keep existing report visible; just prompt upgrade and surface paywall.
          showReportContainer();
          if (resultsBodyEl) {
            resultsBodyEl.classList.remove("results-error");
            resultsBodyEl.classList.remove("empty");
          }
          showPaywall();
          // Focus the paywall for accessibility
          if (paywallCloseEl) {
            paywallCloseEl.focus({ preventScroll: false });
          }
          // Soft-scroll to paywall/pricing area
          const pricingSection = document.querySelector(".pricing-section") || paywallBackdropEl;
          if (pricingSection && typeof pricingSection.scrollIntoView === "function") {
            pricingSection.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          // Do not clear last report; keep it visible.
          // Also avoid overwriting body with error content.
          return;
        }
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        showReportContainer();
        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
          updateToolLayout();
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
          updateToolLayout();
        }
        return;
      }

      // Happy path: payload.data is the validated object from the server
      let structured = null;

      if (payload.data && typeof payload.data === "object") {
        structured = payload.data;
      }

      if (payload.active_pass) {
        activePass = payload.active_pass;
      }
      if (payload.user) {
        currentUser = payload.user;
      }

      // Update free run state from server response
      updateFreeRunState(payload);

      // Track free report viewed event
      if (payload.access_tier === "free_full" && !sampleRun) {
        trackEvent("free_report_viewed", {
          free_run_index: payload.free_run_index,
          free_uses_remaining: payload.free_uses_remaining
        });

        // Show after-run toast based on which free run this was
        if (payload.free_run_index === 1) {
          showRunToast("Free report used. We'll give you one extra run in case you need it.");
        } else if (payload.free_run_index === 2) {
          showRunToast("You've used your free full reports. You can still get your Clarity Score for free anytime.");
        }
      }

      if (!structured) {
        const msg = "Unexpected server response.";
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, "error");
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        showReportContainer();
        resultsBodyEl.textContent = msg;
        resultsBodyEl.style.display = "";
        resultsBodyEl.classList.add("results-error");
        resultsBodyEl.classList.remove("empty");
        renderSummary("");
        updateToolLayout();
        return;
      }

      showReportContainer();
      renderStructuredResults(structured, { 
        isSample: false, 
        accessTier: payload.access_tier || "free_full"
      });
      isSampleReportActive = false;
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      lastReportData = structured;
      triggerReportReveal();
      // Hide skeleton and show results-body
      resultsBodyEl.style.display = ""; // Show results-body
      resultsBodyEl.classList.remove("empty");
      updateToolLayout();
      resultsBodyEl.classList.remove("results-error");
      if (resultsActionsBottomEl) {
        resultsActionsBottomEl.classList.remove("hidden");
      }
      
      // Export/copy only enabled for paid users
      const currentAccessTier = payload.access_tier || "free_full";
      const hasFullAccess = currentAccessTier === "pass_full";
      
      if (exportButtonEl) {
        if (hasFullAccess) {
          exportButtonEl.disabled = false;
          exportButtonEl.title = "";
          exportButtonEl.style.display = "";
        } else {
          exportButtonEl.style.display = "none";
        }
      }
      if (copyFullButtonEl) {
        if (hasFullAccess) {
          copyFullButtonEl.disabled = false;
          copyFullButtonEl.title = "";
          copyFullButtonEl.style.display = "";
        } else {
          copyFullButtonEl.style.display = "none";
        }
      }

      // Only preload Missing Wins for paid users
      if (hasFullAccess) {
        runIdeas({ auto: true, sourceText: text });
      }

      setFocusMode(true);
      
      // Auto-scroll to results area for all runs (not just sample)
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);

      if (typeof resultsBodyEl.scrollTo === "function") {
        resultsBodyEl.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        resultsBodyEl.scrollTop = 0;
      }

      statusEl.textContent = "";
      statusEl.classList.remove("status-loading");
      setStatus("");
    } catch (err) {
      console.error(err);
      statusEl.textContent =
        "Something went wrong. Try again in a moment.";
      statusEl.classList.remove("status-loading");
      setStatus("Something went wrong. Try again in a moment.", "error");
      // Hide skeleton on error
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      showReportContainer();
      resultsBodyEl.textContent =
        "Something went wrong. Try again in a moment.";
      resultsBodyEl.style.display = "";
      resultsBodyEl.classList.add("results-error");
      resultsBodyEl.classList.remove("empty");
      renderSummary("");
      updateToolLayout();
    } finally {
      runButton.disabled = false;
      runButton.textContent = originalButtonText;
      runButton.classList.remove("processing");
      loadingBarEl.classList.remove("active");
      // Only hide skeleton if it's still showing (in case of errors)
      if (resultsSkeletonEl && !resultsSkeletonEl.classList.contains("hidden")) {
        resultsSkeletonEl.classList.add("hidden");
        resultsBodyEl.style.display = ""; // Ensure results-body is visible
      }
      resultsBodyEl.classList.remove("muted");
    }
  }

  // Initialize layout on page load
  updateToolLayout();

  // Short-resume dialog button handlers
  if (shortResumePasteFullBtn) {
    shortResumePasteFullBtn.addEventListener("click", () => {
      trackEvent("short_resume_paste_full");
      hideShortResumeDialog();
      // Focus the input so user can paste full resume
      if (inputEl) {
        inputEl.focus();
        inputEl.select();
      }
      pendingShortResumeOptions = null;
    });
  }

  if (shortResumeReviewAnywayBtn) {
    shortResumeReviewAnywayBtn.addEventListener("click", () => {
      trackEvent("short_resume_review_anyway", {
        text_length: inputEl.value.length,
        bullet_count: countBullets(inputEl.value)
      });
      
      // Check if user wants to skip dialog in future
      if (shortResumeSkipCheckbox?.checked) {
        setSkipShortResumeDialog();
      }
      
      hideShortResumeDialog();
      
      // Continue with the analysis, marking as confirmed
      if (pendingShortResumeOptions) {
        const opts = { ...pendingShortResumeOptions, shortConfirmed: true };
        pendingShortResumeOptions = null;
        runAnalysis(opts);
      }
    });
  }

  runButton.addEventListener("click", runAnalysis);
  if (focusToggleEl) {
    focusToggleEl.addEventListener("click", () => {
      setFocusMode(!focusMode);
    });
  }

  function buildFullReportText(data) {
    if (!data || typeof data !== "object") return "";
    const lines = [];
    lines.push("Resume Review — Recruiter in Your Pocket");
    if (typeof data.score === "number") {
      const band = data.score_label ? ` — ${data.score_label}` : "";
      lines.push(`Score: ${Math.round(data.score)}/100${band}`);
    }
    lines.push("");

    if (data.summary) {
      lines.push("How your resume reads:");
      lines.push("");
      lines.push(data.summary);
      lines.push("");
    }

    if (Array.isArray(data.strengths) && data.strengths.length) {
      lines.push("What’s working:");
      lines.push("");
      data.strengths.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.gaps) && data.gaps.length) {
      lines.push("What’s harder to see:");
      lines.push("");
      data.gaps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.rewrites) && data.rewrites.length) {
      lines.push("Stronger phrasing you can use:");
      lines.push("");
      data.rewrites.forEach((r) => {
        if (!r) return;
        lines.push("Original:");
        lines.push("");
        if (r.original) lines.push(r.original);
        lines.push("");
        lines.push("Better:");
        lines.push("");
        if (r.better) lines.push(r.better);
        if (r.enhancement_note) lines.push(`  ${r.enhancement_note}`);
        lines.push("");
      });
    }

    if (Array.isArray(data.next_steps) && data.next_steps.length) {
      lines.push("Next steps:");
      lines.push("");
      data.next_steps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    lines.push("Generated with Recruiter in Your Pocket — recruiterinyourpocket.com");
    return lines.join("\n");
  }

  if (copyFullButtonEl) {
    copyFullButtonEl.addEventListener("click", async () => {
      if (!lastReportData) {
        statusEl.textContent = "Nothing to copy yet. Run a review first.";
        return;
      }
      if (isSampleReportActive) {
        statusEl.textContent = "Copy is available after you run your own resume.";
        return;
      }
      const text = buildFullReportText(lastReportData);
      if (!text.trim()) {
        statusEl.textContent = "Nothing to copy yet. Run a review first.";
        return;
      }
      try {
        await navigator.clipboard.writeText(text);
        statusEl.textContent = "Report copied.";
        
        // Visual feedback on button
        const originalText = copyFullButtonEl.innerHTML;
        copyFullButtonEl.textContent = "Copied!";
        copyFullButtonEl.classList.add("btn-success-state");
        
        setTimeout(() => {
          copyFullButtonEl.innerHTML = originalText;
          copyFullButtonEl.classList.remove("btn-success-state");
        }, 2000);

        logEvent("copy_clicked");
      } catch (err) {
        statusEl.textContent = "Couldn't copy. Try again.";
      }
    });
  }

  exportButtonEl.addEventListener("click", async () => {
    const originalExportText = exportButtonEl.textContent;
    exportButtonEl.disabled = true;
    exportButtonEl.textContent = "Preparing PDF...";
    const summaryText = resultsSummaryEl ? resultsSummaryEl.innerText.trim() : "";
    const bodyText = resultsBodyEl ? resultsBodyEl.innerText.trim() : "";
    const text = [summaryText, bodyText].filter(Boolean).join("\n\n");
    if (!text || !lastReportData) {
      statusEl.textContent = "Nothing to export yet. Run a review first.";
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
      return;
    }
    logEvent("export_clicked");

    try {
      const generatedOnLocal = new Date().toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
      const resp = await fetch("/api/export-pdf", {
        method: "POST",
        headers: {
          ...authHeaders,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          report: {
            ...lastReportData,
            generated_on: generatedOnLocal
          }
        })
      });
      if (!resp.ok) {
        statusEl.textContent = "Export isn't ready. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        if (downloadWindow && !downloadWindow.closed) downloadWindow.close();
        return;
      }
      const blob = await resp.blob();
      if (!blob || blob.size === 0) {
        statusEl.textContent = "Export isn't ready. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        return;
      }
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "resume-review.pdf";
      a.rel = "noopener";
      a.style.display = "none";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 60000);
      statusEl.textContent = "Exported PDF.";
      
      // Visual feedback
      exportButtonEl.textContent = "Downloaded!";
      exportButtonEl.classList.add("btn-success-state");
      
      setTimeout(() => {
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        exportButtonEl.classList.remove("btn-success-state");
      }, 2000);
    } catch (err) {
      statusEl.textContent = "Could not export right now. Try again.";
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
    }
  });

  inputEl.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
      e.preventDefault();
      runAnalysis({ sample: false });
    }
  });

  async function runIdeas(options = {}) {
    const { auto = false, sourceText, retryCount = 0 } = options;
    let text = (sourceText || inputEl.value || "").trim();
    if (!text && isSampleReportActive && typeof SAMPLE_RESUME_TEXT === "string") {
      text = SAMPLE_RESUME_TEXT.trim();
    }
    if (!text) {
      if (!auto) {
        setIdeasStatus("Add your resume first.", "error");
      }
      return;
    }

    // For the sample experience, cycle through hardwired variants and skip the API.
    if (isSampleReportActive && SAMPLE_IDEAS_VARIANTS.length > 0) {
      const variant = SAMPLE_IDEAS_VARIANTS[ideasRefreshCount % SAMPLE_IDEAS_VARIANTS.length];
      ideasRefreshCount += 1;
      renderIdeas(variant);
      setIdeasStatus("Questions ready.");
      setTimeout(() => setIdeasStatus(""), 1400);
      ideasInFlight = false;
      return;
    }

    const refreshHint =
      ideasSeenOrder.length < 4
        ? `\n\n[refresh-${ideasSeenOrder.length + 1}: vary the questions, avoid repeating earlier ideas, and choose different archetypes or companies/tools to explore.]`
        : "";
    const seenQuestionsList = Array.from(ideasSeenQuestions).slice(-6);
    const diversityHint =
      seenQuestionsList.length > 0
        ? `\n\nDo NOT repeat any of these questions or close paraphrases: ${seenQuestionsList
            .map((q) => `"${q}"`)
            .join(
              ", "
            )}. Keep each question one sentence, under ~22 words, in plain, natural phrasing. Avoid “one moment” phrasing. Vary openings and endings—don’t repeat “what changed?” on every question. Vary companies/teams/tools; avoid superlatives like “toughest” or stacked “At <company>” intros. Choose different archetypes and outcomes; avoid awkward or repetitive wording.`
        : `\n\nKeep each question one sentence, under ~22 words, in plain, natural phrasing. Avoid “one moment” phrasing. Vary openings and endings—don’t repeat “what changed?” on every question. Vary companies/teams/tools; avoid superlatives like “toughest” or stacked “At <company>” intros. Choose different archetypes and outcomes; avoid awkward or repetitive wording.`;
    const textWithHint = `${text}${refreshHint}${diversityHint}`.trim();

    if (ideasInFlight) return;
    ideasInFlight = true;

    const originalIdeasButtonText = ideasRefreshEl ? ideasRefreshEl.textContent : "";

    if (ideasRefreshEl) {
      ideasRefreshEl.disabled = true;
      ideasRefreshEl.textContent = auto ? "Refreshing..." : "Pulling questions...";
    }
    setIdeasStatus("Pulling new questions...");
    setIdeasLoading(true);
    if (ideasBodyEl) {
      ideasBodyEl.classList.remove("results-error");
    }

    try {
      const response = await fetch("/api/resume-ideas", {
        method: "POST",
        headers: {
          ...authHeaders,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ text: textWithHint })
      });

      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok === false) {
        const message =
          payload?.message || "There was an error generating ideas. Please try again.";
        if (ideasBodyEl) {
          ideasBodyEl.textContent = message;
          ideasBodyEl.classList.add("results-error");
          ideasBodyEl.classList.remove("empty");
        }
        setIdeasStatus(message, "error");
        return;
      }

      const structured = payload.data || payload;
      const questions = Array.isArray(structured?.questions) ? structured.questions : [];
      const signature = questions
        .map((q) => String(q || "").trim().toLowerCase())
        .filter(Boolean)
        .join(" | ");

      const seenBefore = signature && ideasSeenSet.has(signature);
      if (!seenBefore && signature) {
        ideasSeenSet.add(signature);
        ideasSeenOrder.push(signature);
        if (ideasSeenOrder.length > 4) {
          const removed = ideasSeenOrder.shift();
          if (removed) ideasSeenSet.delete(removed);
        }
      }

      const needDiversity = seenBefore && ideasSeenOrder.length < 4;
      if (needDiversity && retryCount < 2) {
        ideasInFlight = false;
        return runIdeas({ auto, sourceText, retryCount: retryCount + 1 });
      }

      // Track individual questions to discourage repeats in future refreshes.
      for (const q of questions) {
        const cleaned = String(q || "").trim();
        if (cleaned) ideasSeenQuestions.add(cleaned);
      }

      ideasRefreshCount += 1;
      renderIdeas(structured);
      setIdeasStatus("Questions ready.");
      setTimeout(() => setIdeasStatus(""), 1600);
    } catch (err) {
      console.error(err);
      if (ideasBodyEl) {
        ideasBodyEl.textContent =
          "Something unexpected glitched. Try again in a moment.";
        ideasBodyEl.classList.add("results-error");
        ideasBodyEl.classList.remove("empty");
      }
      setIdeasStatus("Couldn’t load questions. Try again.", "error");
    } finally {
      ideasInFlight = false;
      if (ideasRefreshEl) {
        ideasRefreshEl.disabled = false;
        ideasRefreshEl.textContent = originalIdeasButtonText || "Refresh";
      }
      setIdeasLoading(false);
    }
  }

  if (ideasOpenEl) {
    ideasOpenEl.addEventListener("click", () => {
      logEvent("missing_wins_opened");
      openIdeasModal();
      if (!ideasBodyEl || ideasBodyEl.classList.contains("empty")) {
        runIdeas({ auto: false });
      }
    });
  }

  if (ideasRefreshEl) {
    ideasRefreshEl.addEventListener("click", () => {
      runIdeas({ auto: false });
    });
  }

  if (ideasCloseEl) {
    ideasCloseEl.addEventListener("click", closeIdeasModal);
  }

  if (ideasBackdropEl) {
    ideasBackdropEl.addEventListener("click", closeIdeasModal);
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeIdeasModal();
    }
  });

  const SAMPLE_RESUME_TEXT = `Jane Doe
Senior Product Manager

Summary
Senior product manager with 7+ years of experience shipping consumer and B2B features in fast moving environments. Known for turning vague problems into clear roadmaps and coordinated launches.

Experience
Stripe — Senior Product Manager (2021–Present)
- Led cross functional team of engineers, designers, and data scientists to launch a new onboarding flow for small businesses.
- Simplified KYC steps and reduced drop off, increasing completed sign ups by 18% across key markets.
- Built a simple metrics framework so leadership could see impact weekly.

Google — Product Manager (2017–2021)
- Owned a set of growth experiments for a core collaboration product with tens of millions of users.
- Partnered with UX research and engineering to test new sharing flows that improved active usage by 9%.
- Drove roadmap, specs, and cross team communication for launches across three regions.

Education
BA, Economics
University of Washington

Skills
Product discovery, experimentation, roadmapping, stakeholder communication, SQL, basic Python, Figma`;

  if (dataHandlingInlineEl) {
    dataHandlingInlineEl.addEventListener("click", (event) => {
      event.preventDefault();
      openDataModal();
    });
  }

  if (dataModalCloseEl) {
    dataModalCloseEl.addEventListener("click", closeDataModal);
  }

  if (dataModalEl) {
    dataModalEl.addEventListener("click", (event) => {
      if (event.target === dataModalEl) {
        closeDataModal();
      }
    });
  }

  document.addEventListener("keydown", trapDataModalFocus);

  function openDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.remove("hidden");
    // Small timeout to allow display:flex to apply before opacity transition
    requestAnimationFrame(() => {
      // Force reflow
      void dataModalEl.offsetWidth;
      dataModalEl.classList.remove("hidden"); // Ensure class logic for transition works if using :not(.hidden)
      // Add a visible class if needed, but relying on removing 'hidden' and CSS :not(.hidden) logic
    });
    
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    
    // Trap focus
    const focusable = dataModalEl.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (focusable.length) focusable[0].focus();
  }

  function closeDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.add("hidden");
    document.body.style.overflow = previousBodyOverflow;
  }

  if (sampleResumeButtonEl) {
    sampleResumeButtonEl.addEventListener("click", () => {
      if (!inputEl) return;
      isSampleRun = true;
      inputEl.value = SAMPLE_RESUME_TEXT;
      try {
        localStorage.setItem(STORAGE_KEY, SAMPLE_RESUME_TEXT);
      } catch (e) {
        console.warn("Could not save sample input", e);
      }
      autoResizeTextarea();
      showSavedIndicator();
      updateClearButtonVisibility();
      runAnalysis({ sample: true, textOverride: SAMPLE_RESUME_TEXT });
      
      // Auto-scroll to results area after a brief delay to show skeleton
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 300);
    });
  }

  // Sample report loading and rendering
  async function loadSampleReport() {
    if (cachedSampleReport) {
      return cachedSampleReport;
    }

    // Check if window.SAMPLE_REPORT exists (from inline script)
    if (typeof window !== "undefined" && window.SAMPLE_REPORT) {
      cachedSampleReport = window.SAMPLE_REPORT;
      return cachedSampleReport;
    }

    // Otherwise fetch from JSON file
    try {
      const response = await fetch("/sample-report.json");
      if (!response.ok) {
        return null;
      }
      const data = await response.json();
      cachedSampleReport = data;
      return cachedSampleReport;
    } catch (err) {
      console.warn("Could not load sample report", err);
      return null;
    }
  }

  function showSampleTag() {
    if (reportTagEl) {
      reportTagEl.classList.remove("hidden");
    }
  }

  function hideSampleTag() {
    if (reportTagEl) {
      reportTagEl.classList.add("hidden");
    }
  }

  async function handleSampleReportClick() {
    if (!inputEl || !resultsBodyEl) return;

    // Ensure the report container is visible
    if (reportWrapperEl) {
      reportWrapperEl.style.display = "block";
    }
    // Clear status and errors
    if (statusEl) {
      statusEl.textContent = "";
      statusEl.classList.remove("status-loading", "status-error", "status-success");
    }
    clearValidationError();

    // Set sample report active state
    isSampleReportActive = true;
    showSampleTag();

    // Hide skeleton if visible
    if (resultsSkeletonEl) {
      resultsSkeletonEl.classList.add("hidden");
    }

    // Hide any error states
    resultsBodyEl.classList.remove("results-error", "empty", "muted");
    resultsBodyEl.style.display = "";

    // Log event
    logEvent("sample_report_viewed");

    // Load and render sample report
    const report = await loadSampleReport();
    if (!report) {
      const errorMsg = "Sample report is temporarily unavailable. Try running the sample resume instead.";
      if (statusEl) {
        statusEl.textContent = errorMsg;
        setStatus(errorMsg, "error");
      }
      resultsBodyEl.textContent = errorMsg;
      resultsBodyEl.classList.add("results-error");
      resultsBodyEl.classList.remove("empty");
      updateToolLayout();
      return;
    }

    // Render the sample report
    renderStructuredResults(report, { isSample: true });
    lastReportData = report;

    // Reset ideas diversity for the sample flow
    resetIdeasHistory();

    // Show export/copy buttons so users can see the full experience
    if (resultsActionsBottomEl) {
      resultsActionsBottomEl.classList.remove("hidden");
    }
    if (exportButtonEl) {
      exportButtonEl.disabled = false;
      exportButtonEl.title = "";
    }
    if (copyFullButtonEl) {
      copyFullButtonEl.disabled = false;
      copyFullButtonEl.title = "";
    }

    // Trigger reveal animation
    triggerReportReveal();
    updateToolLayout();

    // Preload missing wins so the modal shows real questions for the sample
    if (ideasBodyEl) {
      runIdeas({ auto: true, sourceText: SAMPLE_RESUME_TEXT });
    }

    // Auto-scroll to results (respect reduced motion)
    setTimeout(() => {
      const reportCard = document.querySelector(".card-output");
      if (reportCard && typeof reportCard.scrollIntoView === "function") {
        if (prefersReducedMotion()) {
          reportCard.scrollIntoView({ block: "start" });
        } else {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
    }, 100);
  }

  if (sampleReportButtonEl) {
    sampleReportButtonEl.addEventListener("click", handleSampleReportClick);
  }

  // Hero CTA buttons
  const heroCtaScrollEl = document.getElementById("hero-cta-scroll");
  const heroSampleReportEl = document.getElementById("hero-sample-report");

  if (heroCtaScrollEl) {
    heroCtaScrollEl.addEventListener("click", (e) => {
      e.preventDefault();
      const inputEl = document.getElementById("main-input");
      if (inputEl) {
        if (prefersReducedMotion()) {
          inputEl.scrollIntoView({ block: "center" });
        } else {
          inputEl.scrollIntoView({ behavior: "smooth", block: "center" });
        }
        setTimeout(() => inputEl.focus(), 400);
      }
    });
  }

  if (heroSampleReportEl) {
    heroSampleReportEl.addEventListener("click", handleSampleReportClick);
  }

  if (clearButtonEl) {
    clearButtonEl.addEventListener("click", () => {
      clearInput();
    });
  }

  // Backdrop click should not scroll page when modal hidden
  if (ideasModalEl) {
    ideasModalEl.addEventListener("click", (e) => {
      if (e.target === ideasModalEl) {
        closeIdeasModal();
      }
    });
  }
function mapErrorToUserMessage(errorCode, fallbackMessage) {
  switch (errorCode) {
    case "VALIDATION_ERROR":
      return "I need a bit more from you before I can give real feedback. Check what you pasted and try again.";
    case "OPENAI_TIMEOUT":
      return "The model took too long to finish this pass. Try again in a moment.";
    case "OPENAI_NETWORK_ERROR":
      return "There was a small network hiccup. Try again and it should go through.";
    case "OPENAI_HTTP_ERROR":
      return "The model had trouble finishing your review. Try once more.";
    case "OPENAI_RESPONSE_PARSE_ERROR":
    case "OPENAI_RESPONSE_SHAPE_INVALID":
    case "OPENAI_RESPONSE_NOT_JSON":
      return "The model replied in a format I could not read cleanly. Run it again and it should come back sharper.";
    default:
      return (
        fallbackMessage ||
        "Something on my side glitched while reading your resume. Try once more."
      );
  }
}

  function setStatus(message, variant = "info") {
    const el = document.getElementById("status-bar");
    if (!el) return;
    el.textContent = message || "";
    el.classList.remove("status-info", "status-error");
    if (message) {
      el.classList.add(variant === "error" ? "status-error" : "status-info");
    }
  }

  function resetIdeasHistory() {
    ideasRefreshCount = 0;
    ideasSeenOrder.length = 0;
    ideasSeenSet.clear();
    ideasSeenQuestions.clear();
  }

  function resetIdeasSection() {
    setIdeasStatus("");
    resetIdeasHistory();
    if (!ideasBodyEl) return;
    ideasBodyEl.innerHTML =
      "I’ll look for wins you have not written yet or forgot about.";
    ideasBodyEl.classList.add("empty");
    ideasBodyEl.classList.remove("results-error");
    if (ideasModalEl) {
      ideasModalEl.classList.remove("visible");
      ideasModalEl.setAttribute("aria-hidden", "true");
    }
  }

  function setIdeasStatus(message, variant = "info") {
    if (!ideasStatusEl) return;
    ideasStatusEl.textContent = message || "";
    ideasStatusEl.classList.toggle("error", variant === "error" && !!message);
  }

  function openIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("hidden");
    ideasModalEl.classList.add("visible");
    ideasModalEl.setAttribute("aria-hidden", "false");
    
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    
    // Force reflow to trigger transition
    requestAnimationFrame(() => {
       // ensure transition happens
       void ideasModalEl.offsetWidth;
    });

    const ideasSheetEl = document.getElementById("ideas-sheet");
    if (ideasSheetEl && typeof ideasSheetEl.scrollIntoView === "function") {
      ideasSheetEl.scrollIntoView({
        behavior: prefersReducedMotion() ? "auto" : "smooth",
        block: "center"
      });
    }
  }

  function closeIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("visible");
    ideasModalEl.classList.add("hidden");
    ideasModalEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = previousBodyOverflow;
  }

  function setIdeasLoading(isLoading) {
    if (!ideasLoadingBarEl) return;
    if (isLoading) {
      ideasLoadingBarEl.style.opacity = "1";
      ideasLoadingBarEl.style.animation = "loadingSlide 1.2s linear infinite";
      ideasLoadingBarEl.classList.add("active");
    } else {
      ideasLoadingBarEl.style.opacity = "0";
      ideasLoadingBarEl.style.animation = "none";
      ideasLoadingBarEl.classList.remove("active");
    }
  }

  function renderIdeas(data) {
    if (!ideasBodyEl) return;
    const { questions, notes, how_to_use: howToUse } = data || {};
    let html = "";

    if (Array.isArray(questions) && questions.length > 0) {
      // Deduplicate and shuffle to avoid the first question sticking.
      const uniq = Array.from(new Set(questions.map((q) => String(q || "").trim()))).filter(Boolean);
      const shuffled = uniq
        .map((item) => ({ item, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ item }) => item);
      const limited = shuffled.slice(0, 3);
      html += `<div class="ideas-section-card"><div class="ideas-section-title">Questions worth answering</div><div class="ideas-section-subline">Use these to surface wins your resume isn’t showing yet.</div><ul class="ideas-list">`;
      for (const q of limited) {
        html += `<li>${escapeHtml(String(q))}</li>`;
      }
      html += `</ul></div>`;
    }

    html += `<div class="ideas-section-card"><div class="ideas-section-title">How to use this</div><p>Pick one question and jot down what actually happened: the situation, the decision you made, what you owned, and what changed.</p></div>`;

    html += `<div class="ideas-section-card"><div class="ideas-section-title">Turn it into a bullet</div><p>Use: verb + what you owned + the outcome (ideally with a number). Skip it if it’s already covered in your resume.</p></div>`;

    ideasBodyEl.innerHTML = html || "";
    ideasBodyEl.classList.remove("empty");
    if (focusToggleEl) focusToggleEl.classList.remove("hidden");
    }


    // Hero dial number animation (0 → 86) with progressive circle fill
    function animateHeroDialNumber() {
      const dialNumber = document.querySelector('.hero-preview-dial-number');
      const dialElement = document.querySelector('.hero-preview-dial');
      if (!dialNumber || !dialElement) return;
      
      const targetValue = 86;
      const targetAngle = 309; // 86/100 * 360 = 309.6deg, rounded to 309deg
      
      if (prefersReducedMotion()) {
        dialNumber.textContent = targetValue.toString();
        dialElement.style.background = `conic-gradient(var(--accent) 0deg ${targetAngle}deg, var(--border-subtle) ${targetAngle}deg 360deg)`;
        return;
      }
      
      const duration = 800;
      const startTime = Date.now();
      const startDelay = 300;
      
      dialNumber.textContent = '0';
      dialElement.style.background = 'conic-gradient(var(--accent) 0deg 0deg, var(--border-subtle) 0deg 360deg)';
      
      setTimeout(() => {
        const animate = () => {
          const elapsed = Date.now() - startTime - startDelay;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
          const current = Math.round(targetValue * eased);
          const currentAngle = Math.round((current / targetValue) * targetAngle);
          
          dialNumber.textContent = current.toString();
          dialElement.style.background = `conic-gradient(var(--accent) 0deg ${currentAngle}deg, var(--border-subtle) ${currentAngle}deg 360deg)`;
          
          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            dialNumber.textContent = targetValue.toString();
            dialElement.style.background = `conic-gradient(var(--accent) 0deg ${targetAngle}deg, var(--border-subtle) ${targetAngle}deg 360deg)`;
          }
        };
        animate();
      }, startDelay);
    }

    // Chapter entry fade animation using IntersectionObserver
    function initChapterObserver() {
      if (prefersReducedMotion()) {
        // Show all chapters immediately if user prefers reduced motion
        document.querySelectorAll('.report-chapter').forEach(chapter => {
          chapter.classList.add('chapter-visible');
        });
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
          if (entry.isIntersecting) {
            // Stagger the animation slightly for multiple chapters
            const delay = index * 60;
            setTimeout(() => {
              entry.target.classList.add('chapter-visible');
            }, delay);
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -20px 0px'
      });

      // Observe current chapters
      document.querySelectorAll('.report-chapter').forEach(chapter => {
        observer.observe(chapter);
      });

      // Re-observe when new chapters are added (MutationObserver)
      const resultsBody = document.getElementById('results-body');
      if (resultsBody) {
        const mutationObserver = new MutationObserver((mutations) => {
          mutations.forEach(mutation => {
            mutation.addedNodes.forEach(node => {
              if (node.nodeType === 1) {
                const chapters = node.querySelectorAll ? 
                  node.querySelectorAll('.report-chapter') : [];
                chapters.forEach(chapter => {
                  observer.observe(chapter);
                });
                if (node.classList && node.classList.contains('report-chapter')) {
                  observer.observe(node);
                }
              }
            });
          });
        });
        mutationObserver.observe(resultsBody, { childList: true, subtree: true });
      }
    }

    (function init() {
      loadSavedInput();
      autoResizeTextarea();
      renderSummary("");
      animateHeroDialNumber();
      initChapterObserver();
    })();
</script>

</body>
</html>
