<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recruiter in Your Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-deep: #020617;
      --bg-elevated: #020818;
      --bg-card: #020818;
      --border-subtle: rgba(148, 163, 184, 0.18);
      --border-strong: rgba(51, 65, 85, 0.9);
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.18);
      --accent-strong: #2563eb;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-muted: #6b7280;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #020617 0, #020617 40%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px 32px;
      font-size: 14px;
      line-height: 1.6;
    }

    .page {
      width: 100%;
      max-width: 1120px;
      border-radius: 28px;
      border: 1px solid rgba(15, 23, 42, 0.95);
      background:
        radial-gradient(120% 160% at top left, #020617 0, #020617 40%, #000 100%);
      box-shadow:
        0 28px 80px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.95);
      padding: 18px 20px 26px;
      position: relative;
      overflow: hidden;
    }

    .page::before {
      content: "";
      position: absolute;
      inset: -60%;
      background:
        radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.08), transparent 60%);
      opacity: 0.8;
      pointer-events: none;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .page {
        padding: 16px 14px 22px;
        border-radius: 22px;
      }
    }

    /* Top bar */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 12px;
      padding-top: 8px;
      padding-bottom: 8px;
      padding-left: 0;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .brand-mark {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--accent);
      border: 1px solid var(--border-subtle);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      line-height: 1;
      color: #e5e7eb;
      letter-spacing: -0.02em;
      transition: transform 150ms ease-out, background 150ms ease-out;
      transform-origin: center;
    }

    .brand-mark:hover {
      transform: scale(1.02);
      background: #4a8ff9;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .brand-name {
      font-size: 15px;
      font-weight: 500;
      color: var(--text-soft);
      letter-spacing: -0.01em;
    }

    .version-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      font-size: 11px;
      color: var(--text-soft);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    @media (max-width: 600px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Hero */

    .hero {
      margin-bottom: 18px;
      padding: 10px 4px 8px;
    }

    .hero-title {
      font-size: 30px;
      letter-spacing: -0.03em;
      color: #f9fafb;
      font-weight: 720;
      line-height: 1.15;
      margin-bottom: 9px;
    }

    .hero-subtitle {
      font-size: 14px;
      color: rgba(156, 163, 175, 0.82);
      max-width: 540px;
      line-height: 1.6;
      margin-bottom: 4px;
    }

    .hero-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 20px;
      margin-top: 4px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.96);
    }

    .hero-pill span:first-child {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: var(--text-soft);
    }

    .hero-cred {
      font-size: 13px;
      color: rgba(156, 163, 175, 0.8);
      max-width: 580px;
      margin-top: 14px;
      line-height: 1.5;
    }

    @media (max-width: 600px) {
      .hero-title {
        font-size: 24px;
      }
      .hero-subtitle {
        font-size: 13px;
      }
    }

    /* Main tool area */

    .tool-layout {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.02fr) minmax(0, 1.05fr);
      gap: 22px;
    }

    @media (max-width: 860px) {
      .tool-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      background:
        linear-gradient(
          150deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(11, 18, 35, 0.98) 50%,
          rgba(3, 7, 18, 1) 100%
        );
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 22px;
      box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.55),
        0 0 0 1px rgba(15, 23, 42, 0.85);
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.04);
      pointer-events: none;
    }

    .card-input {
      background:
        radial-gradient(circle at top left, rgba(37, 99, 235, 0.12), transparent 60%),
        linear-gradient(
          150deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(15, 23, 42, 0.98) 40%,
          rgba(3, 7, 18, 1) 100%
        );
    }

    .card-output {
      background:
        radial-gradient(circle at top right, rgba(37, 99, 235, 0.12), transparent 60%),
        linear-gradient(
          155deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(11, 15, 30, 0.98) 40%,
          rgba(3, 7, 18, 1) 100%
        );
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      color: #f9fafb;
    }

    .mode-pill {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(30, 64, 175, 0.9);
      color: #bfdbfe;
      background:
        radial-gradient(circle at top, rgba(37, 99, 235, 0.22), rgba(15, 23, 42, 0.96));
      white-space: nowrap;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    textarea {
      width: 100%;
      min-height: 252px;
      max-height: 340px;
      overflow-y: auto;
      padding: 12px 14px 11px;
      font-size: 14px;
      color: #f9fafb;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background:
        radial-gradient(circle at top left, rgba(15, 23, 42, 0.94), rgba(2, 6, 23, 0.96));
      resize: none;
      margin-bottom: 8px;
      line-height: 1.55;
    }

    textarea::placeholder {
      color: var(--text-muted);
    }

    .input-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-bottom: 10px;
      color: var(--text-muted);
    }

    .saved-indicator {
      color: #22c55e;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }

    .saved-indicator.visible {
      opacity: 1;
    }

    .mode-label {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .mode-buttons {
      position: relative;
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 4px;
      padding-bottom: 4px;
    }

    @media (max-width: 600px) {
      .mode-buttons {
        gap: 6px;
      }
    }

    .mode-button {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      font-size: 12px;
      cursor: pointer;
      transition:
        background 0.18s ease-out,
        border-color 0.18s ease-out,
        color 0.18s ease-out;
    }

    .mode-button.active {
      background:
        radial-gradient(circle at top, #3b82f6, #2563eb);
      border-color: #3b82f6;
      color: #f9fafb;
      transform: translateY(-0.5px);
    }

    .mode-button.disabled-mode {
      opacity: 0.55;
      cursor: default;
      background: rgba(15, 23, 42, 0.9);
      border-color: #111827;
    }

    .mode-indicator {
      position: absolute;
      bottom: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(to right, #3b82f6, #2563eb);
      transition: width 0.18s ease-out, transform 0.18s ease-out;
    }

    .coming-soon-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
      margin-bottom: 10px;
    }

    .run-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 14px;
    }

    .run-button {
      width: 100%;
      padding: 11px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(to bottom, var(--accent), var(--accent-strong));
      color: #f9fafb;
      font-weight: 600;
      box-shadow:
        0 14px 35px rgba(37, 99, 235, 0.5),
        0 0 0 1px rgba(15, 23, 42, 0.96);
    }

    .run-button:hover:not(:disabled) {
      background: linear-gradient(to bottom, #2563eb, #1d4ed8);
      box-shadow:
        0 18px 40px rgba(37, 99, 235, 0.6),
        0 0 0 1px rgba(15, 23, 42, 0.96);
      transform: translateY(-1px);
    }

    .run-button:disabled {
      opacity: 0.6;
      transform: none;
      cursor: default;
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
      min-height: 18px;
    }

    /* Results */

    .results-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .score-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0;
      border-radius: 10px;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    .score-wrapper.hidden {
      display: none;
    }

    .score-cluster {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

.score-texts {
      display: none;
    }

.score-label-text {
      font-size: 12px;
      color: #e5e7eb;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .score-short-text {
      font-size: 11px;
      color: rgba(148, 163, 184, 0.95);
      line-height: 1.4;
    }

    #results-title {
      font-size: 15px;
      margin-bottom: 6px;
      color: #f9fafb;
      font-weight: 600;
    }

    #results-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

.score-badge {
      display: none;
      align-items: center;
      justify-content: center;
      padding: 7px 13px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
      color: #f9fafb;
      letter-spacing: 0.03em;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 8px 18px rgba(0, 0, 0, 0.45);
      position: relative;
      overflow: hidden;
      transform: scale(0.9);
      opacity: 0;
      transition:
        transform 0.18s ease-out,
        opacity 0.18s ease-out;
    }

    .score-badge::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.06);
      pointer-events: none;
    }

    .score-visible {
      display: inline-flex;
      opacity: 1;
      transform: scale(1);
    }

    .score-tooltip {
      position: absolute;
      top: 120%;
      right: 0;
      width: 240px;
      background: rgba(10, 16, 28, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.55);
      border-radius: 12px;
      padding: 11px 12px;
      font-size: 12px;
      color: #e2e8f0;
      line-height: 1.5;
      opacity: 0;
      transform: translateY(4px);
      pointer-events: none;
      transition: opacity 0.16s ease-out, transform 0.16s ease-out;
      z-index: 5;
    }

.score-tip-line {
      margin-bottom: 6px;
      color: rgba(226, 232, 240, 0.95);
    }

    .score-tip-line:last-child {
      margin-bottom: 0;
    }

    .score-wrapper:hover .score-tooltip,
    .score-wrapper:focus-within .score-tooltip {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .score-low {
      background: linear-gradient(135deg, #7a1f2b, #a1273a);
    }

    .score-mid {
      background: linear-gradient(135deg, #73572a, #8b6e2d);
    }

    .score-good {
      background: linear-gradient(135deg, #1f3f77, #2563eb);
    }

    .score-great {
      background: linear-gradient(135deg, #1f6b3a, #22c55e);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 10px 22px rgba(34, 197, 94, 0.65);
    }

    #loading-bar {
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #1d4ed8, #3b82f6, #1d4ed8);
      background-size: 200% 100%;
      margin-bottom: 4px;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
    }

    #loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.2s linear infinite;
    }

    @keyframes loadingSlide {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    #results-body {
      font-size: 13px;
      color: #cbd5e1;
      background:
        radial-gradient(circle at top, rgba(15, 23, 42, 0.84), rgba(3, 7, 18, 0.84));
      border-radius: 8px;
      border: 1px solid rgba(30, 41, 59, 0.5);
      padding: 6px 10px 6px;
      padding: 10px 12px 10px;
      line-height: 1.65;
      max-height: 480px;
      overflow-y: auto;
      white-space: normal;
      font-weight: 400;
      margin-top: 8px;
    }

    #results-body.empty {
      color: rgba(156, 163, 175, 0.78);
    }

    .results-error {
      border-color: rgba(248, 113, 113, 0.7) !important;
      background: rgba(30, 7, 13, 0.96) !important;
      color: #fecaca !important;
    }

    .result-heading {
      font-size: 14px;
      font-weight: 600;
      margin-top: 12px;
      margin-bottom: 6px;
      color: #f9fafb;
    }

    .result-paragraph {
      margin: 0 0 10px;
    }

    .result-list {
      margin: 2px 0 10px;
      padding-left: 18px;
    }

    .result-list li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .rewrite-label {
      font-weight: 600;
      color: #e2e8f0;
      margin: 4px 0 2px;
    }

    .rewrite-text {
      margin: 0 0 6px;
      padding-left: 8px;
    }

    .empty-hint {
      font-size: 12px;
      color: rgba(156, 163, 175, 0.85);
      margin-top: 4px;
    }

    #results-body:not(.empty) + .empty-hint {
      display: none;
    }

.rewrite-enhancement-note {
  margin-top: 8px;
  font-size: 0.85rem;
  opacity: 0.9;
  font-style: normal;
  background: rgba(37, 99, 235, 0.08);
  border: 1px solid rgba(37, 99, 235, 0.25);
  border-radius: 10px;
  padding: 8px 10px;
  color: #dbeafe;
  line-height: 1.5;
}

    .copy-button {
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 12px;
      padding: 5px 9px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .copy-button:hover {
      background: rgba(31, 41, 55, 0.98);
    }

    /* Rewrite blocks and section separators */

    .rewrite-block {
      margin-top: 12px;
      padding-top: 10px;
    }

    /* line only between successive rewrite blocks */
    .rewrite-block + .rewrite-block {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
    }

    .result-section {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      padding-top: 12px;
      margin-top: 12px;
    }

    .next-steps-heading {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      padding-top: 12px;
      margin-top: 12px;
    }

    /* Creator line and footer */

    .creator-section {
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      opacity: 0.7;
      margin-top: 16px;
      margin-bottom: 8px;
    }

    .footer {
      margin-top: 0;
      padding-top: 16px;
      border-top: 1px solid rgba(30, 41, 59, 0.85);
      text-align: left;
      color: var(--text-muted);
      font-size: 11px;
      line-height: 1.55;
    }

    .footer strong {
      color: #cbd5f5;
      font-weight: 500;
    }

    textarea:focus-visible {
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.35);
    }

    .mode-button:focus-visible,
    .run-button:focus-visible,
    .copy-button:focus-visible {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }

    /* Ghost overlay for textarea */

    .input-wrapper {
      position: relative;
    }

    .resume-hint-overlay {
      position: absolute;
      inset: 12px 14px auto 14px;
      pointer-events: none;
      font-size: 13px;
      line-height: 1.5;
      color: rgba(148, 163, 184, 0.85);
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.94),
        rgba(15, 23, 42, 0.9)
      );
      padding: 6px 8px 6px;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.7);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.45);
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
    }

    .resume-hint-title {
      font-weight: 500;
      color: #e5e7eb;
      margin-bottom: 2px;
    }

    .resume-hint-body {
      font-size: 12px;
      color: rgba(156, 163, 175, 0.9);
    }

    .resume-hint-overlay.hidden {
      opacity: 0;
      transform: translateY(4px);
    }
    .status-bar {
  margin-top: 2px;
  font-size: 0.9rem;
  opacity: 0.9;
  min-height: 1.2em;
}

.status-bar.status-info {
  color: #e5e7eb;
}

  .status-bar.status-error {
    color: #fca5a5;
  }

    /* Achievement ideas (inline + modal) */
    .ideas-inline {
      margin-top: 10px;
      border-top: 1px solid rgba(30, 41, 59, 0.48);
      padding-top: 8px;
      gap: 6px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }

    .ideas-inline.hidden {
      display: none;
    }

    .ideas-inline .ideas-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ideas-inline-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      width: 100%;
    }

    .ideas-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .ideas-kicker {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: rgba(148, 163, 184, 0.9);
      margin-bottom: 2px;
    }

    .ideas-subtitle {
      font-weight: 400;
      font-size: 12px;
      color: var(--text-soft);
      max-width: 360px;
    }

    .ideas-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.18s ease, transform 0.2s ease;
    }

    .ideas-modal.visible {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    .ideas-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(3, 7, 18, 0.65);
      backdrop-filter: blur(4px);
      opacity: 0;
      transition: opacity 0.18s ease;
    }

    .ideas-modal.visible .ideas-backdrop {
      opacity: 1;
    }

    .ideas-sheet {
      position: relative;
      z-index: 1;
      width: min(720px, 92vw);
      max-height: 78vh;
      background: linear-gradient(160deg, rgba(9, 13, 24, 0.97), rgba(6, 10, 18, 0.97));
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 16px;
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.7);
      padding: 8px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.22s ease, transform 0.22s ease;
    }

    .ideas-modal.visible .ideas-sheet {
      opacity: 1;
      transform: translateY(0);
    }

    .ideas-sheet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .ideas-sheet-title {
      font-size: 14px;
      font-weight: 700;
      color: #f1f5f9;
      letter-spacing: -0.01em;
    }

    .ideas-sheet-subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }

    .ideas-sheet-body {
      overflow-y: auto;
      padding: 2px;
    }

    .ghost-button {
      background: rgba(148, 163, 184, 0.08);
      color: #e2e8f0;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 7px 12px;
      border-radius: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: border-color 0.12s ease, background 0.12s ease;
      align-self: flex-start;
    }

    .ghost-button:hover {
      border-color: rgba(148, 163, 184, 0.65);
      background: rgba(148, 163, 184, 0.12);
    }

    .ghost-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ideas-loading-bar {
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, #1d4ed8, #3b82f6, #1d4ed8);
      background-size: 200% 100%;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
      margin-top: 6px;
      border-radius: 999px;
      height: 1.5px;
    }

    .ideas-status {
      font-size: 12px;
      color: rgba(148, 163, 184, 0.9);
      margin-top: 6px;
      min-height: 16px;
    }

    .ideas-status.error {
      color: #fca5a5;
    }

    .ideas-body {
      margin-top: 8px;
      border: 1px solid rgba(30, 41, 59, 0.32);
      border-radius: 10px;
      padding: 12px 14px;
      background: rgba(12, 18, 32, 0.9);
      font-size: 13px;
      line-height: 1.6;
      color: #cbd5e1;
    }

    .ideas-body.empty {
      color: rgba(148, 163, 184, 0.85);
      border-style: dashed;
    }

    .ideas-list {
      margin: 6px 0 8px;
      padding-left: 18px;
    }

    .ideas-list li {
      margin-bottom: 8px;
      line-height: 1.55;
    }

    .ideas-how {
      margin-top: 6px;
      color: rgba(203, 213, 225, 0.9);
      font-size: 13px;
      line-height: 1.5;
    }

    .ideas-sublist {
      margin-top: 4px;
      padding-left: 16px;
      color: rgba(203, 213, 225, 0.9);
      font-size: 12px;
      line-height: 1.5;
    }

    .ideas-divider {
      border-top: 1px solid rgba(30, 41, 59, 0.6);
      margin: 12px 0 8px;
      padding-top: 0;
    }

.ideas-footnote {
      margin-top: 6px;
      font-size: 12px;
      color: var(--text-muted);
    }

  </style>
</head>

<body>
  <div class="page">
    <div class="page-inner">
      <header class="top-bar">
        <div class="brand">
          <div class="brand-mark">R</div>
          <div class="brand-text">
            <div class="brand-name">Recruiter in Your Pocket</div>
          </div>
        </div>
        <div class="version-pill">
          <span class="status-dot"></span>
          <span>v0.2 ¬∑ resume mode live</span>
        </div>
      </header>

      <section class="hero">
        <h1 class="hero-title">Your career. Real recruiter insight.</h1>

        <p class="hero-subtitle">
          Clarity from someone who reads resumes for a living.
        </p>

        <div class="hero-grid">
          <div class="hero-pill">
            <span>1</span><span>Drop your resume in</span>
          </div>
          <div class="hero-pill">
            <span>2</span><span>Get actionable, clear feedback</span>
          </div>
          <div class="hero-pill">
            <span>3</span><span>Give yourself the inside edge</span>
          </div>
        </div>

        <p class="hero-cred">
          Career guidance from former recruiters at Google, Facebook, and OpenAI.
        </p>
      </section>

      <main class="tool-layout">
        <!-- Left column -->
        <section class="card card-input" aria-label="Input panel">
          <div class="card-inner">
            <div class="card-header">
              <h2 class="card-title">Your resume</h2>
              <div class="mode-pill" id="mode-pill">Mode ‚Ä¢ Resume feedback</div>
            </div>

            <label for="main-input" id="input-label">
              Paste your full resume below for a calibrated review.
            </label>

            <div class="input-wrapper">
              <textarea
                id="main-input"
                placeholder="Paste your full resume, including work history, skills, and education."
              ></textarea>

              <div id="resume-hint" class="resume-hint-overlay">
                <div class="resume-hint-title">Paste your full resume here</div>
                <div class="resume-hint-body">
                  Include job titles, bullets, and education. Plain text is perfect.
                </div>
              </div>
            </div>

            <div class="input-meta-row">
              <div>Saved locally on this device.</div>
              <div id="saved-indicator" class="saved-indicator">Saved</div>
            </div>

            <div class="mode-label">Choose a mode</div>
            <div class="mode-buttons" role="tablist" aria-label="Mode selection">
              <button class="mode-button active" data-mode="resume">Resume</button>
              <button
                class="mode-button disabled-mode"
                data-mode="interview"
                aria-disabled="true"
                tabindex="-1"
              >
                Interview prep
              </button>
              <div id="mode-indicator" class="mode-indicator"></div>
            </div>

            <div class="coming-soon-hint">
              Resume mode is live. Interview prep is coming.
            </div>

            <div class="run-row">
              <button id="run-button" class="run-button">Get feedback</button>
              <div id="status" class="status" aria-live="polite" role="status"></div>
            </div>
          </div>
        </section>

        <!-- Right column -->
        <section class="card card-output" aria-label="Results panel">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h2 id="results-title" class="card-title">Recruiter feedback</h2>
                <div id="results-subtitle">
                  Recruiter-calibrated score plus what‚Äôs working, what needs work, and phrasing you can use.
                </div>
              </div>
              <div class="results-header-right">
                <div id="score-wrapper" class="score-wrapper hidden">
                  <div
                    id="score-badge"
                    class="score-badge"
                    tabindex="0"
                    aria-describedby="score-tooltip"
                  ></div>
                  <div id="score-tooltip" class="score-tooltip" role="tooltip"></div>
                </div>
                <button id="copy-button" class="copy-button" aria-label="Copy results">
                  ‚ßâ
                </button>
              </div>
            </div>

            <div id="loading-bar"></div>
            <div id="status-bar" class="status-bar"></div>

            <div
              id="results-body"
              class="empty"
              role="region"
              aria-label="Resume feedback results"
            >
              Your feedback will appear here.
            </div>

            <div class="empty-hint">
              Clear sections, specific guidance, and clearer phrasing you can use.
            </div>

            <div id="ideas-inline" class="ideas-inline hidden" aria-label="Missing wins">
              <div class="ideas-inline-header">
                <div class="ideas-text">
                  <div class="ideas-kicker">Missing wins</div>
                  <div class="ideas-subtitle">Questions to surface work you haven‚Äôt written down yet.</div>
                </div>
                <div class="ideas-actions">
                  <button id="ideas-open" class="ghost-button" type="button">Open</button>
                </div>
              </div>
            </div>

            <div id="ideas-modal" class="ideas-modal" aria-hidden="true">
              <div id="ideas-backdrop" class="ideas-backdrop"></div>
              <div class="ideas-sheet" role="dialog" aria-modal="true" aria-labelledby="ideas-modal-title">
                <div class="ideas-sheet-header">
                  <div>
                    <div id="ideas-modal-title" class="ideas-sheet-title">Missing wins</div>
                    <div class="ideas-sheet-subtitle">Questions to surface work you haven‚Äôt written down yet.</div>
                  </div>
                  <div class="ideas-actions">
                    <button id="ideas-refresh" class="ghost-button" type="button">Refresh</button>
                    <button id="ideas-close" class="ghost-button" type="button" aria-label="Close missing wins">Close</button>
                  </div>
                </div>
                <div id="ideas-loading-bar" class="ideas-loading-bar"></div>
                <div id="ideas-status" class="ideas-status" aria-live="polite"></div>
                <div class="ideas-sheet-body">
                  <div id="ideas-body" class="ideas-body empty" aria-live="polite">
                    I‚Äôll look for wins that haven‚Äôt made it into your resume yet.
                  </div>
                  <div class="ideas-footnote" style="margin-top:8px;">Keep it clear and grounded; show scope and impact.</div>
                </div>
              </div>
            </div>

          </div>
        </section>
      </main>

      <div class="creator-section">
        Created with care in Boulder, CO ü§ç
      </div>

      <footer class="footer">
        <strong>How this works:</strong>
        Your text is sent to our backend, which calls OpenAI's API to generate guidance.
        This system is tuned using the real screening criteria used by recruiters at Google, Facebook, OpenAI, and other top companies.
        We do not store your resume or responses. Only paste content you are comfortable sharing.
      </footer>
    </div>
  </div>

  <script>
  const STORAGE_KEY = "rip-main-input-v1";

  const inputEl = document.getElementById("main-input");
  const inputLabelEl = document.getElementById("input-label");
  const modeButtons = document.querySelectorAll(".mode-button");
  const runButton = document.getElementById("run-button");
  const statusEl = document.getElementById("status");
  const resultsTitleEl = document.getElementById("results-title");
  const resultsSubtitleEl = document.getElementById("results-subtitle");
  const resultsBodyEl = document.getElementById("results-body");
  const modePillEl = document.getElementById("mode-pill");
  const scoreWrapperEl = document.getElementById("score-wrapper");
  const scoreBadgeEl = document.getElementById("score-badge");
  const scoreLabelEl = document.getElementById("score-label");
  const scoreShortEl = document.getElementById("score-short");
  const scoreTooltipEl = document.getElementById("score-tooltip");
  const copyButtonEl = document.getElementById("copy-button");
  const savedIndicatorEl = document.getElementById("saved-indicator");
  const modeIndicatorEl = document.getElementById("mode-indicator");
  const loadingBarEl = document.getElementById("loading-bar");
  const resumeHintEl = document.getElementById("resume-hint");
  const ideasInlineEl = document.getElementById("ideas-inline");
  const ideasOpenEl = document.getElementById("ideas-open");
  const ideasModalEl = document.getElementById("ideas-modal");
  const ideasBackdropEl = document.getElementById("ideas-backdrop");
  const ideasRefreshEl = document.getElementById("ideas-refresh");
  const ideasCloseEl = document.getElementById("ideas-close");
  const ideasBodyEl = document.getElementById("ideas-body");
  const ideasLoadingBarEl = document.getElementById("ideas-loading-bar");
  const ideasStatusEl = document.getElementById("ideas-status");

  let currentMode = "resume";
  let saveTimeout = null;
  let originalButtonText = runButton.textContent;
  let ideasInFlight = false;

  function autoResizeTextarea() {
    const maxHeight = 340;
    inputEl.style.height = "auto";
    const next = Math.min(inputEl.scrollHeight, maxHeight);
    inputEl.style.height = next + "px";
  }

  function showSavedIndicator() {
    if (!savedIndicatorEl) return;
    savedIndicatorEl.classList.add("visible");
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      savedIndicatorEl.classList.remove("visible");
    }, 1200);
  }

  function loadSavedInput() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        inputEl.value = saved;
        autoResizeTextarea();
        showSavedIndicator();
      }
    } catch (e) {
      console.warn("Could not load saved input", e);
    }
  }

  function updateResumeHintVisibility() {
    if (!resumeHintEl) return;
    const hasText = inputEl.value.trim().length > 0;
    const isFocused = document.activeElement === inputEl;

    if (hasText || isFocused) {
      resumeHintEl.classList.add("hidden");
    } else {
      resumeHintEl.classList.remove("hidden");
    }
  }

  inputEl.addEventListener("input", () => {
    autoResizeTextarea();
    try {
      localStorage.setItem(STORAGE_KEY, inputEl.value);
    } catch (e) {
      console.warn("Could not save input", e);
    }
    showSavedIndicator();
    updateResumeHintVisibility();
    if (!inputEl.value.trim()) {
      resetIdeasSection();
      if (ideasInlineEl) ideasInlineEl.classList.add("hidden");
      closeIdeasModal();
    }
  });

  inputEl.addEventListener("focus", updateResumeHintVisibility);
  inputEl.addEventListener("blur", updateResumeHintVisibility);

  function positionModeIndicator() {
    const activeBtn = document.querySelector(".mode-button.active");
    if (!activeBtn || !modeIndicatorEl) return;
    const left = activeBtn.offsetLeft;
    const width = activeBtn.offsetWidth;
    modeIndicatorEl.style.width = width + "px";
    modeIndicatorEl.style.transform = "translateX(" + left + "px)";
  }

  window.addEventListener("resize", positionModeIndicator);

  function clearScoreBadge() {
    scoreBadgeEl.textContent = "";
    scoreBadgeEl.className = "score-badge";
    scoreBadgeEl.removeAttribute("aria-label");
    if (scoreLabelEl) scoreLabelEl.textContent = "";
    if (scoreShortEl) scoreShortEl.textContent = "";
    if (scoreTooltipEl) scoreTooltipEl.textContent = "";
    if (scoreWrapperEl) scoreWrapperEl.classList.add("hidden");
  }

  function getScoreMeta(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    if (clamped >= 97) {
      return {
        score: clamped,
        label: "Rare air",
        short: "Almost nothing to tighten; keep it precise.",
        long:
          "Story reads top-bar with clear ownership, scope, and results. Keep it crisp; a light polish only."
      };
    }
    if (clamped >= 92) {
      return {
        score: clamped,
        label: "Top-bar ready",
        short: "Clear, strong signal with tiny polish left.",
        long:
          "Ownership, scope, and outcomes show up fast. Do a light pass to surface any last numbers or decisions."
      };
    }
    if (clamped >= 85) {
      return {
        score: clamped,
        label: "High bar",
        short: "Real ownership and impact with a few soft spots.",
        long:
          "Signal is strong; tighten any buried scope or decisions and make outcomes pop in the top bullets."
      };
    }
    if (clamped >= 78) {
      return {
        score: clamped,
        label: "Strong story",
        short: "Impact shows; a couple clarity gaps remain.",
        long:
          "Scope and outcomes are present but uneven. Sharpen wording and split dense bullets so wins land faster."
      };
    }
    if (clamped >= 70) {
      return {
        score: clamped,
        label: "Solid foundation",
        short: "Story is here; clarity and scope need surfacing.",
        long:
          "Use numbers and ownership language to make the work obvious. Pull key outcomes up front and trim filler."
      };
    }
    if (clamped >= 60) {
      return {
        score: clamped,
        label: "Needs clarity",
        short: "Signal is buried under wording or missing context.",
        long:
          "Make roles, scope, and outcomes explicit. Remove vague phrasing and show what changed because of you."
      };
    }
    if (clamped >= 50) {
      return {
        score: clamped,
        label: "Thin signal",
        short: "Ownership and outcomes are hard to see.",
        long:
          "Rebuild top bullets with clear role, scope, and before/after changes. Add context before applying."
      };
    }
    return {
      score: clamped,
      label: "Not ready",
      short: "Hard to see role, scope, or results.",
      long:
        "Add structure, roles, and outcomes so there is usable signal. Right now it is not review-ready."
    };
  }

  function applyScoreColor(score) {
    clearScoreBadge();
    if (Number.isNaN(score)) return;
    let cls = "";
    if (score < 50) cls = "score-low";
    else if (score < 70) cls = "score-mid";
    else if (score < 90) cls = "score-good";
    else cls = "score-great";
    scoreBadgeEl.textContent = score + "/100";
    scoreBadgeEl.setAttribute("aria-label", `Score ${score} out of 100`);
    scoreBadgeEl.classList.add("score-visible", cls);
  }

  function renderScoreMeta(score, modelMeta = {}) {
    const meta = getScoreMeta(score);
    applyScoreColor(meta.score);

    const labelText = (modelMeta.score_label || "").trim() || meta.label;
    const shortText = (modelMeta.score_comment_short || "").trim() || meta.short;
    if (scoreTooltipEl) {
      scoreTooltipEl.innerHTML = `
        <div class="score-tip-line" style="font-weight:700;color:#f8fafc;">${escapeHtml(
          labelText
        )}</div>
        <div class="score-tip-line">${escapeHtml(shortText)}</div>
      `;
    }
    if (scoreWrapperEl) scoreWrapperEl.classList.remove("hidden");
  }

  function extractAndApplyScore(text) {
    const match = text.match(/(\d{1,3})\s*\/\s*100/);
    if (!match) {
      clearScoreBadge();
      return;
    }
    const score = parseInt(match[1], 10);
    if (Number.isNaN(score)) {
      clearScoreBadge();
      return;
    }
    applyScoreColor(score);
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function formatResults(text) {
    const lines = text.split("\n");
    let html = "";
    let inList = false;

    function closeList() {
      if (inList) {
        html += "</ul>";
        inList = false;
      }
    }

    for (const raw of lines) {
      const line = raw.trim();
      if (!line) {
        closeList();
        html += '<p class="result-paragraph spacer"></p>';
        continue;
      }

      const headingMatch = line.match(/^(\d+)\.\s+(.*)$/);
      const bulletMatch = line.match(/^[-*‚Ä¢]+\s+(.*)$/);
      const originalMatch = line.match(/^Original:\s*(.*)$/i);
      const betterMatch = line.match(/^Better:\s*(.*)$/i);

      if (headingMatch) {
        closeList();
        html += `<div class="result-heading">${escapeHtml(headingMatch[2])}</div>`;
      } else if (originalMatch) {
        closeList();
        html += `<div class="rewrite-label">Original:</div>`;
        if (originalMatch[1]) {
          html += `<div class="rewrite-text">${escapeHtml(originalMatch[1])}</div>`;
        }
      } else if (betterMatch) {
        closeList();
        html += `<div class="rewrite-label">Better:</div>`;
        if (betterMatch[1]) {
          html += `<div class="rewrite-text">${escapeHtml(betterMatch[1])}</div>`;
        }
      } else if (bulletMatch) {
        if (!inList) {
          html += '<ul class="result-list">';
          inList = true;
        }
        html += `<li>${escapeHtml(bulletMatch[1])}</li>`;
      } else {
        closeList();
        html += `<p class="result-paragraph">${escapeHtml(line)}</p>`;
      }
    }

    closeList();
    return html;
  }

  function renderStructuredResults(data) {
    const {
      summary,
      strengths,
      gaps,
      rewrites,
      next_steps: nextSteps,
      score,
      score_label: scoreLabelText,
      score_comment_short: scoreCommentShort,
      score_comment_long: scoreCommentLong,
      suggested_bullets: suggestedBullets
    } = data || {};

    let html = "";

    // score pill and commentary
    if (typeof score === "number") {
      renderScoreMeta(score, {
        score_label: scoreLabelText,
        score_comment_short: scoreCommentShort,
        score_comment_long: scoreCommentLong
      });
    } else {
      clearScoreBadge();
    }

    // Recruiter's Take
    if (summary && String(summary).trim().length > 0) {
      html += `<div class="result-heading result-section">Recruiter's take</div>`;
      html += `<p class="result-paragraph">${escapeHtml(String(summary).trim())}</p>`;
    }

    // What's Working
    if (Array.isArray(strengths) && strengths.length > 0) {
      html += `<div class="result-heading result-section">What‚Äôs working</div>`;
      html += `<ul class="result-list">`;
      for (const item of strengths) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul>`;
    }

    // What Needs Work
    if (Array.isArray(gaps) && gaps.length > 0) {
      html += `<div class="result-heading result-section">What needs work</div>`;
      html += `<ul class="result-list">`;
      for (const item of gaps) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul>`;
    }

    // Stronger Phrasing You Can Use
    if (Array.isArray(rewrites) && rewrites.length > 0) {
      html += `<div class="result-heading result-section">Stronger phrasing you can use</div>`;

      for (const r of rewrites) {
  if (!r) continue;
  const label = r.label || "";
  const original = r.original || "";
  const better = r.better || "";
  const enhancementNote = r.enhancement_note || r.enhancementNote || "";

  html += `<div class="rewrite-block">`;

  if (label) {
    html += `<p class="result-paragraph"><strong>${escapeHtml(String(label))}</strong></p>`;
  }

  if (original) {
    html += `<div class="rewrite-label">Original</div>`;
    html += `<div class="rewrite-text">${escapeHtml(String(original))}</div>`;
  }

  if (better) {
    html += `<div class="rewrite-label">Better</div>`;
    html += `<div class="rewrite-text">${escapeHtml(String(better))}</div>`;
  }

  if (enhancementNote) {
    html += `<div class="rewrite-enhancement-note">${escapeHtml(String(enhancementNote))}</div>`;
  }

  html += `</div>`;
}

    } else if (Array.isArray(suggestedBullets) && suggestedBullets.length > 0) {
      // Fallback: use suggested_bullets from backend as a simple list
      html += `<div class="result-heading result-section">Stronger phrasing you can use</div>`;
      html += `<ul class="result-list">`;
      for (const bullet of suggestedBullets) {
        if (!bullet) continue;
        html += `<li>${escapeHtml(String(bullet))}</li>`;
      }
      html += `</ul>`;
    }

    // Next Steps
    if (Array.isArray(nextSteps) && nextSteps.length > 0) {
      html += `<div class="result-heading next-steps-heading">Next Steps</div>`;
      html += `<ul class="result-list">`;
      for (const step of nextSteps) {
        if (!step) continue;
        html += `<li>${escapeHtml(String(step))}</li>`;
      }
      html += `</ul>`;
    }

    if (!html) {
      html = "No feedback returned.";
    }

    resultsBodyEl.innerHTML = html;
    resultsBodyEl.classList.remove("empty");
  }

  function setMode(mode) {
    currentMode = mode;
    modeButtons.forEach(btn => {
      const active = btn.dataset.mode === mode;
      btn.classList.toggle("active", active);
    });

    clearScoreBadge();

    if (mode === "resume") {
      resultsTitleEl.textContent = "Recruiter feedback";
      resultsSubtitleEl.textContent =
        "Recruiter-calibrated score plus what‚Äôs working, what needs work, and phrasing you can use.";
      modePillEl.textContent = "Mode ‚Ä¢ Resume feedback";
      if (inputLabelEl) {
        inputLabelEl.textContent = "Paste your full resume below for a calibrated review.";
      }
      inputEl.placeholder =
        "Paste your full resume, including work history, skills, and education.";
    } else if (mode === "interview") {
      resultsTitleEl.textContent = "Interview prep";
      resultsSubtitleEl.textContent =
        "How you read now, stories to prepare, and questions to ask.";
      modePillEl.textContent = "Mode ‚Ä¢ Interview prep";
      if (inputLabelEl) {
        inputLabelEl.textContent =
          "Paste the job description and any notes about the interview or the company.";
      }
      inputEl.placeholder =
        "Paste the job description and your resume bullets for this role. You can also add any notes you have.";
    }

    positionModeIndicator();
  }

  modeButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      if (btn.classList.contains("disabled-mode")) {
        statusEl.textContent = "Interview prep is coming soon.";
        return;
      }
      setMode(btn.dataset.mode);
    });
  });

  async function runAnalysis() {
    const text = inputEl.value.trim();
    if (!text) {
      const msg = "Paste your resume text so I can actually review it.";
      statusEl.textContent = msg;
      setStatus(msg, "error");
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.remove("results-error");
      return;
    }

    statusEl.textContent = "";
    setStatus("");
      runButton.disabled = true;
      originalButtonText = runButton.textContent;
      runButton.textContent = "Processing...";
      loadingBarEl.classList.add("active");
    resultsBodyEl.classList.remove("results-error");
    resultsBodyEl.classList.remove("empty");
    clearScoreBadge();
    if (ideasInlineEl) {
      ideasInlineEl.classList.add("hidden");
    }
    resetIdeasSection();

        try {
      const response = await fetch("/api/resume-feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          mode: currentMode,
          text
        })
      });

      // New: read the unified payload from the backend
      const payload = await response.json().catch(() => null);

      const fieldMessages =
        payload?.details?.fieldErrors &&
        Object.values(payload.details.fieldErrors)
          .filter(Boolean)
          .join(" ");

      // If HTTP is not ok or payload is missing, show a calm error
      if (!response.ok || !payload) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(
            payload?.errorCode,
            payload?.message || "Unexpected server response."
          );
        statusEl.textContent = msg;
        setStatus(msg, "error");
        resultsBodyEl.textContent =
          fieldMessages ||
          "There was an error generating your feedback. Please try again.";
        resultsBodyEl.classList.add("results-error");
        resultsBodyEl.classList.remove("empty");
        return;
      }

      // Backend explicitly signaled an error (ok === false)
      if (payload.ok === false) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(payload.errorCode, payload.message);
        statusEl.textContent = msg;
        setStatus(msg, "error");
        resultsBodyEl.textContent =
          fieldMessages ||
          "There was an error generating your feedback. Please try again.";
        resultsBodyEl.classList.add("results-error");
        resultsBodyEl.classList.remove("empty");
        return;
      }

      // Happy path: payload.data is the validated object from the server
      let structured = null;

      if (payload.data && typeof payload.data === "object") {
        structured = payload.data;
      } else if (typeof payload.content === "string") {
        // Fallback if we only have the JSON string
        structured = JSON.parse(payload.content);
      } else {
        structured = payload;
      }

      renderStructuredResults(structured);
      resultsBodyEl.classList.remove("empty");
      resultsBodyEl.classList.remove("results-error");

      if (ideasInlineEl) {
        ideasInlineEl.classList.remove("hidden");
      }
      runIdeas({ auto: true, sourceText: text });

      if (typeof resultsBodyEl.scrollTo === "function") {
        resultsBodyEl.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        resultsBodyEl.scrollTop = 0;
      }

      statusEl.textContent = "";
      setStatus("");
    } catch (err) {
      console.error(err);
      statusEl.textContent =
        "Something unexpected glitched. Try again in a moment.";
      setStatus("Something unexpected glitched. Try again in a moment.", "error");
      resultsBodyEl.textContent =
        "There was an error generating your feedback. Please try again.";
      resultsBodyEl.classList.add("results-error");
      resultsBodyEl.classList.remove("empty");
    } finally {
      runButton.disabled = false;
      runButton.textContent = originalButtonText;
      loadingBarEl.classList.remove("active");
    }
  }

  runButton.addEventListener("click", runAnalysis);

  copyButtonEl.addEventListener("click", async () => {
    const text = resultsBodyEl.innerText.trim();
    if (!text) {
      statusEl.textContent = "Nothing to copy yet.";
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      statusEl.textContent = "Copied.";
    } catch {
      statusEl.textContent = "Could not copy. Please select the text manually.";
    }
  });

  inputEl.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
      e.preventDefault();
      runAnalysis();
    }
  });

  async function runIdeas(options = {}) {
    const { auto = false, sourceText } = options;
    const text = (sourceText || inputEl.value || "").trim();
    if (!text) {
      if (!auto) {
        setIdeasStatus("Add your resume first.", "error");
      }
      return;
    }

    if (ideasInFlight) return;
    ideasInFlight = true;

    const originalIdeasButtonText = ideasRefreshEl ? ideasRefreshEl.textContent : "";

    if (ideasRefreshEl) {
      ideasRefreshEl.disabled = true;
      ideasRefreshEl.textContent = auto ? "Refreshing..." : "Pulling questions...";
    }
    setIdeasStatus("Pulling new questions...");
    setIdeasLoading(true);
    if (ideasBodyEl) {
      ideasBodyEl.classList.remove("results-error");
    }

    try {
      const response = await fetch("/api/resume-ideas", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ text })
      });

      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok === false) {
        const message =
          payload?.message || "There was an error generating ideas. Please try again.";
        if (ideasBodyEl) {
          ideasBodyEl.textContent = message;
          ideasBodyEl.classList.add("results-error");
          ideasBodyEl.classList.remove("empty");
        }
        setIdeasStatus(message, "error");
        return;
      }

      const structured = payload.data || payload;
      renderIdeas(structured);
      setIdeasStatus("Questions ready.");
      setTimeout(() => setIdeasStatus(""), 1600);
    } catch (err) {
      console.error(err);
      if (ideasBodyEl) {
        ideasBodyEl.textContent =
          "Something unexpected glitched. Try again in a moment.";
        ideasBodyEl.classList.add("results-error");
        ideasBodyEl.classList.remove("empty");
      }
      setIdeasStatus("Couldn‚Äôt load questions. Try again.", "error");
    } finally {
      ideasInFlight = false;
      if (ideasRefreshEl) {
        ideasRefreshEl.disabled = false;
        ideasRefreshEl.textContent = originalIdeasButtonText || "Refresh";
      }
      setIdeasLoading(false);
    }
  }

  if (ideasOpenEl) {
    ideasOpenEl.addEventListener("click", () => {
      openIdeasModal();
      if (!ideasBodyEl || ideasBodyEl.classList.contains("empty")) {
        runIdeas({ auto: false });
      }
    });
  }

  if (ideasRefreshEl) {
    ideasRefreshEl.addEventListener("click", () => {
      runIdeas({ auto: false });
    });
  }

  if (ideasCloseEl) {
    ideasCloseEl.addEventListener("click", closeIdeasModal);
  }

  if (ideasBackdropEl) {
    ideasBackdropEl.addEventListener("click", closeIdeasModal);
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeIdeasModal();
    }
  });

  // Backdrop click should not scroll page when modal hidden
  if (ideasModalEl) {
    ideasModalEl.addEventListener("click", (e) => {
      if (e.target === ideasModalEl) {
        closeIdeasModal();
      }
    });
  }
function mapErrorToUserMessage(errorCode, fallbackMessage) {
  switch (errorCode) {
    case "VALIDATION_ERROR":
      return "I need a bit more from you before I can give real feedback. Check what you pasted and try again.";
    case "OPENAI_TIMEOUT":
      return "The model took too long to finish this pass. Try again in a moment.";
    case "OPENAI_NETWORK_ERROR":
      return "There was a small network hiccup. Try again and it should go through.";
    case "OPENAI_HTTP_ERROR":
      return "The model had trouble finishing your review. Try once more.";
    case "OPENAI_RESPONSE_PARSE_ERROR":
    case "OPENAI_RESPONSE_SHAPE_INVALID":
    case "OPENAI_RESPONSE_NOT_JSON":
      return "The model replied in a format I could not read cleanly. Run it again and it should come back sharper.";
    default:
      return (
        fallbackMessage ||
        "Something on my side glitched while reading your resume. Try once more."
      );
  }
}

  function setStatus(message, variant = "info") {
    const el = document.getElementById("status-bar");
    if (!el) return;
    el.textContent = message || "";
    el.classList.remove("status-info", "status-error");
    if (message) {
      el.classList.add(variant === "error" ? "status-error" : "status-info");
    }
  }

  function resetIdeasSection() {
    setIdeasStatus("");
    if (!ideasBodyEl) return;
    ideasBodyEl.innerHTML =
      "I‚Äôll look for wins that haven‚Äôt made it into your resume yet.";
    ideasBodyEl.classList.add("empty");
    ideasBodyEl.classList.remove("results-error");
    if (ideasModalEl) {
      ideasModalEl.classList.remove("visible");
      ideasModalEl.setAttribute("aria-hidden", "true");
    }
  }

  function setIdeasStatus(message, variant = "info") {
    if (!ideasStatusEl) return;
    ideasStatusEl.textContent = message || "";
    ideasStatusEl.classList.toggle("error", variant === "error" && !!message);
  }

  function openIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.add("visible");
    ideasModalEl.setAttribute("aria-hidden", "false");
  }

  function closeIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("visible");
    ideasModalEl.setAttribute("aria-hidden", "true");
  }

  function setIdeasLoading(isLoading) {
    if (!ideasLoadingBarEl) return;
    if (isLoading) {
      ideasLoadingBarEl.style.opacity = "1";
      ideasLoadingBarEl.style.animation = "loadingSlide 1.2s linear infinite";
      ideasLoadingBarEl.classList.add("active");
    } else {
      ideasLoadingBarEl.style.opacity = "0";
      ideasLoadingBarEl.style.animation = "none";
      ideasLoadingBarEl.classList.remove("active");
    }
  }

  function renderIdeas(data) {
    if (!ideasBodyEl) return;
    const { questions, notes, how_to_use: howToUse } = data || {};
    let html = "";

    if (Array.isArray(questions) && questions.length > 0) {
      const limited = questions.slice(0, 3);
      html += `<div class="result-heading result-section">Questions worth answering</div>`;
      html += `<div class="ideas-how">Use these to surface wins your resume isn‚Äôt showing yet.</div>`;
      html += `<ul class="ideas-list">`;
      for (const q of limited) {
        html += `<li>${escapeHtml(String(q))}</li>`;
      }
      html += `</ul>`;
    }

    html += `<div class="result-heading result-section">How to use this</div>`;
    html += `<p class="result-paragraph">Pick one question and jot down what actually happened: the situation, the decision you made, what you owned, and what changed.</p>`;

    html += `<div class="result-heading result-section">Turn it into a bullet</div>`;
    html += `<p class="result-paragraph">Use: verb + what you owned + the outcome (ideally with a number). Skip it if it‚Äôs already covered in your resume.</p>`;

    ideasBodyEl.innerHTML = html || "";
    ideasBodyEl.classList.remove("empty");
  }


  (function init() {
    loadSavedInput();
    setMode("resume");
    autoResizeTextarea();
    positionModeIndicator();
    updateResumeHintVisibility();
  })();
</script>

</body>
</html>
