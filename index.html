<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recruiter in Your Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&family=Manrope:wght@400;500;600&display=swap");

    :root {
      --bg-page: #FDFDFC;
      --bg-panel: #ffffff;
      --bg-card: #ffffff;
      --border-subtle: #d7dae3;
      --border-strong: #c6cbd6;
      --accent: #3341A6;
      --accent-dark: #26328C;
      --accent-wash: #EEF0FA;
      --accent-boost: #3341A6;
      --accent-strong: #1E2A78;
      --text-main: var(--ink-900);
      --text-soft: var(--slate-700);
      --text-muted: var(--slate-500);
      --ink-900: #0F172A;
      --slate-700: #334155;
      --slate-500: #64748B;
      --wash: #FAF9F6;
      --surface-tint: #F3F4F6;
      --success: #15803d;
      --success-dark: #047857;
      --success-light: #22c55e;
      --error: #b91c1c;
      --error-light: #fca5a5;
      --error-dark: #7f1d1d;
      --error-bg: rgba(185, 28, 28, 0.08);
      --warning: #d97706;
      --warning-dark: #92400e;
      --font-display: "Plus Jakarta Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-body: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --fs-hero: 52px;
      --fs-h1: 26px;
      --fs-h2: 21px;
      --fs-h3: 17px;
      --fs-body: 15px;
      --fs-small: 13px;
      --fs-xs: 12px;
      --fs-tiny: 11px;
      --fs-label: 14px;
      --fs-base: 16px;
      --fs-lg: 18px;
      --fs-xl: 20px;
      --fs-2xl: 22px;
      --fs-3xl: 32px;
      --fs-dial: 36px;
      --lh-very-tight: 1.1;
      --lh-tight: 1.15;
      --lh-snug: 1.2;
      --lh-cozy: 1.25;
      --lh-medium: 1.4;
      --lh-normal: 1.5;
      --lh-custom: 1.55;
      --lh-relaxed: 1.6;
      --lh-loose: 1.65;
      --lh-extra-loose: 1.7;
      --space-micro: 2px;
      --space-xxs: 4px;
      --space-xs: 6px;
      --space-tight: 8px;
      --space-sm: 10px;
      --space-sm-alt: 12px;
      --space-md: 15px;
      --space-md-alt: 16px;
      --space-md-lg: 18px;
      --space-lg: 20px;
      --space-lg-alt: 22px;
      --space-xl: 30px;
      --space-xl-alt: 24px;
      --space-2xl: 40px;
      --space-3xl: 32px;
      --space-xxl: 50px;
      --motion-duration-short: 200ms;
      --motion-duration-medium: 300ms;
      --motion-ease-premium: cubic-bezier(0.16, 1, 0.3, 1);
      --radius-xs: 6px;
      --radius-sm: 8px;
      --radius-md: 10px;
      --radius-input: 12px;
      --radius-lg: 14px;
      --radius-xl: 16px;
      --radius-card: 18px;
      --radius-2xl: 20px;
      --radius-3xl: 22px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 30px rgba(15, 23, 42, 0.06);
      --accent-width: 2px;
      --accent-width-strong: 6px;
      --stack-gap: 16px;
      --focus-outline-color: #A5B4FC;
      --focus-outline-width: 2px;
      --focus-outline-offset: 3px;
      --focus-shadow: 0 0 0 2px rgba(28, 78, 216, 0.16);
      --icon-size-sm: 8px;
      --space-tight-alt: 9px;
      --icon-size-md: 16px;
      --shadow-card: 0 10px 24px rgba(15, 23, 42, 0.08);
      --shadow-button: 0 4px 14px rgba(28, 78, 216, 0.25);
      --shadow-button-hover: 0 6px 18px rgba(23, 60, 169, 0.27);
      --shadow-modal: 0 18px 45px rgba(15, 23, 42, 0.12);
      --shadow-hero: 0 16px 32px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: var(--font-body);
    }

    /* Base type: Manrope 15px / 1.7 for body text */
    body {
      min-height: 100vh;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: var(--space-2xl) var(--space-lg) 42px;
      font-size: var(--fs-body);
      line-height: var(--lh-normal);
    }

    .page {
      width: 100%;
      max-width: 1200px;
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.06);
      background: var(--bg-panel);
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(15, 23, 42, 0.02);
      padding: var(--space-2xl);
      position: relative;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .page {
        padding: var(--space-md-alt) var(--space-md-alt) var(--space-lg-alt) var(--space-md-alt);
        border-radius: var(--radius-3xl);
      }
      .tool-layout {
        gap: var(--space-md-lg);
      }
      .card {
        padding: var(--space-md-lg);
      }
      .hero {
        margin-bottom: var(--space-md-alt);
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-sm);
      }
      .hero-title {
        font-size: var(--fs-h1);
      }
      .hero-subtitle {
        font-size: var(--fs-label);
        line-height: var(--lh-custom);
      }
      .proof-editorial {
        margin-top: var(--space-xl-alt);
        margin-bottom: var(--space-xl-alt);
        padding: var(--space-md-alt) var(--space-md-lg);
      }
      .proof-editorial-heading {
        font-size: var(--fs-label);
        margin-bottom: var(--space-sm-alt);
      }
      .proof-editorial-quote {
        font-size: var(--fs-xs);
        margin-bottom: var(--space-sm);
      }
    }

    /* Top bar */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md-alt);
      gap: var(--space-sm-alt);
      padding: var(--space-xxs) 0 var(--space-md-alt);
    }

    .brand {
      display: inline-flex;
      align-items: baseline;
      gap: var(--space-sm);
    }

    .brand-wordmark {
      font-family: var(--font-display);
      font-size: var(--fs-lg);
      letter-spacing: -0.03em;
      font-weight: 800;
      color: var(--text-main);
      text-transform: none;
      line-height: var(--lh-very-tight);
    }

    .version-pill {
      display: inline-flex;
      align-items: center;
      gap: var(--space-tight);
      padding: var(--space-xxs) var(--space-sm);
      border-radius: var(--radius-xs);
      border: 1px solid var(--border-subtle);
      background: var(--bg-panel);
      font-size: var(--fs-xs);
      color: var(--text-muted);
      letter-spacing: 0.01em;
      text-transform: none;
      box-shadow: none;
    }

    .trust-inline {
      margin-top: var(--space-sm);
      font-size: var(--fs-xs);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: var(--space-tight);
    }

    .trust-inline button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      cursor: pointer;
      font-size: var(--fs-xs);
      padding: 0;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .trust-inline button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .status-dot {
      width: var(--icon-size-sm);
      height: var(--icon-size-sm);
      border-radius: var(--radius-pill);
      background: var(--success);
      box-shadow: 0 0 0 5px rgba(21, 128, 61, 0.12);
    }

    @media (max-width: 600px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Hero */

    .hero {
      position: relative;
      margin: 0 auto var(--space-xl);
      padding: var(--space-xl) var(--space-2xl);
      max-width: 1100px;
      border-radius: var(--radius-card);
      background: var(--wash);
      box-shadow: var(--shadow-hero);
      overflow: hidden;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -8% -12%;
      background: radial-gradient(circle at 20% 20%, rgba(30, 42, 120, 0.10), transparent 30%),
                  radial-gradient(circle at 80% 10%, rgba(15, 23, 42, 0.10), transparent 26%);
      pointer-events: none;
    }

    .hero::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: var(--space-xl);
      background: linear-gradient(180deg, 
        rgba(51, 65, 166, 0.15) 0%, 
        rgba(51, 65, 166, 0.10) 50%,
        transparent 100%);
      border-radius: var(--radius-pill);
      pointer-events: none;
      opacity: 0.7;
    }

    .hero > * {
      position: relative;
      z-index: 1;
    }

    .hero-title {
      font-family: var(--font-display);
      font-size: var(--fs-hero);
      letter-spacing: -0.02em;
      color: var(--ink-900);
      font-weight: 700;
      line-height: var(--lh-tight);
      margin-bottom: var(--space-md);
      max-width: 820px;
    }

    .hero-subtitle {
      font-size: var(--fs-body);
      color: var(--text-soft);
      max-width: 640px;
      line-height: var(--lh-normal);
      margin-bottom: var(--space-sm);
    }

    .hero-credibility {
      font-size: var(--fs-small);
      color: var(--text-muted);
      max-width: 640px;
      line-height: var(--lh-normal);
      margin-bottom: var(--space-lg);
      font-style: italic;
      opacity: 0.9;
    }

    .process-track {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: var(--space-lg);
      margin-top: var(--space-xl);
      margin-bottom: var(--space-lg);
      padding: 0 var(--space-sm);
    }

    .process-line {
      position: absolute;
      top: 16px;
      left: var(--space-xl);
      right: var(--space-xl);
      height: 2px;
      background: var(--border-subtle);
      z-index: 0;
    }

    /* Gradient line for premium feel */
    .process-line::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        var(--accent-wash) 20%, 
        var(--accent-wash) 80%, 
        transparent 100%);
    }

    .process-step {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: var(--space-sm);
    }

    .process-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--bg-main);
      border: 2px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: var(--fs-small);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 4px var(--bg-main); /* Mask the line */
      transition: all 0.3s var(--motion-ease-premium);
    }

    .process-step:hover .process-icon {
      border-color: var(--accent);
      color: var(--accent);
      transform: scale(1.1);
      box-shadow: 0 0 0 6px var(--bg-main);
    }

    .process-label {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-snug);
      max-width: 180px;
      font-weight: 500;
    }

    @media (max-width: 600px) {
      .process-track {
        grid-template-columns: 1fr;
        gap: var(--space-md);
        padding-left: var(--space-lg);
      }

      .process-line {
        top: 0;
        bottom: 0;
        left: 15px; /* Align with icon center */
        right: auto;
        width: 2px;
        height: auto;
        background: linear-gradient(180deg, 
          transparent 0%, 
          var(--border-subtle) 15%, 
          var(--border-subtle) 85%, 
          transparent 100%);
      }

      .process-line::after {
        display: none;
      }

      .process-step {
        flex-direction: row;
        text-align: left;
        align-items: flex-start;
      }

      .process-icon {
        flex-shrink: 0;
        /* On mobile, box-shadow masking is trickier with a vertical line if background isn't solid, 
           but bg-main is solid so it works. */
      }
    }

    .hero-promise {
      margin-top: var(--space-lg);
      font-size: var(--fs-body);
      color: var(--slate-700);
      line-height: var(--lh-loose);
      max-width: 720px;
    }

    .hero-promise strong {
      color: var(--ink-900);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .hero-promise ul {
      list-style: disc;
      padding-left: var(--space-md-lg);
      margin-top: var(--space-xxs);
      display: grid;
      gap: var(--space-xxs);
    }

    /* Social proof */
    .proof {
      margin-top: var(--space-md-lg);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-sm-alt);
    }

    .proof-card {
      background: color-mix(in srgb, var(--bg-panel) 82%, transparent);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-sm-alt) var(--space-md-alt);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .proof-quote {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
    }

    .proof-name {
      font-size: var(--fs-tiny);
      color: var(--text-muted);
      letter-spacing: 0.01em;
    }

    .proof-editorial {
      margin-top: 0;
      margin-bottom: var(--space-2xl);
      padding: var(--space-lg) var(--space-xl-alt);
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-input);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.04);
    }

    .proof-editorial-heading {
      font-size: var(--fs-body);
      font-weight: 700;
      color: var(--ink-900);
      margin-bottom: var(--space-md-lg);
      letter-spacing: -0.01em;
    }

    .proof-editorial-quote {
      font-size: var(--fs-small);
      color: var(--text-main);
      line-height: var(--lh-loose);
      margin-bottom: var(--space-sm-alt);
    }

    .proof-editorial-quote:last-child {
      margin-bottom: 0;
    }

    .future-ribbon {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-sm-alt);
      flex-wrap: wrap;
    }

    .future-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      padding: var(--space-xxs) var(--space-sm);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
      font-size: var(--fs-tiny);
      letter-spacing: 0.01em;
    }

    .future-chip.warm {
      border-color: var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      :root {
        /* --fs-hero: 43px;  Removed: handled by specific overrides */
        --fs-h1: 24px;
        --fs-h2: 20px;
      }
      .hero {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-lg);
        margin-bottom: var(--space-md-lg);
      }
      .hero-title {
        font-size: var(--fs-3xl);
      }
      .hero-subtitle {
        font-size: var(--fs-label);
      }
      .hero-credibility {
        font-size: var(--fs-xs);
        margin-bottom: var(--space-md-lg);
      }
      .hero-grid {
        gap: var(--space-tight) var(--space-sm-alt);
      }
      .stack-heading {
        font-size: var(--fs-2xl);
        margin-bottom: var(--space-sm);
      }
      .stack-subline {
        font-size: var(--fs-small);
        margin-bottom: var(--space-md-alt);
      }
      .stack-section {
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        margin-bottom: var(--space-xl-alt);
      }
      .results-summary {
        padding: var(--space-md-alt) var(--space-md-lg);
        margin-bottom: var(--space-lg);
      }
      .tool-layout {
        gap: var(--space-md-alt);
        grid-template-columns: 1fr;
      }
      .card {
        padding: var(--space-md-alt);
      }
      .results-top {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-lg);
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.1);
      }
      .ideas-sheet {
        padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-alt) var(--space-lg);
      }
      .ideas-sheet::before {
        left: var(--space-md-lg);
        top: var(--space-md-lg);
        bottom: var(--space-md-alt);
      }
      .ideas-sheet-header {
        margin-bottom: var(--space-md-lg);
        gap: var(--space-sm-alt);
      }
      .ideas-sheet-title {
        font-size: var(--fs-xl);
        margin-bottom: var(--space-xxs);
      }
      .ideas-sheet-subtitle {
        font-size: var(--fs-small);
      }
      .ideas-actions .ghost-button {
        font-size: var(--fs-tiny);
        padding: var(--space-xs) var(--space-tight-alt);
      }
    }

    /* Main tool area */

    .tool-layout {
      position: relative;
      margin-top: var(--space-xl);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2xl);
      align-items: start;
    }

    .tool-layout::before {
      content: "";
      position: absolute;
      top: calc(var(--space-xl) * -1);
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: var(--space-xl);
      background: linear-gradient(180deg, 
        rgba(51, 65, 166, 0.12) 0%, 
        rgba(51, 65, 166, 0.08) 50%,
        transparent 100%);
      border-radius: var(--radius-pill);
      pointer-events: none;
      opacity: 0.6;
    }

    .tool-layout.input-full-width {
      grid-template-columns: 1fr;
    }

    /* Ensure columns are balanced and feel like distinct workspaces */
    .card-input {
      min-height: 400px;
    }

    /* Make report wrapper feel like a distinct report panel */
    .report-wrapper {
      position: relative;
    }

    @media (max-width: 1024px) {
      .tool-layout {
        grid-template-columns: 1fr;
        gap: var(--space-xxl);
      }
      
      .card-input {
        min-height: auto;
      }
    }

    .card {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.07);
      padding: var(--space-2xl);
      box-shadow: var(--shadow-soft);
      overflow: visible;
      transition: box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .card::before {
      display: none;
    }

    .card-output {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      padding: var(--space-lg) var(--space-lg) var(--space-xl-alt);
      overflow: hidden;
    }

    .card-output::before {
      content: "";
      position: absolute;
      left: var(--space-lg);
      top: var(--space-lg);
      bottom: var(--space-lg);
      width: 3px;
      border-radius: var(--radius-sm);
      background: var(--accent);
      opacity: 0.3;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
    }

    .card-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
      line-height: var(--lh-cozy);
    }

    .card-input .card-title {
      font-size: var(--fs-h1);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: var(--space-sm);
    }

    label {
      display: block;
      font-size: var(--fs-small);
      color: var(--text-soft);
      margin-bottom: var(--space-sm-alt);
      letter-spacing: 0.01em;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      max-height: 360px;
      overflow-y: auto;
      padding: var(--space-md-alt) var(--space-md-alt);
      font-size: var(--fs-body);
      color: var(--text-main);
      border-radius: var(--radius-input);
      border: 1px solid var(--border-subtle);
      background: var(--bg-panel);
      resize: none;
      margin: 0;
      line-height: var(--lh-loose);
      box-shadow: 0 2px 4px rgba(0,0,0,0.02) inset;
      transition: border-color var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    textarea:focus {
      border-color: var(--accent-light);
      box-shadow: 0 0 0 4px var(--accent-wash), 0 2px 4px rgba(0,0,0,0.02) inset;
      outline: none;
    }

    textarea::placeholder {
      color: rgba(100, 116, 139, 0.42);
      font-size: var(--fs-label);
      font-weight: 500;
      letter-spacing: 0.005em;
    }

    .input-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--fs-xs);
      margin-bottom: var(--space-sm-alt);
      color: var(--text-muted);
    }

    .saved-indicator {
      color: var(--success-light);
      opacity: 0;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium);
    }

    .saved-indicator.visible {
      opacity: 1;
    }

    body.focus-mode .tool-layout {
      grid-template-columns: minmax(0, 1fr);
      margin-top: var(--space-sm);
    }

    body.focus-mode .tool-layout::after {
      display: none;
    }

    body.focus-mode .card-input {
      display: none;
    }

    body.focus-mode .card-output {
      grid-column: 1 / -1;
      max-width: 960px;
      margin: 0 auto;
    }

    .card-input {
      margin-top: 0;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-card);
      border: 1px solid rgba(12, 17, 32, 0.08);
      padding: var(--space-xl-alt);
      background: linear-gradient(165deg, #ffffff 0%, #fafbfd 100%);
      transition: transform 0.4s var(--motion-ease-premium), box-shadow 0.4s var(--motion-ease-premium);
    }

    .card-input:hover {
      transform: translateY(-2px);
      box-shadow: 0 24px 55px rgba(15, 23, 42, 0.12);
    }

    .coming-soon-hint {
      font-size: var(--fs-tiny);
      color: var(--text-muted);
      margin-top: var(--space-micro);
      margin-bottom: var(--space-sm);
    }

    .run-row {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin-top: var(--space-md-alt);
    }

    .run-row::before {
      content: "";
      position: absolute;
      inset: -10px 8px 0 8px;
      background: radial-gradient(circle at 50% 30%, rgba(30, 42, 120, 0.12), transparent 55%);
      filter: blur(6px);
      z-index: 0;
      pointer-events: none;
    }

    .run-row > * {
      position: relative;
      z-index: 1;
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg-panel);
      font-weight: 600;
      border-radius: var(--radius-input);
      padding: var(--space-sm-alt) var(--space-lg-alt);
      border: none;
      box-shadow: var(--shadow-button);
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xxs);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--accent-dark);
      box-shadow: var(--shadow-button-hover);
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: 0 1px 3px rgba(10, 16, 28, 0.12);
      transform: none;
    }

    .btn-primary:disabled:hover {
      background: var(--accent);
      transform: none;
      box-shadow: 0 1px 3px rgba(10, 16, 28, 0.12);
    }

    .btn-success-state {
      background: var(--success-light) !important;
      color: var(--success-dark) !important;
      border-color: var(--success-light) !important;
      transition: all 0.2s ease;
    }

    .btn-secondary {
      background: var(--bg-panel);
      border: 1px solid rgba(28, 78, 216, 0.45);
      color: var(--accent);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-lg);
      box-shadow: 0 4px 10px rgba(28, 78, 216, 0.15);
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium), border-color var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xxs);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--accent-wash);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary:disabled:hover {
      background: var(--bg-panel);
      border-color: var(--border-subtle);
      transform: none;
    }

    .run-button {
      width: 100%;
      font-size: var(--fs-base);
      letter-spacing: -0.01em;
    }

    .copy-button,
    .export-button {
      font-size: var(--fs-small);
      gap: var(--space-xxs);
    }

    .icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      stroke: currentColor;
    }

    @keyframes runButtonPulse {
      0% { background: var(--accent); }
      50% { background: color-mix(in srgb, var(--accent) 92%, white 8%); }
      100% { background: var(--accent); }
    }

    @keyframes shimmer {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    .status {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      min-height: var(--space-md-lg);
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium),
                  transform var(--motion-duration-short) var(--motion-ease-premium);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      font-weight: 500;
      letter-spacing: -0.01em;
    }

    .status.status-loading {
      color: var(--text-main);
    }

    .status.status-loading::before {
      content: "";
      width: 6px;
      height: 6px;
      background-color: var(--accent);
      border-radius: 50%;
      animation: statusPulse 1.5s ease-in-out infinite;
    }

    @keyframes statusPulse {
      0% { opacity: 0.4; transform: scale(0.9); }
      50% { opacity: 1; transform: scale(1.1); }
      100% { opacity: 0.4; transform: scale(0.9); }
    }

    .status:not(:empty) {
      animation: statusFadeIn 0.4s var(--motion-ease-premium);
    }

    @keyframes statusFadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Results */

    .results-header-row {
      display: block;
      margin-top: var(--space-xxs);
      margin-bottom: var(--space-sm);
    }

    .focus-controls {
      display: flex;
      justify-content: flex-end;
      margin: var(--space-xxs) 0 var(--space-sm-alt);
    }

    .focus-button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      font-size: var(--fs-small);
      font-weight: 600;
      letter-spacing: -0.01em;
      cursor: pointer;
      padding: var(--space-xxs) 0;
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
      text-decoration: none;
      transition: color var(--motion-duration-short) var(--motion-ease-premium), text-decoration-color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .focus-button:hover {
      color: var(--accent-strong);
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 2px;
    }

    .focus-button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .results-top {
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-lg) var(--space-lg);
      margin-bottom: var(--space-lg);
      box-shadow: var(--shadow-card);
      transition: background 600ms var(--motion-ease-premium);
    }

    .report-container--visible .results-top {
      background: linear-gradient(135deg, var(--wash) 0%, color-mix(in srgb, var(--accent-wash) 8%, var(--wash) 92%) 100%);
    }

    .report-view {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .results-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: var(--space-sm);
      margin-top: var(--space-tight);
    }

    .results-actions-bottom {
      margin-top: var(--space-md-alt);
    }

    .score-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      padding: 0;
      border-radius: var(--radius-pill);
      background: transparent;
      border: none;
      box-shadow: none;
      width: 100%;
    }

    .score-wrapper.hidden {
      display: none;
    }

    .score-cluster {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .score-texts {
      display: flex;
      flex-direction: column;
      gap: var(--space-micro);
    }

    .score-label-text {
      font-size: var(--fs-small);
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-short-text {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-medium);
    }

    .report-meta {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
      line-height: var(--lh-medium);
    }

    .score-help {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-top: var(--space-xxs);
      line-height: var(--lh-normal);
    }

    #results-title {
      font-size: var(--fs-xl);
      margin-bottom: var(--space-tight);
      color: var(--text-main);
      font-weight: 800;
      letter-spacing: -0.02em;
      position: relative;
    }

    .results-bridge {
      margin: var(--space-md-alt) 0 var(--space-md-lg);
    }

    .report-accent-line {
      height: var(--accent-width);
      background: var(--accent);
      border-radius: var(--radius-pill);
      margin: var(--space-tight) 0 var(--space-xxs);
      transform-origin: left;
      width: 100%;
    }

    .report-wrapper {
      display: none;
    }

    .report-container {
      opacity: 0;
      transform: translateY(12px) scale(0.98);
      filter: blur(3px);
    }

    .report-container--visible {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
      transition:
        opacity 420ms cubic-bezier(0.16, 1, 0.3, 1),
        transform 420ms cubic-bezier(0.16, 1, 0.3, 1),
        filter 420ms cubic-bezier(0.16, 1, 0.3, 1);
    }

    @media (prefers-reduced-motion: reduce) {
      .report-container,
      .report-container--visible {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
        transition: none !important;
      }
      .results-top {
        transition: none !important;
      }
    }

    .report-title {
      position: relative;
      display: inline-block;
    }

    .report-title::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -6px;
      height: 2px;
      width: 100%;
      background: var(--accent);
      transform: scaleX(0);
      transform-origin: left;
    }

    .bridge-heading {
      font-size: var(--fs-base);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin-bottom: var(--space-tight);
    }

    #results-subtitle {
      font-size: var(--fs-base);
      color: var(--slate-700);
      line-height: var(--lh-relaxed);
      max-width: 620px;
      margin: 0;
    }

    .score-header-inside {
      width: 100%;
      display: flex;
        flex-direction: column;
        align-items: center;
      gap: var(--space-sm-alt);
      margin: var(--space-tight) 0 var(--space-md-lg);
    }

    .score-dial-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      position: relative;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .score-dial-container.visible {
      opacity: 1;
    }

    .score-dial {
      position: relative;
      width: 140px;
      height: 140px;
    }

    .score-dial svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .score-dial-bg {
      fill: none;
      stroke: rgba(15, 23, 42, 0.08);
      stroke-width: 8;
    }

    .score-dial-progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 339.292;
      stroke-dashoffset: 339.292;
      transition: stroke-dashoffset 800ms var(--motion-ease-premium);
      transform-origin: center;
    }

    .score-dial-progress[style*="stroke-dashoffset"] {
      transition: stroke-dashoffset 800ms var(--motion-ease-premium);
    }

    @media (prefers-reduced-motion: reduce) {
      .score-dial-progress {
        transition: none;
      }
    }

    .score-dial-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: var(--font-display);
      font-size: var(--fs-dial);
      font-weight: 800;
      letter-spacing: -0.02em;
      color: var(--text-main);
      line-height: 1;
    }

    .score-dial-label {
      font-size: var(--fs-small);
      color: var(--text-muted);
      font-weight: 500;
      text-align: center;
      letter-spacing: 0.01em;
    }

    .score-dial--reveal {
      animation: score-dial-reveal 2s var(--motion-ease-premium),
                 score-dial-glow 0.8s var(--motion-ease-premium) 0.2s;
    }

    @keyframes score-dial-glow {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(51, 65, 166, 0);
      }
      50% {
        box-shadow: 0 0 20px 4px rgba(51, 65, 166, 0.15);
      }
    }

    @keyframes score-dial-reveal {
      from {
        opacity: 0;
        transform: scale(0.88);
        filter: blur(4px);
      }
      60% {
        opacity: 0.95;
        transform: scale(1.02);
        filter: blur(1px);
      }
      to {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .score-dial--reveal {
        animation: none;
      }
      .score-dial-glow {
        animation: none;
      }
    }

    .score-tooltip {
      position: absolute;
      top: calc(100% + var(--space-md-alt));
      left: 50%;
      transform: translateX(-50%) translateY(var(--space-xxs));
      width: 320px;
      max-width: calc(100vw - var(--space-3xl));
      background: var(--bg-panel);
      border: 1px solid var(--border-strong);
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
      border-radius: var(--radius-input);
      padding: var(--space-sm-alt);
      font-size: var(--fs-xs);
      color: var(--text-main);
      line-height: var(--lh-normal);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
      z-index: 5;
    }

    .score-tip-line {
      margin-bottom: var(--space-xxs);
      color: var(--text-soft);
    }

    .score-tip-line:last-child {
      margin-bottom: 0;
    }

    .score-wrapper:hover .score-tooltip,
    .score-wrapper:focus-within .score-tooltip,
    .score-dial-container:hover ~ .score-tooltip,
    .score-dial-container:focus-within ~ .score-tooltip,
    .score-tooltip.open {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
    }

    .score-low .score-dial-progress {
      stroke: var(--error);
    }

    .score-low .score-dial-number {
      color: var(--error-dark);
    }

    .score-mid .score-dial-progress {
      stroke: var(--warning);
    }

    .score-mid .score-dial-number {
      color: var(--warning-dark);
    }

    .score-good .score-dial-progress {
      stroke: var(--accent);
    }

    .score-good .score-dial-number {
      color: var(--accent);
    }

    .score-great .score-dial-progress {
      stroke: var(--success-light);
    }

    .score-great .score-dial-number {
      color: var(--success-dark);
    }

    .issue-breakdown {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin-top: var(--space-tight);
      width: 100%;
      max-width: 280px;
      opacity: 0;
      transition: opacity var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .issue-breakdown.visible {
      opacity: 1;
    }

    .issue-bar {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      padding: var(--space-sm) var(--space-sm-alt);
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
      text-align: left;
      overflow: hidden;
    }

    .issue-bar:hover,
    .issue-bar:focus-visible {
      background: var(--accent-wash);
      border-color: var(--accent);
      transform: translateX(2px);
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .issue-bar-content {
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .issue-bar-label {
      font-size: var(--fs-small);
      font-weight: 600;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .issue-bar-count {
      font-size: var(--fs-xs);
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.01em;
    }

    .issue-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: var(--accent);
      opacity: 0.08;
      width: 0%;
      transition: width 600ms var(--motion-ease-premium);
      z-index: 1;
    }

    .issue-bar[data-count="0"] .issue-bar-fill {
      width: 0%;
    }

    .issue-bar[data-count="1"] .issue-bar-fill {
      width: 20%;
    }

    .issue-bar[data-count="2"] .issue-bar-fill {
      width: 40%;
    }

    .issue-bar[data-count="3"] .issue-bar-fill {
      width: 60%;
    }

    .issue-bar[data-count="4"] .issue-bar-fill,
    .issue-bar[data-count="5"] .issue-bar-fill {
      width: 80%;
    }

    .issue-bar[data-count="6"] .issue-bar-fill,
    .issue-bar[data-count="7"] .issue-bar-fill,
    .issue-bar[data-count="8"] .issue-bar-fill,
    .issue-bar[data-count="9"] .issue-bar-fill,
    .issue-bar[data-count="10"] .issue-bar-fill {
      width: 100%;
    }

    @media (max-width: 1024px) {
      .issue-breakdown {
        max-width: 100%;
        margin-top: var(--space-md-alt);
      }
    }

    @media (max-width: 600px) {
      .issue-breakdown {
        margin-top: var(--space-md-alt);
        gap: var(--space-tight);
      }

      .issue-bar {
        padding: var(--space-tight) var(--space-sm);
      }

      .issue-bar-label {
        font-size: var(--fs-xs);
      }

      .issue-bar-count {
        font-size: var(--fs-tiny);
      }
    }

    .issue-breakdown-microcopy {
      margin-top: var(--space-sm-alt);
      font-size: var(--fs-xs);
      color: var(--text-muted);
      text-align: center;
      line-height: var(--lh-medium);
      letter-spacing: 0.01em;
    }

    @media (max-width: 600px) {
      .issue-breakdown-microcopy {
        font-size: var(--fs-tiny);
        margin-top: var(--space-sm);
      }
    }

    .score-bands-trigger {
      background: none;
      border: none;
      padding: 0;
      color: var(--text-soft);
      font-size: var(--fs-xs);
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: var(--space-micro);
      margin-top: var(--space-tight);
      align-self: flex-start;
    }

    .score-bands-trigger:hover,
    .score-bands-trigger:focus-visible {
      color: var(--text-main);
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
      border-radius: var(--radius-xs);
    }

    .score-bands-panel {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      max-width: 320px;
    }

    .score-bands-panel-title {
      font-size: var(--fs-small);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .score-bands-intro {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-custom);
    }

    .score-bands-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .score-band-item {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: var(--space-tight) var(--space-sm);
      background: var(--surface-tint);
      display: flex;
      flex-direction: column;
      gap: var(--space-xxs);
    }

    .score-band-item.active {
      border-color: var(--accent);
      background: var(--accent-wash);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .score-band-header {
      display: flex;
      align-items: center;
      gap: var(--space-xxs);
      font-size: var(--fs-small);
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-range {
      color: var(--text-main);
    }

    .score-band-label {
      color: var(--text-soft);
      font-weight: 600;
    }

    .score-band-chip {
      margin-left: auto;
      font-size: var(--fs-tiny);
      background: color-mix(in srgb, var(--accent) 20%, var(--bg-panel) 80%);
      color: var(--accent-strong);
      padding: var(--space-xxs) var(--space-xxs);
      border-radius: var(--radius-pill);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-description {
      font-size: var(--fs-xs);
      color: var(--text-soft);
      line-height: var(--lh-normal);
    }

    /* Paywall */
    .paywall-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.42);
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .paywall-card {
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      box-shadow: 0 22px 48px rgba(0, 0, 0, 0.12);
      width: min(520px, 92vw);
      padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-alt);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .paywall-title {
      font-size: var(--fs-lg);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.015em;
    }

    .paywall-subtitle {
      font-size: var(--fs-label);
      color: var(--text-soft);
      line-height: var(--lh-relaxed);
    }

    .paywall-list {
      margin: var(--space-xxs) 0 var(--space-tight);
      padding-left: var(--space-md-lg);
      color: var(--text-main);
      line-height: var(--lh-custom);
      font-size: var(--fs-label);
    }

    .paywall-actions {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
      margin-top: var(--space-xxs);
    }

    .paywall-primary {
      background: var(--accent);
      color: var(--bg-panel);
      border: none;
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md-lg);
      font-size: var(--fs-label);
      font-weight: 700;
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), box-shadow var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-primary:hover:not(:disabled) {
      background: var(--accent-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-button-hover);
    }

    .paywall-primary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .paywall-secondary {
      background: none;
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md-lg);
      font-size: var(--fs-label);
      cursor: pointer;
      transition: background var(--motion-duration-short) var(--motion-ease-premium), border-color var(--motion-duration-short) var(--motion-ease-premium), transform var(--motion-duration-short) var(--motion-ease-premium);
    }

    .paywall-secondary:hover:not(:disabled) {
      background: var(--surface-tint);
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .paywall-secondary:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    #loading-bar {
      height: 3px;
      border-radius: var(--radius-pill);
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      margin-top: var(--space-tight);
      opacity: 0;
      transform: scaleX(0.9);
      transform-origin: center;
    }

    #loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.1s linear infinite;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.18);
    }

    @keyframes loadingSlide {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    #results-body {
      border: 1px solid var(--border-subtle);
      padding: var(--space-md-alt) var(--space-md-lg);
      line-height: var(--lh-loose);
      white-space: normal;
      font-weight: 400;
      margin-top: var(--space-tight);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02);
      background: var(--bg-panel);
      border-radius: var(--radius-input);
    }

    #results-body.muted {
      opacity: 0.55;
      filter: grayscale(0.06);
    }

    #results-body.refreshed {
      animation: fadeUp 0.18s ease-out;
    }

    #results-body.empty {
      color: color-mix(in srgb, var(--text-muted) 82%, transparent);
      background: var(--wash);
      text-align: center;
      padding: var(--space-xl) var(--space-lg);
    }

    .results-summary {
      font-size: var(--fs-body);
      color: var(--text-main);
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-input);
      padding: var(--space-lg) var(--space-xl-alt);
      line-height: var(--lh-extra-loose);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
      margin-bottom: var(--space-xl-alt);
    }

    .results-summary.empty {
      color: var(--text-muted);
      box-shadow: none;
      text-align: center;
    }

    .results-skeleton {
      display: flex;
      flex-direction: column;
      gap: 0;
      min-height: 400px;
      position: relative;
      background: transparent;
      border: none;
      padding: 0;
      margin: 0;
    }

    .skeleton-score-area {
      display: flex !important;
      flex-direction: column;
      align-items: center;
      gap: var(--space-sm-alt);
      padding-bottom: var(--space-tight);
      width: 100%;
    }

    .skeleton-score-dial {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: var(--border-strong) !important;
      border: 2px solid var(--border-subtle);
      position: relative;
      overflow: visible;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-score-dial::after {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      background: var(--wash);
      border: 1px solid var(--border-subtle);
    }

    .skeleton-score-label {
      width: 120px;
      height: var(--fs-label);
      border-radius: var(--radius-xs);
      background: var(--border-strong) !important;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-issue-breakdown {
      display: flex !important;
      flex-direction: column;
      gap: var(--space-sm);
      width: 100%;
      margin-top: var(--space-tight);
      max-width: 100%;
    }

    .skeleton-issue-bar {
      height: 42px;
      border-radius: var(--radius-sm);
      background: var(--border-strong) !important;
      border: 1px solid var(--border-subtle);
      width: 100%;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-results-top,
    .skeleton-summary-section,
    .skeleton-section {
      position: relative;
      padding: var(--space-xl-alt) var(--space-lg) var(--space-lg) calc(var(--space-xl) + 6px);
      margin: 0 0 var(--space-xl) 0;
      border-radius: var(--radius-input);
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
      width: 100%;
    }

    .skeleton-results-top {
      background: var(--wash);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-lg) var(--space-lg);
      margin-bottom: var(--space-lg);
    }

    .skeleton-header-row {
      margin-bottom: var(--space-sm-alt);
    }

    .skeleton-heading {
      width: 200px;
      height: 26px;
      border-radius: var(--radius-xs);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      margin-bottom: var(--space-sm-alt);
      animation: skeletonShimmer 3s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-subline {
      width: 85%;
      height: 14px;
      border-radius: var(--radius-xs);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      margin-bottom: var(--space-lg);
      opacity: 0.7;
      animation: skeletonShimmer 3s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-line {
      height: 8px;
      border-radius: var(--radius-pill);
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%);
      background-size: 200% 100%;
      width: 100%;
      animation: skeletonPulse 1.8s ease-in-out infinite,
                 skeletonShimmer 2.5s ease-in-out infinite;
      flex-shrink: 0;
      display: block !important;
    }

    .skeleton-score-dial,
    .skeleton-score-label,
    .skeleton-issue-bar {
      background: linear-gradient(90deg, 
        var(--border-strong) 0%, 
        color-mix(in srgb, var(--border-strong) 70%, var(--accent-wash) 30%) 50%,
        var(--border-strong) 100%) !important;
      background-size: 200% 100% !important;
      animation: skeletonShimmer 3s ease-in-out infinite;
    }

    @keyframes skeletonPulse {
      0%, 100% {
        opacity: 1;
        background-color: var(--border-strong);
      }
      50% {
        opacity: 0.7;
        background-color: color-mix(in srgb, var(--border-strong) 85%, var(--border-subtle) 15%);
      }
    }

    @keyframes skeletonShimmer {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    /* Make skeleton visible when not hidden - override .hidden class */
    .results-skeleton.hidden {
      display: none !important;
      visibility: hidden !important;
    }
    
    .results-skeleton:not(.hidden) {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 1;
    }

    /* Skeleton accent line should be visible but subtle */
    .results-skeleton.stack-accent-line .skeleton-results-top::before,
    .results-skeleton.stack-accent-line .skeleton-summary-section::before,
    .results-skeleton.stack-accent-line .skeleton-section::before {
      content: "";
      position: absolute;
      left: 0;
      top: 8px;
      bottom: 8px;
      width: 3px;
      background: linear-gradient(180deg, var(--border-strong) 0%, color-mix(in srgb, var(--border-strong) 60%, transparent) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.4;
      pointer-events: none;
      animation: skeletonPulse 1.5s ease-in-out infinite;
    }

    .results-skeleton.stack-accent-line .skeleton-results-top::before {
      display: none; /* results-top doesn't have accent line */
    }

    .skeleton-line.wide { width: 92%; }
    .skeleton-line.mid { width: 74%; }
    .skeleton-line.short { width: 52%; }

    .skeleton-title {
      width: 180px;
      height: 24px;
      margin-bottom: var(--space-sm-alt);
    }

    .skeleton-text-wide {
      width: 85%;
      height: 12px;
      margin-bottom: var(--space-tight);
    }

    .skeleton-text-mid {
      width: 70%;
      height: 12px;
    }

    .skeleton-content-line {
      margin-top: var(--space-tight);
    }

    .hidden {
      display: none !important;
    }

    .results-summary.empty {
      color: var(--text-muted);
    }

    @keyframes reportRevealSoft {
      from {
        opacity: 0;
        transform: translateY(12px) scale(0.98);
        filter: blur(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    @keyframes scorePillPop {
      from {
        transform: scale(0.90);
        background-color: color-mix(in srgb, var(--score-pill-bg) 80%, white 20%);
        opacity: 0.85;
      }
      50% {
        transform: scale(1.04);
        background-color: color-mix(in srgb, var(--score-pill-bg) 95%, white 5%);
        opacity: 0.98;
      }
      100% {
        transform: scale(1);
        background-color: var(--score-pill-bg);
        opacity: 1;
      }
    }

    @keyframes accentLineDraw {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes accentWipe {
      from { transform: scaleY(0); }
      to { transform: scaleY(1); }
    }

    @keyframes titleUnderline {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes reportSectionIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-error {
      border-color: var(--error) !important;
      color: var(--error-dark) !important;
      background: var(--error-bg) !important;
    }

    #results-body {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
      position: relative;
    }

    .stack-accent-line {
      position: relative;
    }

    .stack::before,
    .stack-accent-line::before {
      content: "";
      position: absolute;
      left: 0;
      top: 8px;
      bottom: 8px;
      width: 3px;
      background: linear-gradient(180deg, var(--accent) 0%, color-mix(in srgb, var(--accent) 60%, transparent) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.7;
      pointer-events: none;
      transition: opacity var(--motion-duration-short) var(--motion-ease-premium);
    }

    .stack-section {
      position: relative;
      padding: var(--space-3xl) var(--space-lg) var(--space-xl-alt) var(--space-3xl);
      margin: 0 0 var(--space-3xl) 0;
      border-radius: var(--radius-input);
      transition:
        background var(--motion-duration-short) var(--motion-ease-premium),
        transform var(--motion-duration-short) var(--motion-ease-premium),
        box-shadow var(--motion-duration-short) var(--motion-ease-premium);
    }

    .stack-section:last-child {
      margin-bottom: 0;
    }

    .stack-heading {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin-top: 0;
      margin-bottom: var(--space-sm-alt);
      line-height: var(--lh-cozy);
    }


    .stack-subline {
      font-size: var(--fs-label);
      color: var(--text-muted);
      margin-top: 0;
      margin-bottom: var(--space-lg);
      line-height: var(--lh-relaxed);
      font-weight: 400;
      opacity: 0.9;
    }

    .stack-section:hover,
    .stack-section:focus-within {
      background: rgba(31, 63, 182, 0.04);
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
    }

    .stack-section:hover.stack-accent-line::before,
    .stack-section:focus-within.stack-accent-line::before {
      opacity: 0.9;
    }

    .accent-card-primary {
      position: relative;
      overflow: hidden;
    }

    .accent-card-primary::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      border-radius: var(--radius-card);
    }

    /* Testimonials: keep clean without spine */
    .proof-editorial.accent-card-primary::before {
      display: none;
    }

    /* Hide duplicate accent on ideas sheet header (sheet has its own accent) */
    .ideas-sheet-header.accent-card-primary::before {
      display: none;
    }

    .accent-heading {
      position: relative;
      padding-left: var(--space-md);
    }

    .accent-heading::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 2px;
      height: 1.6em;
      background: var(--accent);
      border-radius: var(--radius-pill);
    }

    .ideas-sheet-header.accent-left {
      padding-left: var(--space-lg);
    }

    .ideas-sheet-header.accent-card-primary {
      padding-left: calc(var(--space-xl) - var(--accent-width-strong));
      overflow: visible;
    }

    .result-paragraph {
      margin: 0 0 var(--space-sm);
    }

    .result-list {
      margin: var(--space-xxs) 0 var(--space-md-alt);
      padding-left: var(--space-md-lg);
    }

    .result-list li {
      margin-bottom: var(--space-sm);
      line-height: var(--lh-relaxed);
    }

    .rewrite-label {
      font-weight: 600;
      color: var(--text-soft);
      margin: 0 0 var(--space-tight);
      font-size: var(--fs-tiny);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-family: var(--font-display);
    }

    .rewrite-column .rewrite-label {
      color: var(--text-muted);
      opacity: 0.8;
    }

    .rewrite-column.right .rewrite-label {
      color: var(--accent);
      font-weight: 700;
      opacity: 1;
    }

    .rewrite-text {
      margin: 0;
      padding-left: 0;
      color: var(--text-main);
      line-height: var(--lh-loose);
      font-size: var(--fs-label);
    }

    .rewrite-column .rewrite-text {
      color: var(--text-soft);
      opacity: 0.85;
    }

    .rewrite-column.right .rewrite-text {
      color: var(--text-main);
      font-weight: 400;
      opacity: 1;
    }

    .empty-hint {
      font-size: var(--fs-xs);
      color: color-mix(in srgb, var(--text-muted) 85%, transparent);
      margin-top: var(--space-xxs);
    }

    #results-body:not(.empty) + .empty-hint {
      display: none;
    }

    .rewrite-enhancement-note {
      margin-top: var(--space-sm-alt);
      font-size: var(--fs-xs);
      font-style: italic;
      padding: 0;
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      padding-left: var(--space-lg);
      position: relative;
      opacity: 0.9;
    }

    .rewrite-enhancement-note::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0.5em;
      width: var(--space-xxs);
      height: var(--space-xxs);
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.4;
    }

    .results-body-better-flash .rewrite-column.right {
      filter: contrast(1.05);
      transition: filter 0.2s ease;
    }

    .results-body-better-flash .rewrite-column:not(.right) {
      opacity: 0.82;
      transition: opacity 0.2s ease;
    }

    @media (prefers-reduced-motion: reduce) {
      .report-view,
      .report-view.report-view--reveal {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view.report-view--focus-start {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view,
      .report-card,
      .score-pill,
      .report-accent-line,
      .report-section,
      .report-title::after,
      .accent-heading::before,
      .accent-card-primary::before {
        animation: none !important;
        transition: none !important;
        transform: none !important;
        opacity: 1 !important;
      }
      .skeleton-heading,
      .skeleton-subline,
      .skeleton-line,
      .skeleton-score-dial,
      .skeleton-score-label,
      .skeleton-issue-bar {
        animation: skeletonPulse 1.8s ease-in-out infinite !important;
        background: var(--border-strong) !important;
        background-size: 100% 100% !important;
      }
      .status {
        animation: none !important;
      }

      .score-dial {
        width: calc(var(--space-3xl) * 3.75);
        height: calc(var(--space-3xl) * 3.75);
      }

      .score-dial-number {
        font-size: calc(var(--fs-3xl) * 0.9375);
      }

      .score-dial-label {
        font-size: var(--fs-xs);
      }

      .run-button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .stack-section {
        transition: none !important;
        transform: none !important;
      }
    }

    .copy-button,
    .export-button {
      font-size: var(--fs-small);
      gap: var(--space-xxs);
    }

    /* Rewrite blocks and section separators */

    .rewrite-block {
      margin-top: 0;
      margin-bottom: var(--space-md-alt);
      padding: var(--space-lg);
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      transition: all var(--motion-duration-short) var(--motion-ease-premium);
      position: relative;
      opacity: 0;
      transform: translateY(var(--space-xxs));
      animation: rewrite-tile-reveal 0.25s var(--motion-ease-premium) forwards;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
    }

    .rewrite-block:nth-child(1) {
      animation-delay: 0ms;
    }

    .rewrite-block:nth-child(2) {
      animation-delay: 40ms;
    }

    .rewrite-block:nth-child(3) {
      animation-delay: 80ms;
    }

    .rewrite-block:nth-child(4) {
      animation-delay: 120ms;
    }

    .rewrite-block:nth-child(5) {
      animation-delay: 160ms;
    }

    @keyframes rewrite-tile-reveal {
      from {
        opacity: 0;
        transform: translateY(var(--space-xxs));
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .rewrite-block {
        animation: none;
        opacity: 1;
        transform: none;
      }
    }

    .rewrite-block:hover {
      background: var(--bg-panel);
      border-color: var(--accent);
      box-shadow: 0 4px 16px rgba(15, 23, 42, 0.08), 0 0 0 1px rgba(28, 78, 216, 0.08);
      transform: translateY(-1px);
    }

    .rewrite-columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: var(--space-xl-alt);
      align-items: start;
    }

    .rewrite-column {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .rewrite-column.right {
      position: relative;
      padding-left: var(--space-xl-alt);
    }

    .rewrite-column.right::before {
      content: "";
      position: absolute;
      left: 0;
      top: var(--space-micro);
      bottom: var(--space-micro);
      width: 2px;
      background: linear-gradient(to bottom, var(--accent), color-mix(in srgb, var(--accent) 80%, transparent));
      border-radius: var(--radius-pill);
      opacity: 0.6;
    }

    .rewrite-column.right::after {
      content: "";
      position: absolute;
      left: calc(-1 * var(--space-xxs));
      top: 0;
      width: var(--space-md-lg);
      height: var(--space-md-lg);
      background: var(--accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--fs-tiny);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(28, 78, 216, 0.25), 0 0 0 2px var(--bg-panel);
      line-height: 1;
    }

    @media (max-width: 600px) {
      .rewrite-columns {
        grid-template-columns: 1fr;
      }
      .rewrite-column.right {
        padding-left: var(--space-xl-alt);
      }

      .rewrite-column.right::before {
        display: block;
      }

      .rewrite-column.right::after {
        display: flex;
      }
    }

    /* Remove border between rewrite blocks since they're now cards */
    .rewrite-block + .rewrite-block {
      border-top: none;
      margin-top: 0;
    }

    /* First rewrite block in a cluster */
    .rewrite-cluster-heading + .rewrite-block {
      margin-top: 0;
    }

    .result-section {
      border-top: 1px solid var(--border-subtle);
      padding-top: var(--space-sm-alt);
      margin-top: var(--space-sm-alt);
    }

    .next-steps-heading {
      border-top: 1px solid var(--border-subtle);
      padding-top: var(--space-sm-alt);
      margin-top: var(--space-sm-alt);
    }

    .result-subline {
      font-size: var(--fs-xs);
      color: var(--text-muted);
      margin-bottom: var(--space-sm);
      line-height: var(--lh-normal);
    }

    .rewrite-cluster-heading {
      font-size: var(--fs-small);
      font-weight: 700;
      color: var(--text-main);
      margin: var(--space-xl-alt) 0 var(--space-md-alt);
      font-family: var(--font-display);
      letter-spacing: -0.01em;
      text-transform: none;
    }

    /* Creator line and footer */

    .creator-section {
      text-align: center;
      color: var(--text-muted);
      font-size: var(--fs-tiny);
      opacity: 0.7;
      margin-top: var(--space-md-alt);
      margin-bottom: var(--space-xxs);
    }

    .footer {
      margin-top: var(--space-md-alt);
      padding-top: 0;
      border-top: none;
      text-align: center;
      color: var(--slate-500);
      font-size: var(--fs-tiny);
      line-height: var(--lh-custom);
    }

    .footer strong {
      color: var(--text-soft);
      font-weight: 600;
    }

    textarea:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: 2px;
      border-color: rgba(15, 23, 42, 0.28);
      box-shadow:
        0 14px 30px rgba(15, 23, 42, 0.14),
        inset 0 0 0 1px rgba(15, 23, 42, 0.28),
        var(--focus-shadow);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .run-button:focus-visible,
    .sample-resume-button:focus-visible,
    .copy-button:focus-visible,
    .export-button:focus-visible,
    .ideas-open-link:focus-visible,
    .stack-section:focus-within {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .input-wrapper {
      position: relative;
      max-height: 440px;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .resume-input-container {
      overflow: hidden;
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.08);
      background: rgba(15, 23, 42, 0.015);
      padding: var(--space-xl-alt) var(--space-md-lg);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.10);
    }

    @media (max-width: 600px) {
      .input-wrapper {
        max-height: 540px;
      }
    }

    .status-bar {
      margin-top: var(--space-xxs);
      font-size: var(--fs-small);
      opacity: 0.95;
      min-height: 1.2em;
      color: var(--text-muted);
      line-height: var(--lh-normal);
      transition: color var(--motion-duration-short) var(--motion-ease-premium);
    }

    .status-bar.status-info {
      color: var(--text-soft);
    }

    .status-bar.status-error {
      color: var(--error);
      font-weight: 500;
    }

    /* Achievement ideas (inline + modal) */
    .ideas-inline {
      margin-top: var(--space-xl);
      margin-bottom: var(--space-lg);
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-xl-alt) var(--space-lg);
      display: flex;
      flex-direction: column;
      gap: var(--space-md-lg);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
    }

    .ideas-inline.hidden {
      display: none;
    }

    .ideas-inline .ideas-text {
      display: flex;
      flex-direction: column;
      gap: var(--space-tight);
    }

    .ideas-actions {
      display: flex;
      gap: var(--space-xxs);
      align-items: flex-start;
      flex-shrink: 0;
      flex-basis: auto;
    }

    .ideas-kicker {
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin-bottom: 0;
    }

    .ideas-subtitle {
      font-weight: 400;
      font-size: var(--fs-label);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      max-width: none;
    }

    .ideas-open-link {
      background: transparent;
      border: none;
      color: var(--accent);
      font-size: var(--fs-label);
      font-weight: 500;
      padding: var(--space-tight) 0;
      cursor: pointer;
      text-decoration: none;
      align-self: flex-start;
      transition: color var(--motion-duration-short) var(--motion-ease-premium), border-color var(--motion-duration-short) var(--motion-ease-premium);
      border-bottom: 1px solid transparent;
    }

    .ideas-open-link:hover,
    .ideas-open-link:focus-visible {
      color: var(--accent-strong);
      border-bottom-color: var(--accent-strong);
      transform: none;
    }

    .ideas-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-md-alt) var(--space-sm-alt);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s var(--motion-ease-premium);
    }

    .ideas-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .ideas-modal.hidden {
      opacity: 0;
      pointer-events: none;
      display: flex; /* Keep flex for layout, rely on opacity */
      visibility: hidden;
    }

    .ideas-modal:not(.hidden) {
        visibility: visible;
    }

    .ideas-modal.visible { /* Legacy class support if JS uses it */
      opacity: 1;
      pointer-events: auto;
      visibility: visible;
    }

    .ideas-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      opacity: 1; /* Parent controls opacity */
    }

    .ideas-sheet {
      position: relative;
      z-index: 1;
      width: min(720px, 92vw);
      max-height: 90vh;
      background: var(--wash);
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-modal);
      padding: calc(var(--space-xl) - var(--space-micro)) var(--space-xl-alt) var(--space-xl-alt) calc(var(--space-xl) + var(--space-xs));
      display: flex;
      flex-direction: column;
      gap: var(--space-sm-alt);
      transform: translateY(8px) scale(0.96);
      transition: transform 0.4s var(--motion-ease-premium);
      border-top: 2px solid var(--accent);
      overflow: hidden;
    }

    .ideas-modal:not(.hidden) .ideas-sheet,
    .ideas-modal.visible .ideas-sheet {
      transform: translateY(0) scale(1);
    }

    .ideas-sheet-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-lg);
      margin-bottom: var(--space-md-alt);
      padding: 0;
      border-bottom: none;
      position: relative;
    }

    .ideas-sheet-header > div:first-child {
      flex: 1 1 auto;
      min-width: 0;
      overflow: visible;
    }

    .ideas-sheet-title {
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.02em;
      margin-bottom: var(--space-tight);
      word-wrap: break-word;
      overflow-wrap: break-word;
      line-height: var(--lh-snug);
    }

    .ideas-sheet-subtitle {
      font-size: var(--fs-label);
      color: var(--text-muted);
      line-height: var(--lh-relaxed);
      margin-top: 0;
      margin-bottom: 0;
      padding-bottom: 2px;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      max-width: 100%;
      display: block;
    }

    .ideas-loading-bar {
      margin: 0 0 var(--space-tight) 0;
    }

    .ideas-status {
      margin-bottom: var(--space-tight);
    }

    .ideas-sheet-body {
      overflow-y: auto;
      padding: 0 2px var(--space-sm) 0;
      display: flex;
      flex-direction: column;
      gap: var(--space-md-alt);
      margin-top: 0;
      flex: 1;
    }

    @media (max-width: 768px) {
      .ideas-modal {
        align-items: flex-end;
        padding: var(--space-sm-alt) 0;
      }
      .ideas-sheet {
        width: 100vw;
        max-width: 100vw;
        max-height: calc(100vh - 96px - env(safe-area-inset-top, 0px));
        height: auto;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        box-shadow: 0 16px 36px rgba(15, 23, 42, 0.16);
        margin-top: env(safe-area-inset-top, var(--space-tight));
        gap: var(--space-md-lg);
      }
      .ideas-sheet::before {
        left: var(--space-md-alt);
        top: var(--space-lg);
        bottom: var(--space-md-lg);
      }
      .ideas-sheet-header {
        position: sticky;
        top: 0;
        padding: 0;
        background: var(--wash);
        z-index: 2;
        border-bottom: none;
        margin-bottom: var(--space-md-alt);
        gap: var(--space-md-lg);
      }
      .ideas-sheet-header > div:first-child {
        flex: 1 1 auto;
        min-width: 0;
        overflow: visible;
      }
      .ideas-sheet-title {
        font-size: var(--fs-2xl);
        margin-bottom: var(--space-xxs);
        line-height: var(--lh-snug);
      }
      .ideas-sheet-subtitle {
        font-size: var(--fs-small);
        line-height: var(--lh-relaxed);
        margin-top: 0;
        padding-bottom: 0;
      }
      .ideas-sheet-body {
        flex: 1;
        overflow-y: auto;
        padding: 0 2px var(--space-sm) 0;
        margin-top: 0;
        gap: var(--space-md-lg);
      }
      .ideas-inline {
        padding: var(--space-lg) var(--space-md-alt) var(--space-md-lg) var(--space-xl-alt);
        gap: var(--space-sm-alt);
      }
      .ideas-kicker {
        font-size: var(--fs-2xl);
      }
      .ideas-actions {
        flex-wrap: wrap;
        gap: var(--space-tight);
      }
      .ideas-actions .ghost-button {
        font-size: var(--fs-xs);
        padding: var(--space-xxs) var(--space-sm);
      }
    }

    .ghost-button {
      background: var(--surface-tint);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      padding: var(--space-xs) var(--space-sm-alt);
      border-radius: var(--radius-md);
      font-size: var(--fs-xs);
      cursor: pointer;
      transition: border-color var(--motion-duration-short) var(--motion-ease-premium), background var(--motion-duration-short) var(--motion-ease-premium);
      align-self: flex-start;
    }

    .ghost-button:hover {
      border-color: var(--border-strong);
      background: var(--surface-tint);
    }

    .ghost-button:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .ghost-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (prefers-reduced-motion: reduce) {
      .run-button:hover,
      .run-button:active,
      .copy-button:hover,
      .export-button:hover,
      .sample-resume-button:hover {
        transform: none !important;
        box-shadow: 0 10px 22px color-mix(in srgb, var(--accent) 18%, transparent);
      }
    }

    .sample-resume-button {
      align-self: flex-start;
      margin: var(--space-xxs) 0 var(--space-sm);
      font-size: var(--fs-small);
    }

    .clear-button {
      align-self: flex-start;
      margin: var(--space-xxs) 0 var(--space-sm);
      font-size: var(--fs-small);
    }

    .clear-button.hidden {
      display: none;
    }

    .button-group {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-sm);
      flex-wrap: wrap;
    }

    .data-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(4px);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s var(--motion-ease-premium);
    }

    .data-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .data-modal.hidden {
      opacity: 0;
      pointer-events: none;
      /* Override display:none from utility class if needed, or rely on opacity */
    }

    .data-modal-card {
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-modal);
      border-radius: var(--radius-lg);
      max-width: 420px;
      width: min(420px, calc(100vw - var(--space-3xl)));
      padding: var(--space-md-lg) var(--space-md-lg) var(--space-md-alt);
      color: var(--text-main);
      transform: translateY(8px) scale(0.96);
      transition: transform 0.4s var(--motion-ease-premium);
    }

    .data-modal:not(.hidden) .data-modal-card {
      transform: translateY(0) scale(1);
    }

    .data-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-sm-alt);
      margin-bottom: var(--space-sm);
    }

    .data-modal-title {
      margin: 0;
      font-size: var(--fs-base);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .data-modal-close {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: var(--fs-small);
      color: var(--text-soft);
      padding: var(--space-xxs);
      border-radius: var(--radius-sm);
      transition: color 0.2s ease;
    }

    .data-modal-close:hover {
      color: var(--text-main);
    }

    .data-modal-close:focus-visible {
      outline: var(--focus-outline-width) solid var(--focus-outline-color);
      outline-offset: var(--focus-outline-offset);
      box-shadow: var(--focus-shadow);
    }

    .data-modal-body {
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
      color: var(--text-soft);
    }

    .data-modal-body p {
      margin: 0 0 var(--space-sm);
    }

    .data-modal-body p:last-child {
      margin-bottom: 0;
    }

    .ideas-loading-bar {
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
      margin-top: var(--space-xxs);
      border-radius: var(--radius-pill);
      height: 1.5px;
    }

    .ideas-status {
      font-size: var(--fs-xs);
      color: rgba(148, 163, 184, 0.9);
      margin-top: var(--space-xxs);
      min-height: var(--space-md-alt);
    }

    .ideas-status.error {
      color: var(--error-light);
    }

    .ideas-body {
      margin-top: var(--space-xxs);
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      gap: var(--space-md-alt);
    }

    .ideas-body.empty {
      color: color-mix(in srgb, var(--text-muted) 90%, transparent);
      border: 1px dashed var(--border-subtle);
      border-radius: var(--radius-input);
      padding: var(--space-lg) var(--space-md-alt);
      text-align: center;
      background: var(--wash);
    }

    .ideas-section-card {
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
      border-radius: var(--radius-lg);
      padding: var(--space-xl-alt) var(--space-xl-alt) var(--space-lg-alt);
    }

    .ideas-section-title {
      font-size: var(--fs-lg);
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin: 0 0 var(--space-sm-alt);
    }

    .ideas-section-subline {
      margin: 0 0 var(--space-md-alt);
      color: var(--text-muted);
      font-size: var(--fs-small);
      line-height: var(--lh-relaxed);
    }

    .ideas-section-card p {
      margin: 0;
      color: var(--text-main);
      line-height: var(--lh-extra-loose);
      font-size: var(--fs-label);
    }

    .ideas-list {
      margin: 0;
      padding-left: var(--space-xl-alt);
    }

    .ideas-list li {
      margin-bottom: var(--space-sm);
      line-height: var(--lh-extra-loose);
      color: var(--text-main);
      font-size: var(--fs-label);
    }

    .ideas-how {
      margin-top: 0;
      font-weight: 600;
      font-size: var(--fs-small);
      line-height: var(--lh-normal);
      color: var(--text-main);
    }

    .ideas-sublist {
      margin-top: var(--space-xxs);
      padding-left: var(--space-md-alt);
      color: rgba(63, 69, 82, 0.85);
      font-size: var(--fs-xs);
      line-height: var(--lh-normal);
    }

    .ideas-divider {
      border-top: 1px solid var(--border-subtle);
      margin: var(--space-sm-alt) 0 var(--space-tight);
      padding-top: 0;
    }

    .ideas-actions .ghost-button {
      border-radius: var(--radius-md);
      padding: var(--space-xs) var(--space-sm-alt);
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.06);
    }

    @media print {
      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        transition: none !important;
        animation: none !important;
      }

      body {
        background: var(--bg-panel);
        color: var(--text-main);
        padding: var(--space-lg);
        font-size: var(--fs-small);
      }

      .page {
        border: none;
        box-shadow: none;
        padding: 0;
        max-width: 780px;
        margin: 0 auto;
      }

      .top-bar,
      .hero,
      .card-input,
      .run-row,
      .results-actions-bottom,
      .data-handling-row,
      .sample-resume-button,
      .version-pill,
      #loading-bar,
      #focus-toggle,
      textarea,
      label[for="main-input"],
      .input-wrapper {
        display: none !important;
      }

      button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .run-button {
        pointer-events: none;
      }

      .card-output {
        box-shadow: 0 0 0 1px rgba(12, 17, 32, 0.08);
        border: 1px solid rgba(12, 17, 32, 0.08);
        padding: var(--space-md);
        border-radius: var(--radius-md);
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-top {
        box-shadow: none;
        border: none;
        background: var(--bg-panel);
        padding: 0 0 var(--space-lg) 0;
      }

      #results-body {
        border: none;
        padding: 0;
      }

      .stack::before,
      .stack-accent-line::before {
        display: none;
      }

      .stack-accent-line {
        border-left: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
        padding-left: var(--space-lg);
      }

      .stack-section {
        margin: var(--space-lg) 0;
        padding: 0 0 var(--space-md) 0;
        box-shadow: none;
        background: var(--bg-panel);
        border-radius: var(--radius-xs);
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .stack-heading {
        margin-bottom: var(--space-md);
      }

      .result-list li,
      .rewrite-block,
      .rewrite-columns,
      .ideas-section-card,
      .card-output {
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-summary {
        border: none;
        box-shadow: none;
        background: var(--bg-panel);
        padding-left: 0;
      }

      .stack-section:hover,
      .stack-section:focus-within,
      .ideas-open-link:hover,
      .ideas-open-link:focus-visible,
      .run-button:hover,
      .copy-button:hover,
      .export-button:hover {
        background: var(--bg-panel);
        transform: none;
        box-shadow: none;
      }

      .ideas-open-link {
        color: var(--text-main);
        text-decoration: none;
        border: none;
      }

      body::after {
        content: "Generated with Recruiter in Your Pocket  recruiterinyourpocket.com";
        display: block;
        margin-top: var(--space-xl);
        font-size: var(--fs-xs);
        color: var(--text-muted);
        text-align: center;
      }
    }

  </style>
</head>

<body>
  <div class="page">
    <div class="page-inner">
      <header class="top-bar">
        <div class="brand">
          <div class="brand-wordmark">Recruiter in Your Pocket</div>
        </div>
      </header>

      <div id="loading-bar"></div>

      <section class="hero">
        <h1 class="hero-title">Strong, recruiter-grade resume feedback in under a minute.</h1>
        <p class="hero-subtitle">Get a specific read on how your story lands, plus stronger bullets and clear next steps.</p>
        <p class="hero-credibility">Crafted by a recruiter who's run 10,000+ interviews and made 1,000+ hires across Google, Meta, OpenAI, and startups across the world.</p>
        <div class="hero-promise">
          <strong>In one minute, you'll get:</strong>
          <ul>
            <li>Specific feedback tailored to your story, not generic AI advice</li>
              <li>Whats working, whats buried, and whats getting missed</li>
            <li>Stronger bullet phrasing and the exact next steps to take</li>
          </ul>
        </div>
        <div class="trust-inline hero-trust-line">
          <span>We dont store your resume.</span>
          <button id="data-handling-inline" type="button" aria-haspopup="dialog" aria-controls="data-modal">How we handle data</button>
        </div>

        <div class="process-track">
          <div class="process-line"></div>
          <div class="process-step">
            <div class="process-icon">1</div>
            <div class="process-label">Paste your resume</div>
          </div>
          <div class="process-step">
            <div class="process-icon">2</div>
            <div class="process-label">See how your story lands</div>
          </div>
          <div class="process-step">
            <div class="process-icon">3</div>
            <div class="process-label">See exactly what to fix and why</div>
          </div>
        </div>

      </section>

      <div class="proof-editorial accent-card-primary" aria-label="Testimonials from users">
        <div class="proof-editorial-heading">What early users say</div>
        <div class="proof-editorial-quote">"Honestly, I thought my resume was fine, but this showed me what actually mattered and what I could finally cut."</div>
          <div class="proof-editorial-quote">"I thought my bullets were good until this showed me my scope was invisible. I had no idea recruiters couldnt see it."</div>
        <div class="proof-editorial-quote">"I kept tweaking the same three bullets. This told me why they felt weak and gave me the actual rewrite."</div>
        <div class="proof-editorial-quote">"It finally made me stop rewriting my resume at midnight every week."</div>
      </div>

      <div id="data-modal" class="data-modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="data-modal-title">
        <div id="data-modal-card" class="data-modal-card" tabindex="-1">
          <div class="data-modal-header">
            <h3 id="data-modal-title" class="data-modal-title">How we handle data</h3>
            <button id="data-modal-close" class="data-modal-close" type="button" aria-label="Close"></button>
          </div>
          <div class="data-modal-body">
            <p>Your resume stays in your browser until you run a review.</p>
            <p>When you run a review, we send only your text to our servers over an encrypted connection.</p>
            <p>We don't keep your resume or use it to train anything.</p>
          </div>
        </div>
      </div>

      <main class="tool-layout">
        <!-- Left column -->
        <section class="card card-input" aria-label="Input panel">
          <div class="card-inner">
            <div class="card-header">
              <h2 class="card-title">Your resume</h2>
            </div>

            <label for="main-input" id="input-label">
              Paste your full resume text, or try the sample to see it in action.
            </label>

            <div class="button-group">
              <button id="sample-resume-button" type="button" class="sample-resume-button btn-primary">Try a sample resume </button>
              <button id="clear-button" type="button" class="clear-button btn-secondary hidden">Clear</button>
            </div>

            <div class="input-wrapper resume-input-container resume-input-shell">
              <textarea
                id="main-input"
                placeholder="Paste your full resume, including work history, skills, and education."
              ></textarea>
            </div>

            <div class="input-meta-row">
              <div>Your resume stays in your browser until you run a review.</div>
              <div id="saved-indicator" class="saved-indicator">Saved</div>
            </div>

            <div class="run-row">
              <button id="run-button" class="run-button btn-primary">Get a recruiters read</button>
              <div id="status" class="status" aria-live="polite" role="status"></div>
            </div>
          </div>
        </section>

        <!-- Right column -->
        <div class="report-wrapper">
          <section class="card card-output" aria-label="Results panel">
            <div class="card-inner report-view report-card report-container" id="report-view">
            <div class="results-top stack-section stack-accent-line">
              <div class="score-header-inside">
                <div id="score-wrapper" class="score-wrapper hidden">
                  <div
                    id="score-dial-container"
                    class="score-dial-container"
                    tabindex="0"
                    aria-describedby="score-tooltip"
                  >
                    <div id="score-dial" class="score-dial">
                      <svg viewBox="0 0 120 120">
                        <circle class="score-dial-bg" cx="60" cy="60" r="54" />
                        <circle
                          id="score-dial-progress"
                          class="score-dial-progress"
                          cx="60"
                          cy="60"
                          r="54"
                        />
                      </svg>
                      <div id="score-dial-number" class="score-dial-number">0</div>
                    </div>
                    <div id="score-dial-label" class="score-dial-label">Overall clarity score</div>
                  </div>
                  <div id="score-tooltip" class="score-tooltip" role="tooltip"></div>
                  <div id="issue-breakdown" class="issue-breakdown hidden">
                    <button class="issue-bar" data-section="impact-results" type="button" aria-label="Impact & Results">
                      <div class="issue-bar-content">
                        <span class="issue-bar-label">Impact & Results</span>
                        <span class="issue-bar-count">0 top suggestions</span>
                      </div>
                      <div class="issue-bar-fill"></div>
                    </button>
                    <button class="issue-bar" data-section="clarity-structure" type="button" aria-label="Clarity & Conciseness">
                      <div class="issue-bar-content">
                        <span class="issue-bar-label">Clarity & Conciseness</span>
                        <span class="issue-bar-count">0 top suggestions</span>
                      </div>
                      <div class="issue-bar-fill"></div>
                    </button>
                    <button class="issue-bar" data-section="focus-craft" type="button" aria-label="Focus & Craft">
                      <div class="issue-bar-content">
                        <span class="issue-bar-label">Focus & Craft</span>
                        <span class="issue-bar-count">0 top suggestions</span>
                      </div>
                      <div class="issue-bar-fill"></div>
                    </button>
                  </div>
                  <div class="issue-breakdown-microcopy">Prioritized improvements in each area</div>
                </div>
              </div>
              <div class="results-header-row">
                <h2 id="results-title" class="card-title"><span class="report-title">Recruiter feedback</span></h2>
                <div class="focus-controls">
                  <button id="focus-toggle" class="focus-button hidden" type="button">Focus on report</button>
                </div>
              </div>
              <div class="score-help">Clarity score shows how quickly your story lands on a first read  calibrated from real hiring decisions.</div>
              <div class="report-accent-line"></div>
              <div class="results-bridge">
                <div class="bridge-heading">What this means</div>
                <div id="results-subtitle">
                  Heres whats clear in your resume, whats buried, and specific ways to make your story hit harder.
                </div>
              </div>
              <div id="results-summary" class="results-summary accent-card-primary empty stack-section stack-accent-line">
                Your recruiters take will appear here.
              </div>
              <div id="status-bar" class="status-bar"></div>
            </div>

            <div id="results-skeleton" class="results-skeleton hidden stack stack-accent-line" aria-hidden="true">
              <div class="skeleton-results-top stack-section stack-accent-line">
              <div class="skeleton-score-area">
                <div class="skeleton-score-dial"></div>
                <div class="skeleton-score-label"></div>
                <div class="skeleton-issue-breakdown">
                  <div class="skeleton-issue-bar"></div>
                  <div class="skeleton-issue-bar"></div>
                  <div class="skeleton-issue-bar"></div>
                </div>
              </div>
                <div class="skeleton-header-row">
                  <div class="skeleton-line skeleton-title"></div>
                </div>
                <div class="skeleton-line skeleton-text-wide"></div>
                <div class="skeleton-line skeleton-text-mid"></div>
              </div>
              <div class="skeleton-summary-section stack-section stack-accent-line">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
                <div class="skeleton-line mid"></div>
                <div class="skeleton-line short"></div>
              </div>
              <div class="skeleton-section stack-section stack-accent-line">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
              </div>
              <div class="skeleton-section stack-section stack-accent-line">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
                <div class="skeleton-line mid"></div>
              </div>
              <div class="skeleton-section stack-section stack-accent-line">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
              </div>
              <div class="skeleton-section stack-section stack-accent-line">
                <div class="skeleton-heading"></div>
                <div class="skeleton-subline"></div>
                <div class="skeleton-line wide skeleton-content-line"></div>
                <div class="skeleton-line mid"></div>
              </div>
            </div>

            <div
              id="results-body"
              class="empty stack stack-accent-line"
              role="region"
              aria-label="Resume feedback results"
            >
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Whats working</div>
                <div class="stack-subline">Strengths that are already clear on first read and help your story land as intended.</div>
              </div>
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Whats harder to see</div>
                <div class="stack-subline">Surfaces buried impact, unclear outcomes, and work that isnt landing clearly yet.</div>
              </div>
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Stronger phrasing you can use</div>
                <div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div>
              </div>
              <div class="stack-section stack-accent-line">
              <div class="stack-heading">Next steps</div>
              <div class="stack-subline">Clear, doable actions that build momentum and make your story easier to read.</div>
              </div>
            </div>

            <div id="results-actions-bottom" class="results-actions results-actions-bottom hidden">
              <button id="export-button" class="export-button btn-primary" aria-label="Export PDF">
                <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 11L8 2M8 11L5 8M8 11L11 8M3 11L3 13C3 13.5523 3.44772 14 4 14L12 14C12.5523 14 13 13.5523 13 13L13 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Export PDF</span>
              </button>
              <button id="copy-full-button" class="copy-button btn-primary" aria-label="Copy report with headings">
                <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="5" y="5" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M4 7C4 6.44772 4.44772 6 5 6H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  <path d="M4 11C4 10.4477 4.44772 10 5 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span>Copy report</span>
              </button>
            </div>

            <div id="ideas-inline" class="ideas-inline hidden stack-section stack-accent-line" aria-label="Missing wins">
              <div class="ideas-text">
                <div class="ideas-kicker stack-heading">Missing wins</div>
                <div class="ideas-subtitle stack-subline">Surfaces buried impact, unclear outcomes, and scope you likely have but didnt express.</div>
              </div>
              <button id="ideas-open" class="ideas-open-link" type="button">Open missing wins </button>
            </div>

            <div id="ideas-modal" class="ideas-modal hidden" aria-hidden="true">
              <div id="ideas-backdrop" class="ideas-backdrop"></div>
              <div class="ideas-sheet" id="ideas-sheet" role="dialog" aria-modal="true" aria-labelledby="ideas-modal-title">
                <div class="ideas-sheet-header accent-card-primary">
                  <div>
                    <div id="ideas-modal-title" class="ideas-sheet-title">Missing wins</div>
                    <div class="ideas-sheet-subtitle">Surfaces buried impact, unclear outcomes, and scope you likely have but didnt express.</div>
                  </div>
                  <div class="ideas-actions">
                    <button id="ideas-refresh" class="ghost-button" type="button">Refresh</button>
                    <button id="ideas-close" class="ghost-button" type="button" aria-label="Close missing wins">Close</button>
                  </div>
                </div>
                <div id="ideas-loading-bar" class="ideas-loading-bar"></div>
                <div id="ideas-status" class="ideas-status" aria-live="polite"></div>
                <div class="ideas-sheet-body">
                  <div id="ideas-body" class="ideas-body empty" aria-live="polite">
                    Ill look for wins you have not written yet or forgot about.
                  </div>
                </div>
              </div>
            </div>

            </div>
          </section>
        </div>
      </main>

      <div id="paywall-backdrop" class="paywall-backdrop" role="dialog" aria-modal="true" aria-labelledby="paywall-title">
        <div class="paywall-card">
          <div class="paywall-title" id="paywall-title">Keep using Resume Studio</div>
          <div class="paywall-subtitle">
            Get unlimited runs and full access to your personalized recruiter report.
          </div>
          <ul class="paywall-list">
            <li>Unlimited resume runs on this browser.</li>
            <li>Access to your full score, summary, and insight stack whenever you need it.</li>
            <li>Future saved reports as they ship.</li>
          </ul>
          <div class="paywall-actions">
            <button id="paywall-upgrade" class="paywall-primary" type="button">Upgrade and keep going</button>
            <button id="paywall-close" class="paywall-secondary" type="button">Not now</button>
          </div>
          <div id="paywall-status" class="paywall-subtitle" aria-live="polite"></div>
        </div>
      </div>

      <footer class="footer">
        Made with care in Boulder, CO 
      </footer>
    </div>
  </div>

  <script>
  // NOTE: This frontend is intentionally single-file. If you add new pages or modes,
  // consider splitting styles into a shared CSS file and moving JS into a small app.js
  // to reduce risk and keep components reusable.
  const STORAGE_KEY = "rip-main-input-v1";

  const inputEl = document.getElementById("main-input");
  const inputLabelEl = document.getElementById("input-label");
  const runButton = document.getElementById("run-button");
  const statusEl = document.getElementById("status");
  const resultsTitleEl = document.getElementById("results-title");
  const resultsSubtitleEl = document.getElementById("results-subtitle");
  const resultsSummaryEl = document.getElementById("results-summary");
  const resultsBodyEl = document.getElementById("results-body");
  const resultsSkeletonEl = document.getElementById("results-skeleton");
  const reportViewEl = document.getElementById("report-view");
  const reportAccentLineEl = document.querySelector(".report-accent-line");
  const scoreWrapperEl = document.getElementById("score-wrapper");
  const scoreBandsTriggerEl = document.getElementById("score-bands-trigger");
  const scoreDialContainerEl = document.getElementById("score-dial-container");
  const issueBreakdownEl = document.getElementById("issue-breakdown");
  const scoreDialEl = document.getElementById("score-dial");
  const scoreDialProgressEl = document.getElementById("score-dial-progress");
  const scoreDialNumberEl = document.getElementById("score-dial-number");
  const scoreDialLabelEl = document.getElementById("score-dial-label");
  const scoreTooltipEl = document.getElementById("score-tooltip");
  const copyFullButtonEl = document.getElementById("copy-full-button");
  const exportButtonEl = document.getElementById("export-button");
  const resultsActionsBottomEl = document.getElementById("results-actions-bottom");
  const reportWrapperEl = document.querySelector(".report-wrapper");
  const dataHandlingInlineEl = document.getElementById("data-handling-inline");
  const dataModalEl = document.getElementById("data-modal");
  const dataModalCardEl = document.getElementById("data-modal-card");
  const dataModalCloseEl = document.getElementById("data-modal-close");
  const textareaEl = document.getElementById("main-input");
  const savedIndicatorEl = document.getElementById("saved-indicator");
  const loadingBarEl = document.getElementById("loading-bar");
  const sampleResumeButtonEl = document.getElementById("sample-resume-button");
  const clearButtonEl = document.getElementById("clear-button");
  const ideasInlineEl = document.getElementById("ideas-inline");
  const ideasOpenEl = document.getElementById("ideas-open");
  const ideasModalEl = document.getElementById("ideas-modal");
  const ideasBackdropEl = document.getElementById("ideas-backdrop");
  const ideasRefreshEl = document.getElementById("ideas-refresh");
  const ideasCloseEl = document.getElementById("ideas-close");
  const ideasBodyEl = document.getElementById("ideas-body");
  const ideasLoadingBarEl = document.getElementById("ideas-loading-bar");
  const ideasStatusEl = document.getElementById("ideas-status");
  const focusToggleEl = document.getElementById("focus-toggle");
  const prefersReducedMotionQuery = window.matchMedia
    ? window.matchMedia("(prefers-reduced-motion: reduce)")
    : null;
  let focusMode = false;
  let hasReportContent = false;
  let hasLoggedPaste = false;
  let lastReportData = null;
  let hasPlayedReportReveal = false;
  let previousBodyOverflow = "";
  let currentReportIsSample = false;
  let dataModalReturnEl = null;

  function setFocusMode(enabled) {
    focusMode = Boolean(enabled);
    document.body.classList.toggle("focus-mode", focusMode);
    if (focusToggleEl) {
      focusToggleEl.classList.toggle("hidden", !hasReportContent);
      focusToggleEl.textContent = focusMode ? "Back to editor" : "Focus on report";
    }
    if (focusMode) {
      triggerFocusEntrance();
    }
  }
  const paywallBackdropEl = document.getElementById("paywall-backdrop");
  const paywallUpgradeEl = document.getElementById("paywall-upgrade");
  const paywallCloseEl = document.getElementById("paywall-close");
  const paywallStatusEl = document.getElementById("paywall-status");

  const currentMode = "resume";
  let saveTimeout = null;
  let originalButtonText = runButton.textContent;
  let ideasInFlight = false;
  let currentScoreMeta = null;
  let lastScoreValue = null;
  let scoreBandsPinned = false;
  let scoreBandsHovering = false;
  let isSampleRun = false;

  const FREE_RUN_LIMIT = 100;
  const RUN_COUNT_KEY = "rip-free-runs-v1";
  const PAID_KEY = "rip-paid-v1";

  // Minimal event logger for future telemetry wiring
  function logEvent(name, data = {}) {
    console.log("[event]", name, data); // TODO: connect to real telemetry endpoint
  }

  function getRunCount() {
    const raw = localStorage.getItem(RUN_COUNT_KEY);
    const n = Number(raw);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  }

  function incrementRunCount() {
    const next = getRunCount() + 1;
    localStorage.setItem(RUN_COUNT_KEY, String(next));
    return next;
  }

  function isPaid() {
    return localStorage.getItem(PAID_KEY) === "1";
  }

  function markPaid() {
    localStorage.setItem(PAID_KEY, "1");
  }

  function showPaywall(msg = "") {
    logEvent("paywall_impression");
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "flex";
    }
    if (paywallStatusEl) {
      paywallStatusEl.textContent = msg || "";
    }
  }

  function hidePaywall() {
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "none";
    }
    if (paywallStatusEl) {
      paywallStatusEl.textContent = "";
    }
  }

  function prefersReducedMotion() {
    return !!(prefersReducedMotionQuery && prefersReducedMotionQuery.matches);
  }

  (function handleCheckoutParams() {
    const params = new URLSearchParams(window.location.search);
    const status = params.get("checkout");
    if (status === "success") {
      markPaid();
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
    if (status === "cancelled") {
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
  })();

  function openDataModal() {
    if (!dataModalEl || !dataModalCardEl) return;
    dataModalEl.classList.remove("hidden");
    dataModalEl.setAttribute("aria-hidden", "false");
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    dataModalReturnEl = document.activeElement instanceof HTMLElement ? document.activeElement : null;
    const focusable = dataModalEl.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
    if (focusable.length > 0) {
      focusable[0].focus();
    }
  }

  function closeDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.add("hidden");
    dataModalEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = previousBodyOverflow || "";
    const returnTarget = dataModalReturnEl || dataHandlingInlineEl;
    if (returnTarget && typeof returnTarget.focus === "function") returnTarget.focus();
    dataModalReturnEl = null;
  }

  function trapDataModalFocus(event) {
    if (!dataModalEl || dataModalEl.classList.contains("hidden")) return;
    const focusable = dataModalEl.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])');
    if (focusable.length === 0) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (event.key === "Tab") {
      if (event.shiftKey && document.activeElement === first) {
        event.preventDefault();
        last.focus();
      } else if (!event.shiftKey && document.activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    }
    if (event.key === "Escape") {
      event.preventDefault();
      closeDataModal();
    }
  }

  function autoResizeTextarea() {
    const maxHeight = 340;
    inputEl.style.height = "auto";
    const next = Math.min(inputEl.scrollHeight, maxHeight);
    inputEl.style.height = next + "px";
  }

  function showSavedIndicator() {
    if (!savedIndicatorEl) return;
    savedIndicatorEl.classList.add("visible");
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      savedIndicatorEl.classList.remove("visible");
    }, 1200);
  }

  function updateClearButtonVisibility() {
    if (clearButtonEl) {
      const hasText = inputEl.value.trim().length > 0;
      clearButtonEl.classList.toggle("hidden", !hasText);
    }
  }

  function clearInput() {
    inputEl.value = "";
    autoResizeTextarea();
    try {
      localStorage.removeItem(STORAGE_KEY);
    } catch (e) {
      console.warn("Could not clear saved input", e);
    }
    resetIdeasSection();
    if (ideasInlineEl) ideasInlineEl.classList.add("hidden");
    closeIdeasModal();
    updateClearButtonVisibility();
    if (resultsBodyEl) {
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
    }
    renderSummary("");
    if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
    clearScoreBadge();
    updateToolLayout();
  }

  function loadSavedInput() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        inputEl.value = saved;
        autoResizeTextarea();
        showSavedIndicator();
        updateClearButtonVisibility();
        return;
      }
    } catch (e) {
      console.warn("Could not load saved input", e);
    }
    inputEl.value = "";
    autoResizeTextarea();
    updateClearButtonVisibility();
  }

  inputEl.addEventListener("input", (event) => {
    autoResizeTextarea();
    const trimmed = inputEl.value.trim();

    if (!trimmed) {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {
        console.warn("Could not clear saved input", e);
      }
      resetIdeasSection();
      if (ideasInlineEl) ideasInlineEl.classList.add("hidden");
      closeIdeasModal();
      updateClearButtonVisibility();
      return;
    }

    try {
      localStorage.setItem(STORAGE_KEY, inputEl.value);
    } catch (e) {
      console.warn("Could not save input", e);
    }
    showSavedIndicator();
    updateClearButtonVisibility();
  });

  inputEl.addEventListener("paste", () => {
    if (!hasLoggedPaste) {
      logEvent("resume_pasted");
      hasLoggedPaste = true;
    }
  });

  function updateToolLayout() {
    const toolLayout = document.querySelector('.tool-layout');
    const resultsBody = document.getElementById('results-body');
    
    if (toolLayout && resultsBody) {
      if (resultsBody.classList.contains('empty')) {
        toolLayout.classList.add('input-full-width');
      } else {
        toolLayout.classList.remove('input-full-width');
      }
    }
  }

  function clearScoreBadge() {
    if (scoreDialNumberEl) scoreDialNumberEl.textContent = "0";
    if (scoreDialContainerEl) {
      scoreDialContainerEl.className = "score-dial-container";
      scoreDialContainerEl.removeAttribute("aria-label");
    }
    if (scoreDialProgressEl) {
      scoreDialProgressEl.style.strokeDashoffset = "339.292";
    }
    if (scoreTooltipEl) {
      scoreTooltipEl.textContent = "";
      scoreTooltipEl.classList.remove("open");
      scoreTooltipEl.setAttribute("aria-hidden", "true");
    }
    if (scoreWrapperEl) scoreWrapperEl.classList.add("hidden");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "none";
    if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
    if (issueBreakdownEl) {
      issueBreakdownEl.classList.add("hidden");
      issueBreakdownEl.classList.remove("visible");
      // Reset display for Focus & Craft bar
      const focusBar = issueBreakdownEl.querySelector('[data-section="focus-craft"]');
      if (focusBar) {
        focusBar.style.display = '';
      }
    }
    currentScoreMeta = null;
    lastScoreValue = null;
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", "false");
  }

  const SCORE_BANDS = [
    {
      id: "not_ready",
      min: 60,
      max: 69,
      label: "Not ready",
      description: "Story is hard to follow. Sections blur together and impact is mostly missing."
    },
    {
      id: "thin_signal",
      min: 70,
      max: 77,
      label: "Thin signal",
      description: "Some good pieces, but the signal is faint. Bullets are vague or light on impact."
    },
    {
      id: "strong_foundation",
      min: 78,
      max: 84,
      label: "Strong foundation",
      description: "Core story is clear. Real wins are present, but not every bullet carries weight."
    },
    {
      id: "high_bar",
      min: 85,
      max: 91,
      label: "High bar",
      description: "Ownership, scope, and results are consistently clear with very little noise."
    },
    {
      id: "rare_air",
      min: 92,
      max: 100,
      label: "Rare air",
      description: "Exceptionally clear and dense signal. Every line earns its place."
    }
  ];

  function getBandIdFromScore(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    const match = SCORE_BANDS.find((band) => clamped >= band.min && clamped <= band.max);
    if (match) return match.id;
    if (clamped < SCORE_BANDS[0].min) return SCORE_BANDS[0].id;
    return SCORE_BANDS[SCORE_BANDS.length - 1].id;
  }

  function getScoreMeta(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    if (clamped >= 97) {
      return {
        score: clamped,
        label: "Rare air",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 92) {
      return {
        score: clamped,
        label: "Top-bar ready",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 85) {
      return {
        score: clamped,
        label: "High bar",
        short: "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        long:
          "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 78) {
      return {
        score: clamped,
        label: "Strong story",
        short: "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        long:
          "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 70) {
      return {
        score: clamped,
        label: "Solid foundation",
        short:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        long:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 60) {
      return {
        score: clamped,
        label: "Needs clarity",
        short:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        long:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 50) {
      return {
        score: clamped,
        label: "Thin signal",
        short: "Ownership and outcomes are hard to see.",
        long:
          "Rebuild top bullets with clear role, scope, and before/after changes. Add context before applying.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    return {
      score: clamped,
      label: "Not ready",
      short: "Hard to see role, scope, or results.",
      long:
        "Add structure, roles, and outcomes so there is usable signal. Right now it is not review-ready.",
      bandId: getBandIdFromScore(clamped)
    };
  }

  function applyScoreColor(score) {
    if (Number.isNaN(score) || !scoreDialContainerEl) return;
    
    // Clear previous color classes
    scoreDialContainerEl.classList.remove("score-low", "score-mid", "score-good", "score-great");
    
    // Apply color class based on score
    let cls = "";
    if (score < 50) cls = "score-low";
    else if (score < 70) cls = "score-mid";
    else if (score < 90) cls = "score-good";
    else cls = "score-great";
    
    if (cls) {
      scoreDialContainerEl.classList.add(cls);
    }
    
    // Update dial progress
    const circumference = 2 * Math.PI * 54; // radius is 54, approximately 339.292
    const percentage = Math.max(0, Math.min(100, score)) / 100;
    const offset = circumference * (1 - percentage);
    
    if (scoreDialProgressEl) {
      // Ensure stroke-dasharray is set
      if (!scoreDialProgressEl.style.strokeDasharray) {
        scoreDialProgressEl.style.strokeDasharray = circumference;
      }
      // Reset to full circle first, then animate to target
      scoreDialProgressEl.style.strokeDashoffset = circumference;
      // Use requestAnimationFrame to ensure the reset is applied before animation
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          scoreDialProgressEl.style.strokeDashoffset = offset;
        });
      });
    }
    
    // Update number with animation
    if (scoreDialNumberEl) {
      const targetScore = Math.round(score);
      const currentScore = parseInt(scoreDialNumberEl.textContent) || 0;
      
      // Animate number counting up
      if (prefersReducedMotion()) {
        scoreDialNumberEl.textContent = targetScore;
      } else {
        const duration = 800;
        const startTime = Date.now();
        const animateNumber = () => {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
          const current = Math.round(currentScore + (targetScore - currentScore) * eased);
          scoreDialNumberEl.textContent = current;
          
          if (progress < 1) {
            requestAnimationFrame(animateNumber);
          } else {
            scoreDialNumberEl.textContent = targetScore;
          }
        };
        animateNumber();
      }
    }
    
    // Set aria label
    scoreDialContainerEl.setAttribute("aria-label", `Score ${Math.round(score)} out of 100`);
  }

  function renderScoreBandsPanel(scoreMeta = {}) {
    if (!scoreTooltipEl) return;
    const bandId = scoreMeta.bandId || getBandIdFromScore(scoreMeta.score);
    const bandsMarkup = SCORE_BANDS.map((band) => {
      const isActive = band.id === bandId;
      return `
        <div class="score-band-item ${isActive ? "active" : ""}">
          <div class="score-band-header">
            <span class="score-band-range">${band.min} to ${band.max}</span>
            <span class="score-band-label"> ${escapeHtml(band.label)}</span>
            ${isActive ? '<span class="score-band-chip">Your band</span>' : ""}
          </div>
          <div class="score-band-description">${escapeHtml(band.description)}</div>
        </div>
      `;
    }).join("");

    scoreTooltipEl.innerHTML = `
      <div class="score-bands-panel">
        <div class="score-bands-panel-title">How to read this score</div>
        <div class="score-bands-intro">This clarity score is powered by a calibrated model shaped by thousands of real interview cycles. Each band reflects how clearly your story lands on a first read.</div>
        <div class="score-bands-list">${bandsMarkup}</div>
      </div>
    `;
  }

  function updateScoreBandsVisibility() {
    if (!scoreTooltipEl) return;
    const isOpen = (scoreBandsPinned || scoreBandsHovering) && !!currentScoreMeta;
    scoreTooltipEl.classList.toggle("open", isOpen);
    scoreTooltipEl.setAttribute("aria-hidden", isOpen ? "false" : "true");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", isOpen ? "true" : "false");
  }

  function triggerScoreGlow() {
    if (!scoreDialContainerEl || prefersReducedMotion()) return;
    scoreDialContainerEl.classList.remove("score-dial--reveal");
    void scoreDialContainerEl.offsetWidth;
    scoreDialContainerEl.classList.add("score-dial--reveal");
  }

  function toggleScoreBandsPinned() {
    if (!currentScoreMeta) return;
    scoreBandsPinned = !scoreBandsPinned;
    if (scoreBandsPinned) {
      renderScoreBandsPanel(currentScoreMeta);
    }
    updateScoreBandsVisibility();
  }

  function closeScoreBandsPanel() {
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    updateScoreBandsVisibility();
  }

  function renderScoreMeta(score, modelMeta = {}) {
    const meta = getScoreMeta(score);
    const prevScoreValue = lastScoreValue;
    
    // Show the dial container
    if (scoreDialContainerEl) {
      scoreDialContainerEl.classList.add("visible");
      scoreDialContainerEl.classList.remove("score-dial--reveal");
      void scoreDialContainerEl.offsetWidth;
      scoreDialContainerEl.classList.add("score-dial--reveal");
    }
    
    applyScoreColor(meta.score);
    
    if (prevScoreValue !== meta.score) {
      triggerScoreGlow();
    }
    lastScoreValue = meta.score;

    const labelText = (modelMeta.score_label || "").trim() || meta.label;
    const shortText = (modelMeta.score_comment_short || "").trim() || meta.short;
    const longText = (modelMeta.score_comment_long || "").trim() || meta.long;
    currentScoreMeta = {
      ...meta,
      label: labelText,
      short: shortText,
      long: longText
    };
    renderScoreBandsPanel(currentScoreMeta);
    updateScoreBandsVisibility();
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "inline";
    if (scoreWrapperEl) scoreWrapperEl.classList.remove("hidden");
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function renderSummary(text) {
    if (!resultsSummaryEl) return;
    const clean = (text || "").trim();
    if (clean) {
      const sentences = clean
        .split(/(?<=[.!?])\s+/)
        .map((s) => s.trim())
        .filter(Boolean);
      const limited = sentences.slice(0, 3);
      const paragraph = limited.join(" ");
      resultsSummaryEl.innerHTML = `
        ${currentReportIsSample ? '<div class="report-meta">Sample report, paste your resume to see your own read.</div>' : ""}
        <div class="stack-heading">How your resume reads</div>
        <div class="stack-subline">A quick read on how your resume actually lands.</div>
        <p class="result-paragraph">${escapeHtml(paragraph || clean)}</p>
      `;
      resultsSummaryEl.classList.remove("empty");
    } else {
      resultsSummaryEl.innerHTML = `
        ${currentReportIsSample ? '<div class="report-meta">Sample report, paste your resume to see your own read.</div>' : ""}
        <div class="stack-heading">How your resume reads</div>
        <div class="stack-subline">A quick read on how your resume actually lands.</div>
        <p class="result-paragraph">Your summary will appear here.</p>
      `;
      resultsSummaryEl.classList.add("empty");
    }
  }

  function applySectionReveal() {
    const elements = [];
    if (resultsSummaryEl) {
      const summaryHeading = resultsSummaryEl.querySelector(".result-heading");
      if (summaryHeading) elements.push(summaryHeading);
    }
    if (resultsBodyEl) {
      const bodyHeadings = resultsBodyEl.querySelectorAll(".result-heading");
      bodyHeadings.forEach((el) => elements.push(el));
    }
    if (!elements.length) return;
    if (prefersReducedMotion()) {
      elements.forEach((el) => {
        el.style.removeProperty("animation-delay");
        el.classList.add("report-section");
      });
      return;
    }
    let delay = 260;
    elements.forEach((el) => {
      el.classList.add("report-section");
      el.style.animationDelay = `${delay}ms`;
      delay += 80;
    });
  }

  function triggerReportReveal() {
    if (!reportViewEl) return;
    applySectionReveal();
    if (!hasPlayedReportReveal) {
      reportViewEl.classList.add("report-container--visible");
      hasPlayedReportReveal = true;
    }
  }

  function triggerFocusEntrance() {
    if (!reportViewEl || prefersReducedMotion()) return;
    reportViewEl.classList.add("report-view--focus-start");
    void reportViewEl.offsetWidth;
    reportViewEl.classList.remove("report-view--focus-start");
  }

  function calculateIssueCounts(data) {
    const { gaps = [], rewrites = [] } = data || {};
    
    let impactResultsCount = 0;
    let clarityStructureCount = 0;
    let focusCraftCount = 0;

    // Group rewrites the same way renderStructuredResults does
    const clarityGroup = [];
    const impactGroup = [];
    const focusCraftGroup = [];
    
    for (const r of rewrites) {
      if (!r) continue;
      const label = (r.label || "").toLowerCase();
      if (label.includes("clarity") || label.includes("concise") || label.includes("conciseness") || label.includes("brevity") || label.includes("phrasing")) {
        clarityGroup.push(r);
      } else if (label.includes("impact") || label.includes("scope") || label.includes("ownership")) {
        impactGroup.push(r);
      } else if (label.includes("focus") || label.includes("relevance") || label.includes("craft") || label.includes("polish")) {
        focusCraftGroup.push(r);
      }
    }

    // Impact & Results: Count only rewrites in the Impact cluster (what's actually shown)
    impactResultsCount = impactGroup.length;

    // Clarity & Conciseness: Count only rewrites in the Clarity cluster (what's actually shown)
    clarityStructureCount = clarityGroup.length;

    // Focus & Craft: Count only Focus/Craft rewrites (no fallback - only show if rewrites exist)
    focusCraftCount = focusCraftGroup.length;

    return {
      impactResults: impactResultsCount,
      clarityStructure: clarityStructureCount,
      focusCraft: focusCraftCount
    };
  }

  function updateIssueBreakdown(counts) {
    if (!issueBreakdownEl) return;

    const impactBar = issueBreakdownEl.querySelector('[data-section="impact-results"]');
    const clarityBar = issueBreakdownEl.querySelector('[data-section="clarity-structure"]');
    const focusBar = issueBreakdownEl.querySelector('[data-section="focus-craft"]');

    if (impactBar) {
      const countEl = impactBar.querySelector('.issue-bar-count');
      if (countEl) {
        countEl.textContent = counts.impactResults === 1 ? '1 top suggestion' : `${counts.impactResults} top suggestions`;
      }
      impactBar.setAttribute('data-count', String(counts.impactResults));
    }

    if (clarityBar) {
      const countEl = clarityBar.querySelector('.issue-bar-count');
      if (countEl) {
        countEl.textContent = counts.clarityStructure === 1 ? '1 top suggestion' : `${counts.clarityStructure} top suggestions`;
      }
      clarityBar.setAttribute('data-count', String(counts.clarityStructure));
    }

    if (focusBar) {
      // Only show Focus & Craft bar if there are actual rewrites
      if (counts.focusCraft > 0) {
        const countEl = focusBar.querySelector('.issue-bar-count');
        if (countEl) {
          countEl.textContent = counts.focusCraft === 1 ? '1 top suggestion' : `${counts.focusCraft} top suggestions`;
        }
        focusBar.setAttribute('data-count', String(counts.focusCraft));
        focusBar.style.display = '';
      } else {
        // Hide the bar if no Focus/Craft rewrites exist
        focusBar.style.display = 'none';
      }
    }

    // Show the breakdown panel
    issueBreakdownEl.classList.remove('hidden');
    setTimeout(() => {
      issueBreakdownEl.classList.add('visible');
    }, 100);
  }

  function handleIssueBarClick(section) {
    const resultsBodyEl = document.getElementById("results-body");
    if (!resultsBodyEl) return;

    let targetEl = null;

    if (section === "impact-results") {
      // Scroll to "Stronger phrasing" section, specifically the Impact cluster
      const strongerPhrasingEl = resultsBodyEl.querySelector('[data-section="stronger-phrasing"]');
      const impactClusterEl = strongerPhrasingEl ? strongerPhrasingEl.querySelector('[data-cluster="impact"]') : null;
      targetEl = impactClusterEl || strongerPhrasingEl || resultsBodyEl.querySelector('[data-section="harder-to-see"]');
    } else if (section === "clarity-structure") {
      // Scroll to "Stronger phrasing" section, specifically the Clarity cluster
      const strongerPhrasingEl = resultsBodyEl.querySelector('[data-section="stronger-phrasing"]');
      const clarityClusterEl = strongerPhrasingEl ? strongerPhrasingEl.querySelector('[data-cluster="clarity"]') : null;
      targetEl = clarityClusterEl || strongerPhrasingEl;
    } else if (section === "focus-craft") {
      // Scroll to "What's harder to see" section
      targetEl = resultsBodyEl.querySelector('[data-section="harder-to-see"]');
    }

    if (targetEl) {
      targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Add a subtle highlight effect
      targetEl.style.transition = 'background-color 0.3s ease';
      targetEl.style.backgroundColor = 'var(--accent-wash)';
      setTimeout(() => {
        targetEl.style.backgroundColor = '';
        setTimeout(() => {
          targetEl.style.transition = '';
        }, 300);
      }, 1500);
    }
  }

  function renderStructuredResults(data) {
    const {
      summary,
      strengths,
      gaps,
      rewrites,
      next_steps: nextSteps,
      score,
      score_label: scoreLabelText,
      score_comment_short: scoreCommentShort,
      score_comment_long: scoreCommentLong,
      suggested_bullets: suggestedBullets,
      missing_wins: missingWins
    } = data || {};
    hasReportContent = true;

    let html = "";

    // score pill and commentary
    if (typeof score === "number") {
      renderScoreMeta(score, {
        score_label: scoreLabelText,
        score_comment_short: scoreCommentShort,
        score_comment_long: scoreCommentLong
      });
    } else {
      clearScoreBadge();
    }

    // Calculate and update issue breakdown counts
    const counts = calculateIssueCounts({ gaps, rewrites });
    updateIssueBreakdown(counts);

    if (Array.isArray(missingWins) && missingWins.length > 0 && ideasInlineEl) {
      ideasInlineEl.classList.remove("hidden");
    }

    renderSummary(summary);

    // What's Working
    if (Array.isArray(strengths) && strengths.length > 0) {
      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Whats working</div><div class="stack-subline">Strengths that are already clear on first read and help your story land as intended.</div><ul class="result-list">`;
      for (const item of strengths) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul></div>`;
    }

    // What's harder to see
    if (Array.isArray(gaps) && gaps.length > 0) {
      html += `<div class="stack-section stack-accent-line" data-section="harder-to-see"><div class="stack-heading">Whats harder to see</div><div class="stack-subline">Surfaces buried impact, unclear outcomes, and work that isnt landing clearly yet.</div><ul class="result-list">`;
      for (const item of gaps) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul></div>`;
    }

    // Stronger Phrasing You Can Use
    if (Array.isArray(rewrites) && rewrites.length > 0) {
      const clarityGroup = [];
      const impactGroup = [];
      const fallbackGroup = [];

      for (const r of rewrites) {
        if (!r) continue;
        const label = (r.label || "").toLowerCase();
        if (label.includes("clarity") || label.includes("concise") || label.includes("conciseness") || label.includes("brevity") || label.includes("phrasing")) {
          clarityGroup.push(r);
        } else if (label.includes("impact") || label.includes("scope") || label.includes("ownership")) {
          impactGroup.push(r);
        } else {
          fallbackGroup.push(r);
        }
      }

      while (fallbackGroup.length) {
        const target = clarityGroup.length <= impactGroup.length ? clarityGroup : impactGroup;
        target.push(fallbackGroup.shift());
      }

      const renderRewriteGroup = (groupItems) => {
        let groupHtml = "";
        for (const r of groupItems) {
          if (!r) continue;
          const original = r.original || "";
          const better = r.better || "";
          const enhancementNote = r.enhancement_note || r.enhancementNote || "";

          groupHtml += `<div class="rewrite-block">`;
          groupHtml += `<div class="rewrite-columns">`;

          groupHtml += `<div class="rewrite-column">`;
          if (original) {
            groupHtml += `<div class="rewrite-label">Original</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(original))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `<div class="rewrite-column right">`;
          if (better) {
            groupHtml += `<div class="rewrite-label">Better</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(better))}</div>`;
          }
          if (enhancementNote) {
            groupHtml += `<div class="rewrite-enhancement-note">${escapeHtml(String(enhancementNote))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `</div>`;

          groupHtml += `</div>`;
        }
        return groupHtml;
      };

      html += `<div class="stack-section stack-accent-line" data-section="stronger-phrasing"><div class="stack-heading">Stronger phrasing you can use</div><div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div>`;

      if (clarityGroup.length > 0) {
        html += `<div class="rewrite-cluster-heading" data-cluster="clarity">Clarity & Conciseness</div>`;
        html += renderRewriteGroup(clarityGroup);
      }

      if (impactGroup.length > 0) {
        html += `<div class="rewrite-cluster-heading" data-cluster="impact">Impact, Scope & Ownership</div>`;
        html += renderRewriteGroup(impactGroup);
      }

      html += `</div>`;
    } else if (Array.isArray(suggestedBullets) && suggestedBullets.length > 0) {
      // Fallback: use suggested_bullets from backend as a simple list
      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Stronger phrasing you can use</div><div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div><ul class="result-list">`;
      for (const bullet of suggestedBullets) {
        if (!bullet) continue;
        html += `<li>${escapeHtml(String(bullet))}</li>`;
      }
      html += `</ul></div>`;
    }

    // Next Steps (override with fixed guidance)
    const fixedNextSteps = [
      "Split multi idea bullets so your role and impact are clearer.",
      "Add numbers or specific outcomes where they strengthen the story.",
      "Highlight your ownership in key achievements so your contribution stands out.",
      "Remember to make your strongest work easy to spot. Most recruiters will make a yes, no, or maybe decision within a few seconds."
    ];
      html += `<div class="stack-section stack-accent-line" data-section="next-steps"><div class="stack-heading">Next steps</div><div class="stack-subline">Clear, doable actions that build momentum and make your story easier to read.</div><ul class="result-list">`;
    for (const step of fixedNextSteps) {
      html += `<li>${escapeHtml(String(step))}</li>`;
    }
    html += `</ul></div>`;

    if (!html) {
      html = "No feedback returned.";
    }

    resultsBodyEl.innerHTML = html;

    // Place Missing Wins inline teaser inside the stack before Next steps
    if (ideasInlineEl) {
      const nextStepsEl = resultsBodyEl.querySelector('[data-section="next-steps"]');
      ideasInlineEl.classList.add("stack-section");
      ideasInlineEl.classList.add("stack-accent-line");
      if (nextStepsEl && nextStepsEl.parentNode === resultsBodyEl) {
        resultsBodyEl.insertBefore(ideasInlineEl, nextStepsEl);
      } else {
        resultsBodyEl.appendChild(ideasInlineEl);
      }
    }
    resultsBodyEl.classList.remove("refreshed");
    void resultsBodyEl.offsetWidth;
    resultsBodyEl.classList.add("refreshed");
    resultsBodyEl.classList.remove("empty");
    resultsBodyEl.classList.add("results-body-better-flash");
    setTimeout(() => resultsBodyEl.classList.remove("results-body-better-flash"), 220);
    updateToolLayout();
  }

  if (scoreWrapperEl) {
    scoreWrapperEl.addEventListener("mouseenter", () => {
      if (!currentScoreMeta) return;
      scoreBandsHovering = true;
      renderScoreBandsPanel(currentScoreMeta);
      updateScoreBandsVisibility();
    });
    scoreWrapperEl.addEventListener("mouseleave", () => {
      scoreBandsHovering = false;
      updateScoreBandsVisibility();
    });
  }

  if (scoreDialContainerEl) {
    // Issue breakdown bar click handlers
    if (issueBreakdownEl) {
      const issueBars = issueBreakdownEl.querySelectorAll('.issue-bar');
      issueBars.forEach(bar => {
        bar.addEventListener('click', () => {
          const section = bar.getAttribute('data-section');
          if (section) {
            handleIssueBarClick(section);
          }
        });
      });
    }

    scoreDialContainerEl.addEventListener("click", () => {
      toggleScoreBandsPinned();
    });
  }

  if (scoreBandsTriggerEl) {
    scoreBandsTriggerEl.addEventListener("click", (event) => {
      event.preventDefault();
      toggleScoreBandsPinned();
    });
  }

  document.addEventListener("click", (event) => {
    if (
      (scoreTooltipEl && scoreTooltipEl.contains(event.target)) ||
      (scoreWrapperEl && scoreWrapperEl.contains(event.target)) ||
      (scoreBandsTriggerEl && scoreBandsTriggerEl.contains(event.target))
    ) {
      return;
    }
    closeScoreBandsPanel();
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      closeScoreBandsPanel();
    }
  });

  async function startCheckout() {
    if (paywallStatusEl) paywallStatusEl.textContent = "Opening checkout...";
    try {
      const resp = await fetch("/api/create-checkout-session", { method: "POST" });
      const data = await resp.json().catch(() => null);
      if (!resp.ok || !data?.ok || !data?.url) {
        const msg =
          data?.message || "Could not start checkout right now. Try again in a moment.";
        if (paywallStatusEl) paywallStatusEl.textContent = msg;
        return;
      }
      window.location.href = data.url;
    } catch (err) {
      if (paywallStatusEl) {
        paywallStatusEl.textContent =
          "Could not start checkout right now. Try again in a moment.";
      }
    }
  }

  if (paywallUpgradeEl) {
    paywallUpgradeEl.addEventListener("click", () => {
      startCheckout();
    });
  }

  if (paywallCloseEl) {
    paywallCloseEl.addEventListener("click", () => {
      hidePaywall();
      statusEl.textContent = "";
      setStatus("");
    });
  }

  async function runAnalysis(options = {}) {
    const sampleRun = options.sample ?? isSampleRun;
    currentReportIsSample = sampleRun;
    isSampleRun = false;
    const text = (options.textOverride ?? inputEl.value ?? "").trim();
    logEvent("run_clicked", { sample: sampleRun });
    if (!text) {
      const msg = "Paste your resume so I can review it.";
      statusEl.textContent = msg;
      setStatus(msg, "error");
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.remove("results-error");
      renderSummary("");
      if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
      return;
    }

    if (!sampleRun && !isPaid() && getRunCount() >= FREE_RUN_LIMIT) {
      statusEl.textContent = "You've used your free reviews. Upgrade to keep going.";
      setStatus("You've used your free reviews. Upgrade to keep going.", "error");
      showPaywall();
      return;
    }

    if (!focusMode) {
      setFocusMode(false);
    }
    statusEl.textContent = "Reading your resume like a recruiter";
    statusEl.classList.add("status-loading");
    setStatus("Reading your resume like a recruiter", "");
      // Ensure the report container is visible while skeleton is showing
      if (reportViewEl) {
        reportViewEl.classList.add("report-container--visible");
      }
      runButton.disabled = true;
      originalButtonText = runButton.textContent;
      runButton.textContent = "Processing...";
      runButton.classList.add("processing");
      loadingBarEl.classList.add("active");
      // Show skeleton and hide results-body content during loading
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.remove("hidden");
      }
      // Ensure results area is visible
      if (reportWrapperEl) {
        reportWrapperEl.style.display = "block";
      }
      // Hide results-body content and show skeleton
      resultsBodyEl.classList.remove("results-error");
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.add("muted");
      resultsBodyEl.style.display = "none"; // Hide results-body when skeleton is showing
      
      // Auto-scroll to results area to show skeleton
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);
    clearScoreBadge();
    if (ideasInlineEl) {
      ideasInlineEl.classList.add("hidden");
    }
    resetIdeasSection();

        try {
      const response = await fetch("/api/resume-feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          mode: currentMode,
          text
        })
      });

      // New: read the unified payload from the backend
      const payload = await response.json().catch(() => null);

      const fieldMessages =
        payload?.details?.fieldErrors &&
        Object.values(payload.details.fieldErrors)
          .filter(Boolean)
          .join(" ");

      const isValidationError = payload?.errorCode === "VALIDATION_ERROR";

      // If HTTP is not ok or payload is missing, show a calm error
      if (!response.ok || !payload) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(
            payload?.errorCode,
            payload?.message || "Unexpected server response."
          );
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, "error");
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
          updateToolLayout();
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
          updateToolLayout();
        }
        return;
      }

      // Backend explicitly signaled an error (ok === false)
      if (payload.ok === false) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(payload.errorCode, payload.message);
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, "error");
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
          updateToolLayout();
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.style.display = "";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
          updateToolLayout();
        }
        return;
      }

      // Happy path: payload.data is the validated object from the server
      let structured = null;

      if (payload.data && typeof payload.data === "object") {
        structured = payload.data;
      }

      if (!structured) {
        const msg = "Unexpected server response.";
        statusEl.textContent = msg;
        statusEl.classList.remove("status-loading");
        setStatus(msg, "error");
        // Hide skeleton on error
        if (resultsSkeletonEl) {
          resultsSkeletonEl.classList.add("hidden");
        }
        resultsBodyEl.textContent = msg;
        resultsBodyEl.style.display = "";
        resultsBodyEl.classList.add("results-error");
        resultsBodyEl.classList.remove("empty");
        renderSummary("");
        updateToolLayout();
        return;
      }

      renderStructuredResults(structured);
      if (reportWrapperEl) {
        reportWrapperEl.style.display = "block";
      }
      lastReportData = structured;
      triggerReportReveal();
      // Hide skeleton and show results-body
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      resultsBodyEl.style.display = ""; // Show results-body
      resultsBodyEl.classList.remove("empty");
      updateToolLayout();
      resultsBodyEl.classList.remove("results-error");
      resultsBodyEl.classList.remove("muted");
      if (!isPaid() && !sampleRun) {
        incrementRunCount();
      }
      if (resultsActionsBottomEl) {
        resultsActionsBottomEl.classList.remove("hidden");
      }

      runIdeas({ auto: true, sourceText: text });

      setFocusMode(true);
      
      // Auto-scroll to results area for all runs (not just sample)
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);

      if (typeof resultsBodyEl.scrollTo === "function") {
        resultsBodyEl.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        resultsBodyEl.scrollTop = 0;
      }

      statusEl.textContent = "";
      statusEl.classList.remove("status-loading");
      setStatus("");
    } catch (err) {
      console.error(err);
      statusEl.textContent =
        "Something went wrong. Try again in a moment.";
      statusEl.classList.remove("status-loading");
      setStatus("Something went wrong. Try again in a moment.", "error");
      // Hide skeleton on error
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      resultsBodyEl.textContent =
        "Something went wrong. Try again in a moment.";
      resultsBodyEl.style.display = "";
      resultsBodyEl.classList.add("results-error");
      resultsBodyEl.classList.remove("empty");
      renderSummary("");
      updateToolLayout();
    } finally {
      runButton.disabled = false;
      runButton.textContent = originalButtonText;
      runButton.classList.remove("processing");
      loadingBarEl.classList.remove("active");
      // Only hide skeleton if it's still showing (in case of errors)
      if (resultsSkeletonEl && !resultsSkeletonEl.classList.contains("hidden")) {
        resultsSkeletonEl.classList.add("hidden");
        resultsBodyEl.style.display = ""; // Ensure results-body is visible
      }
      resultsBodyEl.classList.remove("muted");
    }
  }

  // Initialize layout on page load
  updateToolLayout();

  runButton.addEventListener("click", runAnalysis);
  if (focusToggleEl) {
    focusToggleEl.addEventListener("click", () => {
      setFocusMode(!focusMode);
    });
  }

  function buildFullReportText(data) {
    if (!data || typeof data !== "object") return "";
    const lines = [];
    lines.push("Resume Review  Recruiter in Your Pocket");
    if (typeof data.score === "number") {
      const band = data.score_label ? `  ${data.score_label}` : "";
      lines.push(`Score: ${Math.round(data.score)}/100${band}`);
    }
    lines.push("");

    if (data.summary) {
      lines.push("How your resume reads:");
      lines.push("");
      lines.push(data.summary);
      lines.push("");
    }

    if (Array.isArray(data.strengths) && data.strengths.length) {
      lines.push("Whats working:");
      lines.push("");
      data.strengths.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.gaps) && data.gaps.length) {
      lines.push("Whats harder to see:");
      lines.push("");
      data.gaps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.rewrites) && data.rewrites.length) {
      lines.push("Stronger phrasing you can use:");
      lines.push("");
      data.rewrites.forEach((r) => {
        if (!r) return;
        lines.push("Original:");
        lines.push("");
        if (r.original) lines.push(r.original);
        lines.push("");
        lines.push("Better:");
        lines.push("");
        if (r.better) lines.push(r.better);
        if (r.enhancement_note) lines.push(`  ${r.enhancement_note}`);
        lines.push("");
      });
    }

    if (Array.isArray(data.missing_wins) && data.missing_wins.length) {
      lines.push("Missing wins:");
      lines.push("");
      data.missing_wins.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.next_steps) && data.next_steps.length) {
      lines.push("Next steps:");
      lines.push("");
      data.next_steps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    lines.push("Generated with Recruiter in Your Pocket  recruiterinyourpocket.com");
    return lines.join("\n");
  }

  if (copyFullButtonEl) {
    copyFullButtonEl.addEventListener("click", async () => {
      if (!lastReportData) {
        statusEl.textContent = "Nothing to copy yet. Run a review first.";
        return;
      }
      const text = buildFullReportText(lastReportData);
      if (!text.trim()) {
        statusEl.textContent = "Nothing to copy yet. Run a review first.";
        return;
      }
      try {
        await navigator.clipboard.writeText(text);
        statusEl.textContent = "Report copied.";
        
        // Visual feedback on button
        const originalText = copyFullButtonEl.innerHTML;
        copyFullButtonEl.textContent = "Copied!";
        copyFullButtonEl.classList.add("btn-success-state");
        
        setTimeout(() => {
          copyFullButtonEl.innerHTML = originalText;
          copyFullButtonEl.classList.remove("btn-success-state");
        }, 2000);

        logEvent("copy_clicked");
      } catch (err) {
        statusEl.textContent = "Couldn't copy. Try again.";
      }
    });
  }

  exportButtonEl.addEventListener("click", async () => {
    const originalExportText = exportButtonEl.textContent;
    exportButtonEl.disabled = true;
    exportButtonEl.textContent = "Preparing PDF...";
    const summaryText = resultsSummaryEl ? resultsSummaryEl.innerText.trim() : "";
    const bodyText = resultsBodyEl ? resultsBodyEl.innerText.trim() : "";
    const text = [summaryText, bodyText].filter(Boolean).join("\n\n");
    if (!text || !lastReportData) {
      statusEl.textContent = "Nothing to export yet. Run a review first.";
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
      return;
    }
    logEvent("export_clicked");

    try {
      const generatedOnLocal = new Date().toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
      const resp = await fetch("/api/export-pdf", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          report: {
            ...lastReportData,
            generated_on: generatedOnLocal
          }
        })
      });
      if (!resp.ok) {
        statusEl.textContent = "Export isn't ready. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        if (downloadWindow && !downloadWindow.closed) downloadWindow.close();
        return;
      }
      const blob = await resp.blob();
      if (!blob || blob.size === 0) {
        statusEl.textContent = "Export isn't ready. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        return;
      }
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "resume-review.pdf";
      a.rel = "noopener";
      a.style.display = "none";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 60000);
      statusEl.textContent = "Exported PDF.";
      
      // Visual feedback
      exportButtonEl.textContent = "Downloaded!";
      exportButtonEl.classList.add("btn-success-state");
      
      setTimeout(() => {
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        exportButtonEl.classList.remove("btn-success-state");
      }, 2000);
    } catch (err) {
      statusEl.textContent = "Could not export right now. Try again.";
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
    }
  });

  inputEl.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
      e.preventDefault();
      runAnalysis({ sample: false });
    }
  });

  async function runIdeas(options = {}) {
    const { auto = false, sourceText } = options;
    const text = (sourceText || inputEl.value || "").trim();
    if (!text) {
      if (!auto) {
        setIdeasStatus("Add your resume first.", "error");
      }
      return;
    }

    if (ideasInFlight) return;
    ideasInFlight = true;

    const originalIdeasButtonText = ideasRefreshEl ? ideasRefreshEl.textContent : "";

    if (ideasRefreshEl) {
      ideasRefreshEl.disabled = true;
      ideasRefreshEl.textContent = auto ? "Refreshing..." : "Pulling questions...";
    }
    setIdeasStatus("Pulling new questions...");
    setIdeasLoading(true);
    if (ideasBodyEl) {
      ideasBodyEl.classList.remove("results-error");
    }

    try {
      const response = await fetch("/api/resume-ideas", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ text })
      });

      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok === false) {
        const message =
          payload?.message || "There was an error generating ideas. Please try again.";
        if (ideasBodyEl) {
          ideasBodyEl.textContent = message;
          ideasBodyEl.classList.add("results-error");
          ideasBodyEl.classList.remove("empty");
        }
        setIdeasStatus(message, "error");
        return;
      }

      const structured = payload.data || payload;
      renderIdeas(structured);
      setIdeasStatus("Questions ready.");
      setTimeout(() => setIdeasStatus(""), 1600);
    } catch (err) {
      console.error(err);
      if (ideasBodyEl) {
        ideasBodyEl.textContent =
          "Something unexpected glitched. Try again in a moment.";
        ideasBodyEl.classList.add("results-error");
        ideasBodyEl.classList.remove("empty");
      }
      setIdeasStatus("Couldnt load questions. Try again.", "error");
    } finally {
      ideasInFlight = false;
      if (ideasRefreshEl) {
        ideasRefreshEl.disabled = false;
        ideasRefreshEl.textContent = originalIdeasButtonText || "Refresh";
      }
      setIdeasLoading(false);
    }
  }

  if (ideasOpenEl) {
    ideasOpenEl.addEventListener("click", () => {
      logEvent("missing_wins_opened");
      openIdeasModal();
      if (!ideasBodyEl || ideasBodyEl.classList.contains("empty")) {
        runIdeas({ auto: false });
      }
    });
  }

  if (ideasRefreshEl) {
    ideasRefreshEl.addEventListener("click", () => {
      runIdeas({ auto: false });
    });
  }

  if (ideasCloseEl) {
    ideasCloseEl.addEventListener("click", closeIdeasModal);
  }

  if (ideasBackdropEl) {
    ideasBackdropEl.addEventListener("click", closeIdeasModal);
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeIdeasModal();
    }
  });

  const SAMPLE_RESUME_TEXT = `Jane Doe
Senior Product Manager

Summary
Senior product manager with 7+ years of experience shipping consumer and B2B features in fast moving environments. Known for turning vague problems into clear roadmaps and coordinated launches.

Experience
Stripe  Senior Product Manager (2021Present)
- Led cross functional team of engineers, designers, and data scientists to launch a new onboarding flow for small businesses.
- Simplified KYC steps and reduced drop off, increasing completed sign ups by 18% across key markets.
- Built a simple metrics framework so leadership could see impact weekly.

Google  Product Manager (20172021)
- Owned a set of growth experiments for a core collaboration product with tens of millions of users.
- Partnered with UX research and engineering to test new sharing flows that improved active usage by 9%.
- Drove roadmap, specs, and cross team communication for launches across three regions.

Education
BA, Economics
University of Washington

Skills
Product discovery, experimentation, roadmapping, stakeholder communication, SQL, basic Python, Figma`;

  if (dataHandlingInlineEl) {
    dataHandlingInlineEl.addEventListener("click", (event) => {
      event.preventDefault();
      openDataModal();
    });
  }

  if (dataModalCloseEl) {
    dataModalCloseEl.addEventListener("click", closeDataModal);
  }

  if (dataModalEl) {
    dataModalEl.addEventListener("click", (event) => {
      if (event.target === dataModalEl) {
        closeDataModal();
      }
    });
  }

  document.addEventListener("keydown", trapDataModalFocus);

  function openDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.remove("hidden");
    // Small timeout to allow display:flex to apply before opacity transition
    requestAnimationFrame(() => {
      // Force reflow
      void dataModalEl.offsetWidth;
      dataModalEl.classList.remove("hidden"); // Ensure class logic for transition works if using :not(.hidden)
      // Add a visible class if needed, but relying on removing 'hidden' and CSS :not(.hidden) logic
    });
    
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    
    // Trap focus
    const focusable = dataModalEl.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (focusable.length) focusable[0].focus();
  }

  function closeDataModal() {
    if (!dataModalEl) return;
    dataModalEl.classList.add("hidden");
    document.body.style.overflow = previousBodyOverflow;
  }

  if (sampleResumeButtonEl) {
    sampleResumeButtonEl.addEventListener("click", () => {
      if (!inputEl) return;
      isSampleRun = true;
      inputEl.value = SAMPLE_RESUME_TEXT;
      try {
        localStorage.setItem(STORAGE_KEY, SAMPLE_RESUME_TEXT);
      } catch (e) {
        console.warn("Could not save sample input", e);
      }
      autoResizeTextarea();
      showSavedIndicator();
      updateClearButtonVisibility();
      runAnalysis({ sample: true, textOverride: SAMPLE_RESUME_TEXT });
      
      // Auto-scroll to results area after a brief delay to show skeleton
      setTimeout(() => {
        const reportCard = document.querySelector(".card-output");
        if (reportCard && typeof reportCard.scrollIntoView === "function") {
          reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 300);
    });
  }

  if (clearButtonEl) {
    clearButtonEl.addEventListener("click", () => {
      clearInput();
    });
  }

  // Backdrop click should not scroll page when modal hidden
  if (ideasModalEl) {
    ideasModalEl.addEventListener("click", (e) => {
      if (e.target === ideasModalEl) {
        closeIdeasModal();
      }
    });
  }
function mapErrorToUserMessage(errorCode, fallbackMessage) {
  switch (errorCode) {
    case "VALIDATION_ERROR":
      return "I need a bit more from you before I can give real feedback. Check what you pasted and try again.";
    case "OPENAI_TIMEOUT":
      return "The model took too long to finish this pass. Try again in a moment.";
    case "OPENAI_NETWORK_ERROR":
      return "There was a small network hiccup. Try again and it should go through.";
    case "OPENAI_HTTP_ERROR":
      return "The model had trouble finishing your review. Try once more.";
    case "OPENAI_RESPONSE_PARSE_ERROR":
    case "OPENAI_RESPONSE_SHAPE_INVALID":
    case "OPENAI_RESPONSE_NOT_JSON":
      return "The model replied in a format I could not read cleanly. Run it again and it should come back sharper.";
    default:
      return (
        fallbackMessage ||
        "Something on my side glitched while reading your resume. Try once more."
      );
  }
}

  function setStatus(message, variant = "info") {
    const el = document.getElementById("status-bar");
    if (!el) return;
    el.textContent = message || "";
    el.classList.remove("status-info", "status-error");
    if (message) {
      el.classList.add(variant === "error" ? "status-error" : "status-info");
    }
  }

  function resetIdeasSection() {
    setIdeasStatus("");
    if (!ideasBodyEl) return;
    ideasBodyEl.innerHTML =
      "Ill look for wins you have not written yet or forgot about.";
    ideasBodyEl.classList.add("empty");
    ideasBodyEl.classList.remove("results-error");
    if (ideasModalEl) {
      ideasModalEl.classList.remove("visible");
      ideasModalEl.setAttribute("aria-hidden", "true");
    }
  }

  function setIdeasStatus(message, variant = "info") {
    if (!ideasStatusEl) return;
    ideasStatusEl.textContent = message || "";
    ideasStatusEl.classList.toggle("error", variant === "error" && !!message);
  }

  function openIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("hidden");
    ideasModalEl.classList.add("visible");
    ideasModalEl.setAttribute("aria-hidden", "false");
    
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    
    // Force reflow to trigger transition
    requestAnimationFrame(() => {
       // ensure transition happens
       void ideasModalEl.offsetWidth;
    });

    const ideasSheetEl = document.getElementById("ideas-sheet");
    if (ideasSheetEl && typeof ideasSheetEl.scrollIntoView === "function") {
      ideasSheetEl.scrollIntoView({
        behavior: prefersReducedMotion() ? "auto" : "smooth",
        block: "center"
      });
    }
  }

  function closeIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("visible");
    ideasModalEl.classList.add("hidden");
    ideasModalEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = previousBodyOverflow;
  }

  function setIdeasLoading(isLoading) {
    if (!ideasLoadingBarEl) return;
    if (isLoading) {
      ideasLoadingBarEl.style.opacity = "1";
      ideasLoadingBarEl.style.animation = "loadingSlide 1.2s linear infinite";
      ideasLoadingBarEl.classList.add("active");
    } else {
      ideasLoadingBarEl.style.opacity = "0";
      ideasLoadingBarEl.style.animation = "none";
      ideasLoadingBarEl.classList.remove("active");
    }
  }

  function renderIdeas(data) {
    if (!ideasBodyEl) return;
    const { questions, notes, how_to_use: howToUse } = data || {};
    let html = "";

    if (Array.isArray(questions) && questions.length > 0) {
      const limited = questions.slice(0, 3);
      html += `<div class="ideas-section-card"><div class="ideas-section-title">Questions worth answering</div><div class="ideas-section-subline">Use these to surface wins your resume isnt showing yet.</div><ul class="ideas-list">`;
      for (const q of limited) {
        html += `<li>${escapeHtml(String(q))}</li>`;
      }
      html += `</ul></div>`;
    }

    html += `<div class="ideas-section-card"><div class="ideas-section-title">How to use this</div><p>Pick one question and jot down what actually happened: the situation, the decision you made, what you owned, and what changed.</p></div>`;

    html += `<div class="ideas-section-card"><div class="ideas-section-title">Turn it into a bullet</div><p>Use: verb + what you owned + the outcome (ideally with a number). Skip it if its already covered in your resume.</p></div>`;

    ideasBodyEl.innerHTML = html || "";
    ideasBodyEl.classList.remove("empty");
    if (ideasInlineEl) ideasInlineEl.classList.remove("hidden");
    if (focusToggleEl) focusToggleEl.classList.remove("hidden");
    }


    (function init() {
      loadSavedInput();
      autoResizeTextarea();
      renderSummary("");
    })();
</script>

</body>
</html>
