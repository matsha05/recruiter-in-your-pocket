<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recruiter in Your Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=Manrope:wght@400;500;600&display=swap");

    :root {
      --bg-page: #f5f6f8;
      --bg-panel: #ffffff;
      --bg-card: #ffffff;
      --border-subtle: #d7dae3;
      --border-strong: #c6cbd6;
      --accent: #1C4ED8;
      --accent-dark: #173CA9;
      --accent-wash: #EFF6FF;
      --accent-boost: #193590;
      --accent-strong: #132a75;
      --text-main: var(--ink-900);
      --text-soft: var(--slate-700);
      --text-muted: var(--slate-500);
      --ink-900: #0F172A;
      --slate-700: #334155;
      --slate-500: #64748B;
      --wash: #F8FAFC;
      --surface-tint: #eef1f6;
      --success: #15803d;
      --error: #b91c1c;
      --font-display: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-body: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --fs-hero: 50px;
      --fs-h1: 28px;
      --fs-h2: 22px;
      --fs-h3: 18px;
      --fs-body: 15px;
      --fs-small: 13px;
      --lh-tight: 1.15;
      --lh-normal: 1.5;
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 16px;
      --space-xl: 24px;
      --space-2xl: 32px;
      --space-xxl: 40px;
      --motion-duration-short: 180ms;
      --motion-duration-medium: 350ms;
      --motion-ease-premium: cubic-bezier(0.16, 1, 0.3, 1);
      --radius-card: 18px;
      --radius-input: 12px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 30px rgba(15, 23, 42, 0.06);
      --accent-width: 2px;
      --accent-width-strong: 6px;
      --stack-gap: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: var(--font-body);
    }

    /* Base type: Manrope 15px / 1.7 for body text */
    body {
      min-height: 100vh;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: var(--space-2xl) var(--space-lg) 42px;
      font-size: var(--fs-body);
      line-height: var(--lh-normal);
    }

    .page {
      width: 100%;
      max-width: 1200px;
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.06);
      background: var(--bg-panel);
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(15, 23, 42, 0.02);
      padding: var(--space-2xl);
      position: relative;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .page {
        padding: 16px 14px 22px;
        border-radius: 22px;
      }
      .tool-layout {
        gap: 18px;
      }
      .card {
        padding: 18px;
      }
      .hero {
        margin-bottom: 16px;
        padding: 14px 14px 10px;
      }
      .hero-title {
        font-size: 26px;
      }
      .hero-subtitle {
        font-size: 14px;
        line-height: 1.55;
      }
      .proof-editorial {
        margin-top: 32px;
        padding: 10px 14px;
      }
    }

    /* Top bar */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
      padding: 6px 0 14px;
    }

    .brand {
      display: inline-flex;
      align-items: baseline;
      gap: 10px;
    }

    .brand-wordmark {
      font-family: "Space Grotesk", "Manrope", system-ui, -apple-system, sans-serif;
      font-size: 18px;
      letter-spacing: -0.02em;
      font-weight: 700;
      color: var(--text-main);
      text-transform: uppercase;
      line-height: 1.1;
    }

    .version-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-panel);
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 0.01em;
      text-transform: none;
      box-shadow: none;
    }

    .trust-inline {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.03);
      position: relative;
    }

    .trust-inline button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      cursor: pointer;
      font-size: 12px;
      padding: 0;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .hero-data-card {
      position: absolute;
      top: calc(100% + 4px);
      right: 0;
      width: min(270px, calc(100vw - 32px));
      margin: 0;
      padding: 12px;
      border-radius: 8px;
      background: var(--bg-panel);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.04);
      color: var(--text-soft);
      font-size: 12.5px;
      line-height: 1.5;
      z-index: 5;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 5px rgba(21, 128, 61, 0.12);
    }

    .hero-data-card p {
      margin: 0 0 var(--space-sm) 0;
    }

    .hero-data-card p:last-child {
      margin-bottom: 0;
    }

    .hero-data-card::before {
      content: "";
      position: absolute;
      top: -4px;
      left: 50%;
      width: 4px;
      height: 4px;
      background: var(--bg-panel);
      border-left: 1px solid var(--border-subtle);
      border-top: 1px solid var(--border-subtle);
      transform: translateX(-50%) rotate(45deg);
      box-shadow: none;
    }

    @media (max-width: 600px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Hero */

    .hero {
      position: relative;
      margin: 0 auto var(--space-xl);
      padding: var(--space-xl);
      max-width: 1100px;
      border-radius: var(--radius-card);
      overflow: hidden;
      background: #f9fafc;
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.08);
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -8% -12%;
      background: radial-gradient(circle at 20% 20%, rgba(14, 58, 93, 0.08), transparent 30%),
                  radial-gradient(circle at 80% 10%, rgba(15, 23, 42, 0.08), transparent 26%);
      pointer-events: none;
    }

    .hero > * {
      position: relative;
      z-index: 1;
    }

    .hero-title {
      font-family: var(--font-display);
      font-size: var(--fs-hero);
      letter-spacing: -0.02em;
      color: var(--ink-900);
      font-weight: 700;
      line-height: var(--lh-tight);
      margin-bottom: var(--space-lg);
      max-width: 820px;
    }

    .hero-subtitle {
      font-size: var(--fs-body);
      color: var(--text-soft);
      max-width: 640px;
      line-height: 1.5;
      margin-bottom: var(--space-md);
    }

    .hero-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 20px;
      margin-bottom: 6px;
      font-size: 12px;
      color: var(--text-muted);
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.03);
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 9px;
      padding: 6px 12px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: rgba(255, 255, 255, 0.92);
      color: var(--text-soft);
      letter-spacing: 0.04em;
    }

    .hero-pill span:first-child {
      width: 20px;
      height: 20px;
      border-radius: 7px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: color-mix(in srgb, var(--accent) 12%, white 88%);
      border: 1px solid color-mix(in srgb, var(--accent) 28%, white 72%);
      color: color-mix(in srgb, var(--text-main) 90%, var(--accent) 10%);
      font-weight: 700;
    }

    .hero-promise {
      margin-top: 20px;
      font-size: 14px;
      color: var(--slate-700);
      line-height: 1.6;
      max-width: 720px;
    }

    .hero-promise strong {
      color: var(--ink-900);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .hero-promise ul {
      list-style: disc;
      padding-left: 18px;
      margin-top: 6px;
      display: grid;
      gap: 6px;
    }

    /* Social proof */
    .proof {
      margin-top: 18px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .proof-card {
      background: rgba(255, 255, 255, 0.82);
      border: 1px solid var(--border-subtle);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .proof-quote {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.6;
    }

    .proof-name {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.01em;
    }

    .proof-editorial {
      margin-top: 20px;
      margin-bottom: 16px;
      padding: 0;
      background: transparent;
      border-radius: 0;
      box-shadow: none;
    }

    .proof-editorial-heading {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 10px;
      letter-spacing: -0.01em;
    }

    .proof-editorial-quote {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 8px;
    }

    .proof-editorial-quote:last-child {
      margin-bottom: 0;
    }

    .future-ribbon {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .future-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
      font-size: 11px;
      letter-spacing: 0.01em;
    }

    .future-chip.warm {
      border-color: var(--border-subtle);
      background: var(--surface-tint);
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      :root {
        --fs-hero: 43px;
        --fs-h1: 24px;
        --fs-h2: 20px;
      }
      .hero {
        padding: 18px 14px 14px;
        margin-bottom: 18px;
      }
      .hero-title {
        font-size: 32px;
      }
      .hero-subtitle {
        font-size: 14px;
      }
      .hero-grid {
        gap: 8px 12px;
      }
      .tool-layout {
        gap: 14px;
      }
      .card {
        padding: 16px;
      }
      .results-top {
        padding: 18px 14px 14px;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.1);
      }
      .ideas-sheet {
        width: min(720px, 94vw);
        padding: 16px;
      }
    }

    /* Main tool area */

    .tool-layout {
      position: relative;
      margin-top: var(--space-xl);
      display: flex;
      flex-direction: column;
      gap: var(--space-2xl);
      align-items: stretch;
    }

    .card {
      position: relative;
      background: var(--bg-card);
      border-radius: var(--radius-card);
      border: 1px solid rgba(12, 17, 32, 0.07);
      padding: var(--space-xl);
      box-shadow: var(--shadow-soft);
      overflow: visible;
    }

    .card::before {
      display: none;
    }

    .card-output {
      position: relative;
      background: var(--bg-card);
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      padding: 14px 14px 18px;
      overflow: hidden;
    }

    .card-output::before {
      content: "";
      position: absolute;
      left: 14px;
      top: 14px;
      bottom: 14px;
      width: 3px;
      border-radius: 8px;
      background: var(--accent);
      opacity: 0.3;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: var(--space-sm);
    }

    .card-title {
      font-family: var(--font-display);
      font-size: var(--fs-h1);
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
      line-height: 1.25;
    }

    .card-input .card-title {
      font-size: var(--fs-h1);
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: var(--space-sm);
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 12px;
      letter-spacing: 0.01em;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      max-height: 360px;
      overflow-y: auto;
      padding: 14px 16px;
      font-size: 15px;
      color: var(--text-main);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      resize: none;
      margin: 0;
      line-height: 1.65;
      box-shadow: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease;
    }

    textarea::placeholder {
      color: var(--text-muted);
      font-size: 14px;
    }

    .input-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin-bottom: 12px;
      color: var(--text-muted);
    }

    .saved-indicator {
      color: #22c55e;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }

    .saved-indicator.visible {
      opacity: 1;
    }

    body.focus-mode .tool-layout {
      grid-template-columns: minmax(0, 1fr);
      margin-top: 10px;
    }

    body.focus-mode .tool-layout::after {
      display: none;
    }

    body.focus-mode .card-input {
      display: none;
    }

    body.focus-mode .card-output {
      grid-column: 1 / -1;
      max-width: 960px;
      margin: 0 auto;
    }

    .card-input {
      margin-top: 0;
      border-radius: 20px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(12, 17, 32, 0.08);
      padding: 24px;
    }

    .coming-soon-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
      margin-bottom: 10px;
    }

    .run-row {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 16px;
    }

    .run-row::before {
      content: "";
      position: absolute;
      inset: -10px 8px 0 8px;
      background: radial-gradient(circle at 50% 30%, rgba(14, 58, 93, 0.14), transparent 55%);
      filter: blur(6px);
      z-index: 0;
      pointer-events: none;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      font-weight: 600;
      border-radius: 12px;
      padding: 12px 22px;
      border: none;
      box-shadow: 0 4px 14px rgba(28, 78, 216, 0.25);
      cursor: pointer;
      transition: background 200ms ease, box-shadow 200ms ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--accent-dark);
      box-shadow: 0 6px 18px rgba(23, 60, 169, 0.27);
    }

    .btn-primary:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: 0 1px 3px rgba(10, 16, 28, 0.12);
    }

    .btn-secondary {
      background: #ffffff;
      border: 1px solid rgba(28, 78, 216, 0.45);
      color: var(--accent);
      border-radius: 10px;
      padding: 10px 20px;
      box-shadow: 0 4px 10px rgba(28, 78, 216, 0.15);
      cursor: pointer;
      transition: background 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--accent-wash);
      border-color: var(--accent);
    }

    .run-button {
      width: 100%;
      font-size: 16px;
      letter-spacing: -0.01em;
    }

    .copy-button,
    .export-button {
      font-size: 13px;
      gap: 6px;
    }

    @keyframes runButtonPulse {
      0% { background: var(--accent); }
      50% { background: color-mix(in srgb, var(--accent) 92%, white 8%); }
      100% { background: var(--accent); }
    }

    @keyframes shimmer {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
      min-height: 18px;
    }

    /* Results */

    .results-header-row {
      display: block;
      margin-top: 6px;
      margin-bottom: 10px;
    }

    .focus-controls {
      display: flex;
      justify-content: flex-end;
      margin: 6px 0 12px;
    }

    .focus-button {
      border: none;
      background: transparent;
      color: var(--accent-boost);
      font-size: 13px;
      font-weight: 600;
      letter-spacing: -0.01em;
      cursor: pointer;
      padding: 4px 0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      transition: color 0.12s ease, text-decoration-color 0.12s ease;
    }

    .focus-button:hover {
      color: var(--accent-strong);
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 2px;
    }

    .results-top {
      background: #f8f9fb;
      border: 1px solid var(--border-subtle);
      border-radius: 14px;
      padding: 22px 16px 18px;
      margin-bottom: 14px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
    }

    .report-view {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .results-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }

    .results-actions-bottom {
      margin-top: 16px;
    }

    .score-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 0;
      border-radius: 999px;
      background: transparent;
      border: none;
      box-shadow: none;
    }

    .score-wrapper.hidden {
      display: none;
    }

    .score-cluster {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .score-texts {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .score-label-text {
      font-size: 13px;
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-short-text {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .score-help {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.5;
    }

    #results-title {
      font-size: 20px;
      margin-bottom: 8px;
      color: var(--text-main);
      font-weight: 800;
      letter-spacing: -0.02em;
      position: relative;
    }

    .results-bridge {
      margin: 14px 0 18px;
    }

    .report-accent-line {
      height: var(--accent-width);
      background: var(--accent);
      border-radius: 999px;
      margin: 8px 0 6px;
      transform-origin: left;
      width: 100%;
    }

    .report-wrapper {
      display: none;
    }

    .report-container {
      opacity: 0;
      transform: translateY(10px);
      filter: blur(2px);
    }

    .report-container--visible {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
      transition:
        opacity 340ms cubic-bezier(0.22, 1, 0.36, 1),
        transform 340ms cubic-bezier(0.22, 1, 0.36, 1),
        filter 340ms cubic-bezier(0.22, 1, 0.36, 1);
    }

    @media (prefers-reduced-motion: reduce) {
      .report-container,
      .report-container--visible {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
        transition: none !important;
      }
    }

    .report-title {
      position: relative;
      display: inline-block;
    }

    .report-title::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -6px;
      height: 2px;
      width: 100%;
      background: var(--accent);
      transform: scaleX(0);
      transform-origin: left;
    }

    .bridge-heading {
      font-size: 16px;
      font-weight: 700;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin-bottom: 8px;
    }

    #results-subtitle {
      font-size: 16px;
      color: var(--slate-700);
      line-height: 1.6;
      max-width: 620px;
      margin: 0;
    }

    .score-header-inside {
      width: 100%;
      display: flex;
      justify-content: center;
      margin: 8px 0 14px;
    }

    .score-badge {
      --score-pill-bg: rgba(37, 99, 235, 0.08);
      --score-pill-bg-boost: color-mix(in srgb, var(--score-pill-bg) 90%, white 10%);
      --score-pill-border: rgba(37, 99, 235, 0.28);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 26px;
      border-radius: 999px;
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: -0.01em;
      position: relative;
      overflow: hidden;
      opacity: 0;
      transition:
        transform 0.16s ease-out,
        opacity 0.16s ease-out,
        background-color 0.08s ease-out;
      min-width: 118px;
      text-align: center;
      border: 1px solid var(--score-pill-border);
      background-color: var(--score-pill-bg);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    .score-badge.score-badge--glow {
      background-color: var(--score-pill-bg-boost);
      transition:
        transform 0.16s ease-out,
        opacity 0.16s ease-out,
        background-color 0.06s ease-out;
    }

    .score-pill--reveal {
      animation: score-reveal 0.15s ease-out;
    }

    @keyframes score-reveal {
      from {
        opacity: 0;
        transform: scale(0.96);
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
      }
      to {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      }
    }

    .score-visible {
      opacity: 1;
      transform: scale(1);
    }

    .score-tooltip {
      position: absolute;
      top: 120%;
      right: 0;
      width: 320px;
      background: #ffffff;
      border: 1px solid var(--border-strong);
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
      border-radius: 12px;
      padding: 12px;
      font-size: 12px;
      color: var(--text-main);
      line-height: 1.5;
      opacity: 0;
      transform: translateY(4px);
      pointer-events: none;
      transition: opacity 0.16s ease-out, transform 0.16s ease-out;
      z-index: 5;
    }

    .score-tip-line {
      margin-bottom: 6px;
      color: var(--text-soft);
    }

    .score-tip-line:last-child {
      margin-bottom: 0;
    }

    .score-wrapper:hover .score-tooltip,
    .score-wrapper:focus-within .score-tooltip,
    .score-tooltip.open {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.12);
    }

    .score-low {
      --score-pill-bg: #fbe4df;
      --score-pill-bg-boost: color-mix(in srgb, var(--score-pill-bg) 90%, white 10%);
      --score-pill-border: #f5c7bd;
      background-color: var(--score-pill-bg);
      border-color: var(--score-pill-border);
      color: #3c2317;
    }

    .score-mid {
      --score-pill-bg: #f7edd7;
      --score-pill-bg-boost: color-mix(in srgb, var(--score-pill-bg) 90%, white 10%);
      --score-pill-border: #ecd7ac;
      background-color: var(--score-pill-bg);
      border-color: var(--score-pill-border);
      color: #3f3011;
    }

    .score-good {
      --score-pill-bg: #e8edff;
      --score-pill-bg-boost: color-mix(in srgb, var(--score-pill-bg) 90%, white 10%);
      --score-pill-border: #cbd7ff;
      background-color: var(--score-pill-bg);
      border-color: var(--score-pill-border);
      color: #1f2f63;
    }

    .score-great {
      --score-pill-bg: #e3f6ee;
      --score-pill-bg-boost: color-mix(in srgb, var(--score-pill-bg) 90%, white 10%);
      --score-pill-border: #bdebd4;
      background-color: var(--score-pill-bg);
      border-color: var(--score-pill-border);
      color: #153828;
    }

    .score-bands-trigger {
      background: none;
      border: none;
      padding: 0;
      color: var(--text-soft);
      font-size: 12px;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 2px;
      margin-top: 8px;
      align-self: flex-start;
    }

    .score-bands-trigger:hover,
    .score-bands-trigger:focus-visible {
      color: var(--text-main);
    }

    .score-bands-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 320px;
    }

    .score-bands-panel-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .score-bands-intro {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.55;
    }

    .score-bands-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .score-band-item {
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      padding: 8px 10px;
      background: #f9fafc;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .score-band-item.active {
      border-color: var(--accent);
      background: #eef2ff;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .score-band-header {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-range {
      color: var(--text-main);
    }

    .score-band-label {
      color: var(--text-soft);
      font-weight: 600;
    }

    .score-band-chip {
      margin-left: auto;
      font-size: 11px;
      background: #dfe7ff;
      color: #1f2f63;
      padding: 3px 6px;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-band-description {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.5;
    }

    /* Paywall */
    .paywall-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.42);
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .paywall-card {
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      border-radius: 14px;
      box-shadow: 0 22px 48px rgba(0, 0, 0, 0.12);
      width: min(520px, 92vw);
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .paywall-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.015em;
    }

    .paywall-subtitle {
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.6;
    }

    .paywall-list {
      margin: 4px 0 8px;
      padding-left: 18px;
      color: var(--text-main);
      line-height: 1.55;
      font-size: 14px;
    }

    .paywall-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .paywall-primary {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
    }

    .paywall-secondary {
      background: none;
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
      border-radius: 10px;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    #loading-bar {
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      margin-top: 8px;
      opacity: 0;
      transform: scaleX(0.9);
      transform-origin: center;
    }

    #loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.1s linear infinite;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.18);
    }

    @keyframes loadingSlide {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    #results-body {
      border: 1px solid var(--border-subtle);
      padding: 14px 18px;
      line-height: 1.65;
      white-space: normal;
      font-weight: 400;
      margin-top: 8px;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02);
      background: #ffffff;
      border-radius: 12px;
    }

    #results-body.muted {
      opacity: 0.55;
      filter: grayscale(0.06);
    }

    #results-body.refreshed {
      animation: fadeUp 0.18s ease-out;
    }

    #results-body.empty {
      color: rgba(156, 163, 175, 0.82);
      background: #f9fafb;
    }

    .results-summary {
      font-size: 15px;
      color: var(--text-main);
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 10px 12px;
      line-height: 1.65;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
      margin-bottom: 10px;
    }

    .results-summary.empty {
      color: var(--text-muted);
      box-shadow: none;
    }

    .results-skeleton {
      border: 1px solid var(--border-subtle);
      border-radius: 14px;
      padding: 14px 16px;
      margin-top: 10px;
      background: #ffffff;
      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.02);
      display: grid;
      gap: 6px;
    }

    .skeleton-line {
      height: 6px;
      border-radius: 999px;
      background: #e7e9f0;
      width: 100%;
      animation: none;
    }

    .skeleton-line.wide { width: 92%; }
    .skeleton-line.mid { width: 74%; }
    .skeleton-line.short { width: 52%; }

    .skeleton-divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 2px 0 4px;
    }

    .hidden {
      display: none !important;
    }

    .results-summary.empty {
      color: var(--text-muted);
    }

    @keyframes reportRevealSoft {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scorePillPop {
      from {
        transform: scale(0.92);
        background-color: color-mix(in srgb, var(--score-pill-bg) 85%, white 15%);
      }
      70% {
        transform: scale(1.02);
        background-color: color-mix(in srgb, var(--score-pill-bg) 92%, white 8%);
      }
      100% {
        transform: scale(1);
        background-color: var(--score-pill-bg);
      }
    }

    @keyframes accentLineDraw {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes accentWipe {
      from { transform: scaleY(0); }
      to { transform: scaleY(1); }
    }

    @keyframes titleUnderline {
      from {
        transform: scaleX(0);
      }
      to {
        transform: scaleX(1);
      }
    }

    @keyframes reportSectionIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results-error {
      border-color: var(--error) !important;
      color: #7f1d1d !important;
      background: rgba(185, 28, 28, 0.08) !important;
    }

    #results-body {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: var(--stack-gap);
      position: relative;
    }

    .stack-accent-line {
      position: relative;
    }

    .stack::before,
    .stack-accent-line::before {
      content: "";
      position: absolute;
      left: -12px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--accent) 0%, rgba(31, 63, 182, 0.12) 100%);
      border-radius: var(--radius-pill);
      opacity: 0.65;
      pointer-events: none;
      transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .stack-section {
      position: relative;
      padding: var(--space-xl) var(--space-sm) var(--space-md) var(--space-lg);
      margin: var(--space-xxl) 0;
      border-radius: 12px;
      transition:
        background var(--motion-duration-medium) var(--motion-ease-premium),
        transform var(--motion-duration-medium) var(--motion-ease-premium),
        box-shadow var(--motion-duration-medium) var(--motion-ease-premium);
    }

    .stack-heading {
      font-family: var(--font-display);
      font-size: 25px;
      font-weight: 800;
      color: var(--ink-900);
      letter-spacing: -0.01em;
      margin-top: 32px;
      margin-bottom: 16px;
      line-height: 1.28;
    }

    [data-section="next-steps"] {
      margin-top: calc(var(--space-xxl) + 20px);
    }

    .stack-subline {
      font-size: 16px;
      color: var(--slate-700);
      margin-bottom: 12px;
      line-height: 1.6;
    }

    .stack-section:hover,
    .stack-section:focus-within {
      background: rgba(31, 63, 182, 0.04);
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.06);
    }

    .stack-section:hover.stack-accent-line::before,
    .stack-section:focus-within.stack-accent-line::before {
      opacity: 0.9;
    }

    .accent-card-primary {
      position: relative;
      overflow: hidden;
    }

    .accent-card-primary::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      border-radius: var(--radius-card);
    }

    /* Testimonials: keep clean without spine */
    .proof-editorial.accent-card-primary::before {
      display: none;
    }

    .accent-heading {
      position: relative;
      padding-left: var(--space-md);
    }

    .accent-heading::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 2px;
      height: 1.6em;
      background: var(--accent);
      border-radius: var(--radius-pill);
    }

    .ideas-sheet-header.accent-left {
      padding-left: var(--space-lg);
    }

    .ideas-sheet-header.accent-card-primary {
      padding-left: calc(var(--space-xl) - var(--accent-width-strong));
    }

    .result-paragraph {
      margin: 0 0 10px;
    }

    .result-list {
      margin: 4px 0 16px;
      padding-left: 18px;
    }

    .result-list li {
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .rewrite-label {
      font-weight: 600;
      color: var(--text-soft);
      margin: 4px 0 2px;
    }

    .rewrite-text {
      margin: 0 0 6px;
      padding-left: 8px;
      color: var(--text-main);
    }

    .empty-hint {
      font-size: 12px;
      color: rgba(156, 163, 175, 0.85);
      margin-top: 6px;
    }

    #results-body:not(.empty) + .empty-hint {
      display: none;
    }

    .rewrite-enhancement-note {
      margin-top: 8px;
      font-size: 14px;
      opacity: 0.95;
      font-style: italic;
      padding: 8px 10px;
      color: #475569;
      line-height: 1.5;
      background: transparent;
    }

    .results-body-better-flash .rewrite-column.right {
      filter: contrast(1.05);
      transition: filter 0.2s ease;
    }

    .results-body-better-flash .rewrite-column:not(.right) {
      opacity: 0.82;
      transition: opacity 0.2s ease;
    }

    @media (prefers-reduced-motion: reduce) {
      .report-view,
      .report-view.report-view--reveal {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view.report-view--focus-start {
        transition: none;
        transform: none;
        opacity: 1;
      }

      .report-view,
      .report-card,
      .score-pill,
      .report-accent-line,
      .report-section,
      .report-title::after,
      .accent-heading::before,
      .accent-card-primary::before {
        animation: none !important;
        transition: none !important;
        transform: none !important;
        opacity: 1 !important;
      }

      .score-badge {
        transition: none;
      }

      .score-badge.score-badge--glow {
        background-color: var(--score-pill-bg);
      }

      .run-button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .stack-section {
        transition: none !important;
        transform: none !important;
      }
    }

    .copy-button,
    .export-button {
      font-size: 13px;
      gap: 6px;
    }

    /* Rewrite blocks and section separators */

    .rewrite-block {
      margin-top: 12px;
      padding-top: 10px;
    }

    .rewrite-columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-items: start;
    }

    .rewrite-column {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .rewrite-column.right {
      border-left: 1px solid var(--border-subtle);
      padding-left: 12px;
    }

    @media (max-width: 720px) {
      .rewrite-columns {
        grid-template-columns: 1fr;
      }
      .rewrite-column.right {
        border-left: none;
        padding-left: 0;
      }
    }

    /* line only between successive rewrite blocks */
    .rewrite-block + .rewrite-block {
      border-top: 1px solid var(--border-subtle);
    }

    .result-section {
      border-top: 1px solid var(--border-subtle);
      padding-top: 12px;
      margin-top: 12px;
    }

    .next-steps-heading {
      border-top: 1px solid var(--border-subtle);
      padding-top: 12px;
      margin-top: 12px;
    }

    .result-subline {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .rewrite-cluster-heading {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin: 14px 0 6px;
      letter-spacing: -0.01em;
    }

    /* Creator line and footer */

    .creator-section {
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      opacity: 0.7;
      margin-top: 16px;
      margin-bottom: 6px;
    }

    .footer {
      margin-top: 16px;
      padding-top: 0;
      border-top: none;
      text-align: center;
      color: var(--slate-500);
      font-size: 11px;
      line-height: 1.55;
    }

    .footer strong {
      color: var(--text-soft);
      font-weight: 600;
    }

    textarea:focus-visible {
      outline: none;
      border-color: rgba(15, 23, 42, 0.28);
      box-shadow:
        0 14px 30px rgba(15, 23, 42, 0.14),
        inset 0 0 0 1px rgba(15, 23, 42, 0.28);
    }

    .btn-primary:focus-visible,
    .btn-secondary:focus-visible,
    .run-button:focus-visible,
    .sample-resume-button:focus-visible,
    .copy-button:focus-visible,
    .export-button:focus-visible,
    .ideas-open-link:focus-visible,
    .stack-section:focus-within {
      outline: 2px solid #A5B4FC;
      outline-offset: 3px;
      box-shadow: 0 0 0 2px rgba(28, 78, 216, 0.16);
    }

    /* Ghost overlay for textarea */

    .input-wrapper {
      position: relative;
      max-height: 440px;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .resume-input-container {
      overflow: hidden;
      border-radius: 18px;
      border: 1px solid rgba(12, 17, 32, 0.08);
      background: rgba(15, 23, 42, 0.015);
      padding: 24px 18px;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.10);
    }

    @media (max-width: 600px) {
      .input-wrapper {
        max-height: 540px;
      }
    }

    .resume-hint-overlay {
      position: absolute;
      inset: 14px 16px auto 16px;
      pointer-events: none;
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-soft);
      background: var(--surface-tint);
      padding: 10px 12px 10px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.08);
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
    }

    .resume-hint-title {
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
      letter-spacing: -0.01em;
    }

    .resume-hint-body {
      font-size: 12px;
      color: rgba(156, 163, 175, 0.92);
    }

    .resume-hint-overlay.hidden {
      opacity: 0;
      transform: translateY(4px);
    }
    .status-bar {
      margin-top: 6px;
      font-size: 13px;
      opacity: 0.95;
      min-height: 1.2em;
      color: var(--text-muted);
    }

    .status-bar.status-info {
      color: var(--text-soft);
    }

    .status-bar.status-error {
      color: var(--error);
    }

    /* Achievement ideas (inline + modal) */
    .ideas-inline {
      margin-top: 32px;
      margin-bottom: 14px;
      background: rgba(15, 23, 42, 0.02);
      border: 1px solid rgba(12, 17, 32, 0.08);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
    }

    .ideas-inline.hidden {
      display: none;
    }

    .ideas-inline .ideas-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .ideas-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .ideas-kicker {
      font-size: 15px;
      font-weight: 800;
      color: #0b1224;
      letter-spacing: -0.01em;
      margin-bottom: 2px;
    }

    .ideas-subtitle {
      font-weight: 400;
      font-size: 12px;
      color: var(--text-soft);
      max-width: 360px;
    }

    .ideas-open-link {
      background: transparent;
      border: none;
      color: var(--accent-boost);
      font-size: 12px;
      padding: 0;
      cursor: pointer;
      text-decoration: none;
      align-self: flex-start;
      transition:
        color var(--motion-duration-medium) var(--motion-ease-premium),
        transform var(--motion-duration-medium) var(--motion-ease-premium),
        text-decoration-color var(--motion-duration-medium) var(--motion-ease-premium),
        border-color var(--motion-duration-medium) var(--motion-ease-premium);
      border-bottom: 1px solid transparent;
    }

    .ideas-open-link:hover,
    .ideas-open-link:focus-visible {
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 2px;
      transform: translateX(2px);
      color: var(--accent-strong);
      border-color: var(--accent-strong);
    }

    .ideas-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.18s ease, transform 0.2s ease;
    }

    .ideas-modal.visible {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    .ideas-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.2);
      backdrop-filter: blur(2px);
      opacity: 0;
      transition: opacity 0.18s ease;
    }

    .ideas-modal.visible .ideas-backdrop {
      opacity: 1;
    }

    .ideas-sheet {
      position: relative;
      z-index: 1;
      width: min(720px, 92vw);
      max-height: 85vh;
      background: #ffffff;
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
      padding: 18px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.22s ease, transform 0.22s ease;
      border-top: 2px solid var(--accent);
    }

    .ideas-modal.visible .ideas-sheet {
      opacity: 1;
      transform: translateY(0);
    }

    .ideas-sheet-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 4px;
      position: relative;
    }

    .ideas-sheet-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: -0.02em;
      margin-bottom: 6px;
    }

    .ideas-sheet-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .ideas-sheet-body {
      overflow-y: auto;
      padding: 2px 2px 6px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (max-width: 768px) {
      .ideas-modal {
        align-items: flex-end;
        padding: 12px 0;
      }
      .ideas-sheet {
        width: 100vw;
        max-width: 100vw;
        max-height: calc(100vh - 96px - env(safe-area-inset-top, 0px));
        height: auto;
        border-radius: 16px 16px 0 0;
        padding: 20px;
        box-shadow: 0 16px 36px rgba(15, 23, 42, 0.16);
        margin-top: env(safe-area-inset-top, 8px);
      }
      .ideas-sheet-header {
        position: sticky;
        top: 0;
        padding: 6px 0 10px 0;
        background: #ffffff;
        z-index: 2;
      }
      .ideas-sheet-body {
        flex: 1;
        overflow-y: auto;
        padding: 4px 2px 12px;
        gap: 16px;
      }
      .ideas-actions {
        flex-wrap: wrap;
      }
    }

    .ghost-button {
      background: var(--surface-tint);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      padding: 7px 12px;
      border-radius: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: border-color 0.12s ease, background 0.12s ease;
      align-self: flex-start;
    }

    .ghost-button:hover {
      border-color: var(--border-strong);
      background: var(--surface-tint);
    }

    .ghost-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (prefers-reduced-motion: reduce) {
      .run-button:hover,
      .run-button:active,
      .copy-button:hover,
      .export-button:hover,
      .sample-resume-button:hover {
        transform: none !important;
        box-shadow: 0 10px 22px color-mix(in srgb, var(--accent) 18%, transparent);
      }
    }

    .sample-resume-button {
      align-self: flex-start;
      margin: 6px 0 10px;
      font-size: 13px;
    }

    .data-handling-row {
      margin-top: 4px;
    }

    .data-handling-link {
      font-size: 11px;
      padding: 4px 8px;
    }

    .data-handling-panel {
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.02);
      font-size: 11px;
      color: var(--text-soft);
    }

    .data-handling-title {
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
      letter-spacing: -0.01em;
      font-size: 12px;
    }

    .data-handling-text {
      margin: 0 0 4px;
      line-height: 1.5;
    }

    .data-handling-text:last-child {
      margin-bottom: 0;
    }

    .ideas-loading-bar {
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, var(--accent-strong), var(--accent-boost), var(--accent-strong));
      background-size: 200% 100%;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
      margin-top: 6px;
      border-radius: 999px;
      height: 1.5px;
    }

    .ideas-status {
      font-size: 12px;
      color: rgba(148, 163, 184, 0.9);
      margin-top: 6px;
      min-height: 16px;
    }

    .ideas-status.error {
      color: #fca5a5;
    }

    .ideas-body {
      margin-top: 4px;
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .ideas-body.empty {
      color: var(--text-muted);
      border: 1px dashed var(--border-subtle);
      border-radius: 12px;
      padding: 12px 14px;
    }

    .ideas-section-card {
      background: rgba(15, 23, 42, 0.02);
      border: 1px solid rgba(12, 17, 32, 0.08);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
      border-radius: 14px;
      padding: 14px 16px;
    }

    .ideas-section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
      letter-spacing: -0.01em;
      margin: 0 0 8px;
    }

    .ideas-section-subline {
      margin: 0 0 10px;
      color: var(--text-soft);
      font-size: 13px;
      line-height: 1.5;
    }

    .ideas-section-card p {
      margin: 0;
      color: var(--text-main);
      line-height: 1.6;
    }

    .ideas-list {
      margin: 0;
      padding-left: 22px;
    }

    .ideas-list li {
      margin-bottom: 7px;
      line-height: 1.6;
      color: var(--text-main);
    }

    .ideas-how {
      margin-top: 0;
      font-weight: 600;
      font-size: 13px;
      line-height: 1.5;
      color: var(--text-main);
    }

    .ideas-sublist {
      margin-top: 6px;
      padding-left: 16px;
      color: rgba(63, 69, 82, 0.85);
      font-size: 12px;
      line-height: 1.5;
    }

    .ideas-divider {
      border-top: 1px solid var(--border-subtle);
      margin: 12px 0 8px;
      padding-top: 0;
    }

    .ideas-actions .ghost-button {
      border-radius: 10px;
      padding: 7px 12px;
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.06);
    }

    @media print {
      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        transition: none !important;
        animation: none !important;
      }

      body {
        background: #ffffff;
        color: var(--text-main);
        padding: var(--space-lg);
        font-size: 13px;
      }

      .page {
        border: none;
        box-shadow: none;
        padding: 0;
        max-width: 780px;
        margin: 0 auto;
      }

      .top-bar,
      .hero,
      .card-input,
      .run-row,
      .results-actions-bottom,
      .data-handling-row,
      .sample-resume-button,
      .version-pill,
      #loading-bar,
      #focus-toggle,
      textarea,
      label[for="main-input"],
      .input-wrapper,
      .resume-hint-overlay {
        display: none !important;
      }

      button,
      .copy-button,
      .export-button,
      .ideas-open-link,
      .run-button {
        pointer-events: none;
      }

      .card-output {
        box-shadow: 0 0 0 1px rgba(12, 17, 32, 0.08);
        border: 1px solid rgba(12, 17, 32, 0.08);
        padding: var(--space-md);
        border-radius: 10px;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-top {
        box-shadow: none;
        border: none;
        background: #ffffff;
        padding: 0 0 var(--space-lg) 0;
      }

      #results-body {
        border: none;
        padding: 0;
      }

      .stack::before,
      .stack-accent-line::before {
        display: none;
      }

      .stack-accent-line {
        border-left: 2px solid color-mix(in srgb, var(--accent) 85%, white 15%);
        padding-left: var(--space-lg);
      }

      .stack-section {
        margin: var(--space-lg) 0;
        padding: 0 0 var(--space-md) 0;
        box-shadow: none;
        background: #ffffff;
        border-radius: 4px;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .stack-heading {
        margin-bottom: var(--space-md);
      }

      .result-list li,
      .rewrite-block,
      .rewrite-columns,
      .ideas-section-card,
      .card-output {
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .results-summary {
        border: none;
        box-shadow: none;
        background: #ffffff;
        padding-left: 0;
      }

      .stack-section:hover,
      .stack-section:focus-within,
      .ideas-open-link:hover,
      .ideas-open-link:focus-visible,
      .run-button:hover,
      .copy-button:hover,
      .export-button:hover {
        background: #ffffff;
        transform: none;
        box-shadow: none;
      }

      .ideas-open-link {
        color: var(--text-main);
        text-decoration: none;
        border: none;
      }

      body::after {
        content: "Generated with Recruiter in Your Pocket  recruiterinyourpocket.com";
        display: block;
        margin-top: var(--space-xl);
        font-size: 12px;
        color: var(--text-muted);
        text-align: center;
      }
    }

  </style>
</head>

<body>
  <div class="page">
    <div class="page-inner">
      <header class="top-bar">
        <div class="brand">
          <div class="brand-wordmark">Recruiter in Your Pocket</div>
        </div>
        <div class="version-pill">
          <span class="status-dot"></span>
          <span>Resume isn't stored</span>
        </div>
      </header>

      <div id="loading-bar"></div>

      <section class="hero">
        <h1 class="hero-title">Recruiter-grade resume feedback in under a minute.</h1>
        <p class="hero-subtitle">Paste your resume to get a crafted, honest read on how your story lands, plus stronger bullets and clear next steps.</p>
        <div class="hero-promise">
          <strong>In one minute, youll get:</strong>
          <ul>
            <li>A clear read on how your resume lands</li>
            <li>Whats working and whats getting missed</li>
            <li>Stronger bullet phrasing and simple next steps</li>
          </ul>
        </div>
        <div class="trust-inline">
          <span>Your resume stays private.</span>
          <button id="data-handling-inline" type="button" aria-expanded="false" aria-controls="hero-data-card">How we handle data</button>
        </div>
        <div id="hero-data-card" class="hero-data-card hidden" role="region" aria-label="How we handle your data">
          <p>Your resume stays in your browser until you run a review.</p>
          <p>When you run a review, we send only your text, sent securely, so the model can read it.</p>
          <p>We never store your resume or use it for model training.</p>
        </div>

        <div class="hero-grid">
          <div class="hero-pill">
            <span>1</span><span>Paste your resume story</span>
          </div>
          <div class="hero-pill">
            <span>2</span><span>Get a recruiters read</span>
          </div>
          <div class="hero-pill">
            <span>3</span><span>Turn insight into an edge</span>
          </div>
        </div>

      </section>

      <main class="tool-layout">
        <!-- Left column -->
        <section class="card card-input" aria-label="Input panel">
          <div class="card-inner">
            <div class="card-header">
              <h2 class="card-title">Your resume</h2>
            </div>

            <label for="main-input" id="input-label">
              Paste your full resume, or use the sample to see how it works.
            </label>

            <button id="sample-resume-button" type="button" class="sample-resume-button btn-primary">Try a sample resume </button>

            <div class="input-wrapper resume-input-container resume-input-shell">
              <textarea
                id="main-input"
                placeholder="Paste your full resume, including work history, skills, and education."
              ></textarea>

              <div id="resume-hint" class="resume-hint-overlay">
                <div class="resume-hint-title">Paste your full resume or try the sample</div>
                <div class="resume-hint-body">
                  Ill read it like a recruiter and highlight whats clear, whats hidden, and where phrasing can be sharper.
                </div>
              </div>
            </div>

            <div class="input-meta-row">
              <div>Your resume stays in your browser until you click Get a recruiters read.</div>
              <div id="saved-indicator" class="saved-indicator">Saved</div>
            </div>

            <div class="run-row">
              <button id="run-button" class="run-button btn-primary">Get a recruiters read</button>
              <div id="status" class="status" aria-live="polite" role="status"></div>
            </div>
          </div>
        </section>

        <div class="proof-editorial accent-card-primary" aria-label="Testimonials from users">
          <div class="proof-editorial-heading">What early users say</div>
          <div class="proof-editorial-quote">Honestly, I thought my resume was fine, but this showed me what actually mattered and what I could finally cut.</div>
          <div class="proof-editorial-quote">It connected my past roles into a story I didnt even realize I was trying to tell.</div>
          <div class="proof-editorial-quote">I never understood why some bullets felt off until this explained it in a way that finally clicked.</div>
          <div class="proof-editorial-quote">It finally made me stop rewriting my resume at midnight every week.</div>
        </div>

        <!-- Right column -->
        <div class="report-wrapper">
          <section class="card card-output" aria-label="Results panel">
            <div class="card-inner report-view report-card report-container" id="report-view">
            <div class="results-top stack-section stack-accent-line">
              <div class="score-header-inside">
                <div id="score-wrapper" class="score-wrapper hidden">
                  <div
                    id="score-badge"
                    class="score-badge score-pill"
                    tabindex="0"
                    aria-describedby="score-tooltip"
                  ></div>
                  <div id="score-tooltip" class="score-tooltip" role="tooltip"></div>
                </div>
              </div>
              <div class="results-header-row">
                <h2 id="results-title" class="card-title"><span class="report-title">Recruiter feedback</span></h2>
                <div class="focus-controls">
                  <button id="focus-toggle" class="focus-button hidden" type="button">Focus on report</button>
                </div>
              </div>
              <div class="score-help">Clarity score shows how quickly your story lands on a first read.</div>
              <div class="report-accent-line"></div>
              <div class="results-bridge">
                <div class="bridge-heading">What this means</div>
                <div id="results-subtitle">
                  Heres whats clear, whats buried, and where your story can hit harder.
                </div>
              </div>
              <div id="results-summary" class="results-summary accent-card-primary empty stack-section stack-accent-line">
                Your recruiters take will appear here.
              </div>
              <div id="status-bar" class="status-bar"></div>
            </div>

            <div id="results-skeleton" class="results-skeleton hidden" aria-hidden="true">
              <div class="skeleton-line wide"></div>
              <div class="skeleton-line"></div>
              <div class="skeleton-line"></div>
              <div class="skeleton-divider"></div>
              <div class="skeleton-line wide"></div>
              <div class="skeleton-line mid"></div>
              <div class="skeleton-line short"></div>
            </div>

            <div
              id="results-body"
              class="empty stack stack-accent-line"
              role="region"
              aria-label="Resume feedback results"
            >
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Whats working</div>
                <div class="stack-subline">Strengths that are already clear on first read and help your story land as intended.</div>
              </div>
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Whats harder to see</div>
                <div class="stack-subline">Surfaces buried impact, unclear outcomes, and work that isnt landing clearly yet.</div>
              </div>
              <div class="stack-section stack-accent-line">
                <div class="stack-heading">Stronger phrasing you can use</div>
                <div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div>
              </div>
              <div class="stack-section stack-accent-line">
              <div class="stack-heading">Next steps</div>
              <div class="stack-subline">Clear, doable actions that build momentum and make your story easier to read.</div>
              </div>
            </div>

            <div id="results-actions-bottom" class="results-actions results-actions-bottom hidden">
              <button id="export-button" class="export-button btn-primary" aria-label="Export PDF">
                 <span>Export PDF</span>
              </button>
              <button id="copy-full-button" class="copy-button btn-primary" aria-label="Copy report with headings">
                 <span>Copy report</span>
              </button>
            </div>

            <div id="ideas-inline" class="ideas-inline hidden stack-section stack-accent-line" aria-label="Missing wins">
              <div class="ideas-text">
                <div class="ideas-kicker stack-heading">Missing wins</div>
                <div class="ideas-subtitle stack-subline">Surfaces buried impact, unclear outcomes, and scope you likely have but didnt express.</div>
              </div>
              <button id="ideas-open" class="ideas-open-link" type="button">Open missing wins </button>
            </div>

            <div id="ideas-modal" class="ideas-modal" aria-hidden="true">
              <div id="ideas-backdrop" class="ideas-backdrop"></div>
              <div class="ideas-sheet" id="ideas-sheet" role="dialog" aria-modal="true" aria-labelledby="ideas-modal-title">
                <div class="ideas-sheet-header accent-card-primary">
                  <div>
                    <div id="ideas-modal-title" class="ideas-sheet-title">Missing wins</div>
                    <div class="ideas-sheet-subtitle">Surfaces buried impact, unclear outcomes, and scope you likely have but didnt express.</div>
                  </div>
                  <div class="ideas-actions">
                    <button id="ideas-refresh" class="ghost-button" type="button">Refresh</button>
                    <button id="ideas-close" class="ghost-button" type="button" aria-label="Close missing wins">Close</button>
                  </div>
                </div>
                <div id="ideas-loading-bar" class="ideas-loading-bar"></div>
                <div id="ideas-status" class="ideas-status" aria-live="polite"></div>
                <div class="ideas-sheet-body">
                  <div id="ideas-body" class="ideas-body empty" aria-live="polite">
                    Ill look for wins you have not written yet or forgot about.
                  </div>
                </div>
              </div>
            </div>

            </div>
          </section>
        </div>
      </main>

      <div id="paywall-backdrop" class="paywall-backdrop" role="dialog" aria-modal="true" aria-labelledby="paywall-title">
        <div class="paywall-card">
          <div class="paywall-title" id="paywall-title">Keep using Resume Studio</div>
          <div class="paywall-subtitle">
            Get unlimited runs and full access to your personalized recruiter report.
          </div>
          <ul class="paywall-list">
            <li>Unlimited resume runs on this browser.</li>
            <li>Access to your full score, summary, and insight stack whenever you need it.</li>
            <li>Future saved reports as they ship.</li>
          </ul>
          <div class="paywall-actions">
            <button id="paywall-upgrade" class="paywall-primary" type="button">Upgrade and keep going</button>
            <button id="paywall-close" class="paywall-secondary" type="button">Not now</button>
          </div>
          <div id="paywall-status" class="paywall-subtitle" aria-live="polite"></div>
        </div>
      </div>

      <div class="creator-section">
        Made with care in Boulder, CO 
      </div>

      <footer class="footer">
        We never store your resume or use it for model training.
      </footer>
    </div>
  </div>

  <script>
  // NOTE: This frontend is intentionally single-file. If you add new pages or modes,
  // consider splitting styles into a shared CSS file and moving JS into a small app.js
  // to reduce risk and keep components reusable.
  const STORAGE_KEY = "rip-main-input-v1";

  const inputEl = document.getElementById("main-input");
  const inputLabelEl = document.getElementById("input-label");
  const runButton = document.getElementById("run-button");
  const statusEl = document.getElementById("status");
  const resultsTitleEl = document.getElementById("results-title");
  const resultsSubtitleEl = document.getElementById("results-subtitle");
  const resultsSummaryEl = document.getElementById("results-summary");
  const resultsBodyEl = document.getElementById("results-body");
  const resultsSkeletonEl = document.getElementById("results-skeleton");
  const reportViewEl = document.getElementById("report-view");
  const reportAccentLineEl = document.querySelector(".report-accent-line");
  const scoreWrapperEl = document.getElementById("score-wrapper");
  const scoreBandsTriggerEl = document.getElementById("score-bands-trigger");
  const scoreBadgeEl = document.getElementById("score-badge");
  const scoreLabelEl = document.getElementById("score-label");
  const scoreShortEl = document.getElementById("score-short");
  const scoreTooltipEl = document.getElementById("score-tooltip");
  const copyFullButtonEl = document.getElementById("copy-full-button");
  const exportButtonEl = document.getElementById("export-button");
  const resultsActionsBottomEl = document.getElementById("results-actions-bottom");
  const reportWrapperEl = document.querySelector(".report-wrapper");
  const dataHandlingInlineEl = document.getElementById("data-handling-inline");
  const dataHandlingPanelEl = document.getElementById("hero-data-card");
  const textareaEl = document.getElementById("main-input");
  const savedIndicatorEl = document.getElementById("saved-indicator");
  const loadingBarEl = document.getElementById("loading-bar");
  const resumeHintEl = document.getElementById("resume-hint");
  const sampleResumeButtonEl = document.getElementById("sample-resume-button");
  const ideasInlineEl = document.getElementById("ideas-inline");
  const ideasOpenEl = document.getElementById("ideas-open");
  const ideasModalEl = document.getElementById("ideas-modal");
  const ideasBackdropEl = document.getElementById("ideas-backdrop");
  const ideasRefreshEl = document.getElementById("ideas-refresh");
  const ideasCloseEl = document.getElementById("ideas-close");
  const ideasBodyEl = document.getElementById("ideas-body");
  const ideasLoadingBarEl = document.getElementById("ideas-loading-bar");
  const ideasStatusEl = document.getElementById("ideas-status");
  const focusToggleEl = document.getElementById("focus-toggle");
  const prefersReducedMotionQuery = window.matchMedia
    ? window.matchMedia("(prefers-reduced-motion: reduce)")
    : null;
  let focusMode = false;
  let hasReportContent = false;
  let hasLoggedPaste = false;
  let lastReportData = null;
  let hasPlayedReportReveal = false;
  let previousBodyOverflow = "";

  function setFocusMode(enabled) {
    focusMode = Boolean(enabled);
    document.body.classList.toggle("focus-mode", focusMode);
    if (focusToggleEl) {
      focusToggleEl.classList.toggle("hidden", !hasReportContent);
      focusToggleEl.textContent = focusMode ? "Back to editor" : "Focus on report";
    }
    if (focusMode) {
      triggerFocusEntrance();
    }
  }
  const paywallBackdropEl = document.getElementById("paywall-backdrop");
  const paywallUpgradeEl = document.getElementById("paywall-upgrade");
  const paywallCloseEl = document.getElementById("paywall-close");
  const paywallStatusEl = document.getElementById("paywall-status");

  const currentMode = "resume";
  let saveTimeout = null;
  let originalButtonText = runButton.textContent;
  let ideasInFlight = false;
  let currentScoreMeta = null;
  let lastScoreValue = null;
  let scoreBandsPinned = false;
  let scoreBandsHovering = false;
  let isSampleRun = false;

  const FREE_RUN_LIMIT = 100;
  const RUN_COUNT_KEY = "rip-free-runs-v1";
  const PAID_KEY = "rip-paid-v1";

  // Minimal event logger for future telemetry wiring
  function logEvent(name, data = {}) {
    console.log("[event]", name, data); // TODO: connect to real telemetry endpoint
  }

  function getRunCount() {
    const raw = localStorage.getItem(RUN_COUNT_KEY);
    const n = Number(raw);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  }

  function incrementRunCount() {
    const next = getRunCount() + 1;
    localStorage.setItem(RUN_COUNT_KEY, String(next));
    return next;
  }

  function isPaid() {
    return localStorage.getItem(PAID_KEY) === "1";
  }

  function markPaid() {
    localStorage.setItem(PAID_KEY, "1");
  }

  function showPaywall(msg = "") {
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "flex";
    }
    if (paywallStatusEl) {
      paywallStatusEl.textContent = msg || "";
    }
  }

  function hidePaywall() {
    if (paywallBackdropEl) {
      paywallBackdropEl.style.display = "none";
    }
    if (paywallStatusEl) {
      paywallStatusEl.textContent = "";
    }
  }

  function prefersReducedMotion() {
    return !!(prefersReducedMotionQuery && prefersReducedMotionQuery.matches);
  }

  (function handleCheckoutParams() {
    const params = new URLSearchParams(window.location.search);
    const status = params.get("checkout");
    if (status === "success") {
      markPaid();
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
    if (status === "cancelled") {
      const clean = window.location.pathname + window.location.hash;
      if (window.history && window.history.replaceState) {
        window.history.replaceState({}, document.title, clean);
      }
    }
  })();

  function autoResizeTextarea() {
    const maxHeight = 340;
    inputEl.style.height = "auto";
    const next = Math.min(inputEl.scrollHeight, maxHeight);
    inputEl.style.height = next + "px";
  }

  function showSavedIndicator() {
    if (!savedIndicatorEl) return;
    savedIndicatorEl.classList.add("visible");
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      savedIndicatorEl.classList.remove("visible");
    }, 1200);
  }

  function loadSavedInput() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        inputEl.value = saved;
        autoResizeTextarea();
        showSavedIndicator();
      }
    } catch (e) {
      console.warn("Could not load saved input", e);
    }
  }

  function updateResumeHintVisibility() {
    if (!resumeHintEl) return;
    const hasText = inputEl.value.trim().length > 0;
    const isFocused = document.activeElement === inputEl;

    if (hasText || isFocused) {
      resumeHintEl.classList.add("hidden");
    } else {
      resumeHintEl.classList.remove("hidden");
    }
  }

  inputEl.addEventListener("input", () => {
    autoResizeTextarea();
    try {
      localStorage.setItem(STORAGE_KEY, inputEl.value);
    } catch (e) {
      console.warn("Could not save input", e);
    }
    showSavedIndicator();
    updateResumeHintVisibility();
    if (!inputEl.value.trim()) {
      resetIdeasSection();
      if (ideasInlineEl) ideasInlineEl.classList.add("hidden");
      closeIdeasModal();
    }
  });

  inputEl.addEventListener("paste", () => {
    if (!hasLoggedPaste) {
      logEvent("resume_pasted");
      hasLoggedPaste = true;
    }
  });

  inputEl.addEventListener("focus", updateResumeHintVisibility);
  inputEl.addEventListener("blur", updateResumeHintVisibility);

  function clearScoreBadge() {
    scoreBadgeEl.textContent = "";
    scoreBadgeEl.className = "score-badge";
    scoreBadgeEl.removeAttribute("aria-label");
    if (scoreLabelEl) scoreLabelEl.textContent = "";
    if (scoreShortEl) scoreShortEl.textContent = "";
    if (scoreTooltipEl) {
      scoreTooltipEl.textContent = "";
      scoreTooltipEl.classList.remove("open");
      scoreTooltipEl.setAttribute("aria-hidden", "true");
    }
    if (scoreWrapperEl) scoreWrapperEl.classList.add("hidden");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "none";
    if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
    currentScoreMeta = null;
    lastScoreValue = null;
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", "false");
  }

  const SCORE_BANDS = [
    {
      id: "not_ready",
      min: 60,
      max: 69,
      label: "Not ready",
      description: "Story is hard to follow. Sections blur together and impact is mostly missing."
    },
    {
      id: "thin_signal",
      min: 70,
      max: 77,
      label: "Thin signal",
      description: "Some good pieces, but the signal is faint. Bullets are vague or light on impact."
    },
    {
      id: "strong_foundation",
      min: 78,
      max: 84,
      label: "Strong foundation",
      description: "Core story is clear. Real wins are present, but not every bullet carries weight."
    },
    {
      id: "high_bar",
      min: 85,
      max: 91,
      label: "High bar",
      description: "Ownership, scope, and results are consistently clear with very little noise."
    },
    {
      id: "rare_air",
      min: 92,
      max: 100,
      label: "Rare air",
      description: "Exceptionally clear and dense signal. Every line earns its place."
    }
  ];

  function getBandIdFromScore(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    const match = SCORE_BANDS.find((band) => clamped >= band.min && clamped <= band.max);
    if (match) return match.id;
    if (clamped < SCORE_BANDS[0].min) return SCORE_BANDS[0].id;
    return SCORE_BANDS[SCORE_BANDS.length - 1].id;
  }

  function getScoreMeta(score) {
    const n = Number.isFinite(Number(score)) ? Math.round(Number(score)) : 0;
    const clamped = Math.min(100, Math.max(0, n));
    if (clamped >= 97) {
      return {
        score: clamped,
        label: "Rare air",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 92) {
      return {
        score: clamped,
        label: "Top-bar ready",
        short: "Exceptionally clear and compelling on first read. Very minor refinements only.",
        long:
          "Exceptionally clear and compelling on first read. Very minor refinements only.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 85) {
      return {
        score: clamped,
        label: "High bar",
        short: "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        long:
          "Strong clarity and signal. Only light tightening needed to make your story land even cleaner.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 78) {
      return {
        score: clamped,
        label: "Strong story",
        short: "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        long:
          "Clear momentum and ownership with a few areas needing sharper framing or impact cues.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 70) {
      return {
        score: clamped,
        label: "Solid foundation",
        short:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        long:
          "Solid elements are here, but the core story still feels muted. Tightening scope and impact will lift the clarity.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 60) {
      return {
        score: clamped,
        label: "Needs clarity",
        short:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        long:
          "Your story is present but not landing clearly yet. A few structural tweaks can quickly strengthen the signal.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    if (clamped >= 50) {
      return {
        score: clamped,
        label: "Thin signal",
        short: "Ownership and outcomes are hard to see.",
        long:
          "Rebuild top bullets with clear role, scope, and before/after changes. Add context before applying.",
        bandId: getBandIdFromScore(clamped)
      };
    }
    return {
      score: clamped,
      label: "Not ready",
      short: "Hard to see role, scope, or results.",
      long:
        "Add structure, roles, and outcomes so there is usable signal. Right now it is not review-ready.",
      bandId: getBandIdFromScore(clamped)
    };
  }

  function applyScoreColor(score) {
    clearScoreBadge();
    if (Number.isNaN(score)) return;
    let cls = "";
    if (score < 50) cls = "score-low";
    else if (score < 70) cls = "score-mid";
    else if (score < 90) cls = "score-good";
    else cls = "score-great";
    scoreBadgeEl.textContent = score + "/100";
    scoreBadgeEl.setAttribute("aria-label", `Score ${score} out of 100`);
    scoreBadgeEl.classList.add("score-visible", cls);
  }

  function renderScoreBandsPanel(scoreMeta = {}) {
    if (!scoreTooltipEl) return;
    const bandId = scoreMeta.bandId || getBandIdFromScore(scoreMeta.score);
    const bandsMarkup = SCORE_BANDS.map((band) => {
      const isActive = band.id === bandId;
      return `
        <div class="score-band-item ${isActive ? "active" : ""}">
          <div class="score-band-header">
            <span class="score-band-range">${band.min} to ${band.max}</span>
            <span class="score-band-label"> ${escapeHtml(band.label)}</span>
            ${isActive ? '<span class="score-band-chip">Your band</span>' : ""}
          </div>
          <div class="score-band-description">${escapeHtml(band.description)}</div>
        </div>
      `;
    }).join("");

    scoreTooltipEl.innerHTML = `
      <div class="score-bands-panel">
        <div class="score-bands-panel-title">How to read this score</div>
        <div class="score-bands-intro">This clarity score is powered by a calibrated model shaped by thousands of real interview cycles. Each band reflects how clearly your story lands on a first read.</div>
        <div class="score-bands-list">${bandsMarkup}</div>
      </div>
    `;
  }

  function updateScoreBandsVisibility() {
    if (!scoreTooltipEl) return;
    const isOpen = (scoreBandsPinned || scoreBandsHovering) && !!currentScoreMeta;
    scoreTooltipEl.classList.toggle("open", isOpen);
    scoreTooltipEl.setAttribute("aria-hidden", isOpen ? "false" : "true");
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.setAttribute("aria-expanded", isOpen ? "true" : "false");
  }

  function triggerScoreGlow() {
    if (!scoreBadgeEl || prefersReducedMotion()) return;
    scoreBadgeEl.classList.remove("score-badge--glow");
    void scoreBadgeEl.offsetWidth;
    scoreBadgeEl.classList.add("score-badge--glow");
    setTimeout(() => {
      scoreBadgeEl.classList.remove("score-badge--glow");
    }, 60);
  }

  function toggleScoreBandsPinned() {
    if (!currentScoreMeta) return;
    scoreBandsPinned = !scoreBandsPinned;
    if (scoreBandsPinned) {
      renderScoreBandsPanel(currentScoreMeta);
    }
    updateScoreBandsVisibility();
  }

  function closeScoreBandsPanel() {
    scoreBandsPinned = false;
    scoreBandsHovering = false;
    updateScoreBandsVisibility();
  }

  function renderScoreMeta(score, modelMeta = {}) {
    const meta = getScoreMeta(score);
    const prevScoreValue = lastScoreValue;
    applyScoreColor(meta.score);
    if (scoreBadgeEl) {
      scoreBadgeEl.classList.remove("score-pill--reveal");
      void scoreBadgeEl.offsetWidth;
      scoreBadgeEl.classList.add("score-pill--reveal");
    }
    if (prevScoreValue !== meta.score) {
      triggerScoreGlow();
    }
    lastScoreValue = meta.score;

    const labelText = (modelMeta.score_label || "").trim() || meta.label;
    const shortText = (modelMeta.score_comment_short || "").trim() || meta.short;
    const longText = (modelMeta.score_comment_long || "").trim() || meta.long;
    currentScoreMeta = {
      ...meta,
      label: labelText,
      short: shortText,
      long: longText
    };
    renderScoreBandsPanel(currentScoreMeta);
    updateScoreBandsVisibility();
    if (scoreBandsTriggerEl) scoreBandsTriggerEl.style.display = "inline";
    if (scoreWrapperEl) scoreWrapperEl.classList.remove("hidden");
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function renderSummary(text) {
    if (!resultsSummaryEl) return;
    const clean = (text || "").trim();
    if (clean) {
      const sentences = clean
        .split(/(?<=[.!?])\s+/)
        .map((s) => s.trim())
        .filter(Boolean);
      const limited = sentences.slice(0, 3);
      const paragraph = limited.join(" ");
      resultsSummaryEl.innerHTML = `
        <div class="stack-heading">How your resume reads</div>
        <div class="stack-subline">A quick read on how your resume actually lands.</div>
        <p class="result-paragraph">${escapeHtml(paragraph || clean)}</p>
      `;
      resultsSummaryEl.classList.remove("empty");
    } else {
      resultsSummaryEl.innerHTML = `
        <div class="stack-heading">How your resume reads</div>
        <div class="stack-subline">A quick read on how your resume actually lands.</div>
        <p class="result-paragraph">Your summary will appear here.</p>
      `;
      resultsSummaryEl.classList.add("empty");
    }
  }

  function applySectionReveal() {
    const elements = [];
    if (resultsSummaryEl) {
      const summaryHeading = resultsSummaryEl.querySelector(".result-heading");
      if (summaryHeading) elements.push(summaryHeading);
    }
    if (resultsBodyEl) {
      const bodyHeadings = resultsBodyEl.querySelectorAll(".result-heading");
      bodyHeadings.forEach((el) => elements.push(el));
    }
    if (!elements.length) return;
    if (prefersReducedMotion()) {
      elements.forEach((el) => {
        el.style.removeProperty("animation-delay");
        el.classList.add("report-section");
      });
      return;
    }
    let delay = 260;
    elements.forEach((el) => {
      el.classList.add("report-section");
      el.style.animationDelay = `${delay}ms`;
      delay += 80;
    });
  }

  function triggerReportReveal() {
    if (!reportViewEl) return;
    applySectionReveal();
    if (!hasPlayedReportReveal) {
      reportViewEl.classList.add("report-container--visible");
      hasPlayedReportReveal = true;
    }
  }

  function triggerFocusEntrance() {
    if (!reportViewEl || prefersReducedMotion()) return;
    reportViewEl.classList.add("report-view--focus-start");
    void reportViewEl.offsetWidth;
    reportViewEl.classList.remove("report-view--focus-start");
  }

  function renderStructuredResults(data) {
    const {
      summary,
      strengths,
      gaps,
      rewrites,
      next_steps: nextSteps,
      score,
      score_label: scoreLabelText,
      score_comment_short: scoreCommentShort,
      score_comment_long: scoreCommentLong,
      suggested_bullets: suggestedBullets,
      missing_wins: missingWins
    } = data || {};
    hasReportContent = true;

    let html = "";

    // score pill and commentary
    if (typeof score === "number") {
      renderScoreMeta(score, {
        score_label: scoreLabelText,
        score_comment_short: scoreCommentShort,
        score_comment_long: scoreCommentLong
      });
    } else {
      clearScoreBadge();
    }

    if (Array.isArray(missingWins) && missingWins.length > 0 && ideasInlineEl) {
      ideasInlineEl.classList.remove("hidden");
    }

    renderSummary(summary);

    // What's Working
    if (Array.isArray(strengths) && strengths.length > 0) {
      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Whats working</div><div class="stack-subline">Strengths that are already clear on first read and help your story land as intended.</div><ul class="result-list">`;
      for (const item of strengths) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul></div>`;
    }

    // Whats harder to see
    if (Array.isArray(gaps) && gaps.length > 0) {
      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Whats harder to see</div><div class="stack-subline">Surfaces buried impact, unclear outcomes, and work that isnt landing clearly yet.</div><ul class="result-list">`;
      for (const item of gaps) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul></div>`;
    }

    // Stronger Phrasing You Can Use
    if (Array.isArray(rewrites) && rewrites.length > 0) {
      const clarityGroup = [];
      const impactGroup = [];
      const fallbackGroup = [];

      for (const r of rewrites) {
        if (!r) continue;
        const label = (r.label || "").toLowerCase();
        if (label.includes("clarity") || label.includes("concise") || label.includes("conciseness") || label.includes("brevity") || label.includes("phrasing")) {
          clarityGroup.push(r);
        } else if (label.includes("impact") || label.includes("scope") || label.includes("ownership")) {
          impactGroup.push(r);
        } else {
          fallbackGroup.push(r);
        }
      }

      while (fallbackGroup.length) {
        const target = clarityGroup.length <= impactGroup.length ? clarityGroup : impactGroup;
        target.push(fallbackGroup.shift());
      }

      const renderRewriteGroup = (groupItems) => {
        let groupHtml = "";
        for (const r of groupItems) {
          if (!r) continue;
          const original = r.original || "";
          const better = r.better || "";
          const enhancementNote = r.enhancement_note || r.enhancementNote || "";

          groupHtml += `<div class="rewrite-block">`;
          groupHtml += `<div class="rewrite-columns">`;

          groupHtml += `<div class="rewrite-column">`;
          if (original) {
            groupHtml += `<div class="rewrite-label">Original</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(original))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `<div class="rewrite-column right">`;
          if (better) {
            groupHtml += `<div class="rewrite-label">Better</div>`;
            groupHtml += `<div class="rewrite-text">${escapeHtml(String(better))}</div>`;
          }
          groupHtml += `</div>`;

          groupHtml += `</div>`;

          if (enhancementNote) {
            groupHtml += `<div class="rewrite-enhancement-note accent-heading">${escapeHtml(String(enhancementNote))}</div>`;
          }

          groupHtml += `</div>`;
        }
        return groupHtml;
      };

      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Stronger phrasing you can use</div><div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div>`;

      if (clarityGroup.length > 0) {
        html += `<div class="rewrite-cluster-heading">Clarity & Conciseness</div>`;
        html += renderRewriteGroup(clarityGroup);
      }

      if (impactGroup.length > 0) {
        html += `<div class="rewrite-cluster-heading">Impact, Scope & Ownership</div>`;
        html += renderRewriteGroup(impactGroup);
      }

      html += `</div>`;
    } else if (Array.isArray(suggestedBullets) && suggestedBullets.length > 0) {
      // Fallback: use suggested_bullets from backend as a simple list
      html += `<div class="stack-section stack-accent-line"><div class="stack-heading">Stronger phrasing you can use</div><div class="stack-subline">Crisp, realistic upgrades that make your accomplishments clearer without changing your voice.</div><ul class="result-list">`;
      for (const bullet of suggestedBullets) {
        if (!bullet) continue;
        html += `<li>${escapeHtml(String(bullet))}</li>`;
      }
      html += `</ul></div>`;
    }

    // Next Steps (override with fixed guidance)
    const fixedNextSteps = [
      "Split multi idea bullets so your role and impact are clearer.",
      "Add numbers or specific outcomes where they strengthen the story.",
      "Highlight your ownership in key achievements so your contribution stands out.",
      "Remember to make your strongest work easy to spot. Most recruiters will make a yes, no, or maybe decision within a few seconds."
    ];
      html += `<div class="stack-section stack-accent-line" data-section="next-steps"><div class="stack-heading">Next steps</div><div class="stack-subline">Clear, doable actions that build momentum and make your story easier to read.</div><ul class="result-list">`;
    for (const step of fixedNextSteps) {
      html += `<li>${escapeHtml(String(step))}</li>`;
    }
    html += `</ul></div>`;

    if (!html) {
      html = "No feedback returned.";
    }

    resultsBodyEl.innerHTML = html;

    // Place Missing Wins inline teaser inside the stack before Next steps
    if (ideasInlineEl) {
      const nextStepsEl = resultsBodyEl.querySelector('[data-section="next-steps"]');
      ideasInlineEl.classList.add("stack-section");
      ideasInlineEl.classList.add("stack-accent-line");
      if (nextStepsEl && nextStepsEl.parentNode === resultsBodyEl) {
        resultsBodyEl.insertBefore(ideasInlineEl, nextStepsEl);
      } else {
        resultsBodyEl.appendChild(ideasInlineEl);
      }
    }
    resultsBodyEl.classList.remove("refreshed");
    void resultsBodyEl.offsetWidth;
    resultsBodyEl.classList.add("refreshed");
    resultsBodyEl.classList.remove("empty");
    resultsBodyEl.classList.add("results-body-better-flash");
    setTimeout(() => resultsBodyEl.classList.remove("results-body-better-flash"), 220);
  }

  if (scoreWrapperEl) {
    scoreWrapperEl.addEventListener("mouseenter", () => {
      if (!currentScoreMeta) return;
      scoreBandsHovering = true;
      renderScoreBandsPanel(currentScoreMeta);
      updateScoreBandsVisibility();
    });
    scoreWrapperEl.addEventListener("mouseleave", () => {
      scoreBandsHovering = false;
      updateScoreBandsVisibility();
    });
  }

  if (scoreBadgeEl) {
    scoreBadgeEl.addEventListener("click", () => {
      toggleScoreBandsPinned();
    });
  }

  if (scoreBandsTriggerEl) {
    scoreBandsTriggerEl.addEventListener("click", (event) => {
      event.preventDefault();
      toggleScoreBandsPinned();
    });
  }

  document.addEventListener("click", (event) => {
    if (
      (scoreTooltipEl && scoreTooltipEl.contains(event.target)) ||
      (scoreWrapperEl && scoreWrapperEl.contains(event.target)) ||
      (scoreBandsTriggerEl && scoreBandsTriggerEl.contains(event.target))
    ) {
      return;
    }
    closeScoreBandsPanel();
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      closeScoreBandsPanel();
    }
  });

  async function startCheckout() {
    if (paywallStatusEl) paywallStatusEl.textContent = "Opening checkout...";
    try {
      const resp = await fetch("/api/create-checkout-session", { method: "POST" });
      const data = await resp.json().catch(() => null);
      if (!resp.ok || !data?.ok || !data?.url) {
        const msg =
          data?.message || "Could not start checkout right now. Try again in a moment.";
        if (paywallStatusEl) paywallStatusEl.textContent = msg;
        return;
      }
      window.location.href = data.url;
    } catch (err) {
      if (paywallStatusEl) {
        paywallStatusEl.textContent =
          "Could not start checkout right now. Try again in a moment.";
      }
    }
  }

  if (paywallUpgradeEl) {
    paywallUpgradeEl.addEventListener("click", () => {
      startCheckout();
    });
  }

  if (paywallCloseEl) {
    paywallCloseEl.addEventListener("click", () => {
      hidePaywall();
      statusEl.textContent = "";
      setStatus("");
    });
  }

  async function runAnalysis() {
    const sampleRun = isSampleRun;
    const text = inputEl.value.trim();
    logEvent("run_clicked", { sample: sampleRun });
    if (!text) {
      const msg = "Paste your resume text so I can actually review it.";
      statusEl.textContent = msg;
      setStatus(msg, "error");
      resultsBodyEl.textContent = "Your feedback will appear here.";
      resultsBodyEl.classList.add("empty");
      resultsBodyEl.classList.remove("results-error");
      renderSummary("");
      if (resultsActionsBottomEl) resultsActionsBottomEl.classList.add("hidden");
      return;
    }

    if (!sampleRun && !isPaid() && getRunCount() >= FREE_RUN_LIMIT) {
      statusEl.textContent = "Youve used your free runs. Upgrade to keep going.";
      setStatus("Youve used your free runs. Upgrade to keep going.", "error");
      showPaywall();
      return;
    }

    if (!focusMode) {
      setFocusMode(false);
    }
    statusEl.textContent = "";
    setStatus("");
      runButton.disabled = true;
      originalButtonText = runButton.textContent;
      runButton.textContent = "Processing...";
      runButton.classList.add("processing");
      loadingBarEl.classList.add("active");
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.remove("hidden");
      }
    resultsBodyEl.classList.remove("results-error");
    resultsBodyEl.classList.remove("empty");
    resultsBodyEl.classList.add("muted");
    clearScoreBadge();
    if (ideasInlineEl) {
      ideasInlineEl.classList.add("hidden");
    }
    resetIdeasSection();

        try {
      const response = await fetch("/api/resume-feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          mode: currentMode,
          text
        })
      });

      // New: read the unified payload from the backend
      const payload = await response.json().catch(() => null);

      const fieldMessages =
        payload?.details?.fieldErrors &&
        Object.values(payload.details.fieldErrors)
          .filter(Boolean)
          .join(" ");

      const isValidationError = payload?.errorCode === "VALIDATION_ERROR";

      // If HTTP is not ok or payload is missing, show a calm error
      if (!response.ok || !payload) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(
            payload?.errorCode,
            payload?.message || "Unexpected server response."
          );
        statusEl.textContent = msg;
        setStatus(msg, "error");

        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
        }
        return;
      }

      // Backend explicitly signaled an error (ok === false)
      if (payload.ok === false) {
        const msg =
          fieldMessages ||
          mapErrorToUserMessage(payload.errorCode, payload.message);
        statusEl.textContent = msg;
        setStatus(msg, "error");
        if (isValidationError) {
          renderSummary(msg);
          resultsBodyEl.textContent = "";
          resultsBodyEl.classList.add("empty");
          resultsBodyEl.classList.remove("results-error");
        } else {
          resultsBodyEl.textContent =
            fieldMessages ||
            "Something went wrong. Try again in a moment.";
          resultsBodyEl.classList.add("results-error");
          resultsBodyEl.classList.remove("empty");
          renderSummary("");
        }
        return;
      }

      // Happy path: payload.data is the validated object from the server
      let structured = null;

      if (payload.data && typeof payload.data === "object") {
        structured = payload.data;
      }

      if (!structured) {
        const msg = "Unexpected server response.";
        statusEl.textContent = msg;
        setStatus(msg, "error");
        resultsBodyEl.textContent = msg;
        resultsBodyEl.classList.add("results-error");
        resultsBodyEl.classList.remove("empty");
        renderSummary("");
        return;
      }

      renderStructuredResults(structured);
      if (reportWrapperEl) {
        reportWrapperEl.style.display = "block";
      }
      lastReportData = structured;
      triggerReportReveal();
      resultsBodyEl.classList.remove("empty");
      resultsBodyEl.classList.remove("results-error");
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      resultsBodyEl.classList.remove("muted");
      if (!isPaid() && !sampleRun) {
        incrementRunCount();
      }
      if (resultsActionsBottomEl) {
        resultsActionsBottomEl.classList.remove("hidden");
      }

      runIdeas({ auto: true, sourceText: text });

      setFocusMode(true);
      const reportCard = document.querySelector(".card-output");
      if (reportCard && typeof reportCard.scrollIntoView === "function") {
        reportCard.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      if (typeof resultsBodyEl.scrollTo === "function") {
        resultsBodyEl.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        resultsBodyEl.scrollTop = 0;
      }

      statusEl.textContent = "";
      setStatus("");
    } catch (err) {
      console.error(err);
      statusEl.textContent =
        "Something went wrong. Try again in a moment.";
      setStatus("Something went wrong. Try again in a moment.", "error");
      resultsBodyEl.textContent =
        "Something went wrong. Try again in a moment.";
      resultsBodyEl.classList.add("results-error");
      resultsBodyEl.classList.remove("empty");
      renderSummary("");
    } finally {
      runButton.disabled = false;
      runButton.textContent = originalButtonText;
      runButton.classList.remove("processing");
      loadingBarEl.classList.remove("active");
      if (resultsSkeletonEl) {
        resultsSkeletonEl.classList.add("hidden");
      }
      resultsBodyEl.classList.remove("muted");
      isSampleRun = false;
    }
  }

  runButton.addEventListener("click", runAnalysis);
  if (focusToggleEl) {
    focusToggleEl.addEventListener("click", () => {
      setFocusMode(!focusMode);
    });
  }

  function buildFullReportText(data) {
    if (!data || typeof data !== "object") return "";
    const lines = [];
    lines.push("Resume Review  Recruiter in Your Pocket");
    if (typeof data.score === "number") {
      const band = data.score_label ? `  ${data.score_label}` : "";
      lines.push(`Score: ${Math.round(data.score)}/100${band}`);
    }
    lines.push("");

    if (data.summary) {
      lines.push("How your resume reads:");
      lines.push("");
      lines.push(data.summary);
      lines.push("");
    }

    if (Array.isArray(data.strengths) && data.strengths.length) {
      lines.push("Whats working:");
      lines.push("");
      data.strengths.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.gaps) && data.gaps.length) {
      lines.push("Whats harder to see:");
      lines.push("");
      data.gaps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.rewrites) && data.rewrites.length) {
      lines.push("Stronger phrasing you can use:");
      lines.push("");
      data.rewrites.forEach((r) => {
        if (!r) return;
        lines.push("Original:");
        lines.push("");
        if (r.original) lines.push(r.original);
        lines.push("");
        lines.push("Better:");
        lines.push("");
        if (r.better) lines.push(r.better);
        if (r.enhancement_note) lines.push(`  ${r.enhancement_note}`);
        lines.push("");
      });
    }

    if (Array.isArray(data.missing_wins) && data.missing_wins.length) {
      lines.push("Missing wins:");
      lines.push("");
      data.missing_wins.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    if (Array.isArray(data.next_steps) && data.next_steps.length) {
      lines.push("Next steps:");
      lines.push("");
      data.next_steps.forEach((item) => lines.push(`- ${item}`));
      lines.push("");
    }

    lines.push("Generated with Recruiter in Your Pocket  recruiterinyourpocket.com");
    return lines.join("\n");
  }

  if (copyFullButtonEl) {
    copyFullButtonEl.addEventListener("click", async () => {
      if (!lastReportData) {
        statusEl.textContent = "Nothing to copy yet.";
        return;
      }
      const text = buildFullReportText(lastReportData);
      if (!text.trim()) {
        statusEl.textContent = "Nothing to copy yet.";
        return;
      }
      try {
        await navigator.clipboard.writeText(text);
        statusEl.textContent = "Report copied.";
      } catch (err) {
        statusEl.textContent = "Couldnt copy the report. Please try again.";
      }
    });
  }

  exportButtonEl.addEventListener("click", async () => {
    const originalExportText = exportButtonEl.textContent;
    exportButtonEl.disabled = true;
    exportButtonEl.textContent = "Preparing PDF...";
    const summaryText = resultsSummaryEl ? resultsSummaryEl.innerText.trim() : "";
    const bodyText = resultsBodyEl ? resultsBodyEl.innerText.trim() : "";
    const text = [summaryText, bodyText].filter(Boolean).join("\n\n");
    if (!text || !lastReportData) {
      statusEl.textContent = "Nothing to export yet.";
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
      return;
    }
    logEvent("report_pdf_export_clicked");

    // Open a placeholder window immediately to keep the user gesture alive
    const downloadWindow = window.open("", "_blank");
    if (downloadWindow) {
      downloadWindow.document.write("<p style='font-family:sans-serif; font-size:14px; padding:16px;'>Preparing PDF...</p>");
    }

    try {
      const generatedOnLocal = new Date().toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
      const resp = await fetch("/api/export-pdf", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          report: {
            ...lastReportData,
            generated_on: generatedOnLocal
          }
        })
      });
      if (!resp.ok) {
        statusEl.textContent = "Could not export right now. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        if (downloadWindow && !downloadWindow.closed) downloadWindow.close();
        return;
      }
      const blob = await resp.blob();
      if (!blob || blob.size === 0) {
        statusEl.textContent = "Could not export right now. Try again.";
        exportButtonEl.disabled = false;
        exportButtonEl.textContent = originalExportText;
        if (downloadWindow && !downloadWindow.closed) downloadWindow.close();
        return;
      }
      const reader = new FileReader();
      reader.onloadend = () => {
        const dataUrl = reader.result;
        if (downloadWindow && !downloadWindow.closed) {
          downloadWindow.location.href = dataUrl;
          downloadWindow.focus();
        } else {
          const a = document.createElement("a");
          a.href = dataUrl;
          a.target = "_blank";
          a.rel = "noopener";
          a.download = "resume-review.pdf";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
      };
      reader.readAsDataURL(blob);
      statusEl.textContent = "Exported PDF.";
    } catch (err) {
      statusEl.textContent = "Could not export right now. Try again.";
      if (downloadWindow && !downloadWindow.closed) downloadWindow.close();
    } finally {
      exportButtonEl.disabled = false;
      exportButtonEl.textContent = originalExportText;
    }
  });

  inputEl.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
      e.preventDefault();
      runAnalysis();
    }
  });

  async function runIdeas(options = {}) {
    const { auto = false, sourceText } = options;
    const text = (sourceText || inputEl.value || "").trim();
    if (!text) {
      if (!auto) {
        setIdeasStatus("Add your resume first.", "error");
      }
      return;
    }

    if (ideasInFlight) return;
    ideasInFlight = true;

    const originalIdeasButtonText = ideasRefreshEl ? ideasRefreshEl.textContent : "";

    if (ideasRefreshEl) {
      ideasRefreshEl.disabled = true;
      ideasRefreshEl.textContent = auto ? "Refreshing..." : "Pulling questions...";
    }
    setIdeasStatus("Pulling new questions...");
    setIdeasLoading(true);
    if (ideasBodyEl) {
      ideasBodyEl.classList.remove("results-error");
    }

    try {
      const response = await fetch("/api/resume-ideas", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ text })
      });

      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok === false) {
        const message =
          payload?.message || "There was an error generating ideas. Please try again.";
        if (ideasBodyEl) {
          ideasBodyEl.textContent = message;
          ideasBodyEl.classList.add("results-error");
          ideasBodyEl.classList.remove("empty");
        }
        setIdeasStatus(message, "error");
        return;
      }

      const structured = payload.data || payload;
      renderIdeas(structured);
      setIdeasStatus("Questions ready.");
      setTimeout(() => setIdeasStatus(""), 1600);
    } catch (err) {
      console.error(err);
      if (ideasBodyEl) {
        ideasBodyEl.textContent =
          "Something unexpected glitched. Try again in a moment.";
        ideasBodyEl.classList.add("results-error");
        ideasBodyEl.classList.remove("empty");
      }
      setIdeasStatus("Couldnt load questions. Try again.", "error");
    } finally {
      ideasInFlight = false;
      if (ideasRefreshEl) {
        ideasRefreshEl.disabled = false;
        ideasRefreshEl.textContent = originalIdeasButtonText || "Refresh";
      }
      setIdeasLoading(false);
    }
  }

  if (ideasOpenEl) {
    ideasOpenEl.addEventListener("click", () => {
      openIdeasModal();
      if (!ideasBodyEl || ideasBodyEl.classList.contains("empty")) {
        runIdeas({ auto: false });
      }
    });
  }

  if (ideasRefreshEl) {
    ideasRefreshEl.addEventListener("click", () => {
      runIdeas({ auto: false });
    });
  }

  if (ideasCloseEl) {
    ideasCloseEl.addEventListener("click", closeIdeasModal);
  }

  if (ideasBackdropEl) {
    ideasBackdropEl.addEventListener("click", closeIdeasModal);
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeIdeasModal();
    }
  });

  function hideDataPanel() {
    if (dataHandlingPanelEl && !dataHandlingPanelEl.classList.contains("hidden")) {
      dataHandlingPanelEl.classList.add("hidden");
      if (dataHandlingInlineEl) dataHandlingInlineEl.setAttribute("aria-expanded", "false");
    }
  }

  const SAMPLE_RESUME_TEXT = `Jane Doe
Senior Product Manager

Summary
Senior product manager with 7+ years of experience shipping consumer and B2B features in fast moving environments. Known for turning vague problems into clear roadmaps and coordinated launches.

Experience
Stripe  Senior Product Manager (2021Present)
- Led cross functional team of engineers, designers, and data scientists to launch a new onboarding flow for small businesses.
- Simplified KYC steps and reduced drop off, increasing completed sign ups by 18% across key markets.
- Built a simple metrics framework so leadership could see impact weekly.

Google  Product Manager (20172021)
- Owned a set of growth experiments for a core collaboration product with tens of millions of users.
- Partnered with UX research and engineering to test new sharing flows that improved active usage by 9%.
- Drove roadmap, specs, and cross team communication for launches across three regions.

Education
BA, Economics
University of Washington

Skills
Product discovery, experimentation, roadmapping, stakeholder communication, SQL, basic Python, Figma`;

  if (dataHandlingInlineEl && dataHandlingPanelEl) {
    dataHandlingInlineEl.addEventListener("click", (event) => {
      event.preventDefault();
      const isHidden = dataHandlingPanelEl.classList.contains("hidden");
      if (isHidden) {
        dataHandlingPanelEl.classList.remove("hidden");
        dataHandlingInlineEl.setAttribute("aria-expanded", "true");
      } else {
        hideDataPanel();
      }
    });
  }

  document.addEventListener("click", (event) => {
    const target = event.target;
    if (!dataHandlingPanelEl || !dataHandlingInlineEl) return;
    if (
      dataHandlingPanelEl.contains(target) ||
      dataHandlingInlineEl.contains(target)
    ) {
      return;
    }
    hideDataPanel();
  });

  if (sampleResumeButtonEl) {
    sampleResumeButtonEl.addEventListener("click", () => {
      if (!inputEl) return;
      isSampleRun = true;
      inputEl.value = SAMPLE_RESUME_TEXT;
      saveInput(inputEl.value);
      autoResizeTextarea();
      updateResumeHintVisibility();
      showSavedIndicator();
    });
  }

  // Backdrop click should not scroll page when modal hidden
  if (ideasModalEl) {
    ideasModalEl.addEventListener("click", (e) => {
      if (e.target === ideasModalEl) {
        closeIdeasModal();
      }
    });
  }
function mapErrorToUserMessage(errorCode, fallbackMessage) {
  switch (errorCode) {
    case "VALIDATION_ERROR":
      return "I need a bit more from you before I can give real feedback. Check what you pasted and try again.";
    case "OPENAI_TIMEOUT":
      return "The model took too long to finish this pass. Try again in a moment.";
    case "OPENAI_NETWORK_ERROR":
      return "There was a small network hiccup. Try again and it should go through.";
    case "OPENAI_HTTP_ERROR":
      return "The model had trouble finishing your review. Try once more.";
    case "OPENAI_RESPONSE_PARSE_ERROR":
    case "OPENAI_RESPONSE_SHAPE_INVALID":
    case "OPENAI_RESPONSE_NOT_JSON":
      return "The model replied in a format I could not read cleanly. Run it again and it should come back sharper.";
    default:
      return (
        fallbackMessage ||
        "Something on my side glitched while reading your resume. Try once more."
      );
  }
}

  function setStatus(message, variant = "info") {
    const el = document.getElementById("status-bar");
    if (!el) return;
    el.textContent = message || "";
    el.classList.remove("status-info", "status-error");
    if (message) {
      el.classList.add(variant === "error" ? "status-error" : "status-info");
    }
  }

  function resetIdeasSection() {
    setIdeasStatus("");
    if (!ideasBodyEl) return;
    ideasBodyEl.innerHTML =
      "Ill look for wins you have not written yet or forgot about.";
    ideasBodyEl.classList.add("empty");
    ideasBodyEl.classList.remove("results-error");
    if (ideasModalEl) {
      ideasModalEl.classList.remove("visible");
      ideasModalEl.setAttribute("aria-hidden", "true");
    }
  }

  function setIdeasStatus(message, variant = "info") {
    if (!ideasStatusEl) return;
    ideasStatusEl.textContent = message || "";
    ideasStatusEl.classList.toggle("error", variant === "error" && !!message);
  }

  function openIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.add("visible");
    ideasModalEl.setAttribute("aria-hidden", "false");
    previousBodyOverflow = document.body.style.overflow || "";
    document.body.style.overflow = "hidden";
    const ideasSheetEl = document.getElementById("ideas-sheet");
    if (ideasSheetEl && typeof ideasSheetEl.scrollIntoView === "function") {
      ideasSheetEl.scrollIntoView({
        behavior: prefersReducedMotion() ? "auto" : "smooth",
        block: "center"
      });
    }
  }

  function closeIdeasModal() {
    if (!ideasModalEl) return;
    ideasModalEl.classList.remove("visible");
    ideasModalEl.setAttribute("aria-hidden", "true");
    document.body.style.overflow = previousBodyOverflow;
  }

  function setIdeasLoading(isLoading) {
    if (!ideasLoadingBarEl) return;
    if (isLoading) {
      ideasLoadingBarEl.style.opacity = "1";
      ideasLoadingBarEl.style.animation = "loadingSlide 1.2s linear infinite";
      ideasLoadingBarEl.classList.add("active");
    } else {
      ideasLoadingBarEl.style.opacity = "0";
      ideasLoadingBarEl.style.animation = "none";
      ideasLoadingBarEl.classList.remove("active");
    }
  }

  function renderIdeas(data) {
    if (!ideasBodyEl) return;
    const { questions, notes, how_to_use: howToUse } = data || {};
    let html = "";

    if (Array.isArray(questions) && questions.length > 0) {
      const limited = questions.slice(0, 3);
      html += `<div class="ideas-section-card"><div class="ideas-section-title">Questions worth answering</div><div class="ideas-section-subline">Use these to surface wins your resume isnt showing yet.</div><ul class="ideas-list">`;
      for (const q of limited) {
        html += `<li>${escapeHtml(String(q))}</li>`;
      }
      html += `</ul></div>`;
    }

    html += `<div class="ideas-section-card"><div class="ideas-section-title">How to use this</div><p>Pick one question and jot down what actually happened: the situation, the decision you made, what you owned, and what changed.</p></div>`;

    html += `<div class="ideas-section-card"><div class="ideas-section-title">Turn it into a bullet</div><p>Use: verb + what you owned + the outcome (ideally with a number). Skip it if its already covered in your resume.</p></div>`;

    ideasBodyEl.innerHTML = html || "";
    ideasBodyEl.classList.remove("empty");
    if (ideasInlineEl) ideasInlineEl.classList.remove("hidden");
    if (focusToggleEl) focusToggleEl.classList.remove("hidden");
    }


    (function init() {
      loadSavedInput();
      autoResizeTextarea();
      updateResumeHintVisibility();
      renderSummary("");
    })();
</script>

</body>
</html>
