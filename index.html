<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recruiter in Your Pocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-deep: #020617;
      --bg-elevated: #020818;
      --bg-card: #020818;
      --border-subtle: rgba(148, 163, 184, 0.18);
      --border-strong: rgba(51, 65, 85, 0.9);
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.18);
      --accent-strong: #2563eb;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-muted: #6b7280;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #020617 0, #020617 40%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px 32px;
      font-size: 14px;
      line-height: 1.6;
    }

    .page {
      width: 100%;
      max-width: 1120px;
      border-radius: 28px;
      border: 1px solid rgba(15, 23, 42, 0.95);
      background:
        radial-gradient(120% 160% at top left, #020617 0, #020617 40%, #000 100%);
      box-shadow:
        0 28px 80px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.95);
      padding: 18px 20px 26px;
      position: relative;
      overflow: hidden;
    }

    .page::before {
      content: "";
      position: absolute;
      inset: -60%;
      background:
        radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.08), transparent 60%);
      opacity: 0.8;
      pointer-events: none;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .page {
        padding: 16px 14px 22px;
        border-radius: 22px;
      }
    }

    /* Top bar */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      gap: 12px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .brand-mark {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, #bfdbfe 0, #60a5fa 24%, #1d4ed8 60%);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 1),
        0 0 18px rgba(37, 99, 235, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .brand-mark::after {
      content: "R";
      font-size: 11px;
      font-weight: 700;
      color: #020617;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .brand-name {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #cbd5f5;
    }

    .version-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      font-size: 11px;
      color: var(--text-soft);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    @media (max-width: 600px) {
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Hero */

    .hero {
      margin-bottom: 18px;
      padding: 10px 4px 8px;
    }

    .hero-title {
      font-size: 30px;
      letter-spacing: -0.03em;
      color: #f9fafb;
      font-weight: 720;
      line-height: 1.15;
      margin-bottom: 6px;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-soft);
      max-width: 540px;
      line-height: 1.6;
    }

    .hero-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 20px;
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.96);
    }

    .hero-pill span:first-child {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: var(--text-soft);
    }

    .hero-cred {
      font-size: 13px;
      color: rgba(156, 163, 175, 0.8);
      max-width: 580px;
      margin-top: 14px;
      line-height: 1.5;
    }

    @media (max-width: 600px) {
      .hero-title {
        font-size: 24px;
      }
      .hero-subtitle {
        font-size: 13px;
      }
    }

    /* Main tool area */

    .tool-layout {
      margin-top: 4px;
      display: grid;
      grid-template-columns: minmax(0, 1.02fr) minmax(0, 1.05fr);
      gap: 20px;
    }

    @media (max-width: 860px) {
      .tool-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      background:
        linear-gradient(
          150deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(11, 18, 35, 0.98) 50%,
          rgba(3, 7, 18, 1) 100%
        );
      border-radius: 18px;
      border: 1px solid var(--border-strong);
      padding: 18px 16px 18px;
      box-shadow:
        0 18px 48px rgba(0, 0, 0, 0.72),
        0 0 0 1px rgba(15, 23, 42, 0.96);
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.04);
      pointer-events: none;
    }

    .card-input {
      background:
        radial-gradient(circle at top left, rgba(37, 99, 235, 0.12), transparent 60%),
        linear-gradient(
          150deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(15, 23, 42, 0.98) 40%,
          rgba(3, 7, 18, 1) 100%
        );
    }

    .card-output {
      background:
        radial-gradient(circle at top right, rgba(37, 99, 235, 0.12), transparent 60%),
        linear-gradient(
          155deg,
          rgba(15, 23, 42, 0.96) 0%,
          rgba(11, 15, 30, 0.98) 40%,
          rgba(3, 7, 18, 1) 100%
        );
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      color: #f9fafb;
    }

    .mode-pill {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(30, 64, 175, 0.9);
      color: #bfdbfe;
      background:
        radial-gradient(circle at top, rgba(37, 99, 235, 0.22), rgba(15, 23, 42, 0.96));
      white-space: nowrap;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    textarea {
      width: 100%;
      min-height: 240px;
      max-height: 340px;
      overflow-y: auto;
      padding: 12px 12px 12px;
      font-size: 14px;
      color: #f9fafb;
      border-radius: 14px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background:
        radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(2, 6, 23, 0.98));
      resize: none;
      margin-bottom: 8px;
      line-height: 1.55;
    }

    textarea::placeholder {
      color: var(--text-muted);
    }

    .input-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-bottom: 12px;
      color: var(--text-muted);
    }

    .saved-indicator {
      color: #22c55e;
      opacity: 0;
      transition: opacity 0.25s ease-out;
    }

    .saved-indicator.visible {
      opacity: 1;
    }

    .mode-label {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .mode-buttons {
      position: relative;
      display: inline-flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 4px;
      padding-bottom: 4px;
    }

    @media (max-width: 600px) {
      .mode-buttons {
        gap: 6px;
      }
    }

    .mode-button {
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      font-size: 12px;
      cursor: pointer;
      transition:
        background 0.18s ease-out,
        border-color 0.18s ease-out,
        color 0.18s ease-out;
    }

    .mode-button.active {
      background:
        radial-gradient(circle at top, #3b82f6, #2563eb);
      border-color: #3b82f6;
      color: #f9fafb;
      transform: translateY(-0.5px);
    }

    .mode-button.disabled-mode {
      opacity: 0.55;
      cursor: default;
      background: rgba(15, 23, 42, 0.9);
      border-color: #111827;
    }

    .mode-indicator {
      position: absolute;
      bottom: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(to right, #3b82f6, #2563eb);
      transition: width 0.18s ease-out, transform 0.18s ease-out;
    }

    .coming-soon-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      margin-bottom: 10px;
    }

    .run-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
    }

    .run-button {
      width: 100%;
      padding: 11px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(to bottom, var(--accent), var(--accent-strong));
      color: #f9fafb;
      font-weight: 600;
      box-shadow:
        0 14px 35px rgba(37, 99, 235, 0.5),
        0 0 0 1px rgba(15, 23, 42, 0.96);
    }

    .run-button:hover:not(:disabled) {
      background: linear-gradient(to bottom, #2563eb, #1d4ed8);
      box-shadow:
        0 18px 40px rgba(37, 99, 235, 0.6),
        0 0 0 1px rgba(15, 23, 42, 0.96);
      transform: translateY(-1px);
    }

    .run-button:disabled {
      opacity: 0.6;
      transform: none;
      cursor: default;
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
      min-height: 18px;
    }

    /* Results */

    .results-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #results-title {
      font-size: 15px;
      margin-bottom: 4px;
      color: #f9fafb;
      font-weight: 600;
    }

    #results-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .score-badge {
      display: none;
      align-items: center;
      justify-content: center;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      color: #f9fafb;
      letter-spacing: 0.03em;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 8px 18px rgba(0, 0, 0, 0.45);
      position: relative;
      overflow: hidden;
      transform: scale(0.9);
      opacity: 0;
      transition:
        transform 0.18s ease-out,
        opacity 0.18s ease-out;
    }

    .score-badge::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.06);
      pointer-events: none;
    }

    .score-visible {
      display: inline-flex;
      opacity: 1;
      transform: scale(1);
    }

    .score-low {
      background: linear-gradient(135deg, #7a1f2b, #a1273a);
    }

    .score-mid {
      background: linear-gradient(135deg, #73572a, #8b6e2d);
    }

    .score-good {
      background: linear-gradient(135deg, #1f3f77, #2563eb);
    }

    .score-great {
      background: linear-gradient(135deg, #1f6b3a, #22c55e);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 10px 22px rgba(34, 197, 94, 0.65);
    }

    #loading-bar {
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #1d4ed8, #3b82f6, #1d4ed8);
      background-size: 200% 100%;
      margin-bottom: 8px;
      opacity: 0;
      transform: scaleX(0.8);
      transform-origin: center;
    }

    #loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.2s linear infinite;
    }

    @keyframes loadingSlide {
      0% { background-position: 0% 0; }
      100% { background-position: 200% 0; }
    }

    #results-body {
      font-size: 13px;
      color: #e2e8f0;
      background:
        radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(3, 7, 18, 0.98));
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      padding: 16px 12px 12px;
      line-height: 1.65;
      max-height: 480px;
      overflow-y: auto;
      white-space: normal;
    }

    #results-body.empty {
      color: var(--text-muted);
    }

    .results-error {
      border-color: rgba(248, 113, 113, 0.7) !important;
      background: rgba(30, 7, 13, 0.96) !important;
      color: #fecaca !important;
    }

    .result-heading {
      font-size: 14px;
      font-weight: 600;
      margin-top: 12px;
      margin-bottom: 4px;
      color: #f9fafb;
    }

    .result-paragraph {
      margin: 2px 0 8px;
    }

    .result-list {
      margin: 4px 0 8px;
      padding-left: 18px;
    }

    .result-list li {
      margin-bottom: 4px;
    }

    .rewrite-label {
      font-weight: 600;
      color: #e2e8f0;
      margin: 4px 0 2px;
    }

    .rewrite-text {
      margin: 0 0 6px;
      padding-left: 8px;
    }

    .empty-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    #results-body:not(.empty) + .empty-hint {
      display: none;
    }

.rewrite-enhancement-note {
  margin-top: 6px;
  font-size: 0.85rem;
  opacity: 0.8;
  font-style: italic;
}

    .copy-button {
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 12px;
      padding: 5px 9px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .copy-button:hover {
      background: rgba(31, 41, 55, 0.98);
    }

    /* Rewrite blocks and section separators */

    .rewrite-block {
      margin-top: 12px;
      padding-top: 10px;
    }

    /* line only between successive rewrite blocks */
    .rewrite-block + .rewrite-block {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
    }

    .result-section {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      padding-top: 12px;
      margin-top: 12px;
    }

    .next-steps-heading {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      padding-top: 12px;
      margin-top: 12px;
    }

    /* Creator line and footer */

    .creator-section {
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      opacity: 0.7;
      margin-top: 48px;
      margin-bottom: 4px;
    }

    .footer {
      margin-top: 0;
      padding-top: 12px;
      border-top: 1px solid rgba(30, 41, 59, 0.85);
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      line-height: 1.55;
    }

    .footer strong {
      color: #cbd5f5;
      font-weight: 500;
    }

    textarea:focus-visible,
    .mode-button:focus-visible,
    .run-button:focus-visible,
    .copy-button:focus-visible {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }

    /* Ghost overlay for textarea */

    .input-wrapper {
      position: relative;
    }

    .resume-hint-overlay {
      position: absolute;
      inset: 12px 14px auto 14px;
      pointer-events: none;
      font-size: 13px;
      line-height: 1.5;
      color: rgba(148, 163, 184, 0.9);
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.97),
        rgba(15, 23, 42, 0.94)
      );
      padding: 6px 8px 8px;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.8);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.55);
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
    }

    .resume-hint-title {
      font-weight: 500;
      color: #e5e7eb;
      margin-bottom: 2px;
    }

    .resume-hint-body {
      font-size: 12px;
      color: rgba(156, 163, 175, 0.9);
    }

    .resume-hint-overlay.hidden {
      opacity: 0;
      transform: translateY(4px);
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="page-inner">
      <header class="top-bar">
        <div class="brand">
          <div class="brand-mark"></div>
          <div class="brand-text">
            <div class="brand-name">Recruiter in your pocket</div>
          </div>
        </div>
        <div class="version-pill">
          <span class="status-dot"></span>
          <span>v0.2 ¬∑ resume mode live</span>
        </div>
      </header>

      <section class="hero">
        <h1 class="hero-title">Your career. Real recruiter insight.</h1>

        <p class="hero-subtitle">
          Inside insight most people simply never get.
        </p>

        <div class="hero-grid">
          <div class="hero-pill">
            <span>1</span><span>Drop your resume in</span>
          </div>
          <div class="hero-pill">
            <span>2</span><span>Get actionable, clear feedback</span>
          </div>
          <div class="hero-pill">
            <span>3</span><span>Give yourself the inside edge</span>
          </div>
        </div>

        <p class="hero-cred">
          Career guidance from former recruiters at Google, Facebook, and OpenAI.
        </p>
      </section>

      <main class="tool-layout">
        <!-- Left column -->
        <section class="card card-input" aria-label="Input panel">
          <div class="card-inner">
            <div class="card-header">
              <h2 class="card-title">Your input</h2>
              <div class="mode-pill" id="mode-pill">Mode ‚Ä¢ Resume feedback</div>
            </div>

            <label for="main-input" id="input-label">
              Drop your full resume below.
            </label>

            <div class="input-wrapper">
              <textarea
                id="main-input"
                placeholder="Paste your full resume, including work history, skills, and education."
              ></textarea>

              <div id="resume-hint" class="resume-hint-overlay">
                <div class="resume-hint-title">Paste your full resume here</div>
                <div class="resume-hint-body">
                  Include job titles, bullets, and education. Plain text is perfect.
                </div>
              </div>
            </div>

            <div class="input-meta-row">
              <div>Saved locally on this device.</div>
              <div id="saved-indicator" class="saved-indicator">Saved</div>
            </div>

            <div class="mode-label">What do you want to work on?</div>
            <div class="mode-buttons" role="tablist" aria-label="Mode selection">
              <button class="mode-button active" data-mode="resume">Resume</button>
              <button
                class="mode-button disabled-mode"
                data-mode="interview"
                aria-disabled="true"
                tabindex="-1"
              >
                Interview prep
              </button>
              <div id="mode-indicator" class="mode-indicator"></div>
            </div>

            <div class="coming-soon-hint">
              Resume is live now, with interview prep and more guided formats on the way.
            </div>

            <div class="run-row">
              <button id="run-button" class="run-button">Get feedback</button>
              <div id="status" class="status" aria-live="polite" role="status"></div>
            </div>
          </div>
        </section>

        <!-- Right column -->
        <section class="card card-output" aria-label="Results panel">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <h2 id="results-title" class="card-title">Resume feedback</h2>
                <div id="results-subtitle">
                  A recruiter calibrated resume score with insight on what works, what needs improvement, and clearer phrasing you can use.
                </div>
              </div>
              <div class="results-header-right">
                <div id="score-badge" class="score-badge"></div>
                <button id="copy-button" class="copy-button" aria-label="Copy results">
                  ‚ßâ
                </button>
              </div>
            </div>

            <div id="loading-bar"></div>

            <div
              id="results-body"
              class="empty"
              role="region"
              aria-label="Resume feedback results"
            >
              Your feedback will appear here.
            </div>

            <div class="empty-hint">
              Clear sections, specific guidance, and clearer phrasing you can use.
            </div>
          </div>
        </section>
      </main>

      <div class="creator-section">
        Created with care in Boulder, CO ü§ç
      </div>

      <footer class="footer">
        <strong>How this works:</strong>
        Your text is sent to our backend, which calls OpenAI's API to generate guidance.
        This system is tuned using the real screening criteria used by recruiters at Google, Facebook, OpenAI, and other top companies.
        We do not store your resume or responses. Only paste content you are comfortable sharing.
      </footer>
    </div>
  </div>

  <script>
  const STORAGE_KEY = "rip-main-input-v1";

  const inputEl = document.getElementById("main-input");
  const inputLabelEl = document.getElementById("input-label");
  const modeButtons = document.querySelectorAll(".mode-button");
  const runButton = document.getElementById("run-button");
  const statusEl = document.getElementById("status");
  const resultsTitleEl = document.getElementById("results-title");
  const resultsSubtitleEl = document.getElementById("results-subtitle");
  const resultsBodyEl = document.getElementById("results-body");
  const modePillEl = document.getElementById("mode-pill");
  const scoreBadgeEl = document.getElementById("score-badge");
  const copyButtonEl = document.getElementById("copy-button");
  const savedIndicatorEl = document.getElementById("saved-indicator");
  const modeIndicatorEl = document.getElementById("mode-indicator");
  const loadingBarEl = document.getElementById("loading-bar");
  const resumeHintEl = document.getElementById("resume-hint");

  let currentMode = "resume";
  let saveTimeout = null;
  let originalButtonText = runButton.textContent;

  function autoResizeTextarea() {
    const maxHeight = 340;
    inputEl.style.height = "auto";
    const next = Math.min(inputEl.scrollHeight, maxHeight);
    inputEl.style.height = next + "px";
  }

  function showSavedIndicator() {
    if (!savedIndicatorEl) return;
    savedIndicatorEl.classList.add("visible");
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
      savedIndicatorEl.classList.remove("visible");
    }, 1200);
  }

  function loadSavedInput() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        inputEl.value = saved;
        autoResizeTextarea();
        showSavedIndicator();
      }
    } catch (e) {
      console.warn("Could not load saved input", e);
    }
  }

  function updateResumeHintVisibility() {
    if (!resumeHintEl) return;
    const hasText = inputEl.value.trim().length > 0;
    const isFocused = document.activeElement === inputEl;

    if (hasText || isFocused) {
      resumeHintEl.classList.add("hidden");
    } else {
      resumeHintEl.classList.remove("hidden");
    }
  }

  inputEl.addEventListener("input", () => {
    autoResizeTextarea();
    try {
      localStorage.setItem(STORAGE_KEY, inputEl.value);
    } catch (e) {
      console.warn("Could not save input", e);
    }
    showSavedIndicator();
    updateResumeHintVisibility();
  });

  inputEl.addEventListener("focus", updateResumeHintVisibility);
  inputEl.addEventListener("blur", updateResumeHintVisibility);

  function positionModeIndicator() {
    const activeBtn = document.querySelector(".mode-button.active");
    if (!activeBtn || !modeIndicatorEl) return;
    const left = activeBtn.offsetLeft;
    const width = activeBtn.offsetWidth;
    modeIndicatorEl.style.width = width + "px";
    modeIndicatorEl.style.transform = "translateX(" + left + "px)";
  }

  window.addEventListener("resize", positionModeIndicator);

  function clearScoreBadge() {
    scoreBadgeEl.textContent = "";
    scoreBadgeEl.className = "score-badge";
  }

  function applyScoreColor(score) {
    clearScoreBadge();
    if (Number.isNaN(score)) return;
    let cls = "";
    if (score < 50) cls = "score-low";
    else if (score < 70) cls = "score-mid";
    else if (score < 90) cls = "score-good";
    else cls = "score-great";
    scoreBadgeEl.textContent = score + "/100";
    scoreBadgeEl.classList.add("score-visible", cls);
  }

  function extractAndApplyScore(text) {
    const match = text.match(/(\d{1,3})\s*\/\s*100/);
    if (!match) {
      clearScoreBadge();
      return;
    }
    const score = parseInt(match[1], 10);
    if (Number.isNaN(score)) {
      clearScoreBadge();
      return;
    }
    applyScoreColor(score);
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function formatResults(text) {
    const lines = text.split("\n");
    let html = "";
    let inList = false;

    function closeList() {
      if (inList) {
        html += "</ul>";
        inList = false;
      }
    }

    for (const raw of lines) {
      const line = raw.trim();
      if (!line) {
        closeList();
        html += '<p class="result-paragraph spacer"></p>';
        continue;
      }

      const headingMatch = line.match(/^(\d+)\.\s+(.*)$/);
      const bulletMatch = line.match(/^[-*‚Ä¢]+\s+(.*)$/);
      const originalMatch = line.match(/^Original:\s*(.*)$/i);
      const betterMatch = line.match(/^Better:\s*(.*)$/i);

      if (headingMatch) {
        closeList();
        html += `<div class="result-heading">${escapeHtml(headingMatch[2])}</div>`;
      } else if (originalMatch) {
        closeList();
        html += `<div class="rewrite-label">Original:</div>`;
        if (originalMatch[1]) {
          html += `<div class="rewrite-text">${escapeHtml(originalMatch[1])}</div>`;
        }
      } else if (betterMatch) {
        closeList();
        html += `<div class="rewrite-label">Better:</div>`;
        if (betterMatch[1]) {
          html += `<div class="rewrite-text">${escapeHtml(betterMatch[1])}</div>`;
        }
      } else if (bulletMatch) {
        if (!inList) {
          html += '<ul class="result-list">';
          inList = true;
        }
        html += `<li>${escapeHtml(bulletMatch[1])}</li>`;
      } else {
        closeList();
        html += `<p class="result-paragraph">${escapeHtml(line)}</p>`;
      }
    }

    closeList();
    return html;
  }

  function renderStructuredResults(data) {
    const {
      summary,
      strengths,
      gaps,
      rewrites,
      next_steps: nextSteps,
      score,
      suggested_bullets: suggestedBullets
    } = data || {};

    let html = "";

    // score pill
    if (typeof score === "number") {
      applyScoreColor(score);
    } else {
      clearScoreBadge();
    }

    // Recruiter's Take
    if (summary && String(summary).trim().length > 0) {
      html += `<div class="result-heading result-section">Recruiter's Take</div>`;
      html += `<p class="result-paragraph">${escapeHtml(String(summary).trim())}</p>`;
    }

    // What's Working
    if (Array.isArray(strengths) && strengths.length > 0) {
      html += `<div class="result-heading result-section">What's Working</div>`;
      html += `<ul class="result-list">`;
      for (const item of strengths) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul>`;
    }

    // What Needs Work
    if (Array.isArray(gaps) && gaps.length > 0) {
      html += `<div class="result-heading result-section">What Needs Work</div>`;
      html += `<ul class="result-list">`;
      for (const item of gaps) {
        if (!item) continue;
        html += `<li>${escapeHtml(String(item))}</li>`;
      }
      html += `</ul>`;
    }

    // Stronger Phrasing You Can Use
    if (Array.isArray(rewrites) && rewrites.length > 0) {
      html += `<div class="result-heading result-section">Stronger Phrasing You Can Use</div>`;

      for (const r of rewrites) {
  if (!r) continue;
  const label = r.label || "";
  const original = r.original || "";
  const better = r.better || "";
  const enhancementNote = r.enhancement_note || r.enhancementNote || "";

  html += `<div class="rewrite-block">`;

  if (label) {
    html += `<p class="result-paragraph"><strong>${escapeHtml(String(label))}</strong></p>`;
  }

  if (original) {
    html += `<div class="rewrite-label">Original</div>`;
    html += `<div class="rewrite-text">${escapeHtml(String(original))}</div>`;
  }

  if (better) {
    html += `<div class="rewrite-label">Better</div>`;
    html += `<div class="rewrite-text">${escapeHtml(String(better))}</div>`;
  }

  if (enhancementNote) {
    html += `<div class="rewrite-enhancement-note">${escapeHtml(String(enhancementNote))}</div>`;
  }

  html += `</div>`;
}

    } else if (Array.isArray(suggestedBullets) && suggestedBullets.length > 0) {
      // Fallback: use suggested_bullets from backend as a simple list
      html += `<div class="result-heading result-section">Stronger Phrasing You Can Use</div>`;
      html += `<ul class="result-list">`;
      for (const bullet of suggestedBullets) {
        if (!bullet) continue;
        html += `<li>${escapeHtml(String(bullet))}</li>`;
      }
      html += `</ul>`;
    }

    // Next Steps
    if (Array.isArray(nextSteps) && nextSteps.length > 0) {
      html += `<div class="result-heading next-steps-heading">Next Steps</div>`;
      html += `<ul class="result-list">`;
      for (const step of nextSteps) {
        if (!step) continue;
        html += `<li>${escapeHtml(String(step))}</li>`;
      }
      html += `</ul>`;
    }

    if (!html) {
      html = "No feedback returned.";
    }

    resultsBodyEl.innerHTML = html;
    resultsBodyEl.classList.remove("empty");
  }

  function setMode(mode) {
    currentMode = mode;
    modeButtons.forEach(btn => {
      const active = btn.dataset.mode === mode;
      btn.classList.toggle("active", active);
    });

    clearScoreBadge();

    if (mode === "resume") {
      resultsTitleEl.textContent = "Resume feedback";
      resultsSubtitleEl.textContent =
        "A recruiter calibrated resume score with insight on what works, what needs improvement, and clearer phrasing you can use.";
      modePillEl.textContent = "Mode ‚Ä¢ Resume feedback";
      if (inputLabelEl) {
        inputLabelEl.textContent = "Drop your full resume below.";
      }
      inputEl.placeholder =
        "Paste your full resume, including work history, skills, and education.";
    } else if (mode === "interview") {
      resultsTitleEl.textContent = "Interview prep";
      resultsSubtitleEl.textContent =
        "How you read now, stories to prepare, and questions to ask.";
      modePillEl.textContent = "Mode ‚Ä¢ Interview prep";
      if (inputLabelEl) {
        inputLabelEl.textContent =
          "Paste the job description and any notes about the interview or the company.";
      }
      inputEl.placeholder =
        "Paste the job description and your resume bullets for this role. You can also add any notes you have.";
    }

    positionModeIndicator();
  }

  modeButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      if (btn.classList.contains("disabled-mode")) {
        statusEl.textContent = "Interview prep is coming soon.";
        return;
      }
      setMode(btn.dataset.mode);
    });
  });

  async function runAnalysis() {
    const text = inputEl.value.trim();
    if (!text) {
      statusEl.textContent = "Add your resume first.";
      return;
    }

    runButton.disabled = true;
    originalButtonText = runButton.textContent;
    runButton.textContent = "Processing...";
    loadingBarEl.classList.add("active");
    resultsBodyEl.classList.remove("results-error");
    resultsBodyEl.classList.remove("empty");
    clearScoreBadge();

    try {
      const response = await fetch("/api/resume-feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
          body: JSON.stringify({
    mode: currentMode,
    text
  })
      });

      let data = null;
      try {
        data = await response.json();
      } catch {
        data = null;
      }

      if (!response.ok) {
        const msg = data?.error || "Unexpected server response.";
        throw new Error(msg);
      }

            // Try to interpret structured JSON first
      let structured = null;

      // Our backend returns { content: "<json string>" }
      if (typeof data?.content === "string") {
        let raw = data.content.trim();

        const fence =
          raw.match(/```json([\s\S]*?)```/) ||
          raw.match(/```([\s\S]*?)```/);

        if (fence && fence[1]) {
          raw = fence[1].trim();
        }

        try {
          structured = JSON.parse(raw);
        } catch (e) {
          console.warn("Failed to parse JSON content, falling back to text.", e);
          structured = null;
        }
      } else if (data && typeof data === "object" && !Array.isArray(data)) {
        // Backend might already have parsed JSON
        structured = data;
      }

      const looksStructured =
        structured &&
        (typeof structured.score === "number" ||
          structured.summary ||
          Array.isArray(structured.strengths) ||
          Array.isArray(structured.gaps) ||
          Array.isArray(structured.rewrites) ||
          Array.isArray(structured.next_steps) ||
          Array.isArray(structured.suggested_bullets));

      if (looksStructured) {
        renderStructuredResults(structured);
      } else if (typeof data?.content === "string") {
        const trimmed = data.content.trim();
        const formatted = formatResults(trimmed);
        resultsBodyEl.innerHTML = formatted || "No feedback returned.";
        resultsBodyEl.classList.remove("empty");
        extractAndApplyScore(trimmed);
      } else {
        resultsBodyEl.textContent = "Unexpected response.";
        resultsBodyEl.classList.remove("empty");
      }


      if (typeof resultsBodyEl.scrollTo === "function") {
        resultsBodyEl.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        resultsBodyEl.scrollTop = 0;
      }

      statusEl.textContent = "Feedback ready. Adjust anything you like and run it again.";
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Something went wrong. Please try again.";
      resultsBodyEl.textContent =
        "There was an error generating your feedback. Please try again.";
      resultsBodyEl.classList.add("results-error");
    } finally {
      runButton.disabled = false;
      runButton.textContent = originalButtonText;
      loadingBarEl.classList.remove("active");
    }
  }

  runButton.addEventListener("click", runAnalysis);

  copyButtonEl.addEventListener("click", async () => {
    const text = resultsBodyEl.innerText.trim();
    if (!text) {
      statusEl.textContent = "Nothing to copy yet.";
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      statusEl.textContent = "Copied.";
    } catch {
      statusEl.textContent = "Could not copy. Please select the text manually.";
    }
  });

  inputEl.addEventListener("keydown", (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
      e.preventDefault();
      runAnalysis();
    }
  });

  (function init() {
    loadSavedInput();
    setMode("resume");
    autoResizeTextarea();
    positionModeIndicator();
    updateResumeHintVisibility();
  })();
</script>

</body>
</html>